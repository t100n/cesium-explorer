function Gamepad(e){this.keybindings=e,this.axes={leftStickX:0,leftStickY:1},this.buttons={throttle:2,brake:3,handbrake:1,camera:0,cruiseControl:8,compass:15,fps:16,pause:9,tiltUp:6,tiltDown:7,lookFront:10,lookBack:11,lookLeft:4,lookRight:5,automatic:12,gearUp:13,gearDown:14},this.viewX=0,this.viewY=0,this.tilt=0,this.steering=0,this.throttle=0,this.brake=0,this.handbrake=0,this.camera=0,this.cruiseControl=0,this.compass=0,this.fps=0,this.automatic=0,this.gearUp=0,this.gearDown=0,this.pause=!1,this.isDown={},this.isUp={},this.isPressed={},this.pollInterval=!1,this.gamepads=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],this.startVibrate=function(){"function"==typeof navigator.mozVibrate?navigator.mozVibrate(50):"function"==typeof navigator.vibrate&&navigator.vibrate(50)},this.stopVibrate=function(){"function"==typeof navigator.mozVibrate?navigator.mozVibrate(0):"function"==typeof navigator.vibrate&&navigator.vibrate(0)},this.poll=function(){this.gamepads=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[];for(var e=0,t=this.gamepads.length;t>e;e++){var i=this.gamepads[e];i&&this.updateControls(i)}},this.buttonPressed=function(e){return"object"==typeof e?e.pressed:e>.5},this.getButtonPressed=function(){this.gamepads=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[];for(var e=0,t=this.gamepads.length;t>e;e++){var i=this.gamepads[e];if(i){for(var s=0;s<i.buttons.length;s++)if(this.buttonPressed(i.buttons[s]))return{type:"button",key:s};for(var a=0;a<i.axes.length;a++)if(0!=parseInt(i.axes[a]))return{type:"axis",key:a}}}return!1},this.updateControls=function(e){this.tilt=0,this.throttle=0,this.brake=0,this.handbrake=0,this.camera=0,this.cruiseControl=0,this.compass=0,this.fps=0,this.automatic=0,this.gearUp=0,this.gearDown=0,this.viewX=0,this.viewY=0;for(var t=0;t<e.buttons.length;t++)if(this.buttonPressed(e.buttons[t])){if(this.isDown[t]=!0,"button"==this.keybindings.gamepad.left.type&&this.keybindings.gamepad.left.key==t&&(this.steering=-1),"button"==this.keybindings.gamepad.right.type&&this.keybindings.gamepad.right.key==t&&(this.steering=1),"button"==this.keybindings.gamepad.throttle.type&&this.keybindings.gamepad.throttle.key==t&&(this.throttle=1),"button"==this.keybindings.gamepad.brake.type&&this.keybindings.gamepad.brake.key==t&&(this.brake=1),"button"==this.keybindings.gamepad.pause.type&&this.keybindings.gamepad.pause.key==t&&this.isUp[t]&&cesiumExplorer.physics)if(cesiumExplorer.physics.pause=this.pause=!this.pause,this.pause){clearInterval(this.pollInterval);var i=this;this.pollInterval=setInterval(function(){i.poll()},50),google.earth.removeEventListener(cesiumExplorer.physics.ge,"frameend",$bind(cesiumExplorer.physics,cesiumExplorer.physics.update)),window.audioMonkey.stopAll()}else clearInterval(this.pollInterval),cesiumExplorer.game.lastUpdate=Date.now(),google.earth.addEventListener(cesiumExplorer.physics.ge,"frameend",$bind(cesiumExplorer.physics,cesiumExplorer.physics.update));"button"==this.keybindings.gamepad.handbrake.type&&this.keybindings.gamepad.handbrake.key==t&&(this.handbrake=1),"button"==this.keybindings.gamepad.camera.type&&this.keybindings.gamepad.camera.key==t&&(this.camera=1),"button"==this.keybindings.gamepad.cruiseControl.type&&this.keybindings.gamepad.cruiseControl.key==t&&(this.cruiseControl=1),"button"==this.keybindings.gamepad.compass.type&&this.keybindings.gamepad.compass.key==t&&(this.compass=1),"button"==this.keybindings.gamepad.fps.type&&this.keybindings.gamepad.fps.key==t&&(this.fps=1),"button"==this.keybindings.gamepad.automatic.type&&this.keybindings.gamepad.automatic.key==t&&(this.automatic=1),"button"==this.keybindings.gamepad.gearUp.type&&this.keybindings.gamepad.gearUp.key==t&&(this.gearUp=1),"button"==this.keybindings.gamepad.gearDown.type&&this.keybindings.gamepad.gearDown.key==t&&(this.gearDown=1),"button"==this.keybindings.gamepad.lookLeft.type&&this.keybindings.gamepad.lookLeft.key==t&&(this.viewX=-1),"button"==this.keybindings.gamepad.lookRight.type&&this.keybindings.gamepad.lookRight.key==t&&(this.viewX=1),"button"==this.keybindings.gamepad.lookBack.type&&this.keybindings.gamepad.lookBack.key==t&&(this.viewY=-1),"button"==this.keybindings.gamepad.lookFront.type&&this.keybindings.gamepad.lookFront.key==t&&(this.viewY=1),"button"==this.keybindings.gamepad.up.type&&this.keybindings.gamepad.up.key==t&&(this.tilt=-1),"button"==this.keybindings.gamepad.down.type&&this.keybindings.gamepad.down.key==t&&(this.tilt=1),this.isUp[t]=!1}else this.isUp[t]=!0;for(var s=0;s<e.axes.length;s++){if("axis"==this.keybindings.gamepad.left.type&&this.keybindings.gamepad.left.key==s&&(this.steering=e.axes[s]),"axis"==this.keybindings.gamepad.right.type&&this.keybindings.gamepad.right.key==s&&(this.steering=e.axes[s]),"axis"==this.keybindings.gamepad.throttle.type&&this.keybindings.gamepad.throttle.key==s&&(this.throttle=e.axes[s]),"axis"==this.keybindings.gamepad.brake.type&&this.keybindings.gamepad.brake.key==s&&(this.brake=e.axes[s]),"axis"==this.keybindings.gamepad.pause.type&&this.keybindings.gamepad.pause.key==s&&parseInt(Math.abs(e.axes[s]))>0&&cesiumExplorer.physics)if(cesiumExplorer.physics.pause=this.pause=!this.pause,this.pause){clearInterval(this.pollInterval);var i=this;this.pollInterval=setInterval(function(){i.poll()},50),google.earth.removeEventListener(cesiumExplorer.physics.ge,"frameend",$bind(cesiumExplorer.physics,cesiumExplorer.physics.update)),window.audioMonkey.stopAll()}else clearInterval(this.pollInterval),cesiumExplorer.game.lastUpdate=Date.now(),google.earth.addEventListener(cesiumExplorer.physics.ge,"frameend",$bind(cesiumExplorer.physics,cesiumExplorer.physics.update));"axis"==this.keybindings.gamepad.handbrake.type&&this.keybindings.gamepad.handbrake.key==s&&(this.handbrake=e.axes[s]),"axis"==this.keybindings.gamepad.camera.type&&this.keybindings.gamepad.camera.key==s&&(this.camera=e.axes[s]),"axis"==this.keybindings.gamepad.cruiseControl.type&&this.keybindings.gamepad.cruiseControl.key==s&&(this.cruiseControl=e.axes[s]),"axis"==this.keybindings.gamepad.compass.type&&this.keybindings.gamepad.compass.key==s&&(this.compass=e.axes[s]),"axis"==this.keybindings.gamepad.fps.type&&this.keybindings.gamepad.fps.key==s&&(this.fps=e.axes[s]),"axis"==this.keybindings.gamepad.automatic.type&&this.keybindings.gamepad.automatic.key==s&&(this.automatic=e.axes[s]),"axis"==this.keybindings.gamepad.gearUp.type&&this.keybindings.gamepad.gearUp.key==s&&(this.gearUp=e.axes[s]),"axis"==this.keybindings.gamepad.gearDown.type&&this.keybindings.gamepad.gearDown.key==s&&(this.gearDown=e.axes[s]),"axis"==this.keybindings.gamepad.lookLeft.type&&this.keybindings.gamepad.lookLeft.key==s&&(this.viewX=e.axes[s]),"axis"==this.keybindings.gamepad.lookRight.type&&this.keybindings.gamepad.lookRight.key==s&&(this.viewX=e.axes[s]),"axis"==this.keybindings.gamepad.lookBack.type&&this.keybindings.gamepad.lookBack.key==s&&(this.viewY=e.axes[s]),"axis"==this.keybindings.gamepad.lookFront.type&&this.keybindings.gamepad.lookFront.key==s&&(this.viewY=e.axes[s]),"axis"==this.keybindings.gamepad.up.type&&this.keybindings.gamepad.up.key==s&&(this.tilt=e.axes[s]),"axis"==this.keybindings.gamepad.down.type&&this.keybindings.gamepad.down.key==s&&(this.tilt=e.axes[s])}},this.getLeftStickX=function(){return this.steering},this.getLeftTilt=function(){return parseInt(this.tilt)},this.getThrottle=function(){return this.throttle},this.getBrake=function(){return this.brake},this.getPause=function(){return this.pause},this.getHandbrake=function(){return this.handbrake},this.getCamera=function(){return this.camera},this.getCruiseControl=function(){return this.cruiseControl},this.getCompass=function(){return this.compass},this.getFps=function(){return this.fps},this.getAutomatic=function(){return this.automatic},this.getGearUp=function(){return this.gearUp},this.getGearDown=function(){return this.gearDown},this.getViewX=function(){return this.viewX},this.getViewY=function(){return this.viewY};var t=this;"ongamepadconnected"in window&&(window.addEventListener("gamepadconnected",function(e){log("info",e),t.gamepads=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[]},!1),window.addEventListener("gamepaddisconnected",function(e){log("info",e)},!1))}