function AudioMonkey(){this["class"]="AudioMonkey",AudioBufferSourceNode.prototype.FINISHED_STATE=3,AudioBufferSourceNode.prototype.PLAYING_STATE=2,AudioBufferSourceNode.prototype.SCHEDULED_STATE=1,AudioBufferSourceNode.prototype.UNSCHEDULED_STATE=0,this.FADE_TIME=1,this.FREQ_MUL=7e3,this.QUAL_MUL=30,this.context=!1,this.manifest={},this.sounds={},this.init=function(){try{this.stopAll(),this.context||(window.AudioContext=window.AudioContext||window.webkitAudioContext,this.context=new AudioContext);for(var s in this.manifest)this.load(s,this.manifest[s])}catch(t){}},this.syncStream=function(s){try{var t=new Uint8Array(s.response);t.indexOf=Array.prototype.indexOf;for(var o=s.sync,e=t;;){if(s.retry++,o=e.indexOf(255,o),-1==o||e[o+1]&!0)break;o++}if(-1!=o){var n=s.response.slice(o);return delete s.response,s.response=null,s.response=n,s.sync=o,!0}}catch(i){log("error",i)}return!1},this.cloneAudioBuffer=function(s){try{for(var t=[],o=0,e=s.numberOfChannels,n=0;e>n;n++)try{t[n]=new Float32Array(s.getChannelData(n)),o++}catch(i){}for(var u=this.context.createBuffer(s.numberOfChannels,s.length,s.sampleRate),n=0;e>n;n++)try{u.getChannelData(n).set(t[n])}catch(i){}return u}catch(i){return log("error",i),!1}},this.decode=function(s,t){var o=this,e=function(){o.syncStream(t)?o.decode(s,t):(o.sounds[s].buffer=o.context.createBuffer(t.response,!1),o.sounds[s].loaded=!0)};o.context.decodeAudioData(t.response,function(t){"undefined"!=typeof o.sounds[s]&&(o.sounds[s].buffer=t,o.sounds[s].loaded=!0)},e)},this.stopAll=function(){for(var s in this.sounds)this.stop(s)},this.pauseAll=function(){for(var s in this.sounds)try{if(this.sounds[s].pausedAt=Date.now(),"undefined"==typeof this.sounds[s]||!this.sounds[s].loaded||!this.sounds[s].sound||this.sounds[s].sound&&this.sounds[s].sound.playbackState&&this.sounds[s].sound.playbackState==AudioBufferSourceNode.FINISHED_STATE)continue;this.sounds[s].sound.stop||(this.sounds[s].sound.stop=this.sounds[s].sound.noteOff);try{this.sounds[s].sound.stop(0)}catch(t){}"undefined"==typeof this.sounds[s].playbackState&&(this.sounds[s].playbackState=AudioBufferSourceNode.FINISHED_STATE)}catch(t){log("error",t)}},this.resumeAll=function(){for(var s in this.sounds)this.play(s)},this.add=function(s,t){this.manifest[s]=t},this.remove=function(s){try{delete this.manifest[s],this.stop(s),"undefined"!=typeof this.sounds[s]&&(this.sounds[s].sound=null,this.sounds[s].gain=null,this.sounds[s].buffer=null,delete this.sounds[s])}catch(t){log("error",t)}},this.load=function(s,t){try{var o=this,e=new XMLHttpRequest;e.open("GET",t,!0),e.responseType="arraybuffer",this.sounds[s]={sound:!1,buffer:!1,gain:!1,filter:!1,loaded:!1,fadding:!1,startTime:0,startedAt:!1,pausedAt:!1},e.onload=function(){e.buf=e.response,e.sync=0,e.retry=0,o.decode(s,e)},e.send()}catch(n){log("error",n)}},this.play=function(s,t,o,e,n,i,u,d){try{if("undefined"==typeof this.sounds[s]||!this.sounds[s].loaded||this.sounds[s].fadding)return;if(0==window.globalVolume&&this.sounds[s].sound)return this.stop(s);if(0==window.globalVolume)return;if(this.sounds[s].reversed&&e>0)return this.stop(s);if(this.sounds[s].sound&&this.sounds[s].sound.playbackState==AudioBufferSourceNode.PLAYING_STATE&&!this.sounds[s].reversed){if(n)return;this.stop(s)}var r=this.context.createBufferSource();this.sounds[s].sound=r,this.sounds[s].reversed=!1;var a=this.sounds[s].buffer;0>e&&(a=this.cloneAudioBuffer(this.sounds[s].buffer),Array.prototype.reverse.call(a.getChannelData(0)),Array.prototype.reverse.call(a.getChannelData(1))),r.buffer=a,e&&(r.playbackRate.value=Math.abs(parseFloat(e))),n&&(r.loop=!0,r.loopStart=0,r.loopEnd=this.sounds[s].buffer.duration),n&&i&&(r.loopStart=i),n&&u&&(r.loopEnd=u),r.start||(r.start=r.noteOn),e>0?r.start(this.context.currentTime,t*this.sounds[s].buffer.duration*e+o):r.start(this.context.currentTime,t*this.sounds[s].buffer.duration+o);var h=this.context.createGain();this.sounds[s].gain=h,r.connect(h),h.connect(this.context.destination),"undefined"!=typeof this.sounds[s].gain.gain&&(this.sounds[s].gain.gain.value=d*window.globalVolume),this.sounds[s].startTime=this.context.currentTime,this.sounds[s].startedAt=Date.now(),"undefined"==typeof this.sounds[s].playbackState&&(this.sounds[s].playbackState=AudioBufferSourceNode.PLAYING_STATE)}catch(f){log("error",f)}},this.reverse=function(s){try{if("undefined"==typeof this.sounds[s]||!this.sounds[s].loaded||!this.sounds[s].sound||this.sounds[s].reversed)return;this.sounds[s].reversed=!0;var t=this.cloneAudioBuffer(this.sounds[s].buffer);Array.prototype.reverse.call(t.getChannelData(0)),Array.prototype.reverse.call(t.getChannelData(1)),this.sounds[s].sound.loop=!1,this.sounds[s].sound.buffer=t,this.sounds[s].sound.start(this.context.currentTime,this.sounds[s].sound.loopStart)}catch(o){log("error",o)}},this.rate=function(s,t){try{if("undefined"==typeof this.sounds[s]||!this.sounds[s].loaded||!this.sounds[s].sound||this.sounds[s].reversed)return;"undefined"==typeof this.sounds[s].playbackState&&(this.sounds[s].playbackState=AudioBufferSourceNode.PLAYING_STATE),t&&(this.sounds[s].sound.playbackRate.value=Math.abs(parseFloat(t)))}catch(o){log("error",o)}},this.volume=function(s,t){try{if("undefined"==typeof this.sounds[s]||!this.sounds[s].loaded||!this.sounds[s].sound||this.sounds[s].reversed)return;"undefined"==typeof this.sounds[s].playbackState&&(this.sounds[s].playbackState=AudioBufferSourceNode.PLAYING_STATE),"undefined"!=typeof this.sounds[s].gain.gain&&(this.sounds[s].gain.gain.cancelScheduledValues(this.context.currentTime),this.sounds[s].gain.gain.setValueAtTime(t*window.globalVolume,this.context.currentTime))}catch(o){log("error",o)}},this.changeFrequency=function(s,t){try{var o=40,e=this.context.sampleRate/2,n=Math.log(e/o)/Math.LN2,i=Math.pow(2,n*(t-1));this.sounds[s].filter.frequency.value=e*i}catch(u){log("error",u)}},this.changeQuality=function(s,t){try{this.sounds[s].filter.Q.value=t*this.QUAL_MUL}catch(o){log("error",o)}},this.stop=function(s){try{if("undefined"==typeof this.sounds[s]||!this.sounds[s].loaded||!this.sounds[s].sound||this.sounds[s].sound&&this.sounds[s].sound.playbackState&&this.sounds[s].sound.playbackState==AudioBufferSourceNode.FINISHED_STATE)return;this.sounds[s].sound.stop||(this.sounds[s].sound.stop=this.sounds[s].sound.noteOff);try{this.sounds[s].sound.stop(0),this.sounds[s].sound=!1}catch(t){log("error",t)}"undefined"==typeof this.sounds[s].playbackState&&(this.sounds[s].playbackState=AudioBufferSourceNode.FINISHED_STATE)}catch(t){log("error",t)}},this.fadeOut=function(s){try{if("undefined"==typeof this.sounds[s]||!this.sounds[s].loaded||!this.sounds[s].sound||this.sounds[s].sound&&this.sounds[s].sound.playbackState==AudioBufferSourceNode.FINISHED_STATE)return;var t=this,o=50,e=function(s,n){return 0>n?t.sounds[s].sound.stop():("undefined"!=typeof t.sounds[s].gain.gain&&(t.sounds[s].gain.gain.value=n),void setTimeout(function(){e(s,n-.05)},o))};"undefined"!=typeof t.sounds[s].gain.gain&&e(s,t.sounds[s].gain.gain.value)}catch(n){log("error",n)}},this.fadeIn=function(s){try{if("undefined"==typeof this.sounds[s]||!this.sounds[s].loaded||!this.sounds[s].sound||this.sounds[s].sound&&this.sounds[s].sound.playbackState==AudioBufferSourceNode.FINISHED_STATE)return;this.sounds[s].fadding=!0;var t=this,o=50,e=function(s,n){return n>1?t.sounds[s].fadding=!1:("undefined"!=typeof t.sounds[s].gain.gain&&(t.sounds[s].gain.gain.value=n),void setTimeout(function(){e(s,n+.05)},o))};e(s,0)}catch(n){log("error",n)}},this.crossfade=function(s,t){try{var o=this.sounds[s].sound,e=this.sounds[s].gain,n=this.sounds[s].buffer.duration,i=this.context.currentTime;e.gain.linearRampToValueAtTime(0,i),e.gain.linearRampToValueAtTime(1,i+this.FADE_TIME),o.start(0),e.gain.linearRampToValueAtTime(1,i+n-ctx.FADE_TIME),e.gain.linearRampToValueAtTime(0,i+n);var u=arguments.callee;this.timer=setTimeout(function(){u(t,s)},1e3*(n-this.FADE_TIME))}catch(d){log("error",d)}}}