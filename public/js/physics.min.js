function Placemark(e,i,t,s,a){if(this.scene=e,this.visibility=!0,this.lat=i,this.lng=t,this.alt=0,this.billboards=this.scene.primitives.add(new Cesium.BillboardCollection),this.labels=this.scene.primitives.add(new Cesium.LabelCollection),this.billboards.add({image:a,position:new Cesium.Cartesian3(0,0,0),horizontalOrigin:Cesium.HorizontalOrigin.CENTER}),s){this.labels.add({text:s,position:new Cesium.Cartesian3(0,0,5),horizontalOrigin:Cesium.HorizontalOrigin.CENTER,font:"18px sans-serif"});for(var o=0,n=this.labels.length;n>o;o++){var h=this.labels.get(o);h.position=Cesium.Cartesian3.fromDegrees(t,i,0)}}for(var o=0,n=this.billboards.length;n>o;o++){var h=this.billboards.get(o);h.position=Cesium.Cartesian3.fromDegrees(t,i,0)}this.setLatLng=function(e,i){isNaN(e)&&(e=0),isNaN(i)&&(i=0);for(var t=0,s=this.billboards.length;s>t;t++){var a=this.billboards.get(t);a.position=Cesium.Cartesian3.fromDegrees(i,e,0)}for(var t=0,s=this.labels.length;s>t;t++){var a=this.labels.get(t);a.position=Cesium.Cartesian3.fromDegrees(i,e,0)}this.lat=e,this.lng=i},this.setLatLngAlt=function(e,i,t){isNaN(e)&&(e=0),isNaN(i)&&(i=0),isNaN(t)&&(t=0);for(var s=0,a=this.billboards.length;a>s;s++){var o=this.billboards.get(s);o.position=Cesium.Cartesian3.fromDegrees(i,e,t)}for(var s=0,a=this.labels.length;a>s;s++){var o=this.labels.get(s);o.position=Cesium.Cartesian3.fromDegrees(i,e,t)}this.lat=e,this.lng=i,this.alt=t},this.getVisibility=function(){return this.visibility},this.setVisibility=function(e){if(this.visibility!=e){if(this.billboards)for(var i=0,t=this.billboards.length;t>i;i++){var s=this.billboards.get(i);s.show=e}if(this.labels)for(var i=0,t=this.labels.length;t>i;i++){var s=this.labels.get(i);s.show=e}this.visibility=e}},this.remove=function(){log("info","Placemark","remove"),this.scene.primitives.remove(this.billboards),this.labels&&this.scene.primitives.remove(this.labels)}}function Label(e,i,t,s){this.scene=e,this.visibility=!0,this.lat=i,this.lng=t,this.alt=0,this.labels=this.scene.primitives.add(new Cesium.LabelCollection),this.labels.add({text:s,position:new Cesium.Cartesian3(0,0,5),horizontalOrigin:Cesium.HorizontalOrigin.CENTER,font:"18px sans-serif"});for(var a=0,o=this.labels.length;o>a;a++){var n=this.labels.get(a);n.position=Cesium.Cartesian3.fromDegrees(t,i,0)}this.setName=function(e){for(var i=0,t=this.labels.length;t>i;i++){var s=this.labels.get(i);s.text=e}},this.setLatLng=function(e,i){isNaN(e)&&(e=0),isNaN(i)&&(i=0);for(var t=0,s=this.labels.length;s>t;t++){var a=this.labels.get(t);a.position=Cesium.Cartesian3.fromDegrees(i,e,0)}this.lat=e,this.lng=i},this.setLatLngAlt=function(e,i,t){isNaN(e)&&(e=0),isNaN(i)&&(i=0),isNaN(t)&&(t=0);for(var s=0,a=this.labels.length;a>s;s++){var o=this.labels.get(s);o.position=Cesium.Cartesian3.fromDegrees(i,e,t)}this.lat=e,this.lng=i,this.alt=t},this.getVisibility=function(){return this.visibility},this.setVisibility=function(e){if(this.visibility!=e){if(this.labels)for(var i=0,t=this.labels.length;t>i;i++){var s=this.labels.get(i);s.show=e}this.visibility=e}},this.remove=function(){log("info","Placemark","remove"),this.labels&&(this.scene.primitives.remove(this.labels),this.labels=null)}}function Model(e,i,t,s,a,o,n,h){this.loading=!1,this.loaded=!1,this.scene=e,this.url=i,this.name=t,this.icon=s,this.nameModel=!1,this.spec=h,this.headingOffset=0,this.tiltOffset=0,this.rollOffset=0,this.altitudeOffset=0,this.modelMatrix=!1,this.initialModelMatrix=!1,this.componentAltitude=new vehicle.Suspension(0,0,h?h.mass:0,h?h.spring:0,h?h.damper:0),this.componentTilt=new vehicle.Suspension(0,0,h?h.mass:0,h?h.spring:0,h?h.damper:0),this.componentRoll=new vehicle.Suspension(0,0,h?h.mass:0,h?h.spring:0,h?h.damper:0),this.componentXScale=new vehicle.Scaler(.1,.1),this.componentYScale=new vehicle.Scaler(.1,.1),this.componentZScale=new vehicle.Scaler(.1,.1),this.timer=0,this.retract=!1,this.lat=!1,this.lng=!1,this.alt=!1,this.heading=!1,this.tilt=!1,this.roll=!1,this.scaleX=a?a:1,this.scaleY=o?o:1,this.scaleZ=n?n:1,this.scale=new Cesium.Cartesian3(this.scaleX,this.scaleY,this.scaleZ),this.visibility=!0,this.loaded=!1,this.billboards=this.scene.primitives.add(new Cesium.BillboardCollection),this.labels=this.scene.primitives.add(new Cesium.LabelCollection),this.load=function(e){var t=this;this.loading=!0,this.model=this.scene.primitives.add(Cesium.Model.fromGltf({url:i})),this.model.readyToRender.addEventListener(function(i){t.modelObj=i,e&&(t.model.id=e),t.onFetched()})},this.remove=function(){this.model&&this.scene.primitives.remove(this.model),this.nameModel&&this.scene.primitives.remove(this.nameModel)},this.onFetched=function(){try{this.loaded=!0,this.loading=!1,this.setLocation(this.lat,this.lng,this.alt,this.heading,this.tilt,this.roll)}catch(e){}},this.setLocation=function(e,i,t,s,a,o){if(isNaN(e)&&(e=0),isNaN(i)&&(i=0),isNaN(t)&&(t=0),isNaN(s)&&(s=0),isNaN(a)&&(a=0),isNaN(o)&&(o=0),this.loaded){var n=Cesium.Cartesian3.fromDegrees(i,e,t,this.scene.globe.ellipsoid,new Cesium.Cartesian3),h=Cesium.Transforms.eastNorthUpToFixedFrame(n);if(this.initialModelMatrix){var l=new Cesium.Cartesian3,r=new Cesium.Matrix3;Cesium.Matrix4.getRotation(h,r);var n=Cesium.Cartesian3.fromDegrees(i,e,t,this.scene.globe.ellipsoid,new Cesium.Cartesian3),h=Cesium.Transforms.eastNorthUpToFixedFrame(n);Cesium.Matrix4.getTranslation(h,l);var c=Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Z,-s),d=Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_X,-a),m=Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Y,-o),u=Cesium.Quaternion.multiply(c,d,new Cesium.Quaternion);Cesium.Quaternion.multiply(u,m,u);var p=new Cesium.Matrix3;Cesium.Matrix3.fromQuaternion(u,p),Cesium.Matrix3.multiply(r,p,r),Cesium.Matrix4.fromRotationTranslation(r,l,this.model.modelMatrix)}else{this.model.modelMatrix=this.modelMatrix=h,this.initialModelMatrix=h.clone();var l=new Cesium.Cartesian3,r=new Cesium.Matrix3;Cesium.Matrix4.getRotation(h,r),r=rotCameraMatrix(r,-s,-a,o);var n=Cesium.Cartesian3.fromDegrees(i,e,t,this.scene.globe.ellipsoid,new Cesium.Cartesian3),h=Cesium.Transforms.eastNorthUpToFixedFrame(n);Cesium.Matrix4.getTranslation(h,l),Cesium.Matrix4.fromRotationTranslation(r,l,this.model.modelMatrix)}if(Cesium.Matrix4.multiplyByScale(this.model.modelMatrix,this.scale,this.model.modelMatrix),this.nameModel&&1!=this.nameModel){var v=1;this.spec&&(v+=this.spec.vehiclealt);for(var g=0,f=this.billboards.length;f>g;g++){var y=this.billboards.get(g);y.position=Cesium.Cartesian3.fromDegrees(i,e,t+v)}for(var g=0,f=this.labels.length;f>g;g++){var y=this.labels.get(g);y.position=Cesium.Cartesian3.fromDegrees(i,e,t+v)}}}this.lat=e,this.lng=i,this.alt=t,this.heading=s,this.tilt=a,this.roll=o},this.setLocationRotation=function(e,i,t,s){if(isNaN(e)&&(e=0),isNaN(i)&&(i=0),isNaN(t)&&(t=0),this.loaded){var a=Cesium.Cartesian3.fromDegrees(i,e,t,this.scene.globe.ellipsoid,new Cesium.Cartesian3),o=Cesium.Transforms.eastNorthUpToFixedFrame(a);this.initialModelMatrix||(this.model.modelMatrix=this.modelMatrix=o,this.initialModelMatrix=o.clone());var n=new Cesium.Cartesian3,h=new Cesium.Matrix3.fromQuaternion(s),a=(Cesium.Matrix4.getTranslation(this.model.modelMatrix,new Cesium.Cartesian3),Cesium.Cartesian3.fromDegrees(i,e,t,this.scene.globe.ellipsoid,new Cesium.Cartesian3)),o=Cesium.Transforms.eastNorthUpToFixedFrame(a);Cesium.Matrix4.getTranslation(o,n),Cesium.Matrix4.fromRotationTranslation(h,n,this.model.modelMatrix),Cesium.Matrix4.multiplyByScale(this.model.modelMatrix,this.scale,this.model.modelMatrix),this.lat=e,this.lng=i,this.alt=t,this.nameModel&&1!=this.nameModel&&(this.nameModel.modelMatrix=o)}},this.setName=function(e,i,t,s,a){if(isNaN(e)&&(e=0),isNaN(i)&&(i=0),isNaN(t)&&(t=0),this.loaded){if(1==this.nameModel)return;if(this.nameModel)return;s&&(this.nameModel=1,s&&(this.labels.add({text:s,position:Cesium.Cartesian3.fromDegrees(i,e,t+this.spec.vehiclealt+1),horizontalOrigin:Cesium.HorizontalOrigin.CENTER,font:"18px sans-serif"}),this.nameModel=this.labels))}},this.setScale=function(e,i,t){this.model&&this.loaded&&(this.scaleX!=e||this.scaleY!=i||this.scaleZ!=t)&&(this.model.scale=new Cesium.Cartesian3(e,i,t))},this.getVisibility=function(){return this.visibility},this.setVisibility=function(e){if(this.visibility!=e){if(this.model&&(this.model.show=e),this.billboards)for(var i=0,t=this.billboards.length;t>i;i++){var s=this.billboards.get(i);s.show=e}if(this.labels)for(var i=0,t=this.labels.length;t>i;i++){var s=this.labels.get(i);s.show=e}this.visibility=e}}}function Attitude(e){this.loaded=!1,this.scene=e,this.opacity=1,this.visibility=!0,this.drawOrder=!1,this.sizeX=1/0,this.sizeY=1/0,this.tilt=1/0,this.roll=1/0,this.positionX=1/0,this.positionY=1/0,this.anchorX=1/0,this.anchorY=1/0,this.load=function(){this.overlay=$(document.createElement("div")).appendTo("#map3d-container"),this.overlay.addClass("attitude_indicator"),this.overlay.css({position:"absolute",top:"50px",left:"100px",right:"100px",bottom:"50px"}),this.attitude=new AttitudeIndicator(".attitude_indicator"),this.loaded=!0},this.remove=function(){this.loaded=!1,this.overlay.remove()},this.setPosition=function(e,i,t,s){this.loaded&&(this.overlay.css({position:"absolute",top:s+i+"px",left:t+e+"px"}),this.anchorX=t,this.anchorY=s,this.positionX=e,this.positionY=i)},this.setAttitude=function(e,i){this.loaded&&(this.tilt!=e||this.roll!=i)&&(this.attitude.updateAngles(-i.toFixed(2),-e.toFixed(2)),this.tilt=e,this.roll=i)},this.setSize=function(e,i){this.loaded&&(this.sizeX!=e||this.sizeY!=i)&&(this.overlay.css({width:e+"px",height:i+"px"}),this.sizeX=e,this.sizeY=i)},this.setOpacity=function(e){this.loaded&&this.opacity!=e&&(this.opacity>0&&0==e&&this.setVisibility(!1),0==this.opacity&&e>0&&this.setVisibility(!0),this.opacity=e,this.overlay.css("opacity",e))},this.getVisibility=function(){return this.visibility},this.setVisibility=function(e){this.loaded&&this.visibility!=e&&(this.overlay.css("visibility",e?"visible":"hidden"),this.visibility=e)},this.setDrawOrder=function(e){this.drawOrder!=e&&(this.overlay.css("zIndex",e),this.drawOrder=e)}}function Sprite(e,i,t){this.loaded=!1,this.scene=e,this.url=i,this.spec=t,this.opacity=1,this.visibility=!0,this.drawOrder=!1,this.sizeX=1/0,this.sizeY=1/0,this.rotation=1/0,this.positionX=1/0,this.positionY=1/0,this.anchorX=1/0,this.anchorY=1/0,this.load=function(){this.overlay=$(document.createElement("div")).appendTo("#map3d-container"),this.overlay.css({position:"absolute",top:"0px",left:"0px"}),this.image=$(document.createElement("img")).appendTo(this.overlay),this.image.attr("src",i),this.loaded=!0},this.remove=function(){this.loaded=!1,this.overlay.remove()},this.setPosition=function(e,i,t,s){this.loaded&&(this.overlay.css({position:"absolute",top:s+i+"px",left:t+e+"px"}),this.anchorX=t,this.anchorY=s,this.positionX=e,this.positionY=i)},this.setRotation=function(e){this.loaded&&this.rotation!=e&&(this.overlay.css({"-ms-transform":"rotate("+e+"deg)","-webkit-transform":"rotate("+e+"deg)",transform:"rotate("+e+"deg)"}),this.rotation=e)},this.setSize=function(e,i){this.loaded&&(this.sizeX!=e||this.sizeY!=i)&&(this.overlay.css({width:e+"px",height:i+"px"}),this.sizeX=e,this.sizeY=i)},this.setOpacity=function(e){this.loaded&&this.opacity!=e&&(this.opacity>0&&0==e&&this.setVisibility(!1),0==this.opacity&&e>0&&this.setVisibility(!0),this.opacity=e,this.overlay.css("opacity",e))},this.getVisibility=function(){return this.visibility},this.setVisibility=function(e){this.loaded&&this.visibility!=e&&(this.overlay.css("visibility",e?"visible":"hidden"),this.visibility=e)},this.setDrawOrder=function(e){this.drawOrder!=e&&(this.overlay.css("zIndex",e),this.drawOrder=e)}}function SpriteNumber(e,i,t,s,a,o){this.loaded=!1,this.scene=e,this.value=1/0,this.positionX=1/0,this.positionY=1/0,this.lastUpdate=0,this.object=$(document.createElement("div")).appendTo("#map3d-container"),this.object.addClass("sprite-number-container"),this.object.css("position","absolute"),i?this.object.css("left",i+"px"):t&&this.object.css("right",t+"px"),s?this.object.css("top",s+"px"):a&&this.object.css("bottom",a+"px"),this.valueContainer=$(document.createElement("span")).appendTo(this.object),this.valueContainer.addClass("sprite-number-value"),this.unitContainer=$(document.createElement("span")).appendTo(this.object),o&&(this.unitContainer.addClass("sprite-number-unit"),this.unitContainer.html(o)),this.loaded=!0,this.setPosition=function(e,i,t,s){this.loaded&&(e?this.object.css("left",e+"px"):i&&this.object.css("right",i+"px"),t?this.object.css("top",t+"px"):s&&this.object.css("bottom",s+"px"))},this.setValue=function(e){this.loaded&&this.value!=e&&(this.valueContainer.html(e),this.value=e)},this.remove=function(){this.object.remove(),this.loaded=!1}}function Text(e,i,t,s,a,o){this.loaded=!1,this.scene=e,this.value=1/0,this.positionX=1/0,this.positionY=1/0,this.lastUpdate=0,this.object=$(document.createElement("div")).appendTo("#map3d-container"),this.object.addClass("sprite-number-container"),this.object.css("position","absolute"),i?this.object.css("left",i+"px"):t&&this.object.css("right",t+"px"),s?this.object.css("top",s+"px"):a&&this.object.css("bottom",a+"px"),this.unitContainer=$(document.createElement("span")).appendTo(this.object),o&&(this.unitContainer.addClass("sprite-number-unit"),this.unitContainer.html(o)),this.loaded=!0,this.setPosition=function(e,i,t,s){this.loaded&&(e?this.object.css("left",e+"px"):i&&this.object.css("right",i+"px"),t?this.object.css("top",t+"px"):s&&this.object.css("bottom",s+"px"))},this.remove=function(){this.object.remove(),this.loaded=!1}}function SpriteRPM(e,i,t,s,a,o,n,h,l){this.loaded=!1,this.scene=e,this.value=1/0,this.positionX=1/0,this.positionY=1/0,this.lastUpdate=0,this.object=$(document.createElement("div")).appendTo("#map3d-container"),this.object.css({position:"absolute",width:o*(h+1)+"px",height:n+"px"}),i?this.object.css("left",i+"px"):t&&this.object.css("right",t+"px"),s?this.object.css("top",s+"px"):a&&this.object.css("bottom",a+"px"),this.sprites=[];for(var r=1;h>=r;){var c=r++;this.sprites[c]=[],this.sprites[c][0]=$(document.createElement("img")).appendTo(this.object),this.sprites[c][0].attr("src",l+"background_"+c+".png"),this.sprites[c][0].css({position:"absolute",left:o*c+"px",top:"0px",opacity:1,zIndex:1}),this.sprites[c][1]=$(document.createElement("img")).appendTo(this.object),this.sprites[c][1].attr("src",l+c+".png"),this.sprites[c][1].css({position:"absolute",left:o*c+"px",top:"0px",opacity:.005,zIndex:2})}this.loaded=!0,this.setPosition=function(e,i,t,s){this.loaded&&(e?this.object.css("left",e+"px"):i&&this.object.css("right",i+"px"),t?this.object.css("top",t+"px"):s&&this.object.css("bottom",s+"px"))},this.setValue=function(e){if(this.loaded&&this.value!=e){for(var i=e*h/100,t=1;h>=t;){var s=t++;i>s?this.sprites[s][1].css("opacity",1):this.sprites[s][1].css("opacity",.005)}this.value=e}},this.remove=function(){this.object.remove(),this.loaded=!1}}function cal_to_jd(e,i,t,s,a,o,n){var h,l,r;if(0==i)return alert("There is no year 0 in the Julian system!"),"invalid";if(1582==i&&10==t&&s>4&&15>s)return alert("The dates 5 through 14 October, 1582, do not exist in the Gregorian system!"),"invalid";"BCE"==e&&(i=-i+1),t>2?(h=i,r=t+1):(h=i-1,r=t+13);var c=Math.floor(Math.floor(365.25*h)+Math.floor(30.6001*r)+s+1720995),d=588829;s+31*(t+12*i)>=d&&(l=Math.floor(.01*h),c+=2-l+Math.floor(.25*l));var m=a/24-.5;0>m&&(m+=1,--c);var u=m+(o+n/60)/60/24,p=1e5*(c+u),v=Math.floor(p);return p-v>.5&&++v,v/1e5}function $bind(e,i){if(null==i)return null;null==i.__id__&&(i.__id__=$fid++);var t;return null==e.hx__closures__?e.hx__closures__={}:t=e.hx__closures__[i.__id__],null==t&&(t=function(){return t.method.apply(t.scope,arguments)},t.scope=e,t.method=i,e.hx__closures__[i.__id__]=t),t}var rotCameraMatrix=function(e,i,t,s){var a,o;if(a=0===i?Cesium.Matrix3.IDENTITY:Cesium.Matrix3.fromRotationZ(-i),o=0!==t?Cesium.Matrix3.fromRotationX(-t):Cesium.Matrix3.IDENTITY,Cesium.Matrix3.multiply(e,a,e),Cesium.Matrix3.multiply(e,o,e),0!==s){var n=new Cesium.Cartesian3;Cesium.Matrix3.getColumn(e,0,n);var h=new Cesium.Cartesian3;Cesium.Matrix3.getColumn(e,1,h);var l=new Cesium.Cartesian3;Cesium.Matrix3.getColumn(e,2,l);var r=s,c=Cesium.Matrix3.fromQuaternion(Cesium.Quaternion.fromAxisAngle(l,r));Cesium.Matrix3.multiplyByVector(c,n,n),Cesium.Matrix3.multiplyByVector(c,h,h),Cesium.Matrix3.multiplyByVector(c,l,l),Cesium.Matrix3.setColumn(e,0,n,e),Cesium.Matrix3.setColumn(e,1,h,e),Cesium.Matrix3.setColumn(e,2,l,e)}return e};DrivingSimulator=function(){this.ee=new EventEmitter,this.tooFar=!1,this.isSpawning=!0,this.startTime=Date.now(),this.currentTime=Date.now(),this.prevTime=Date.now(),this.deltaTime=0,this.fps=0,this.framesCounter=0,this.frameCheckTimer=Date.now(),this.doUpdate=!1,this.lastUpdate=0,this.other=!1,this.wheelAngle=0,this.isRightHandDrive=!1,this.viewPointIndex=0,this.vehicle=!1,this.vehicleData=!1,this.name=!1,this.icon=!1,this.teleported=!0,this.isSpawningDiv=!1,this.isSpawningStart=0,this.active=!0,this.element=!1,this.keyState=[],this.keyStates=[],this.keyCount=[],this.preventKeys=[32,33,34,35,36,37,38,39,40];for(var e=1;100>e;){var i=e++;this.keyCount[i]=0}this.hasLandingGear=!1,this.pause=!1,this.gearDownCount=0,this.gearUpCount=0,this.viewY=0,this.viewX=0,this.handbrake=0,this.handbrakeCount=0,this.displayPositionCount=0,this.switchDriverSheetCount=0,this.changeViewPointCount=0,this.changeCruiseControlCount=0,this.cruiseControl=0,this.changeCompassCount=0,this.changeFpsCount=0,this.showCompass=0,this.showFps=0,this.brake=0,this.throttle=0,this.steeringDelta=0,this.altitudeOffset=0,this.tiltOffset=0,this.rollOffset=0,this.up=!1,this.down=!1,this.left=!1,this.right=!1,this.lastSpeedKmh=0,this.lastTiltOffset=this.removeBodies=[],this.totalkms=0,this.totalmeters=0,this.checker=!1,this.intersection=new Math3D.geometry.Intersection,this.destroy=function(){this.viewer.clock.onTick.removeEventListener($bind(this,this.update)),this.bodyModel&&this.bodyModel.remove(),this.removeOverlays();try{window.audioMonkey&&(window.audioMonkey.remove(this.username+"_forward"),window.audioMonkey.remove(this.username+"_slip"),window.audioMonkey.remove(this.username+"_vehicleCrash"))}catch(e){log("error",e)}},this.getLoadingPercentage=function(){return"undefined"!=typeof this.scene.globe._surface&&"undefined"!=typeof this.scene.globe._surface._tileLoadQueue&&"undefined"!=typeof this.scene.globe._surface._tileLoadQueue.length?Math.max(0,100-this.scene.globe._surface._tileLoadQueue.length):100},this.init=function(e){this.vehicleData=e,this.onSuccess(!1)},this.onSuccess=function(e){this.ge=e,this.setupKeyboard(),this.onLoad()},this.setViewPoints=function(){if(this.viewPoints=[new ViewPoint("normal",this.vehicleData.camheight,-this.vehicleData.traildistance,83,0,0),new ViewPoint("normal",2.5*this.vehicleData.camheight,2*-this.vehicleData.traildistance,79,0,0),new ViewPoint("top_panoramic",10*this.vehicleData.camheight,2*-this.vehicleData.traildistance,45,0,0),new ViewPoint("top",20*this.vehicleData.camheight,0,0,0,0)],this.vehicleData.vehicleCameras&&this.vehicleData.vehicleCameras.length>0)for(var e=0,i=this.vehicleData.vehicleCameras.length;i>e;e++){var t=this.vehicleData.vehicleCameras[e];this.viewPoints.push(new ViewPoint(t.type,t.altitude,t.offset,t.tilt,t.dir,t.heading))}},this.drawOverlays=function(e,i){log("info","drawOverlays",this.username);try{if(this.vehicleData.showSpeed){if(!this.speedOverlay||i){this.speedOverlay&&this.speedOverlay.remove();for(var t=4*this.vehicleData.maxspeed,s=1;(t=parseInt(t/10))>0;)s++;this.vehicleData.showAltitude?("km"==window.unit.toLowerCase()&&(this.speedOverlay=new SpriteNumber(this.scene,!1,25,!1,78,"km/h")),"mi"==window.unit.toLowerCase()&&(this.speedOverlay=new SpriteNumber(this.scene,!1,25,!1,78,"mph"))):("km"==window.unit.toLowerCase()&&(this.speedOverlay=new SpriteNumber(this.scene,!1,25,!1,53,"km/h")),"mi"==window.unit.toLowerCase()&&(this.speedOverlay=new SpriteNumber(this.scene,!1,25,!1,53,"mph")))}}else this.speedOverlay&&this.speedOverlay.remove(),this.speedOverlay=null;if(this.vehicleData.showAltitude){if(!this.altitudeOverlay||i){this.altitudeOverlay&&this.altitudeOverlay.remove();var s=10;"km"==window.unit.toLowerCase()&&(this.altitudeOverlay=new SpriteNumber(this.scene,!1,25,!1,53,"m")),"mi"==window.unit.toLowerCase()&&(this.altitudeOverlay=new SpriteNumber(this.scene,!1,25,!1,53,"ft"))}}else this.altitudeOverlay&&this.altitudeOverlay.remove(),this.altitudeOverlay=null;if(this.vehicleData.showRPM){if(!this.rpmOverlay||i){this.gearOverlay&&this.gearOverlay.remove();for(var t=this.vehicleData.maxGear,s=2;(t=parseInt(t/10))>0;)s++;this.vehicleData.showAltitude||this.vehicleData.showSpeed?this.vehicleData.showAltitude?this.gearOverlay=new SpriteNumber(this.scene,!1,60,!1,103):this.gearOverlay=new SpriteNumber(this.scene,!1,60,!1,78):this.gearOverlay=new SpriteNumber(this.scene,!1,60,!1,53),this.rpmOverlay&&this.rpmOverlay.remove();var s=5;this.vehicleData.showAltitude||this.vehicleData.showSpeed?this.vehicleData.showAltitude?this.rpmOverlay=new SpriteRPM(this.scene,!1,25,!1,105,6,19,s,window.SITE_URL+"/img/bar_v2_"):this.rpmOverlay=new SpriteRPM(this.scene,!1,25,!1,80,6,19,s,window.SITE_URL+"/img/bar_v2_"):this.rpmOverlay=new SpriteRPM(this.scene,!1,25,!1,55,6,19,s,window.SITE_URL+"/img/bar_v2_")}}else this.rpmOverlay&&this.rpmOverlay.remove(),this.gearOverlay&&this.gearOverlay.remove(),this.rpmOverlay=null,this.gearOverlay=null;this.showCompass?((!this.compassOverlay||i&&e)&&(this.compassOverlay&&this.compassOverlay.remove(),this.compassNeedleOverlay&&this.compassNeedleOverlay.remove(),this.compassOverlay=new Sprite(this.scene,window.SITE_URL+"/img/compass_gauge_v2.png?"+window.version),this.compassOverlay.load(),this.compassOverlay.setPosition($("#map3d").width()/2-50,$("#map3d").height()-105,0,0),this.compassOverlay.setOpacity(.6),this.compassOverlay.setDrawOrder(100),this.compassNeedleOverlay=new Sprite(this.scene,window.SITE_URL+"/img/compass_needle_v2.png?"+window.version),this.compassNeedleOverlay.load(),this.compassNeedleOverlay.setPosition($("#map3d").width()/2-50,$("#map3d").height()-105,0,0),this.compassNeedleOverlay.image.css("-webkit-filter","invert(100%)"),this.compassNeedleOverlay.image.css("filter","invert(100%)"),this.compassNeedleOverlay.setOpacity(1),this.compassNeedleOverlay.setDrawOrder(150)),"air"==this.vehicleData.mainCategory?(!this.attitudeOverlay||i&&e)&&(this.attitudeOverlay&&this.attitudeOverlay.remove(),this.attitudeOverlay=new Attitude(this.scene),this.attitudeOverlay.load(),this.attitudeOverlay.setDrawOrder(50)):this.attitudeOverlay&&this.attitudeOverlay.remove()):(this.attitudeOverlay&&this.attitudeOverlay.remove(),this.compassOverlay&&this.compassOverlay.remove(),this.compassNeedleOverlay&&this.compassNeedleOverlay.remove(),this.attitudeOverlay=null,this.compassOverlay=null,this.compassNeedleOverlay=null),this.showFps?(!this.fpsOverlay||i&&e)&&(this.fpsOverlay&&this.fpsOverlay.remove(),this.fpsOverlay=new SpriteNumber(this.scene,!1,25,30,!1,"fps")):(this.fpsOverlay&&this.fpsOverlay.remove(),this.fpsOverlay=null)}catch(a){log("error","drawOverlays",a)}},this.removeOverlays=function(){try{this.speedOverlay&&this.speedOverlay.remove(),this.speedOverlay=null,this.altitudeOverlay&&this.altitudeOverlay.remove(),this.altitudeOverlay=null,this.rpmOverlay&&this.rpmOverlay.remove(),this.rpmOverlay=null,this.gearOverlay&&this.gearOverlay.remove(),this.gearOverlay=null,this.fpsOverlay&&this.fpsOverlay.remove(),this.fpsOverlay=null,this.attitudeOverlay&&this.attitudeOverlay.remove(),this.attitudeOverlay=null,this.compassOverlay&&this.compassOverlay.remove(),this.compassNeedleOverlay&&this.compassNeedleOverlay.remove(),this.compassOverlay=null,this.compassNeedleOverlay=null,this.transmissionOverlay&&this.transmissionOverlay.remove(),this.transmissionOverlay=null,this.cruiseControlOverlay&&this.cruiseControlOverlay.remove(),this.cruiseControlOverlay=null}catch(e){log("error","removeOverlays",e)}},this.onLoad=function(){window.currentVehicle=this.vehicleData._id.toString(),this.setViewPoints(),this.bodyModel&&this.bodyModel.remove(),this.bodyModel=new Model(this.scene,this.vehicleData.chassi?this.vehicleData.chassi.url:"https://dl.dropboxusercontent.com/u/3050123/Archive3.gltf",!1,!1,this.vehicleData.modelxscale,this.vehicleData.modelyscale,this.vehicleData.modelzscale,this.vehicleData),this.bodyModel.load(this.username),this.setupVehicle(window.lat,window.lon,window.heading,this.getAltitude(new LatLng(window.lat,window.lon),"startLocation")),this.prevCamera=new LatLngAlt(0,0,0),this.currentTime=Date.now(),this.drawOverlays(!0,!0);this.viewer.clock.onTick.addEventListener($bind(this,this.update))},this.onReLoad=function(){this.setViewPoints(),this.cruiseControl=!1,this.stallOverlay&&this.stallOverlay.remove(),this.cruiseControlOverlay&&this.cruiseControlOverlay.remove(),this.transmissionOverlay&&this.transmissionOverlay.remove(),this.stallOverlay=null,this.cruiseControlOverlay=null,this.transmissionOverlay=null,this.bodyModel&&this.bodyModel.remove(),this.bodyModel=new Model(this.scene,this.vehicleData.chassi?this.vehicleData.chassi.url:"https://dl.dropboxusercontent.com/u/3050123/Archive3.gltf",!1,!1,this.vehicleData.modelxscale,this.vehicleData.modelyscale,this.vehicleData.modelzscale,this.vehicleData),this.bodyModel.load(this.username),this.setupVehicle(window.lat,window.lon,window.heading,this.getAltitude(new LatLng(window.lat,window.lon),"startLocation")),this.drawOverlays(!0,!0)},this.changeViewPoint=function(e){null!=e?this.viewPointIndex=e:++this.viewPointIndex>=this.viewPoints.length&&(this.viewPointIndex=0)},this.onMouseUp=function(){this.setKeyFocus()},this.createFocusControl=function(e){},this.setKeyFocus=function(){var e=this.scene.canvas;e.setAttribute("tabindex","0"),e.focus(),this.setActive(!0)},this.previousDestinationHeading=0,this.previousDestinationDistance=1/0,this.updateKeyStatus=function(e){this.steeringDelta=0,this.throttle=0,this.brake=0,this.viewX=0,this.viewY=0,this.up=!1,this.down=!1,this.left=!1,this.right=!1,this.isSpawning||(0!=this.getStickX()?this.steeringDelta=this.getStickX():this.gamepad&&0!=this.gamepad.getLeftStickX()&&(this.steeringDelta=this.gamepad.getLeftStickX()),this.gamepad&&this.gamepad.getThrottle()>0?this.throttle=1:this.gamepad&&this.gamepad.getBrake()>0?this.brake=1:this.isDown(cca(this.keybindings.keyboard.throttle,0))?this.throttle=1:this.isDown(cca(this.keybindings.keyboard.brake,0))?this.brake=1:this.throttle=this.brake=0,this.gamepad&&this.gamepad.getCamera()>0?this.changeViewPointCount++:this.isDown(cca(this.keybindings.keyboard.camera,0))>0?this.changeViewPointCount++:this.changeViewPointCount=0,this.gamepad&&this.gamepad.getGearUp()>0?this.changeGearUpCount++:this.isDown(cca(this.keybindings.keyboard.gearUp,0))>0?this.changeGearUpCount++:this.changeGearUpCount=0,this.gamepad&&this.gamepad.getGearDown()>0?this.changeGearDownCount++:this.isDown(cca(this.keybindings.keyboard.gearDown,0))>0?this.changeGearDownCount++:this.changeGearDownCount=0,this.gamepad&&this.gamepad.getCompass()>0?this.changeCompassCount++:this.isDown(cca(this.keybindings.keyboard.compass,0))>0?this.changeCompassCount++:this.changeCompassCount=0,this.gamepad&&this.gamepad.getFps()>0?this.changeFpsCount++:this.isDown(cca(this.keybindings.keyboard.fps,0))>0?this.changeFpsCount++:this.changeFpsCount=0,this.gamepad&&0!=this.gamepad.getViewX()?this.viewX=this.gamepad.getViewX():this.isDown(cca(this.keybindings.keyboard.lookRight,0))?this.viewX=1:this.isDown(cca(this.keybindings.keyboard.lookLeft,0))?this.viewX=-1:this.viewX=0,this.gamepad&&0!=this.gamepad.getViewY()?this.viewY=this.gamepad.getViewY():this.isDown(cca(this.keybindings.keyboard.lookFront,0))?this.viewY=1:this.isDown(cca(this.keybindings.keyboard.lookBack,0))?this.viewY=-1:this.viewY=0,this.gamepad&&this.gamepad.getLeftTilt()<0?this.up=!0:this.gamepad&&this.gamepad.getLeftTilt()>0?this.down=!0:this.isDown(cca(this.keybindings.keyboard.up,0))?this.up=!0:this.isDown(cca(this.keybindings.keyboard.down,0))?this.down=!0:(this.up=!1,this.down=!1),this.isDown(cca("T",0))?this.left=!0:this.left=!1,this.isDown(cca("G",0))?this.right=!0:this.right=!1,this.handbrake=0,this.vehicle.tiltOffset<185?this.throttle=1:this.vehicle.tiltOffset>190?this.throttle=-.1:this.throttle=.3,this.up?$("#up").addClass("active"):$("#up").removeClass("active"),this.down?$("#down").addClass("active"):$("#down").removeClass("active"),this.steeringDelta<0?$("#left").addClass("active"):$("#left").removeClass("active"),this.steeringDelta>0?$("#right").addClass("active"):$("#right").removeClass("active"),this.changeViewPointCount>0?$("#camera").addClass("active"):$("#camera").removeClass("active"))},this.getSteeringDelta=function(){return this.steeringDelta},this.getThrottle=function(){return this.throttle},this.getBrake=function(){return this.brake},this.getHandbrake=function(){return this.handbrake},this.getUp=function(){return this.up},this.getDown=function(){return this.down},this.getLeft=function(){return this.left},this.getRight=function(){return this.right},this.gearUpPressed=function(){return 1==this.gearUpCount},this.gearDownPressed=function(){return 1==this.gearDownCount},this.changeViewPointPressed=function(){return 1==this.changeViewPointCount},this.changeCruiseControlPressed=function(){return 1==this.changeCruiseControlCount},this.changeAutomaticPressed=function(){return 1==this.changeAutomaticCount},this.changeGearUpPressed=function(){return 1==this.changeGearUpCount},this.changeGearDownPressed=function(){return 1==this.changeGearDownCount},this.changeCompassPressed=function(){return 1==this.changeCompassCount},this.changeFpsPressed=function(){return 1==this.changeFpsCount},this.switchDriverSheetPressed=function(){return 1==this.switchDriverSheetCount},this.displayPositionPressed=function(){return 1==this.displayPositionCount},this.getViewX=function(){return this.viewX},this.getViewY=function(){return this.viewY},this.onKeyDown=function(e){if(this.active){var i,t=window;i=t.event?t.event.keyCode:e.keyCode,this.keyState[i]=!0;for(var s=0,a=this.preventKeys;s<a.length;){var o=a[s];++s,i==o&&(e.preventDefault?e.preventDefault():e.returnValue=!1)}}},this.onKeyUp=function(e){var i,t=window;i=t.event?t.event.keyCode:e.keyCode,this.keyState[i]=!1;for(var s=0,a=this.preventKeys;s<a.length;){var o=a[s];++s,i==o&&(e.preventDefault?e.preventDefault():e.returnValue=!1)}},this.updateKeys=function(){for(var e=1;100>e;){var i=e++;this.keyState&&this.keyState[i]?this.keyCount[i]++:this.keyCount[i]=0}},this.isDown=function(e){return this.keyState?this.keyState[e]:!1},this.getStickX=function(){return this.keyState&&this.keyState[39]?1:this.keyState&&this.keyState[37]?-1:0},this.getStickY=function(){return this.keyState&&this.keyState[38]?1:this.keyState&&this.keyState[40]?-1:0},this.isPressed=function(e){return 1==this.keyCount[e]},this.isKeyPressed=function(){return this.keyState&&(this.keyState[32]||this.keyState[17])?!0:!1},this.setupKeyboard=function(){var e=this,i=[];for(var t in this.keybindings.keyboard)i.push(this.keybindings.keyboard[t]);Mousetrap.bind(i,function(i){e.pause||e.onKeyDown(i)},"keydown"),Mousetrap.bind(i,function(i){e.pause||e.onKeyUp(i)},"keyup"),Mousetrap.bind(this.keybindings.keyboard.pause,function(i){if(e.pause=!e.pause,e.pause){e.viewer.clock.onTick.removeEventListener($bind(e,e.update));try{window.audioMonkey.stopAll()}catch(t){log("error",t)}$("#paused").show()}else cesiumExplorer.physics.prevTime=Date.now(),e.viewer.clock.onTick.addEventListener($bind(e,e.update)),$("#paused").hide()},"keyup"),this.gamepad=new Gamepad(this.keybindings)},this.setupDebug=function(){this.vehicleBackPlacemark&&this.vehicleBackPlacemark.remove(),this.vehicleBackPlacemark=new Placemark(this.scene,window.lat,window.lon,"vehicle back",window.SITE_URL+"/img/my_marker.png"),this.vehicleBackPlacemark.setVisibility(!0),this.vehicleFrontPlacemark&&this.vehicleFrontPlacemark.remove(),this.vehicleFrontPlacemark=new Placemark(this.scene,window.lat,window.lon,"vehicle front",window.SITE_URL+"/img/my_marker.png"),
this.vehicleFrontPlacemark.setVisibility(!0),this.vehicleLeftPlacemark&&this.vehicleLeftPlacemark.remove(),this.vehicleLeftPlacemark=new Placemark(this.scene,window.lat,window.lon,"vehicle left",window.SITE_URL+"/img/my_marker.png"),this.vehicleLeftPlacemark.setVisibility(!0),this.vehicleRightPlacemark&&this.vehicleRightPlacemark.remove(),this.vehicleRightPlacemark=new Placemark(this.scene,window.lat,window.lon,"vehicle right",window.SITE_URL+"/img/my_marker.png"),this.vehicleRightPlacemark.setVisibility(!0)},this.setupVehicle=function(e,i,t,s){this.vehiclePosition=new LatLng(parseFloat(e),parseFloat(i)),this.partialDistance=0,this.vehicleTargetPosition=new LatLng(parseFloat(e),parseFloat(i)),this.vehicleAltitude=new vehicle.Suspension(parseFloat(s),parseFloat(s),this.vehicleData.suspensionMass,this.vehicleData.suspensionSpring,this.vehicleData.suspensionDamper),this.vehicleAltitude.velocity=.1,this.vehicleTilt=new vehicle.Suspension(0,0,this.vehicleData.tiltMass,this.vehicleData.tiltSpring,this.vehicleData.tiltDamper),this.vehicleTilt.velocity=.1,this.vehicleRoll=new vehicle.Suspension(0,0,this.vehicleData.rollMass,this.vehicleData.rollSpring,this.vehicleData.rollDamper),this.vehicleRoll.velocity=.1,this.setupPhysics(t),this.cameraHeadingBase=this.getVehicleHeading(),this.startTime=Date.now(),this.setKeyFocus()},this.setupPhysics=function(e){this.vehicleSpec=new vehicle.VehicleSpec,this.vehicleSpec.bodyWidth=this.vehicleData.bodyWidth,this.vehicleSpec.bodyLength=this.vehicleData.bodyLength,this.vehicleSpec.rearY=this.vehicleData.rearY,this.vehicleSpec.wheelBase=this.vehicleData.wheelBase,this.vehicleSpec.tread=this.vehicleData.tread,this.vehicleSpec.wheelRadius=this.vehicleData.wheelRadius;var i=PolygonData.getCarVertices(this.vehicleData.bodyLength,this.vehicleData.bodyWidth,this.vehicleData.type);this.vehicle&&this.vehicle.destroy(),this.vehicle=new vehicle.Vehicle(this.world,i,this.vehicleSpec,0,0,e,!0,this.vehicleData,this.username),this.vehicle.gearBox.gearRatio[-1]=this.vehicleData.reverseGearRatio,this.vehicle.gearBox.gearRatio[1]=this.vehicleData.firstGearRatio,this.vehicle.gearBox.gearRatio[2]=this.vehicleData.secondGearRatio,this.vehicle.gearBox.gearRatio[3]=this.vehicleData.thirdGearRatio,this.vehicle.gearBox.gearRatio[4]=this.vehicleData.fourthGearRatio,this.vehicle.gearBox.gearRatio[5]=this.vehicleData.fifthGearRatio,this.vehicle.gearBox.gearRatio[6]=this.vehicleData.sixthGearRatio,this.vehicle.gearBox.maxGear=this.vehicleData.maxGear,this.vehicle.gearBox.gearRatioTopSpeed[-1]=this.vehicleData.reverseGearRatioTopSpeed,this.vehicle.gearBox.gearRatioTopSpeed[1]=this.vehicleData.firstGearRatioTopSpeed,this.vehicle.gearBox.gearRatioTopSpeed[2]=this.vehicleData.secondGearRatioTopSpeed,this.vehicle.gearBox.gearRatioTopSpeed[3]=this.vehicleData.thirdGearRatioTopSpeed,this.vehicle.gearBox.gearRatioTopSpeed[4]=this.vehicleData.fourthGearRatioTopSpeed,this.vehicle.gearBox.gearRatioTopSpeed[5]=this.vehicleData.fifthGearRatioTopSpeed,this.vehicle.gearBox.gearRatioTopSpeed[6]=this.vehicleData.sixthGearRatioTopSpeed,this.vehicle.brakeRatio=this.vehicleData.brakeRatio,this.vehicle.liftOffMinSpeed=this.vehicleData.liftOffMinSpeed,this.prevPosition=this.vehicle.getPosition(),this.currentPosition=this.vehicle.getPosition();var t=window.document.getElementById("debug_canvas");if(null!=t){this.enableDebugCanvas=!0;var s=(t.getContext("2d"),new box2D.dynamics.B2DebugDraw);s.setDrawScale(10),s.setCanvas(t),s.setFillAlpha(.3),s.setLineThickness(1),s.setFlags(box2D.dynamics.B2DebugDraw.e_shapeBit|box2D.dynamics.B2DebugDraw.e_jointBit),this.world.setDebugDraw(s)}for(var a=0;100>a;){{a++}this.updatePhysics(.016666666666666666)}},this.cleanupBodies=function(){for(;this.removeBodies.length>0;){{var e=this.removeBodies.splice(0,1)[0];e.getUserData()}this.world.destroyBody(e)}},this.updatePhysics=function(e,i){this.vehicle.setSteeringLever(this.getSteeringDelta()),this.vehicle.setThrottle(this.getThrottle()),this.vehicle.setBrake(this.getBrake()),this.vehicle.setHandbrake(this.getHandbrake()),this.vehicle.setUp(this.getUp()),this.vehicle.setDown(this.getDown()),this.vehicle.setLeft(this.getLeft()),this.vehicle.setRight(this.getRight()),this.vehicle.update(e),this.vehicleAltitude.update(e),this.vehicleTilt.update(e),this.vehicleRoll.update(e),this.cleanupBodies(),this.world.step(e,8,3),this.world.clearForces(),this.vehicle.lateUpdate(e)},this.update=function(e){Date.now()-this.frameCheckTimer<1e3?this.framesCounter++:(this.fps=this.framesCounter,this.framesCounter=0,this.frameCheckTimer=Date.now()),this.fpsOverlay&&this.fpsOverlay.setValue(this.fps),this.ee.emitEvent("preUpdate");(Date.now()-this.prevTime)/1e3;this.batchedUpdate(),this.enableDebugCanvas&&this.world.drawDebugData(),this.ee.emitEvent("postUpdate")},this.handleKeysPressed=function(e){if(this.changeViewPointPressed()&&this.changeViewPoint(),this.changeCruiseControlPressed()&&(this.cruiseControl=!this.cruiseControl,this.drawOverlays(!0,!1)),this.changeCompassPressed()&&(this.showCompass=!this.showCompass,this.drawOverlays(!1,!1)),this.changeFpsPressed()&&(this.showFps=!this.showFps,this.drawOverlays(!1,!1)),this.switchDriverSheetPressed()&&(this.isRightHandDrive=!this.isRightHandDrive,this.changeViewPoint(0)),this.changeAutomaticPressed()&&"ground"==this.vehicleData.mainCategory&&(this.vehicle.automatic=!this.vehicle.automatic,this.drawOverlays(!0,!1)),this.changeGearUpPressed()&&this.vehicle.gearUp(),this.changeGearDownPressed()&&this.vehicle.gearDown(),this.gearUpPressed()&&this.vehicle.gearUp(),this.gearDownPressed()&&this.vehicle.gearDown(),"plane"==this.vehicleData.category||this.vehicle.konamiCodeFly){var i=box2D.common.math.B2Math.dot(this.vehicle.body.getLinearVelocity(),vehicle.Box2DUtils.getFrontVector(this.vehicle.body));this.vehicle.up?this.vehicle.tiltOffset+=.1*i*e:this.vehicle.down?this.vehicle.tiltOffset-=.1*i*e:this.vehicle.tiltOffset>window.defaultTiltOffset+.1*i*e?this.vehicle.tiltOffset-=.1*i*e:this.vehicle.tiltOffset<window.defaultTiltOffset-.1*i*e?this.vehicle.tiltOffset+=.1*i*e:this.vehicle.tiltOffset=window.defaultTiltOffset}},this.handleSpawning=function(e){var i=this.isSpawning;if(!this.bodyModel||!this.bodyModel.loaded||!this.bodyModel.initialModelMatrix||this.teleported&&this.getLoadingPercentage()<99&&Date.now()-this.isSpawningStart<15e3?(this.isSpawningDiv||(this.isSpawningDiv=$(document.createElement("div")).appendTo("#map3d-container"),this.isSpawningDiv.css({position:"absolute",top:"0px",left:"0px",right:"0px",bottom:"0px",fontSize:"24px",fontWeight:"600",textAlign:"center",backgroundColor:"rgba(0,0,0,0.35)",color:"#fff",lineHeight:$("#map3d-container").height()+"px"}),this.isSpawningDiv.html('<div style="display:inline-block; vertical-align:middle"><div class="loading_dots" style="padding: 0px;"><span></span><span style="margin: 0 5px 0 5px;"></span><span></span></div></div>'),this.isSpawningStart=Date.now()),this.isSpawning=!0):(this.isSpawningDiv&&(this.isSpawningDiv.remove(),this.isSpawningDiv=!1,this.teleported=!1),this.isSpawning=!1,this.isSpawningStart=Date.now()),i&&!this.isSpawning)try{window.audioMonkey.init()}catch(t){log("error",t)}},this.handleOverlays=function(e){"air"==this.vehicleData.mainCategory&&(this.vehicle.tilt>.5||this.vehicle.isHoverAbsoluteCeiling&&this.vehicle.tilt>.1?(this.stallOverlay&&this.stallOverlay.remove(),this.stallOverlay=new Text(this.scene,$("#map3d").width()/2-26,!1,53,!1,"STALL"),this.stallOverlay.unitContainer.css("padding-left","0px"),this.stallOverlay.unitContainer.css("font-weight","800"),window.audioMonkey&&window.audioMonkey.play("warning",0,0,3,!0),window.audioMonkey.rate("warning",3)):(this.stallOverlay&&this.stallOverlay.remove(),window.audioMonkey&&window.audioMonkey.stop("warning")))},this.handleSounds=function(e,i){var t=i/this.vehicleData.maxspeed+this.vehicleData.soundMinimumRate,s=0;0>s&&(s=0);var a=Math3D.MyMath.clamp(i/this.vehicleData.maxspeed,window.defaultMinVolume/100,window.defaultMaxVolume/100)-s;0>a&&(a=0);var o=Math3D.MyMath.clamp(i/this.vehicleData.maxspeed,window.defaultMinVolume/100,window.defaultMaxVolume/100)-s;0>o&&(o=0);try{window.audioMonkey.play("forward",i/this.vehicleData.maxspeed,0,t,!0,this.vehicleData.soundLoopStart,this.vehicleData.soundLoopEnd,a),window.audioMonkey.volume("forward",a),window.audioMonkey.rate("forward",t)}catch(n){log("error",n)}if(this.vehicle.squealLevel>.35&&!this.vehicle.airborne){var t=Math3D.MyMath.clamp(this.vehicle.squealLevel+this.vehicleData.slipMinimumRate,this.vehicleData.slipMinimumRate,1);try{window.audioMonkey.play("slip",i/this.vehicleData.maxspeed,0,t,!0,this.vehicleData.slipLoopStart,this.vehicleData.slipLoopEnd,o),window.audioMonkey.volume("slip",o),window.audioMonkey.rate("slip",t)}catch(n){log("error",n)}try{this.gamepad&&this.gamepad.startVibrate()}catch(n){log("error",n)}}else try{window.audioMonkey.stop("slip")}catch(n){log("error",n)}},this.batchedUpdate=function(){new LatLon(this.vehiclePosition.lat(),this.vehiclePosition.lng(),window.full.R);this.prevTime=this.currentTime,this.currentTime=Date.now();var e,i;e=i=Math3D.MyMath.clamp(this.currentTime-this.prevTime,1,50)/1e3;var t=e-i;0>t?t=0:t/=i,this.handleSpawning(i),this.gamepad&&this.gamepad.poll(),this.updateKeyStatus(i),this.handleKeysPressed(i);var s=this.prevPosition,a=this.currentPosition;s.x=a.x,s.y=a.y,s.z=a.z,this.updatePhysics(e,i),this.currentPosition=this.vehicle.getPosition();var o=this.currentPosition.x-this.prevPosition.x,n=this.currentPosition.y-this.prevPosition.y,h=Math.sqrt(o*o+n*n);h+=h*t;var l=Math.atan2(n,o)+1.5707963267948966;if(isNaN(l)||isNaN(h))return void this.setupPhysics(0);if(e=i=.03,this.vehicle.crashedWithLimits=!1,this.vehicle.crashedWithUser=!1,this.vehiclePosition=this.vehiclePosition.createOffset(l,h-(this.vehicle.airborne?h*Math3D.MyMath.clamp(1*Math.abs(this.vehicle.tilt),0,2):0)),this.updateVehicle(i,!1),this.updateCamera(i),this.updateSpeedMeter(Math.round(this.vehicle.getSpeedKmh()),Math.round(this.vehicle.getSpeedMph())),this.updateAltitudeMeter(this.vehicleAltitude.position),this.updateRPMMeter(this.vehicle.getRPM()),this.updateCompass(180*this.bodyModel.heading/Math.PI),this.updateAttitude(this.vehicleTilt.position.toDeg(),this.vehicleRoll.position.toDeg()),window.physics){var r=window.physics.absSpeed=this.vehicle.getSpeedKmh();this.handleSounds(i,r),this.handleOverlays(i)}},this.latestAltitude=!1,this.latestAltitudes={},this.getAltitude=function(e,i){if(!e||isNaN(e.lat())||isNaN(e.lng()))return log("info",i,"No valid location provided",e),1;var t=Cesium.Cartesian3.fromDegrees(e.lng(),e.lat(),0,this.ellipsoid,new Cesium.Cartesian3),s=this.scene.globe.getHeight(Cesium.Ellipsoid.WGS84.cartesianToCartographic(t));return s&&0>=s&&(s=.1),s?(this.latestAltitude=s,this.latestAltitudes[i?i:e.lng()+"_"+e.lat()]=s,s):this.latestAltitudes[i?i:e.lng()+"_"+e.lat()]?this.latestAltitudes[i?i:e.lng()+"_"+e.lat()]:this.latestAltitude?s:s},this.getAltitudeNoCache=function(e){if(!e||isNaN(e.lat())||isNaN(e.lng()))return void 0;var i=Cesium.Cartesian3.fromDegrees(e.lng(),e.lat(),0,this.ellipsoid,new Cesium.Cartesian3),t=this.scene.globe.getHeight(Cesium.Ellipsoid.WGS84.cartesianToCartographic(i));return t},this.getAirDensity=function(e){return e*=3.28084,0>=e?.002377:1e3>=e?.002308:2e3>=e?.002241:3e3>=e?.002175:4e3>=e?.002111:5e3>=e?.002048:6e3>=e?.001987:7e3>=e?.001927:8e3>=e?.001868:9e3>=e?.001811:1e4>=e?.001755:15e3>=e?.001496:2e4>=e?.001266:25e3>=e?.001065:3e4>=e?889e-6:35e3>=e?737e-6:36089>=e?706e-6:4e4>=e?585e-6:45e3>=e?46e-5:5e4>=e?362e-6:285e-6},this.applyHorizontalForces=function(e,i,t,s,a){this.vehicle.airborne&&(this.terrainTilt=0,this.terrainRoll=0),("plane"==this.vehicleData.category||this.vehicle.konamiCodeFly)&&this.vehicle.airborne&&("plane"==this.vehicleData.category?this.terrainRoll=this.vehicle.getSteeringAngle()*this.vehicle.body.getLinearVelocity().length()*-this.vehicleData.steerroll*s:this.terrainRoll=-this.vehicle.getSteeringAngle()*this.vehicle.body.getLinearVelocity().length()*this.vehicleData.steerroll*s,this.terrainRoll=Math3D.MyMath.clamp(this.terrainRoll,-this.vehicleData.rollclamp/180*Math.PI,this.vehicleData.rollclamp/180*Math.PI))},this.applyVerticalForces=function(e,i,t,s,a,o){if("plane"==this.vehicleData.category||this.vehicle.konamiCodeFly){this.vehicle.tiltOffset>360?this.vehicleTilt.position.toDeg()<-179&&(this.vehicle.tiltOffset-=360,this.vehicleTilt.position=3.1396936244990847,this.vehicleTilt.targetPosition=3.1396936244990847):this.vehicle.tiltOffset<0&&this.vehicleTilt.position.toDeg()>179&&(this.vehicle.tiltOffset+=360,this.vehicleTilt.position=-3.1396936244990847,this.vehicleTilt.targetPosition=-3.1396936244990847);var n=.911344*this.vehicle.getSpeedKmh(),h=(.4*this.vehicleData.bodyLength+.2*this.vehicleData.bodyLength)/2,l=this.vehicleData.bodyWidth*h,r=-this.vehicleTilt.position,c=9.8*this.vehicle.getMass(),d=this.vehicle.airborne?0:c/2e3*a,m=6.2831853*r-d;if(185!=this.vehicle.tiltOffset){this.lift=1*this.getAirDensity(this.vehicleAltitude.position)*n*l*m-c/2e3*a;{this.vehicle.getMass()/(this.getAirDensity(this.vehicleAltitude.position)*l*n*n)}}var u=Math.abs(185-this.vehicle.tiltOffset),p=185-this.vehicle.tiltOffset>0?-1:1,v=this.vehicle.speedKmh/this.vehicleData.mass;if(0>v&&(v=this.vehicle.speedKmh),this.vehicle.speedKmh<this.vehicle.liftOffMinSpeed){var g=Math.abs(Math.max(v,100)*a*(c/2e3));this.vehicleAltitude.targetPosition-=(g-u*p*.05)*a*a}else this.vehicle.tiltOffset>185||this.vehicle.tiltOffset>275&&this.vehicle.speedKmh<.7*this.vehicle.liftOffMinSpeed?this.vehicleAltitude.targetPosition+=p*u*a*Math.max(v,25)*a*a:this.vehicle.tiltOffset<185&&(this.vehicleAltitude.targetPosition+=p*u*a*Math.max(v,25)*a*a);var f=this.vehicle.wasAirborne=this.vehicle.airborne,y=this.vehicleAltitude.position-i,b=this.getLatLngAlt(2*this.vehicleData.bodyWidth,0,this.vehicleData.vehiclealt),w=b.altitude()-t,D=this.getLatLngAlt(2*-this.vehicleData.bodyWidth,0,this.vehicleData.vehiclealt),x=D.altitude()-s;if(0>=x||0>=w){var C=0>=x?-Math3D.MyMath.clamp(e+this.terrainRoll,0,10)*Math.PI/180:Math3D.MyMath.clamp(e+this.terrainRoll,0,10)*Math.PI/180;isNaN(C)||(this.vehicle.body.m_angularVelocity+=C);{(Date.now()-this.vehicle.airborneTime)/5e4+.01}if(this.vehicle.speedKmh>.7*this.vehicle.liftOffMinSpeed){var _=this.vehicle.body.getLinearVelocity().copy();_.multiply(Math3D.MyMath.clamp(e*Math.abs(this.terrainRoll)*a,0,.5)),_.negativeSelf();var M=this.vehicle.body.getLinearVelocity();M.add(_)}if(window.audioMonkey){try{window.audioMonkey.play("vehicleCrash",0,0,1,!1),window.audioMonkey.volume("vehicleCrash",.01+this.vehicle.speedKmh/this.vehicleData.maxspeed),window.audioMonkey.rate("vehicleCrash",Math.min(.5+this.vehicle.speedKmh/this.vehicleData.maxspeed,1))}catch(S){log("error",S)}try{this.gamepad&&this.gamepad.startVibrate()}catch(S){log(S)}}}y>.5&&w>0&&x>0?this.vehicle.airborne=!0:this.vehicle.airborne=!1,this.vehicle.crashed&&Date.now()-this.vehicle.crashedTime>150&&(this.vehicle.crashed=!1);var B=this.vehicle.airborne&&f&&this.vehicle.speedKmh<.3*this.vehicle.liftOffMinSpeed||(this.vehicle.airborne||f)&&this.vehicle.dropping,O=!this.vehicle.airborne&&(this.vehicle.speedKmh<=this.vehicle.liftOffMinSpeed||f)&&(this.vehicle.dropping||this.vehicle.speedKmh>this.vehicle.liftOffMinSpeed),T=.01*Math.abs(this.vehicle.tiltOffset-180);if(i+=T,B)this.vehicle.airborneTime||(this.vehicle.airborneTime=Date.now()),this.vehicle.dropping=!0,this.vehicle.speedKmh<.3*this.vehicle.liftOffMinSpeed&&(this.vehicle.tiltOffset-=.1*e*a+.5,this.terrainRoll=0),this.vehicleData.minGroundAlt>i?this.vehicleData.minGroundAlt-=y*a+a:this.vehicleData.minGroundAlt<i&&(this.vehicleData.minGroundAlt=i),this.vehicle.up&&this.vehicle.speedKmh>=this.vehicle.liftOffMinSpeed?(this.terrainTilt=(180-this.vehicle.tiltOffset)*Math.PI/180,this.terrainTilt=Math3D.MyMath.clamp(this.terrainTilt,-this.vehicleData.tiltclamp,this.vehicleData.tiltclamp),this.vehicleTilt.targetPosition=this.terrainTilt,this.vehicle.tiltOffset>=170&&this.vehicle.speedKmh>this.vehicle.liftOffMinSpeed&&(this.vehicle.dropping=!1)):(this.vehicle.tiltOffset=Math3D.MyMath.clamp(this.vehicle.tiltOffset,90,this.vehicleData.tiltclamp),this.terrainTilt=(180-this.vehicle.tiltOffset)*Math.PI/180,this.vehicleTilt.targetPosition=this.terrainTilt);else if(O){if(.5>=y&&(this.vehicle.dropping||this.vehicle.speedKmh>this.vehicle.liftOffMinSpeed||f)){this.vehicle.crashed=!0,this.vehicle.crashedTime=Date.now();{(Date.now()-this.vehicle.airborneTime)/5e4+.01}if(this.vehicle.speedKmh>.7*this.vehicle.liftOffMinSpeed){var _=this.vehicle.body.getLinearVelocity().copy();_.multiply(Math3D.MyMath.clamp(e*a*a+.5*(185-this.vehicle.tiltOffset)*a,0,1)),_.negativeSelf();var M=this.vehicle.body.getLinearVelocity();M.add(_)}if(!this.hasLandingGear){this.vehiclePosition.createOffset(this.getVehicleHeading(),this.vehicleData.axisdistance),this.vehiclePosition.createOffset(this.getVehicleHeading()+3.141592/(this.vehicleData.axisdistance+this.vehicleData.wheelsdistance),-this.vehicleData.axisdistance),this.vehiclePosition.createOffset(this.getVehicleHeading()-3.141592/(this.vehicleData.axisdistance+this.vehicleData.wheelsdistance),-this.vehicleData.axisdistance)}this.vehicle.dropping=!1}0>y&&(this.vehicleData.minGroundAlt=i+T,this.vehicleAltitude.targetPosition=i+T,this.vehicleAltitude.position=i+T,this.vehicleTilt.position=this.terrainTilt,this.vehicleRoll.position=this.terrainRoll),this.vehicleTilt.targetPosition=this.terrainTilt,this.vehicleRoll.targetPosition=this.terrainRoll,this.vehicle.tiltOffset=this.vehicle.airborne?185:180}else f&&this.vehicle.airborne&&(this.vehicle.crashed=!0,this.vehicle.crashedTime=Date.now()),0>y&&(this.vehicleData.minGroundAlt=i+T,this.vehicleAltitude.targetPosition=i+T,this.vehicleAltitude.position=i+T,this.vehicle.tiltOffset>188&&(this.vehicle.tiltOffset-=.2*e*a)),this.terrainTilt=(180-this.vehicle.tiltOffset)*Math.PI/180,this.terrainTilt=Math3D.MyMath.clamp(this.terrainTilt,-this.vehicleData.tiltclamp,this.vehicleData.tiltclamp),this.vehicleTilt.targetPosition=this.terrainTilt,!this.vehicle.airborne&&!f&&this.vehicle.speedKmh<this.vehicle.liftOffMinSpeed&&(this.vehicle.tiltOffset=180)}this.vehicleAltitude.position>this.vehicleData.absoluteCeiling?this.vehicle.isHoverAbsoluteCeiling=!0:this.vehicle.isHoverAbsoluteCeiling=!1,this.vehicleAltitude.position<0&&(this.vehicleAltitude.position=0)},this.applyTurningForces=function(e,i,t){var s=Math3D.Angle.wrap(this.getVehicleHeading());return s},this.applyVehicleAttitude=function(e,i){"air"!=this.vehicleData.mainCategory&&"person"!=this.vehicleData.type&&!this.vehicle.konamiCodeFly||this.vehicle.dropping?this.vehicle.setAttitude(-e,i):this.vehicle.setAttitude(-e,i)},this.updateVehicle=function(e,i){var t,s=this.terrainRoll,a=(this.terrainTilt,this.vehiclePosition.createOffset(this.getVehicleHeading(),this.vehicleData.axisdistance));t=this.getAltitude(a,"locationFront");var o,n=this.vehiclePosition.createOffset(this.getVehicleHeading(),-this.vehicleData.axisdistance);if(o=this.getAltitude(n,"locationBack"),t&&o){this.terrainTilt=-Math.atan((t-o)/(2*this.vehicleData.axisdistance));var h,l=this.vehiclePosition.createOffset(this.getVehicleHeading()-1.570796326794897,this.vehicleData.wheelsdistance/2);h=this.getAltitude(l,"locationLeft");var r,c=this.vehiclePosition.createOffset(this.getVehicleHeading()+1.570796326794897,this.vehicleData.wheelsdistance/2);if(r=this.getAltitude(c,"locationRight"),h&&r){this.terrainRoll=Math.atan((r-h)/this.vehicleData.wheelsdistance);var d,m=this.vehiclePosition.createOffset(this.getVehicleHeading()-1.570796326794897,2*this.vehicleData.bodyWidth);d=this.getAltitude(m,"locationLeftWing");var u,p=this.vehiclePosition.createOffset(this.getVehicleHeading()+1.570796326794897,2*this.vehicleData.bodyWidth);if(u=this.getAltitude(p,"locationRightWing"),d&&u){var v=this.vehicle.getSteeringAngle()*Math3D.MyMath.linearMap(this.vehicle.speed,0,vehicle.Box2DUtils.toMps(this.vehicleData.maxspeed),0,10)*e*this.vehicleData.steerroll*(this.vehicleData.rollSpring*-this.terrainRoll+this.vehicleData.rollDamper)*Math3D.MyMath.linearMap(this.vehicle.getSquealLevel(),0,1,0,.3)*e,g=box2D.common.math.B2Math.dot(this.vehicle.body.getLinearVelocity(),vehicle.Box2DUtils.getFrontVector(this.vehicle.body));this.isSpawning||this.applyHorizontalForces(v,g,s,e,i);var f=this.vehiclePosition.lat(),y=this.vehiclePosition.lng(),b=(this.vehiclePosition,0);b=this.vehicle.wheelie&&this.vehicle.tiltOffset>190?o+Math3D.MyMath.linearMap(this.vehicle.tiltOffset,180,270,0,20)*e:this.vehicle.wheelie&&this.vehicle.tiltOffset<170?t+Math3D.MyMath.linearMap(360-this.vehicle.tiltOffset,180,270,0,20)*e:(t+o+h+r)/4,n=null,a=null,l=null,c=null;var w=b+this.vehicleData.upOffset,D=0;if(this.vehicleData.minGroundAlt>w&&(this.vehicleData.minGroundAlt=w),this.isSpawning||this.applyVerticalForces(g,w,u,d,e,i),this.isSpawning);else{if("ground"==this.vehicleData.mainCategory&&!this.vehicle.airborne&&"bike"!=this.vehicleData.category&&!this.vehicle.konamiCodeFly){var x=this.vehicle.getSteeringAngle()*g*Math.abs(this.vehicleRoll.velocity)*.25*Math.PI/180;isNaN(x)||(this.vehicle.body.m_angularVelocity+=x)}this.vehicleRoll.targetPosition=this.terrainRoll,this.vehicleRoll.update(e)}this.vehicleAltitude.update(e),D=this.vehicleAltitude.position,this.vehicleAltitude.position<w&&(D=w);var C=this.applyTurningForces(g,e,i),_=this.vehicleTilt.position,M=this.vehicleRoll.position;this.isSpawning||this.applyVehicleAttitude(_,M),this.vehicleAltitude.position=D,this.bodyModel.setLocation(f,y,D,C,_,M);var S=.2777777777777778*this.vehicle.getSpeedKmh()*e/this.vehicleSpec.wheelRadius;-1==this.vehicle.getGear()&&(S=-S),S=Math3D.MyMath.clamp(S,-.34906585039886595,.34906585039886595),this.wheelAngle+=S;{Math3D.geometry.Quaternion.euler(C,_,M)}window.lat=this.vehiclePosition.lat(),window.lon=this.vehiclePosition.lng(),window.heading=C,window.tilt=_,window.roll=M}}}},this.updateCamera=function(e){var i=this,t=1-Math.exp(-6*e),s=Math3D.Angle.wrap(i.getVehicleHeading());i.cameraHeadingBase+=Math3D.Angle.wrap(s-i.cameraHeadingBase)*t,i.cameraHeadingBase=Math3D.Angle.wrap(i.cameraHeadingBase);var a=i.getViewY(),o=i.getViewX(),n=-.5>a;i.viewPointIndex=i.viewPointIndex%i.viewPoints.length;var h=i.viewPoints[i.viewPointIndex],l=0,r=0,c=0;a>0&&(c=.4363323129985825*a),r=.872664625997165*o+(h.heading?h.heading*Math.PI/180:0);var d=-i.vehicleTilt.position,m="normal"==h.type&&"plane"!=i.vehicleData.type?i.vehicleRoll.position*e:i.vehicleRoll.position;n&&(r=3.141592653589794,d=-d,m=-m),d=.0174532925199433*h.tilt+d+c;{var u,p,v,g,f,y,b;i.viewPointIndex}switch(h.type){case"fps":i.cameraHeading=i.getVehicleHeading(),f=d,y=m;var w;n?(w=i.vehiclePosition.createOffset(i.cameraHeading+.3*o+h.dir,-(h.offset+l)),i.cameraHeading+=.3*o+h.dir,b=h.offset+l,f-=.17453292519943298):(w=i.vehiclePosition.createOffset(i.cameraHeading+h.dir,-(h.offset+l)),i.cameraHeading+=h.dir,b=h.offset+l),u=w.lat(),p=w.lng();var D=function(e){var i,t=new LatLng(u,p);return i=e.getAltitude(t,"camera")}(this);if(!D)return;g=i.vehicleAltitude.position+h.altitude,v=i.vehicleAltitude.position+h.altitude-D;break;case"fixed":i.cameraHeading=i.cameraHeadingBase,f=d,y=0,b=h.offset+l;var w=i.vehiclePosition.createOffset(i.cameraHeading,h.offset+l);u=w.lat(),p=w.lng();var D=function(e){var i,t=new LatLng(u,p);return i=e.getAltitude(t,"camera")}(this);if(!D)return;g=i.vehicleAltitude.position+h.altitude,v=i.vehicleAltitude.position+h.altitude-D;break;case"top_panoramic":i.cameraHeading=0,f=.0174532925199433*h.tilt,y=0;var x,C=i.vehicle.getSpeedKmh();x=C*C,h.altitude=Math3D.MyMath.linearMap(x,0,1e4,20,30),h.offset=Math3D.MyMath.linearMap(x,0,1e4,-20,-30);var _,M=i.vehiclePosition.createOffset(i.cameraHeading,h.offset+l),C=i.vehicle.getSpeedKmh();_=C*C;var S=Math3D.MyMath.linearMap(_,0,1e4,2,10),B=M.createOffset(i.getVehicleHeading(),S);u=B.lat(),p=B.lng(),b=h.offset+l;var D=function(e){var i,t=new LatLng(u,p);return i=e.getAltitude(t,"camera")}(this);if(!D)return;g=i.vehicleAltitude.position+h.altitude,v=i.vehicleAltitude.position+h.altitude-D;break;case"top":i.cameraHeading=i.cameraHeadingBase,f=.0174532925199433*h.tilt,y=0;var x,C=i.vehicle.getSpeedKmh();x=C*C,h.altitude=Math3D.MyMath.linearMap(x,0,1e4,50,60);var w=i.vehiclePosition.createOffset(i.cameraHeading,-(h.offset+l));u=w.lat(),p=w.lng(),b=h.offset+l;var D=function(e){var i,t=new LatLng(u,p);return i=e.getAltitude(t,"camera")}(this);if(!D)return;g=i.vehicleAltitude.position+h.altitude,v=i.vehicleAltitude.position+h.altitude-D;break;default:i.cameraHeading=i.cameraHeadingBase+r,f="helicopter"==this.vehicleData.category&&this.vehicle.airborne?Math3D.MyMath.clamp(d,1.3,6.2):d,y=m,l-=Math.min(i.vehicle.speed*e,.25*Math.abs(h.offset));var O=new Math3D.geometry.Vector3(h.dir,h.offset+l,0);O.rotateZ(i.getVehicleHeading()-i.cameraHeading);var w=i.getLatLngAlt(O.x,O.y,h.altitude);u=w.lat(),p=w.lng(),b=h.offset+l,i.cameraHeading+=h.dir;var D=function(e){var i,t=new LatLng(u,p);return i=e.getAltitude(t,"camera")}(this);if(!D)return;g=w.altitude(),v=w.altitude()-D}if(!(isNaN(p)||isNaN(u)||isNaN(g))&&this.bodyModel.loaded&&this.bodyModel.initialModelMatrix){var T=Cesium.Cartesian3.fromDegrees(p,u,g,this.ellipsoid,new Cesium.Cartesian3),P=Cesium.Transforms.eastNorthUpToFixedFrame(T);this.camera.transform=P;var k=Cesium.Matrix4.multiplyByPointAsVector(this.bodyModel.modelMatrix,Cesium.Cartesian3.UNIT_Y,new Cesium.Cartesian3);Cesium.Matrix4.multiplyByPointAsVector(this.camera.inverseTransform,k,k),Cesium.Cartesian3.negate(k,k),Cesium.Cartesian3.normalize(k,k),this.camera.tilt||(this.camera.tilt=0),this.camera.lookAt(T,new Cesium.HeadingPitchRange(i.cameraHeading,-(Math.PI/2-f-this.camera.tilt),10));var P=this.camera.transform;this.camera.lookAtTransform(Cesium.Matrix4.IDENTITY),this.camera.heading=i.cameraHeading;{Math.PI/2-f-this.camera.tilt}this.camera.lookAtTransform(P),this.camera.twistLeft(y)}},this.updateSpeedMeter=function(e,i){try{this.speedOverlay&&this.speedOverlay.setValue("km"==window.unit.toLowerCase()?parseInt(e):parseInt(i))}catch(t){log("error","updateSpeedMeter",t)}},this.updateAltitudeMeter=function(e){try{this.altitudeOverlay&&this.altitudeOverlay.setValue("km"==window.unit?parseInt(e):parseInt(3.28084*e))}catch(i){log("error","updateAltitudeMeter",i)}},this.updateRPMMeter=function(e){try{this.gearOverlay&&this.gearOverlay.setValue(this.vehicle.gearBox.gear),this.rpmOverlay&&this.rpmOverlay.setValue(e)}catch(i){log("error","updateRPMMeter",i)}},this.updateCompass=function(e){try{this.compassOverlay&&this.compassOverlay.setRotation(e)}catch(i){log("error","updateCompass",i)}},this.updateAttitude=function(e,i){try{this.attitudeOverlay&&this.attitudeOverlay.setAttitude(e,i)}catch(t){log("error","updateAttitude",t)}},this.getLatLngAlt=function(e,i,t){var s=new Math3D.geometry.Vector3(e,i,t),a=new Math3D.geometry.Matrix3x3;a.setRotationY(-this.vehicleRoll.position),s.multiply(a),a.setRotationX(-this.vehicleTilt.position),s.multiply(a);var o=-Math.atan2(s.y,s.x)+1.570796326794897,n=Math3D.MyMath.lengthVector(s.x,s.y),h=this.vehiclePosition.createOffset(this.getVehicleHeading()+o,n),l=0;return l=this.vehicleAltitude.position+s.z,new LatLngAlt(h.lat(),h.lng(),l)},this.getVehicleHeading=function(){return this.vehicle.getHeading()},this.setActive=function(e){this.active=e}},cesiumExplorer.tasksQueue=[],cesiumExplorer.processQueue=function(){if(cesiumExplorer.tasksQueue.length>0){var e=cesiumExplorer.tasksQueue.splice(0,1)[0];e&&"function"==typeof e.work&&e.work()}},cesiumExplorer.main=function(e){cesiumExplorer.baseURL="http://"+window.location.host+"/",cesiumExplorer.modelsURL=cesiumExplorer.baseURL+"models/",cesiumExplorer.imagesURL=cesiumExplorer.baseURL+"images/",cesiumExplorer.physics=new DrivingSimulator,cesiumExplorer.physics.world=window.world,cesiumExplorer.physics.username=window.userId,cesiumExplorer.physics.keybindings=window.keybindings,Cesium.BingMapsApi.defaultKey="AtLFxgtc7NXG2TSUOUyscnuEK24fNrFlr708iSjcQ_IQBWrxQ1_F6Gp6MdZMjnq-";var i=new Date,t=cal_to_jd("CE",i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds())+"",s=new Cesium.JulianDate(t.split(".")[0],t.split(".")[1]);cesiumExplorer.physics.viewer=new Cesium.Viewer("map3d",{homeButton:!1,baseLayerPicker:!1,infoBox:!1,sceneModePicker:!1,selectionIndicator:!1,timeline:!1,navigationHelpButton:!1,fullscreenButton:!1,navigationInstructionsInitiallyVisible:!1,geocoder:!1,animation:!1,scene3DOnly:!0,clock:new Cesium.Clock({currentTime:s}),imageryProvider:new Cesium.BingMapsImageryProvider({url:"//dev.virtualearth.net",key:Cesium.BingMapsApi.defaultKey,mapStyle:Cesium.BingMapsStyle.AERIAL,hasAlphaChannel:!1,defaultAlpha:1})}),cesiumExplorer.physics.viewer.scene.globe.enableLighting=!0,cesiumExplorer.physics.scene=cesiumExplorer.physics.viewer.scene,cesiumExplorer.physics.scene.moon=void 0,cesiumExplorer.physics.viewer.scene.globe.depthTestAgainstTerrain=!0,cesiumExplorer.physics.scene.globe.maximumScreenSpaceError=5;var a=new Cesium.CesiumTerrainProvider({url:"//cesiumjs.org/stk-terrain/tilesets/world/tiles"});cesiumExplorer.physics.scene.terrainProvider=a;var o=cesiumExplorer.physics.scene.canvas;o.setAttribute("tabindex","0"),o.onclick=function(){o.focus()},cesiumExplorer.physics.ellipsoid=cesiumExplorer.physics.scene.globe.ellipsoid,cesiumExplorer.physics.camera=cesiumExplorer.physics.scene.camera,cesiumExplorer.physics.camera.constrainedAxis=void 0,cesiumExplorer.physics.init(e),window.full.init();var n=$bind(cesiumExplorer,cesiumExplorer.processQueue);cesiumExplorer.physics.ee.addListener("postUpdate",n)},cesiumExplorer.screenshot=function(){cesiumExplorer.physics.viewer.scene._canvas.toDataURL()},cesiumExplorer.captureVideo=function(){cesiumExplorer.physics.viewer.scene._canvas.toDataURL()},cesiumExplorer["goto"]=window.cesiumExplorer["goto"]=function(e,i,t,s,a){var o=t,n=cesiumExplorer.physics.getAltitude(new LatLng(e,i),"goto")+(o?o:0);n||(n=0),o=n,cesiumExplorer.physics.teleported=!0,cesiumExplorer.physics.bodyModel.initialModelMatrix=!1,cesiumExplorer.physics.vehicle.body.setLinearVelocity(new box2D.common.math.B2Vec2(0,0)),cesiumExplorer.physics.vehicleData.minGroundAlt=o,cesiumExplorer.physics.vehicle.tiltOffset=180,cesiumExplorer.physics.vehicle.altitudeOffset=0,cesiumExplorer.physics.vehiclePosition=new LatLng(parseFloat(e),parseFloat(i)),cesiumExplorer.physics.vehicleAltitude=new vehicle.Suspension(parseFloat(o),parseFloat(o),cesiumExplorer.physics.vehicleData.suspensionMass,cesiumExplorer.physics.vehicleData.suspensionSpring,cesiumExplorer.physics.vehicleData.suspensionDamper),cesiumExplorer.physics.vehicleTilt=new vehicle.Suspension(0,0,cesiumExplorer.physics.vehicleData.tiltMass,cesiumExplorer.physics.vehicleData.tiltSpring,cesiumExplorer.physics.vehicleData.tiltDamper),cesiumExplorer.physics.vehicleRoll=new vehicle.Suspension(0,0,cesiumExplorer.physics.vehicleData.rollMass,cesiumExplorer.physics.vehicleData.rollSpring,cesiumExplorer.physics.vehicleData.rollDamper),cesiumExplorer.physics.setupPhysics(a*Math.PI/180);var h={alt:t,speed:s,lat:e,lng:i},l=function(){var e=this.alt,i=this.lat,t=this.lng,s=this.speed,o=this;if(!cesiumExplorer.physics.isSpawning){var n=cesiumExplorer.physics.getAltitude(new LatLng(i,t),"goto")+(e?e:0);if(n&&(e=n),cesiumExplorer.physics.ee.removeListener("postUpdate",o.callback),cesiumExplorer.physics.vehicle.body.setLinearVelocity(new box2D.common.math.B2Vec2(0,0)),cesiumExplorer.physics.vehicleData.minGroundAlt=e,cesiumExplorer.physics.vehicle.tiltOffset=180,cesiumExplorer.physics.vehicle.altitudeOffset=0,cesiumExplorer.physics.vehiclePosition=new LatLng(parseFloat(i),parseFloat(t)),cesiumExplorer.physics.vehicleAltitude=new vehicle.Suspension(parseFloat(e),parseFloat(e),cesiumExplorer.physics.vehicleData.suspensionMass,cesiumExplorer.physics.vehicleData.suspensionSpring,cesiumExplorer.physics.vehicleData.suspensionDamper),cesiumExplorer.physics.vehicleTilt=new vehicle.Suspension(0,0,cesiumExplorer.physics.vehicleData.tiltMass,cesiumExplorer.physics.vehicleData.tiltSpring,cesiumExplorer.physics.vehicleData.tiltDamper),
cesiumExplorer.physics.vehicleRoll=new vehicle.Suspension(0,0,cesiumExplorer.physics.vehicleData.rollMass,cesiumExplorer.physics.vehicleData.rollSpring,cesiumExplorer.physics.vehicleData.rollDamper),cesiumExplorer.physics.setupPhysics(a*Math.PI/180),cesiumExplorer.physics&&(cesiumExplorer.physics.vehicleAltitude.targetPosition=cesiumExplorer.physics.vehicleAltitude.position=e),s){var h=vehicle.Box2DUtils.getFrontVector(cesiumExplorer.physics.vehicle.body);h.multiply(s/3.6),cesiumExplorer.physics.vehicle.body.m_linearVelocity.add(h)}}};h.callback=$bind(h,l),cesiumExplorer.physics.ee.addListener("postUpdate",h.callback)},cesiumExplorer.activate=window.cesiumExplorer.activate=function(){cesiumExplorer.physics.setActive(!0)},cesiumExplorer.deactivate=window.cesiumExplorer.deactivate=function(){cesiumExplorer.physics.setActive(!1)};var IMap=function(){},PolygonData=function(){};PolygonData.createCarVertices=function(e,i,t){var s=!1;s="plane"==t?[[i/5,-e/2],[i/4,-e/3],[i/4,-e/7],[i,0],[i,e/7],[i/4,e/7],[i/4,e/2]]:[[i/2,-e/2],[i/2,e/2]];for(var a=[],o=0;o<s.length;){var n=s[o];++o,a.push(new box2D.common.math.B2Vec2(n[0],n[1]))}for(var h=s.length;--h>=0;){var n=s[h];a.push(new box2D.common.math.B2Vec2(-n[0],n[1]))}return a},PolygonData.getCarVertices=function(e,i,t){return PolygonData.createCarVertices(e,i,t)};var Reflect=function(){};Reflect.isFunction=function(e){return"function"==typeof e&&!(e.__name__||e.__ename__)};var Std=function(){};Std.string=function(e){return js.Boot.__string_rec(e,"")},Std.random=function(e){return 0>=e?0:Math.floor(Math.random()*e)};var StringTools=function(){};StringTools.hex=function(e,i){var t="",s="0123456789ABCDEF";do t=s.charAt(15&e)+t,e>>>=4;while(e>0);if(null!=i)for(;t.length<i;)t="0"+t;return t};var ViewPoint=function(e,i,t,s,a,o){this.type=e,this.altitude=i,this.offset=t,this.dir=a,this.tilt=s,this.heading=o},haxe={};haxe.Timer=function(){},haxe.Timer.stamp=function(){return Date.now()/1e3},haxe.ds={},haxe.ds.StringMap=function(){this.h={}},haxe.ds.StringMap.__interfaces__=[IMap],haxe.ds.StringMap.prototype={set:function(e,i){this.h["$"+e]=i},get:function(e){return this.h["$"+e]},keys:function(){var e=[];for(var i in this.h)this.h.hasOwnProperty(i)&&e.push(i.substr(1));return iter(e)}};var HxOverrides=function(){};HxOverrides.__name__=!0,HxOverrides.dateStr=function(e){var i=e.getMonth()+1,t=e.getDate(),s=e.getHours(),a=e.getMinutes(),o=e.getSeconds();return e.getFullYear()+"-"+(10>i?"0"+i:""+i)+"-"+(10>t?"0"+t:""+t)+" "+(10>s?"0"+s:""+s)+":"+(10>a?"0"+a:""+a)+":"+(10>o?"0"+o:""+o)},HxOverrides.strDate=function(e){switch(e.length){case 8:var i=e.split(":"),t=new Date;return t.setTime(0),t.setUTCHours(i[0]),t.setUTCMinutes(i[1]),t.setUTCSeconds(i[2]),t;case 10:var i=e.split("-");return new Date(i[0],i[1]-1,i[2],0,0,0);case 19:var i=e.split(" "),s=i[0].split("-"),a=i[1].split(":");return new Date(s[0],s[1]-1,s[2],a[0],a[1],a[2]);default:throw"Invalid date format : "+e}},HxOverrides.cca=function(e,i){var t=e.charCodeAt(i);return t!=t?void 0:t},HxOverrides.substr=function(e,i,t){return null!=i&&0!=i&&null!=t&&0>t?"":(null==t&&(t=e.length),0>i?(i=e.length+i,0>i&&(i=0)):0>t&&(t=e.length+t-i),e.substr(i,t))},HxOverrides.remove=function(e,i){for(var t=0,s=e.length;s>t;){if(e[t]==i)return e.splice(t,1),!0;t++}return!1},HxOverrides.iter=function(e){return{cur:0,arr:e,hasNext:function(){return this.cur<this.arr.length},next:function(){return this.arr[this.cur++]}}};var js={};js.Boot=function(){},js.Boot.__string_rec=function(e,i){if(null==e)return"null";if(i.length>=5)return"<...>";var t=typeof e;switch("function"==t&&(e.__name__||e.__ename__)&&(t="object"),t){case"object":if(e instanceof Array){if(e.__enum__){if(2==e.length)return e[0];var s=e[0]+"(";i+="	";for(var a=2,o=e.length;o>a;){var n=a++;s+=2!=n?","+js.Boot.__string_rec(e[n],i):js.Boot.__string_rec(e[n],i)}return s+")"}var n,h=e.length,s="[";i+="	";for(var o=0;h>o;){var l=o++;s+=(l>0?",":"")+js.Boot.__string_rec(e[l],i)}return s+="]"}var r;if(r=e.toString,null!=r&&r!=Object.toString){var c=e.toString();if("[object Object]"!=c)return c}var d=null,s="{\n";i+="	";var m=null!=e.hasOwnProperty;for(var d in e)(!m||e.hasOwnProperty(d))&&"prototype"!=d&&"__class__"!=d&&"__super__"!=d&&"__interfaces__"!=d&&"__properties__"!=d&&(2!=s.length&&(s+=", \n"),s+=i+d+" : "+js.Boot.__string_rec(e[d],i));return i=i.substring(1),s+="\n"+i+"}";case"function":return"<function>";case"string":return e;default:return String(e)}},js.Boot.__interfLoop=function(e,i){if(null==e)return!1;if(e==i)return!0;var t=e.__interfaces__;if(null!=t)for(var s=0,a=t.length;a>s;){var o=s++,n=t[o];if(n==i||js.Boot.__interfLoop(n,i))return!0}return js.Boot.__interfLoop(e.__super__,i)},js.Boot.__instanceof=function(e,i){if(null==i)return!1;switch(i){case Int:return(0|e)===e;case Float:return"number"==typeof e;case Bool:return"boolean"==typeof e;case String:return"string"==typeof e;case Dynamic:return!0;default:if(null==e)return!1;if("function"==typeof i){if(e instanceof i)return i==Array?null==e.__enum__:!0;if(js.Boot.__interfLoop(e.__class__,i))return!0}return i==Class&&null!=e.__name__?!0:i==Enum&&null!=e.__ename__?!0:e.__enum__==i}},js.Boot.__cast=function(e,i){if(js.Boot.__instanceof(e,i))return e;throw"Cannot cast "+Std.string(e)+" to "+Std.string(i)};var $_,$fid=0;Array.prototype.indexOf&&(remove=function(e,i){var t=e.indexOf(i);return-1==t?!1:(e.splice(t,1),!0)}),Math.NaN=Number.NaN,Math.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,Math.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,Math.isFinite=function(e){return isFinite(e)},Math.isNaN=function(e){return isNaN(e)},String.prototype.__class__=String,String.__name__=!0,Array.prototype.__class__=Array,Array.__name__=!0,Date.prototype.__class__=Date,Date.__name__=["Date"];var Int={__name__:["Int"]},Dynamic={__name__:["Dynamic"]},Float=Number;Float.__name__=["Float"];var Bool=Boolean;Bool.__ename__=["Bool"];var Class={__name__:["Class"]},Enum={};DrivingSimulator.DRIVERS_EYE_X=.35,DrivingSimulator.DRIVERS_EYE_Y=0,DrivingSimulator.DRIVERS_EYE_Z=1.2,DrivingSimulator.STEERING_OFFSET_Y=.75,DrivingSimulator.STEERING_OFFSET_Z=-.32,DrivingSimulator.VIEWPOINT_DRIVER=0,DrivingSimulator.VIEWPOINT_RC=3,DrivingSimulator.VIEWPOINT_TOPDOWN=4,DrivingSimulator.GRAVITY_X=616,DrivingSimulator.GRAVITY_Y=210,DrivingSimulator.GRAVITY_MARKER_X=664,DrivingSimulator.GRAVITY_MARKER_Y=258,LatLng.EARTH_RADIUS=6371e3,box2D.collision.B2Collision.b2_nullFeature=255,box2D.collision.B2Collision.s_incidentEdge=box2D.collision.B2Collision.makeClipPointVector(),box2D.collision.B2Collision.s_clipPoints1=box2D.collision.B2Collision.makeClipPointVector(),box2D.collision.B2Collision.s_clipPoints2=box2D.collision.B2Collision.makeClipPointVector(),box2D.collision.B2Collision.s_edgeAO=new Array,box2D.collision.B2Collision.s_edgeBO=new Array,box2D.collision.B2Collision.s_localTangent=new box2D.common.math.B2Vec2,box2D.collision.B2Collision.s_localNormal=new box2D.common.math.B2Vec2,box2D.collision.B2Collision.s_planePoint=new box2D.common.math.B2Vec2,box2D.collision.B2Collision.s_normal=new box2D.common.math.B2Vec2,box2D.collision.B2Collision.s_tangent=new box2D.common.math.B2Vec2,box2D.collision.B2Collision.s_tangent2=new box2D.common.math.B2Vec2,box2D.collision.B2Collision.s_v11=new box2D.common.math.B2Vec2,box2D.collision.B2Collision.s_v12=new box2D.common.math.B2Vec2,box2D.collision.B2Collision.b2CollidePolyTempVec=new box2D.common.math.B2Vec2,box2D.collision.B2Distance.s_simplex=new box2D.collision.B2Simplex,box2D.collision.B2Distance.s_saveA=new Array,box2D.collision.B2Distance.s_saveB=new Array,box2D.collision.B2DynamicTreeNode.currentID=0,box2D.collision.B2Manifold.e_circles=1,box2D.collision.B2Manifold.e_faceA=2,box2D.collision.B2Manifold.e_faceB=4,box2D.collision.B2SeparationFunction.e_points=1,box2D.collision.B2SeparationFunction.e_faceA=2,box2D.collision.B2SeparationFunction.e_faceB=4,box2D.collision.B2TimeOfImpact.b2_toiCalls=0,box2D.collision.B2TimeOfImpact.b2_toiIters=0,box2D.collision.B2TimeOfImpact.b2_toiMaxIters=0,box2D.collision.B2TimeOfImpact.b2_toiRootIters=0,box2D.collision.B2TimeOfImpact.b2_toiMaxRootIters=0,box2D.collision.B2TimeOfImpact.s_cache=new box2D.collision.B2SimplexCache,box2D.collision.B2TimeOfImpact.s_distanceInput=new box2D.collision.B2DistanceInput,box2D.collision.B2TimeOfImpact.s_xfA=new box2D.common.math.B2Transform,box2D.collision.B2TimeOfImpact.s_xfB=new box2D.common.math.B2Transform,box2D.collision.B2TimeOfImpact.s_fcn=new box2D.collision.B2SeparationFunction,box2D.collision.B2TimeOfImpact.s_distanceOutput=new box2D.collision.B2DistanceOutput,box2D.collision.shapes.B2Shape.e_unknownShape=-1,box2D.collision.shapes.B2Shape.e_circleShape=0,box2D.collision.shapes.B2Shape.e_polygonShape=1,box2D.collision.shapes.B2Shape.e_edgeShape=2,box2D.collision.shapes.B2Shape.e_shapeTypeCount=3,box2D.collision.shapes.B2Shape.e_hitCollide=1,box2D.collision.shapes.B2Shape.e_missCollide=0,box2D.collision.shapes.B2Shape.e_startsInsideCollide=-1,box2D.collision.shapes.B2PolygonShape.s_mat=new box2D.common.math.B2Mat22,box2D.common.B2Settings.VERSION="2.1alpha",box2D.common.B2Settings.USHRT_MAX=65535,box2D.common.B2Settings.b2_pi=Math.PI,box2D.common.B2Settings.b2_maxManifoldPoints=2,box2D.common.B2Settings.b2_aabbExtension=.1,box2D.common.B2Settings.b2_aabbMultiplier=2,box2D.common.B2Settings.b2_polygonRadius=2*box2D.common.B2Settings.b2_linearSlop,box2D.common.B2Settings.b2_linearSlop=.005,box2D.common.B2Settings.b2_angularSlop=.011111111111111112*box2D.common.B2Settings.b2_pi,box2D.common.B2Settings.b2_toiSlop=8*box2D.common.B2Settings.b2_linearSlop,box2D.common.B2Settings.b2_maxTOIContactsPerIsland=32,box2D.common.B2Settings.b2_maxTOIJointsPerIsland=32,box2D.common.B2Settings.b2_velocityThreshold=1,box2D.common.B2Settings.b2_maxLinearCorrection=.2,box2D.common.B2Settings.b2_maxAngularCorrection=.044444444444444446*box2D.common.B2Settings.b2_pi,box2D.common.B2Settings.b2_maxTranslation=999999,box2D.common.B2Settings.b2_maxTranslationSquared=box2D.common.B2Settings.b2_maxTranslation*box2D.common.B2Settings.b2_maxTranslation,box2D.common.B2Settings.b2_maxRotation=5.5*box2D.common.B2Settings.b2_pi,box2D.common.B2Settings.b2_maxRotationSquared=box2D.common.B2Settings.b2_maxRotation*box2D.common.B2Settings.b2_maxRotation,box2D.common.B2Settings.b2_contactBaumgarte=.2,box2D.common.B2Settings.b2_timeToSleep=.5,box2D.common.B2Settings.b2_linearSleepTolerance=.01,box2D.common.B2Settings.b2_angularSleepTolerance=.011111111111111112*box2D.common.B2Settings.b2_pi,box2D.common.math.B2Math.b2Vec2_zero=new box2D.common.math.B2Vec2(0,0),box2D.common.math.B2Math.b2Mat22_identity=box2D.common.math.B2Mat22.fromVV(new box2D.common.math.B2Vec2(1,0),new box2D.common.math.B2Vec2(0,1)),box2D.common.math.B2Math.b2Transform_identity=new box2D.common.math.B2Transform(box2D.common.math.B2Math.b2Vec2_zero,box2D.common.math.B2Math.b2Mat22_identity),box2D.common.math.B2Math.MIN_VALUE=2.2250738585072014e-308,box2D.common.math.B2Math.MAX_VALUE=1.7976931348623157e308,box2D.dynamics.B2Body.s_xf1=new box2D.common.math.B2Transform,box2D.dynamics.B2Body.e_islandFlag=1,box2D.dynamics.B2Body.e_awakeFlag=2,box2D.dynamics.B2Body.e_allowSleepFlag=4,box2D.dynamics.B2Body.e_bulletFlag=8,box2D.dynamics.B2Body.e_fixedRotationFlag=16,box2D.dynamics.B2Body.e_activeFlag=32,box2D.dynamics.B2Body.b2_staticBody=0,box2D.dynamics.B2Body.b2_kinematicBody=1,box2D.dynamics.B2Body.b2_dynamicBody=2,box2D.dynamics.B2ContactFilter.b2_defaultFilter=new box2D.dynamics.B2ContactFilter,box2D.dynamics.B2ContactListener.b2_defaultListener=new box2D.dynamics.B2ContactListener,box2D.dynamics.B2ContactManager.s_evalCP=new box2D.collision.B2ContactPoint,box2D.dynamics.B2DebugDraw.e_shapeBit=1,box2D.dynamics.B2DebugDraw.e_jointBit=2,box2D.dynamics.B2DebugDraw.e_aabbBit=4,box2D.dynamics.B2DebugDraw.e_pairBit=8,box2D.dynamics.B2DebugDraw.e_centerOfMassBit=16,box2D.dynamics.B2DebugDraw.e_controllerBit=32,box2D.dynamics.B2Island.s_impulse=new box2D.dynamics.B2ContactImpulse,box2D.dynamics.B2World.s_timestep2=new box2D.dynamics.B2TimeStep,box2D.dynamics.B2World.s_xf=new box2D.common.math.B2Transform,box2D.dynamics.B2World.s_backupA=new box2D.common.math.B2Sweep,box2D.dynamics.B2World.s_backupB=new box2D.common.math.B2Sweep,box2D.dynamics.B2World.s_timestep=new box2D.dynamics.B2TimeStep,box2D.dynamics.B2World.s_queue=new Array,box2D.dynamics.B2World.s_jointColor=new box2D.common.B2Color(.5,.8,.8),box2D.dynamics.B2World.e_newFixture=1,box2D.dynamics.B2World.e_locked=2,box2D.dynamics.contacts.B2Contact.e_sensorFlag=1,box2D.dynamics.contacts.B2Contact.e_continuousFlag=2,box2D.dynamics.contacts.B2Contact.e_islandFlag=4,box2D.dynamics.contacts.B2Contact.e_toiFlag=8,box2D.dynamics.contacts.B2Contact.e_touchingFlag=16,box2D.dynamics.contacts.B2Contact.e_enabledFlag=32,box2D.dynamics.contacts.B2Contact.e_filterFlag=64,box2D.dynamics.contacts.B2Contact.s_input=new box2D.collision.B2TOIInput,box2D.dynamics.contacts.B2PositionSolverManifold.circlePointA=new box2D.common.math.B2Vec2,box2D.dynamics.contacts.B2PositionSolverManifold.circlePointB=new box2D.common.math.B2Vec2,box2D.dynamics.contacts.B2ContactSolver.s_worldManifold=new box2D.collision.B2WorldManifold,box2D.dynamics.contacts.B2ContactSolver.s_psm=new box2D.dynamics.contacts.B2PositionSolverManifold,box2D.dynamics.joints.B2Joint.e_unknownJoint=0,box2D.dynamics.joints.B2Joint.e_revoluteJoint=1,box2D.dynamics.joints.B2Joint.e_prismaticJoint=2,box2D.dynamics.joints.B2Joint.e_distanceJoint=3,box2D.dynamics.joints.B2Joint.e_pulleyJoint=4,box2D.dynamics.joints.B2Joint.e_mouseJoint=5,box2D.dynamics.joints.B2Joint.e_gearJoint=6,box2D.dynamics.joints.B2Joint.e_lineJoint=7,box2D.dynamics.joints.B2Joint.e_weldJoint=8,box2D.dynamics.joints.B2Joint.e_frictionJoint=9,box2D.dynamics.joints.B2Joint.e_inactiveLimit=0,box2D.dynamics.joints.B2Joint.e_atLowerLimit=1,box2D.dynamics.joints.B2Joint.e_atUpperLimit=2,box2D.dynamics.joints.B2Joint.e_equalLimits=3,box2D.dynamics.joints.B2PulleyJoint.b2_minPulleyLength=2,box2D.dynamics.joints.B2RevoluteJoint.tImpulse=new box2D.common.math.B2Vec2,Math3D.Angle.PI2=6.283185307179586,vehicle.GearBox.DRIVE=1,vehicle.GearBox.REVERSE=-1,vehicle.Vehicle.GEAR_CHANGE_TARGET=.4,vehicle.Vehicle.ROLLING_DRAG_FORCE=25,vehicle.Vehicle.BUMP_DRAG_FACTOR=1e3;