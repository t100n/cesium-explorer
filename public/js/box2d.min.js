box2D={},box2D.collision={},box2D.collision.B2AABB=function(){this.lowerBound=new box2D.common.math.B2Vec2,this.upperBound=new box2D.common.math.B2Vec2},box2D.collision.B2AABB.__name__=!0,box2D.collision.B2AABB.prototype={isValid:function(){var t=this.upperBound.x-this.lowerBound.x,o=this.upperBound.y-this.lowerBound.y,i=t>=0&&o>=0;return i=i&&this.lowerBound.isValid()&&this.upperBound.isValid()},getCenter:function(){return new box2D.common.math.B2Vec2((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)},getExtents:function(){return new box2D.common.math.B2Vec2((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)},contains:function(t){var o=!0;return o=o&&this.lowerBound.x<=t.lowerBound.x,o=o&&this.lowerBound.y<=t.lowerBound.y,o=o&&t.upperBound.x<=this.upperBound.x,o=o&&t.upperBound.y<=this.upperBound.y},rayCast:function(t,o){var i,s,n,e,m,a=-1.7976931348623157e308,c=1.7976931348623157e308,l=o.p1.x,r=o.p1.y,_=o.p2.x-o.p1.x,h=o.p2.y-o.p1.y,x=Math.abs(_),y=Math.abs(h),u=t.normal;if(2.2250738585072014e-308>x){if(l<this.lowerBound.x||this.upperBound.x<l)return!1}else if(i=1/_,s=(this.lowerBound.x-l)*i,n=(this.upperBound.x-l)*i,m=-1,s>n&&(e=s,s=n,n=e,m=1),s>a&&(u.x=m,u.y=0,a=s),c=Math.min(c,n),a>c)return!1;if(2.2250738585072014e-308>y){if(r<this.lowerBound.y||this.upperBound.y<r)return!1}else if(i=1/h,s=(this.lowerBound.y-r)*i,n=(this.upperBound.y-r)*i,m=-1,s>n&&(e=s,s=n,n=e,m=1),s>a&&(u.y=m,u.x=0,a=s),c=Math.min(c,n),a>c)return!1;return t.fraction=a,!0},testOverlap:function(t){var o=t.lowerBound.x-this.upperBound.x,i=t.lowerBound.y-this.upperBound.y,s=this.lowerBound.x-t.upperBound.x,n=this.lowerBound.y-t.upperBound.y;return o>0||i>0?!1:s>0||n>0?!1:!0},combine:function(t,o){this.lowerBound.x=Math.min(t.lowerBound.x,o.lowerBound.x),this.lowerBound.y=Math.min(t.lowerBound.y,o.lowerBound.y),this.upperBound.x=Math.max(t.upperBound.x,o.upperBound.x),this.upperBound.y=Math.max(t.upperBound.y,o.upperBound.y)},__class__:box2D.collision.B2AABB},box2D.common={},box2D.common.math={},box2D.common.math.B2Vec2=function(t,o){null==o&&(o=0),null==t&&(t=0),this.x=t,this.y=o},box2D.common.math.B2Vec2.__name__=!0,box2D.common.math.B2Vec2.make=function(t,o){return new box2D.common.math.B2Vec2(t,o)},box2D.common.math.B2Vec2.prototype={setZero:function(){this.x=0,this.y=0},set:function(t,o){null==o&&(o=0),null==t&&(t=0),this.x=t,this.y=o},setV:function(t){this.x=t.x,this.y=t.y},getNegative:function(){return new box2D.common.math.B2Vec2(-this.x,-this.y)},negativeSelf:function(){this.x=-this.x,this.y=-this.y},copy:function(){return new box2D.common.math.B2Vec2(this.x,this.y)},add:function(t){this.x+=t.x,this.y+=t.y},subtract:function(t){this.x-=t.x,this.y-=t.y},multiply:function(t){this.x*=t,this.y*=t},mulM:function(t){var o=this.x;this.x=t.col1.x*o+t.col2.x*this.y,this.y=t.col1.y*o+t.col2.y*this.y},mulTM:function(t){var o=box2D.common.math.B2Math.dot(this,t.col1);this.y=box2D.common.math.B2Math.dot(this,t.col2),this.x=o},crossVF:function(t){var o=this.x;this.x=t*this.y,this.y=-t*o},crossFV:function(t){var o=this.x;this.x=-t*this.y,this.y=t*o},minV:function(t){this.x=this.x<t.x?this.x:t.x,this.y=this.y<t.y?this.y:t.y},maxV:function(t){this.x=this.x>t.x?this.x:t.x,this.y=this.y>t.y?this.y:t.y},abs:function(){this.x<0&&(this.x=-this.x),this.y<0&&(this.y=-this.y)},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthSquared:function(){return this.x*this.x+this.y*this.y},normalize:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);if(2.2250738585072014e-308>t)return 0;var o=1/t;return this.x*=o,this.y*=o,t},isValid:function(){return box2D.common.math.B2Math.isValid(this.x)&&box2D.common.math.B2Math.isValid(this.y)},__class__:box2D.common.math.B2Vec2},box2D.collision.ClipVertex=function(){this.v=new box2D.common.math.B2Vec2,this.id=new box2D.collision.B2ContactID},box2D.collision.ClipVertex.__name__=!0,box2D.collision.ClipVertex.prototype={set:function(t){this.v.setV(t.v),this.id.set(t.id)},__class__:box2D.collision.ClipVertex},box2D.collision.B2ContactID=function(){this.features=new box2D.collision.Features,this.features._m_id=this},box2D.collision.B2ContactID.__name__=!0,box2D.collision.B2ContactID.prototype={set:function(t){this.set_key(t._key)},copy:function(){var t=new box2D.collision.B2ContactID;return t.set_key(this.get_key()),t},get_key:function(){return this._key},set_key:function(t){return this._key=t,this.features._referenceEdge=255&this._key,this.features._incidentEdge=(65280&this._key)>>8&255,this.features._incidentVertex=(16711680&this._key)>>16&255,this.features._flip=(-16777216&this._key)>>24&255,this._key},__class__:box2D.collision.B2ContactID},box2D.collision.Features=function(){},box2D.collision.Features.__name__=!0,box2D.collision.Features.prototype={get_referenceEdge:function(){return this._referenceEdge},set_referenceEdge:function(t){return this._referenceEdge=t,this._m_id._key=-256&this._m_id._key|255&this._referenceEdge,t},get_incidentEdge:function(){return this._incidentEdge},set_incidentEdge:function(t){return this._incidentEdge=t,this._m_id._key=-65281&this._m_id._key|this._incidentEdge<<8&65280,t},get_incidentVertex:function(){return this._incidentVertex},set_incidentVertex:function(t){return this._incidentVertex=t,this._m_id._key=-16711681&this._m_id._key|this._incidentVertex<<16&16711680,t},get_flip:function(){return this._flip},set_flip:function(t){return this._flip=t,this._m_id._key=16777215&this._m_id._key|this._flip<<24&-16777216,t},__class__:box2D.collision.Features},box2D.collision.B2Collision=function(){},box2D.collision.B2Collision.__name__=!0,box2D.collision.B2Collision.clipSegmentToLine=function(t,o,i,s){var n,e=0;n=o[0];var m=n.v;n=o[1];var a=n.v,c=i.x*m.x+i.y*m.y-s,l=i.x*a.x+i.y*a.y-s;if(0>=c&&t[e++].set(o[0]),0>=l&&t[e++].set(o[1]),0>c*l){var r=c/(c-l);n=t[e];var _=n.v;_.x=m.x+r*(a.x-m.x),_.y=m.y+r*(a.y-m.y),n=t[e];var h;c>0?(h=o[0],n.id=h.id):(h=o[1],n.id=h.id),++e}return e},box2D.collision.B2Collision.edgeSeparation=function(t,o,i,s,n){var e,m,a=(t.m_vertexCount,t.m_vertices),c=t.m_normals,l=s.m_vertexCount,r=s.m_vertices;e=o.R,m=c[i];var _=e.col1.x*m.x+e.col2.x*m.y,h=e.col1.y*m.x+e.col2.y*m.y;e=n.R;for(var x=e.col1.x*_+e.col1.y*h,y=e.col2.x*_+e.col2.y*h,u=0,p=1.7976931348623157e308,d=0;l>d;){var B=d++;m=r[B];var b=m.x*x+m.y*y;p>b&&(p=b,u=B)}m=a[i],e=o.R;var D=o.position.x+(e.col1.x*m.x+e.col2.x*m.y),f=o.position.y+(e.col1.y*m.x+e.col2.y*m.y);m=r[u],e=n.R;var g=n.position.x+(e.col1.x*m.x+e.col2.x*m.y),v=n.position.y+(e.col1.y*m.x+e.col2.y*m.y);g-=D,v-=f;var A=g*_+v*h;return A},box2D.collision.B2Collision.findMaxSeparation=function(t,o,i,s,n){var e,m,a=o.m_vertexCount,c=o.m_normals;m=n.R,e=s.m_centroid;var l=n.position.x+(m.col1.x*e.x+m.col2.x*e.y),r=n.position.y+(m.col1.y*e.x+m.col2.y*e.y);m=i.R,e=o.m_centroid,l-=i.position.x+(m.col1.x*e.x+m.col2.x*e.y),r-=i.position.y+(m.col1.y*e.x+m.col2.y*e.y);for(var _=l*i.R.col1.x+r*i.R.col1.y,h=l*i.R.col2.x+r*i.R.col2.y,x=0,y=-1.7976931348623157e308,u=0;a>u;){var p=u++;e=c[p];var d=e.x*_+e.y*h;d>y&&(y=d,x=p)}var B,b=box2D.collision.B2Collision.edgeSeparation(o,i,x,s,n);B=x-1>=0?x-1:a-1;var D,f=box2D.collision.B2Collision.edgeSeparation(o,i,B,s,n);D=a>x+1?x+1:0;var g,v,A,w=box2D.collision.B2Collision.edgeSeparation(o,i,D,s,n);if(f>b&&f>w)A=-1,g=B,v=f;else{if(!(w>b))return t[0]=x,b;A=1,g=D,v=w}for(;;){if(x=-1==A?g-1>=0?g-1:a-1:a>g+1?g+1:0,b=box2D.collision.B2Collision.edgeSeparation(o,i,x,s,n),!(b>v))break;g=x,v=b}return t[0]=g,v},box2D.collision.B2Collision.findIncidentEdge=function(t,o,i,s,n,e){var m,a,c=(o.m_vertexCount,o.m_normals),l=n.m_vertexCount,r=n.m_vertices,_=n.m_normals;m=i.R,a=c[s];var h=m.col1.x*a.x+m.col2.x*a.y,x=m.col1.y*a.x+m.col2.y*a.y;m=e.R;var y=m.col1.x*h+m.col1.y*x;x=m.col2.x*h+m.col2.y*x,h=y;for(var u=0,p=1.7976931348623157e308,d=0;l>d;){var B=d++;a=_[B];var b=h*a.x+x*a.y;p>b&&(p=b,u=B)}var D,f,g=u;f=l>g+1?g+1:0,D=t[0],a=r[g],m=e.R,D.v.x=e.position.x+(m.col1.x*a.x+m.col2.x*a.y),D.v.y=e.position.y+(m.col1.y*a.x+m.col2.y*a.y),D.id.features.set_referenceEdge(s),D.id.features.set_incidentEdge(g),D.id.features.set_incidentVertex(0),D=t[1],a=r[f],m=e.R,D.v.x=e.position.x+(m.col1.x*a.x+m.col2.x*a.y),D.v.y=e.position.y+(m.col1.y*a.x+m.col2.y*a.y),D.id.features.set_referenceEdge(s),D.id.features.set_incidentEdge(f),D.id.features.set_incidentVertex(1)},box2D.collision.B2Collision.makeClipPointVector=function(){var t=new Array;return t[0]=new box2D.collision.ClipVertex,t[1]=new box2D.collision.ClipVertex,t},box2D.collision.B2Collision.collidePolygons=function(t,o,i,s,n){var e;t.m_pointCount=0;var m=o.m_radius+s.m_radius,a=0;box2D.collision.B2Collision.s_edgeAO[0]=a;var c=box2D.collision.B2Collision.findMaxSeparation(box2D.collision.B2Collision.s_edgeAO,o,i,s,n);if(a=box2D.collision.B2Collision.s_edgeAO[0],!(c>m)){var l=0;box2D.collision.B2Collision.s_edgeBO[0]=l;var r=box2D.collision.B2Collision.findMaxSeparation(box2D.collision.B2Collision.s_edgeBO,s,n,o,i);if(l=box2D.collision.B2Collision.s_edgeBO[0],!(r>m)){var _,h,x,y,u,p,d,B=.98,b=.001;r>B*c+b?(_=s,h=o,x=n,y=i,u=l,t.m_type=box2D.collision.B2Manifold.e_faceB,p=1):(_=o,h=s,x=i,y=n,u=a,t.m_type=box2D.collision.B2Manifold.e_faceA,p=0);var D=box2D.collision.B2Collision.s_incidentEdge;box2D.collision.B2Collision.findIncidentEdge(D,_,x,u,h,y);var f,g=_.m_vertexCount,v=_.m_vertices,A=v[u];f=g>u+1?v[u+1|0]:v[0];var w=box2D.collision.B2Collision.s_localTangent;w.set(f.x-A.x,f.y-A.y),w.normalize();var V=box2D.collision.B2Collision.s_localNormal;V.x=w.y,V.y=-w.x;var C=box2D.collision.B2Collision.s_planePoint;C.set(.5*(A.x+f.x),.5*(A.y+f.y));var M=box2D.collision.B2Collision.s_tangent;d=x.R,M.x=d.col1.x*w.x+d.col2.x*w.y,M.y=d.col1.y*w.x+d.col2.y*w.y;var S=box2D.collision.B2Collision.s_tangent2;S.x=-M.x,S.y=-M.y;var I=box2D.collision.B2Collision.s_normal;I.x=M.y,I.y=-M.x;var j=box2D.collision.B2Collision.s_v11,L=box2D.collision.B2Collision.s_v12;j.x=x.position.x+(d.col1.x*A.x+d.col2.x*A.y),j.y=x.position.y+(d.col1.y*A.x+d.col2.y*A.y),L.x=x.position.x+(d.col1.x*f.x+d.col2.x*f.y),L.y=x.position.y+(d.col1.y*f.x+d.col2.y*f.y);var P,J=I.x*j.x+I.y*j.y,F=-M.x*j.x-M.y*j.y+m,T=M.x*L.x+M.y*L.y+m,R=box2D.collision.B2Collision.s_clipPoints1,z=box2D.collision.B2Collision.s_clipPoints2;if(P=box2D.collision.B2Collision.clipSegmentToLine(R,D,S,F),!(2>P||(P=box2D.collision.B2Collision.clipSegmentToLine(z,R,M,T),2>P))){t.m_localPlaneNormal.setV(V),t.m_localPoint.setV(C);for(var k=0,q=0,E=box2D.common.B2Settings.b2_maxManifoldPoints;E>q;){var K=q++;e=z[K];var O=I.x*e.v.x+I.y*e.v.y-J;if(m>=O){var W=t.m_points[k];d=y.R;var N=e.v.x-y.position.x,X=e.v.y-y.position.y;W.m_localPoint.x=N*d.col1.x+X*d.col1.y,W.m_localPoint.y=N*d.col2.x+X*d.col2.y,W.m_id.set(e.id),W.m_id.features.set_flip(p),++k}}t.m_pointCount=k}}}},box2D.collision.B2Collision.collideCircles=function(t,o,i,s,n){t.m_pointCount=0;var e,m;e=i.R,m=o.m_p;var a=i.position.x+(e.col1.x*m.x+e.col2.x*m.y),c=i.position.y+(e.col1.y*m.x+e.col2.y*m.y);e=n.R,m=s.m_p;var l=n.position.x+(e.col1.x*m.x+e.col2.x*m.y),r=n.position.y+(e.col1.y*m.x+e.col2.y*m.y),_=l-a,h=r-c,x=_*_+h*h,y=o.m_radius+s.m_radius;x>y*y||(t.m_type=box2D.collision.B2Manifold.e_circles,t.m_localPoint.setV(o.m_p),t.m_localPlaneNormal.setZero(),t.m_pointCount=1,t.m_points[0].m_localPoint.setV(s.m_p),t.m_points[0].m_id.set_key(0))},box2D.collision.B2Collision.collidePolygonAndCircle=function(t,o,i,s,n){t.m_pointCount=0;var e,m,a,c;c=n.R,a=s.m_p;var l=n.position.x+(c.col1.x*a.x+c.col2.x*a.y),r=n.position.y+(c.col1.y*a.x+c.col2.y*a.y);e=l-i.position.x,m=r-i.position.y,c=i.R;for(var _=e*c.col1.x+m*c.col1.y,h=e*c.col2.x+m*c.col2.y,x=0,y=-1.7976931348623157e308,u=o.m_radius+s.m_radius,p=o.m_vertexCount,d=o.m_vertices,B=o.m_normals,b=0;p>b;){var D=b++;a=d[D],e=_-a.x,m=h-a.y,a=B[D];var f=a.x*e+a.y*m;if(f>u)return;f>y&&(y=f,x=D)}var g,v=x;g=p>v+1?v+1:0;var A=d[v],w=d[g];if(2.2250738585072014e-308>y)return t.m_pointCount=1,t.m_type=box2D.collision.B2Manifold.e_faceA,t.m_localPlaneNormal.setV(B[x]),t.m_localPoint.x=.5*(A.x+w.x),t.m_localPoint.y=.5*(A.y+w.y),t.m_points[0].m_localPoint.setV(s.m_p),void t.m_points[0].m_id.set_key(0);var V=(_-A.x)*(w.x-A.x)+(h-A.y)*(w.y-A.y),C=(_-w.x)*(A.x-w.x)+(h-w.y)*(A.y-w.y);if(0>=V){if((_-A.x)*(_-A.x)+(h-A.y)*(h-A.y)>u*u)return;t.m_pointCount=1,t.m_type=box2D.collision.B2Manifold.e_faceA,t.m_localPlaneNormal.x=_-A.x,t.m_localPlaneNormal.y=h-A.y,t.m_localPlaneNormal.normalize(),t.m_localPoint.setV(A),t.m_points[0].m_localPoint.setV(s.m_p),t.m_points[0].m_id.set_key(0)}else if(0>=C){if((_-w.x)*(_-w.x)+(h-w.y)*(h-w.y)>u*u)return;t.m_pointCount=1,t.m_type=box2D.collision.B2Manifold.e_faceA,t.m_localPlaneNormal.x=_-w.x,t.m_localPlaneNormal.y=h-w.y,t.m_localPlaneNormal.normalize(),t.m_localPoint.setV(w),t.m_points[0].m_localPoint.setV(s.m_p),t.m_points[0].m_id.set_key(0)}else{var M=.5*(A.x+w.x),S=.5*(A.y+w.y);if(y=(_-M)*B[v].x+(h-S)*B[v].y,y>u)return;t.m_pointCount=1,t.m_type=box2D.collision.B2Manifold.e_faceA,t.m_localPlaneNormal.x=B[v].x,t.m_localPlaneNormal.y=B[v].y,t.m_localPlaneNormal.normalize(),t.m_localPoint.set(M,S),t.m_points[0].m_localPoint.setV(s.m_p),t.m_points[0].m_id.set_key(0)}},box2D.collision.B2Collision.testOverlap=function(t,o){var i=o.lowerBound,s=t.upperBound,n=i.x-s.x,e=i.y-s.y;i=t.lowerBound,s=o.upperBound;var m=i.x-s.x,a=i.y-s.y;return n>0||e>0?!1:m>0||a>0?!1:!0},box2D.collision.B2ContactPoint=function(){this.position=new box2D.common.math.B2Vec2,this.velocity=new box2D.common.math.B2Vec2,this.normal=new box2D.common.math.B2Vec2,this.id=new box2D.collision.B2ContactID},box2D.collision.B2ContactPoint.__name__=!0,box2D.collision.B2ContactPoint.prototype={__class__:box2D.collision.B2ContactPoint},box2D.collision.B2Simplex=function(){this.m_v1=new box2D.collision.B2SimplexVertex,this.m_v2=new box2D.collision.B2SimplexVertex,this.m_v3=new box2D.collision.B2SimplexVertex,this.m_vertices=new Array,this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3},box2D.collision.B2Simplex.__name__=!0,box2D.collision.B2Simplex.prototype={readCache:function(t,o,i,s,n){box2D.common.B2Settings.b2Assert(0<=t.count&&t.count<=3);var e,m;this.m_count=t.count;for(var a,c=this.m_vertices,l=0,r=this.m_count;r>l;){var _=l++;a=c[_],a.indexA=t.indexA[_],a.indexB=t.indexB[_],e=o.getVertex(a.indexA),m=s.getVertex(a.indexB),a.wA=box2D.common.math.B2Math.mulX(i,e),a.wB=box2D.common.math.B2Math.mulX(n,m),a.w=box2D.common.math.B2Math.subtractVV(a.wB,a.wA),a.a=0}if(this.m_count>1){var h=t.metric,x=this.getMetric();(.5*h>x||x>2*h||2.2250738585072014e-308>x)&&(this.m_count=0)}0==this.m_count&&(a=c[0],a.indexA=0,a.indexB=0,e=o.getVertex(0),m=s.getVertex(0),a.wA=box2D.common.math.B2Math.mulX(i,e),a.wB=box2D.common.math.B2Math.mulX(n,m),a.w=box2D.common.math.B2Math.subtractVV(a.wB,a.wA),this.m_count=1)},writeCache:function(t){t.metric=this.getMetric(),t.count=0|this.m_count;for(var o=this.m_vertices,i=0,s=this.m_count;s>i;){var n=i++;t.indexA[n]=0|o[n].indexA,t.indexB[n]=0|o[n].indexB}},getSearchDirection:function(){var t=this.m_count;switch(t){case 1:return this.m_v1.w.getNegative();case 2:var o=box2D.common.math.B2Math.subtractVV(this.m_v2.w,this.m_v1.w),i=box2D.common.math.B2Math.crossVV(o,this.m_v1.w.getNegative());return i>0?box2D.common.math.B2Math.crossFV(1,o):box2D.common.math.B2Math.crossVF(o,1);default:return box2D.common.B2Settings.b2Assert(!1),new box2D.common.math.B2Vec2}},getClosestPoint:function(){var t=this.m_count;switch(t){case 0:return box2D.common.B2Settings.b2Assert(!1),new box2D.common.math.B2Vec2;case 1:return this.m_v1.w;case 2:return new box2D.common.math.B2Vec2(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return box2D.common.B2Settings.b2Assert(!1),new box2D.common.math.B2Vec2}},getWitnessPoints:function(t,o){var i=this.m_count;switch(i){case 0:box2D.common.B2Settings.b2Assert(!1);break;case 1:t.setV(this.m_v1.wA),o.setV(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,o.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,o.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:o.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,o.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:box2D.common.B2Settings.b2Assert(!1)}},getMetric:function(){var t=this.m_count;switch(t){case 0:return box2D.common.B2Settings.b2Assert(!1),0;case 1:return 0;case 2:return box2D.common.math.B2Math.subtractVV(this.m_v1.w,this.m_v2.w).length();case 3:return box2D.common.math.B2Math.crossVV(box2D.common.math.B2Math.subtractVV(this.m_v2.w,this.m_v1.w),box2D.common.math.B2Math.subtractVV(this.m_v3.w,this.m_v1.w));default:return box2D.common.B2Settings.b2Assert(!1),0}},solve2:function(){var t=this.m_v1.w,o=this.m_v2.w,i=box2D.common.math.B2Math.subtractVV(o,t),s=-(t.x*i.x+t.y*i.y);if(0>=s)return this.m_v1.a=1,void(this.m_count=1);var n=o.x*i.x+o.y*i.y;if(0>=n)return this.m_v2.a=1,this.m_count=1,void this.m_v1.set(this.m_v2);var e=1/(n+s);this.m_v1.a=n*e,this.m_v2.a=s*e,this.m_count=2},solve3:function(){var t=this.m_v1.w,o=this.m_v2.w,i=this.m_v3.w,s=box2D.common.math.B2Math.subtractVV(o,t),n=box2D.common.math.B2Math.dot(t,s),e=box2D.common.math.B2Math.dot(o,s),m=e,a=-n,c=box2D.common.math.B2Math.subtractVV(i,t),l=box2D.common.math.B2Math.dot(t,c),r=box2D.common.math.B2Math.dot(i,c),_=r,h=-l,x=box2D.common.math.B2Math.subtractVV(i,o),y=box2D.common.math.B2Math.dot(o,x),u=box2D.common.math.B2Math.dot(i,x),p=u,d=-y,B=box2D.common.math.B2Math.crossVV(s,c),b=B*box2D.common.math.B2Math.crossVV(o,i),D=B*box2D.common.math.B2Math.crossVV(i,t),f=B*box2D.common.math.B2Math.crossVV(t,o);if(0>=a&&0>=h)return this.m_v1.a=1,void(this.m_count=1);if(m>0&&a>0&&0>=f){var g=1/(m+a);return this.m_v1.a=m*g,this.m_v2.a=a*g,void(this.m_count=2)}if(_>0&&h>0&&0>=D){var v=1/(_+h);return this.m_v1.a=_*v,this.m_v3.a=h*v,this.m_count=2,void this.m_v2.set(this.m_v3)}if(0>=m&&0>=d)return this.m_v2.a=1,this.m_count=1,void this.m_v1.set(this.m_v2);if(0>=_&&0>=p)return this.m_v3.a=1,this.m_count=1,void this.m_v1.set(this.m_v3);if(p>0&&d>0&&0>=b){var A=1/(p+d);return this.m_v2.a=p*A,this.m_v3.a=d*A,this.m_count=2,void this.m_v1.set(this.m_v3)}var w=1/(b+D+f);this.m_v1.a=b*w,this.m_v2.a=D*w,this.m_v3.a=f*w,this.m_count=3},__class__:box2D.collision.B2Simplex},box2D.collision.B2SimplexVertex=function(){},box2D.collision.B2SimplexVertex.__name__=!0,box2D.collision.B2SimplexVertex.prototype={set:function(t){this.wA.setV(t.wA),this.wB.setV(t.wB),this.w.setV(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB},__class__:box2D.collision.B2SimplexVertex},box2D.collision.B2Distance=function(){},box2D.collision.B2Distance.__name__=!0,box2D.collision.B2Distance.distance=function(t,o,i){++box2D.collision.B2Distance.b2_gjkCalls;var s=i.proxyA,n=i.proxyB,e=i.transformA,m=i.transformB,a=box2D.collision.B2Distance.s_simplex;a.readCache(o,s,e,n,m);for(var c,l=a.m_vertices,r=20,_=box2D.collision.B2Distance.s_saveA,h=box2D.collision.B2Distance.s_saveB,x=0,y=a.getClosestPoint(),u=y.lengthSquared(),p=u,d=0;r>d;){x=a.m_count;for(var B=0;x>B;){var b=B++;_[b]=l[b].indexA,h[b]=l[b].indexB}var B=a.m_count;switch(B){case 1:break;case 2:a.solve2();break;case 3:a.solve3();break;default:box2D.common.B2Settings.b2Assert(!1)}if(3==a.m_count)break;c=a.getClosestPoint(),p=c.lengthSquared(),u=p;var D=a.getSearchDirection();if(D.lengthSquared()<0)break;var f=l[a.m_count],g=s.getSupport(box2D.common.math.B2Math.mulTMV(e.R,D.getNegative()));f.indexA=0|g,f.wA=box2D.common.math.B2Math.mulX(e,s.getVertex(f.indexA));var g=n.getSupport(box2D.common.math.B2Math.mulTMV(m.R,D));f.indexB=0|g,f.wB=box2D.common.math.B2Math.mulX(m,n.getVertex(f.indexB)),f.w=box2D.common.math.B2Math.subtractVV(f.wB,f.wA),++d,++box2D.collision.B2Distance.b2_gjkIters;for(var v=!1,B=0;x>B;){var b=B++;if(f.indexA==_[b]&&f.indexB==h[b]){v=!0;break}}if(v)break;++a.m_count}var g=box2D.common.math.B2Math.max(box2D.collision.B2Distance.b2_gjkMaxIters,d);if(box2D.collision.B2Distance.b2_gjkMaxIters=0|g,a.getWitnessPoints(t.pointA,t.pointB),t.distance=box2D.common.math.B2Math.subtractVV(t.pointA,t.pointB).length(),t.iterations=d,a.writeCache(o),i.useRadii){var A=s.m_radius,w=n.m_radius;if(t.distance>A+w&&t.distance>2.2250738585072014e-308){t.distance-=A+w;var V=box2D.common.math.B2Math.subtractVV(t.pointB,t.pointA);V.normalize(),t.pointA.x+=A*V.x,t.pointA.y+=A*V.y,t.pointB.x-=w*V.x,t.pointB.y-=w*V.y}else c=new box2D.common.math.B2Vec2,c.x=.5*(t.pointA.x+t.pointB.x),c.y=.5*(t.pointA.y+t.pointB.y),t.pointA.x=t.pointB.x=c.x,t.pointA.y=t.pointB.y=c.y,t.distance=0}},box2D.collision.B2DistanceInput=function(){},box2D.collision.B2DistanceInput.__name__=!0,box2D.collision.B2DistanceInput.prototype={__class__:box2D.collision.B2DistanceInput},box2D.collision.B2DistanceOutput=function(){this.pointA=new box2D.common.math.B2Vec2,this.pointB=new box2D.common.math.B2Vec2},box2D.collision.B2DistanceOutput.__name__=!0,box2D.collision.B2DistanceOutput.prototype={__class__:box2D.collision.B2DistanceOutput},box2D.collision.B2DistanceProxy=function(){this.m_vertices=new Array},box2D.collision.B2DistanceProxy.__name__=!0,box2D.collision.B2DistanceProxy.prototype={set:function(t){var o=t.getType();switch(o){case box2D.collision.shapes.B2Shape.e_circleShape:var i;i=js.Boot.__cast(t,box2D.collision.shapes.B2CircleShape),this.m_vertices=new Array,this.m_vertices[0]=i.m_p,this.m_count=1,this.m_radius=i.m_radius;break;case box2D.collision.shapes.B2Shape.e_polygonShape:var s;s=js.Boot.__cast(t,box2D.collision.shapes.B2PolygonShape),this.m_vertices=s.m_vertices,this.m_count=s.m_vertexCount,this.m_radius=s.m_radius;break;default:box2D.common.B2Settings.b2Assert(!1)}},getSupport:function(t){for(var o=0,i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,s=1,n=this.m_count;n>s;){var e=s++,m=this.m_vertices[e].x*t.x+this.m_vertices[e].y*t.y;m>i&&(o=e,i=m)}return o},getSupportVertex:function(t){for(var o=0,i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,s=1,n=this.m_count;n>s;){var e=s++,m=this.m_vertices[e].x*t.x+this.m_vertices[e].y*t.y;m>i&&(o=e,i=m)}return this.m_vertices[o]},getVertexCount:function(){return this.m_count},getVertex:function(t){return box2D.common.B2Settings.b2Assert(t>=0&&t<this.m_count),this.m_vertices[t]},__class__:box2D.collision.B2DistanceProxy},box2D.collision.B2DynamicTree=function(){this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0},box2D.collision.B2DynamicTree.__name__=!0,box2D.collision.B2DynamicTree.prototype={createProxy:function(t,o){var i=this.allocateNode(),s=box2D.common.B2Settings.b2_aabbExtension,n=box2D.common.B2Settings.b2_aabbExtension;return i.aabb.lowerBound.x=t.lowerBound.x-s,i.aabb.lowerBound.y=t.lowerBound.y-n,i.aabb.upperBound.x=t.upperBound.x+s,i.aabb.upperBound.y=t.upperBound.y+n,i.userData=o,this.insertLeaf(i),i},destroyProxy:function(t){this.removeLeaf(t),this.freeNode(t)},moveProxy:function(t,o,i){if(box2D.common.B2Settings.b2Assert(t.isLeaf()),t.aabb.contains(o))return!1;this.removeLeaf(t);var s;s=box2D.common.B2Settings.b2_aabbExtension+box2D.common.B2Settings.b2_aabbMultiplier*(i.x>0?i.x:-i.x);var n;return n=box2D.common.B2Settings.b2_aabbExtension+box2D.common.B2Settings.b2_aabbMultiplier*(i.y>0?i.y:-i.y),t.aabb.lowerBound.x=o.lowerBound.x-s,t.aabb.lowerBound.y=o.lowerBound.y-n,t.aabb.upperBound.x=o.upperBound.x+s,t.aabb.upperBound.y=o.upperBound.y+n,this.insertLeaf(t),!0},rebalance:function(t){if(null!=this.m_root)for(var o=0;t>o;){for(var i=(o++,this.m_root),s=0;0==i.isLeaf();)i=0!=(this.m_path>>s&1)?i.child2:i.child1,s=s+1&31;++this.m_path,this.removeLeaf(i),this.insertLeaf(i)}},getFatAABB:function(t){return t.aabb},getUserData:function(t){return t.userData},query:function(t,o){if(null!=this.m_root){var i=new Array,s=0;for(i[s++]=this.m_root;s>0;){var n=i[--s];if(n.aabb.testOverlap(o))if(n.isLeaf()){var e=t(n);if(!e)return}else i[s++]=n.child1,i[s++]=n.child2}}},rayCast:function(t,o){if(null!=this.m_root){var i=o.p1,s=o.p2,n=box2D.common.math.B2Math.subtractVV(i,s);n.normalize();var e,m,a=box2D.common.math.B2Math.crossFV(1,n),c=box2D.common.math.B2Math.absV(a),l=o.maxFraction,r=new box2D.collision.B2AABB;e=i.x+l*(s.x-i.x),m=i.y+l*(s.y-i.y),r.lowerBound.x=Math.min(i.x,e),r.lowerBound.y=Math.min(i.y,m),r.upperBound.x=Math.max(i.x,e),r.upperBound.y=Math.max(i.y,m);var _=new Array,h=0;for(_[h++]=this.m_root;h>0;){var x=_[--h];if(0!=x.aabb.testOverlap(r)){var y=x.aabb.getCenter(),u=x.aabb.getExtents(),p=Math.abs(a.x*(i.x-y.x)+a.y*(i.y-y.y))-c.x*u.x-c.y*u.y;if(!(p>0))if(x.isLeaf()){var d=new box2D.collision.B2RayCastInput;if(d.p1=o.p1,d.p2=o.p2,d.maxFraction=o.maxFraction,l=t(d,x),0==l)return;e=i.x+l*(s.x-i.x),m=i.y+l*(s.y-i.y),r.lowerBound.x=Math.min(i.x,e),r.lowerBound.y=Math.min(i.y,m),r.upperBound.x=Math.max(i.x,e),r.upperBound.y=Math.max(i.y,m)}else _[h++]=x.child1,_[h++]=x.child2}}}},allocateNode:function(){if(null!=this.m_freeList){var t=this.m_freeList;return this.m_freeList=t.parent,t.parent=null,t.child1=null,t.child2=null,t}return new box2D.collision.B2DynamicTreeNode},freeNode:function(t){t.parent=this.m_freeList,this.m_freeList=t},insertLeaf:function(t){if(++this.m_insertionCount,null==this.m_root)return this.m_root=t,void(this.m_root.parent=null);var o=t.aabb.getCenter(),i=this.m_root;if(0==i.isLeaf())do{var s=i.child1,n=i.child2,e=Math.abs((s.aabb.lowerBound.x+s.aabb.upperBound.x)/2-o.x)+Math.abs((s.aabb.lowerBound.y+s.aabb.upperBound.y)/2-o.y),m=Math.abs((n.aabb.lowerBound.x+n.aabb.upperBound.x)/2-o.x)+Math.abs((n.aabb.lowerBound.y+n.aabb.upperBound.y)/2-o.y);i=m>e?s:n}while(0==i.isLeaf());var a=i.parent,c=this.allocateNode();if(c.parent=a,c.userData=null,c.aabb.combine(t.aabb,i.aabb),null!=a){i.parent.child1==i?a.child1=c:a.child2=c,c.child1=i,c.child2=t,i.parent=c,t.parent=c;do{if(a.aabb.contains(c.aabb))break;a.aabb.combine(a.child1.aabb,a.child2.aabb),c=a,a=a.parent}while(null!=a)}else c.child1=i,c.child2=t,i.parent=c,t.parent=c,this.m_root=c},removeLeaf:function(t){if(t==this.m_root)return void(this.m_root=null);var o,i=t.parent,s=i.parent;if(o=i.child1==t?i.child2:i.child1,null!=s)for(s.child1==i?s.child1=o:s.child2=o,o.parent=s,this.freeNode(i);null!=s;){var n=s.aabb;if(s.aabb=new box2D.collision.B2AABB,s.aabb.combine(s.child1.aabb,s.child2.aabb),n.contains(s.aabb))break;s=s.parent}else this.m_root=o,o.parent=null,this.freeNode(i)},__class__:box2D.collision.B2DynamicTree},box2D.collision.IBroadPhase=function(){},box2D.collision.IBroadPhase.__name__=!0,box2D.collision.IBroadPhase.prototype={__class__:box2D.collision.IBroadPhase},box2D.collision.B2DynamicTreeBroadPhase=function(){this.m_tree=new box2D.collision.B2DynamicTree,this.m_moveBuffer=new Array,this.m_pairBuffer=new Array,this.m_pairCount=0},box2D.collision.B2DynamicTreeBroadPhase.__name__=!0,box2D.collision.B2DynamicTreeBroadPhase.__interfaces__=[box2D.collision.IBroadPhase],box2D.collision.B2DynamicTreeBroadPhase.prototype={createProxy:function(t,o){var i=this.m_tree.createProxy(t,o);return++this.m_proxyCount,this.bufferMove(i),i},destroyProxy:function(t){this.unBufferMove(t),--this.m_proxyCount,this.m_tree.destroyProxy(t)},moveProxy:function(t,o,i){var s=this.m_tree.moveProxy(t,o,i);s&&this.bufferMove(t)},testOverlap:function(t,o){var i=this.m_tree.getFatAABB(t),s=this.m_tree.getFatAABB(o);return i.testOverlap(s)},getUserData:function(t){return this.m_tree.getUserData(t)},getFatAABB:function(t){return this.m_tree.getFatAABB(t)},getProxyCount:function(){return this.m_proxyCount},updatePairs:function(t){var o=this;this.m_pairCount=0;for(var i=0,s=this.m_moveBuffer;i<s.length;){var n=[s[i]];++i;var e=function(t){return function(i){if(i==t[0])return!0;o.m_pairCount==o.m_pairBuffer.length&&(o.m_pairBuffer[o.m_pairCount]=new box2D.collision.B2DynamicTreePair);var s=o.m_pairBuffer[o.m_pairCount];return i.id<t[0].id?(s.proxyA=i,s.proxyB=t[0]):(s.proxyA=t[0],s.proxyB=i),++o.m_pairCount,!0}}(n),m=this.m_tree.getFatAABB(n[0]);this.m_tree.query(e,m)}this.m_moveBuffer=new Array;for(var a=!0,c=0;a;)if(c>=this.m_pairCount)a=!1;else{var l=this.m_pairBuffer[c],r=this.m_tree.getUserData(l.proxyA),_=this.m_tree.getUserData(l.proxyB);for(t(r,_),++c;c<this.m_pairCount;){var h=this.m_pairBuffer[c];if(h.proxyA!=l.proxyA||h.proxyB!=l.proxyB)break;++c}}},query:function(t,o){this.m_tree.query(t,o)},rayCast:function(t,o){this.m_tree.rayCast(t,o)},validate:function(){},rebalance:function(t){this.m_tree.rebalance(t)},bufferMove:function(t){this.m_moveBuffer[this.m_moveBuffer.length]=t},unBufferMove:function(t){HxOverrides.remove(this.m_moveBuffer,t)},comparePairs:function(){return 0},__class__:box2D.collision.B2DynamicTreeBroadPhase},box2D.collision.B2DynamicTreeNode=function(){this.aabb=new box2D.collision.B2AABB,this.id=box2D.collision.B2DynamicTreeNode.currentID++},box2D.collision.B2DynamicTreeNode.__name__=!0,box2D.collision.B2DynamicTreeNode.prototype={isLeaf:function(){return null==this.child1},__class__:box2D.collision.B2DynamicTreeNode},box2D.collision.B2DynamicTreePair=function(){},box2D.collision.B2DynamicTreePair.__name__=!0,box2D.collision.B2DynamicTreePair.prototype={__class__:box2D.collision.B2DynamicTreePair},box2D.collision.B2Manifold=function(){this.m_pointCount=0,this.m_points=new Array;for(var t=0,o=box2D.common.B2Settings.b2_maxManifoldPoints;o>t;){var i=t++;this.m_points[i]=new box2D.collision.B2ManifoldPoint}this.m_localPlaneNormal=new box2D.common.math.B2Vec2,this.m_localPoint=new box2D.common.math.B2Vec2},box2D.collision.B2Manifold.__name__=!0,box2D.collision.B2Manifold.prototype={reset:function(){for(var t=0,o=box2D.common.B2Settings.b2_maxManifoldPoints;o>t;){var i=t++;this.m_points[i].reset()}this.m_localPlaneNormal.setZero(),this.m_localPoint.setZero(),this.m_type=0,this.m_pointCount=0},set:function(t){this.m_pointCount=t.m_pointCount;for(var o=0,i=box2D.common.B2Settings.b2_maxManifoldPoints;i>o;){var s=o++;this.m_points[s].set(t.m_points[s])}this.m_localPlaneNormal.setV(t.m_localPlaneNormal),this.m_localPoint.setV(t.m_localPoint),this.m_type=t.m_type},copy:function(){var t=new box2D.collision.B2Manifold;return t.set(this),t},__class__:box2D.collision.B2Manifold},box2D.collision.B2ManifoldPoint=function(){this.m_localPoint=new box2D.common.math.B2Vec2,this.m_id=new box2D.collision.B2ContactID,this.reset()},box2D.collision.B2ManifoldPoint.__name__=!0,box2D.collision.B2ManifoldPoint.prototype={reset:function(){this.m_localPoint.setZero(),this.m_normalImpulse=0,this.m_tangentImpulse=0,this.m_id.set_key(0)},set:function(t){this.m_localPoint.setV(t.m_localPoint),this.m_normalImpulse=t.m_normalImpulse,this.m_tangentImpulse=t.m_tangentImpulse,this.m_id.set(t.m_id)},__class__:box2D.collision.B2ManifoldPoint},box2D.collision.B2OBB=function(){this.R=new box2D.common.math.B2Mat22,this.center=new box2D.common.math.B2Vec2,this.extents=new box2D.common.math.B2Vec2},box2D.collision.B2OBB.__name__=!0,box2D.collision.B2OBB.prototype={__class__:box2D.collision.B2OBB},box2D.collision.B2RayCastInput=function(t,o,i){null==i&&(i=1),this.p1=new box2D.common.math.B2Vec2,this.p2=new box2D.common.math.B2Vec2,null!=t&&this.p1.setV(t),null!=o&&this.p2.setV(o),this.maxFraction=i},box2D.collision.B2RayCastInput.__name__=!0,box2D.collision.B2RayCastInput.prototype={__class__:box2D.collision.B2RayCastInput},box2D.collision.B2RayCastOutput=function(){this.normal=new box2D.common.math.B2Vec2},box2D.collision.B2RayCastOutput.__name__=!0,box2D.collision.B2RayCastOutput.prototype={__class__:box2D.collision.B2RayCastOutput},box2D.collision.B2SeparationFunction=function(){this.m_localPoint=new box2D.common.math.B2Vec2,this.m_axis=new box2D.common.math.B2Vec2},box2D.collision.B2SeparationFunction.__name__=!0,box2D.collision.B2SeparationFunction.prototype={initialize:function(t,o,i,s,n){this.m_proxyA=o,this.m_proxyB=s;var e=t.count;box2D.common.B2Settings.b2Assert(e>0&&3>e);var m,a,c,l,r,_,h,x,y,u,p,d,B,b,D=new box2D.common.math.B2Vec2,f=new box2D.common.math.B2Vec2;
if(1==e)this.m_type=box2D.collision.B2SeparationFunction.e_points,D=this.m_proxyA.getVertex(t.indexA[0]),f=this.m_proxyB.getVertex(t.indexB[0]),d=D,p=i.R,r=i.position.x+(p.col1.x*d.x+p.col2.x*d.y),_=i.position.y+(p.col1.y*d.x+p.col2.y*d.y),d=f,p=n.R,h=n.position.x+(p.col1.x*d.x+p.col2.x*d.y),x=n.position.y+(p.col1.y*d.x+p.col2.y*d.y),this.m_axis.x=h-r,this.m_axis.y=x-_,this.m_axis.normalize();else if(t.indexB[0]==t.indexB[1])this.m_type=box2D.collision.B2SeparationFunction.e_faceA,m=this.m_proxyA.getVertex(t.indexA[0]),a=this.m_proxyA.getVertex(t.indexA[1]),f=this.m_proxyB.getVertex(t.indexB[0]),this.m_localPoint.x=.5*(m.x+a.x),this.m_localPoint.y=.5*(m.y+a.y),this.m_axis=box2D.common.math.B2Math.crossVF(box2D.common.math.B2Math.subtractVV(a,m),1),this.m_axis.normalize(),d=this.m_axis,p=i.R,y=p.col1.x*d.x+p.col2.x*d.y,u=p.col1.y*d.x+p.col2.y*d.y,d=this.m_localPoint,p=i.R,r=i.position.x+(p.col1.x*d.x+p.col2.x*d.y),_=i.position.y+(p.col1.y*d.x+p.col2.y*d.y),d=f,p=n.R,h=n.position.x+(p.col1.x*d.x+p.col2.x*d.y),x=n.position.y+(p.col1.y*d.x+p.col2.y*d.y),B=(h-r)*y+(x-_)*u,0>B&&this.m_axis.negativeSelf();else if(t.indexA[0]==t.indexA[0])this.m_type=box2D.collision.B2SeparationFunction.e_faceB,c=this.m_proxyB.getVertex(t.indexB[0]),l=this.m_proxyB.getVertex(t.indexB[1]),D=this.m_proxyA.getVertex(t.indexA[0]),this.m_localPoint.x=.5*(c.x+l.x),this.m_localPoint.y=.5*(c.y+l.y),this.m_axis=box2D.common.math.B2Math.crossVF(box2D.common.math.B2Math.subtractVV(l,c),1),this.m_axis.normalize(),d=this.m_axis,p=n.R,y=p.col1.x*d.x+p.col2.x*d.y,u=p.col1.y*d.x+p.col2.y*d.y,d=this.m_localPoint,p=n.R,h=n.position.x+(p.col1.x*d.x+p.col2.x*d.y),x=n.position.y+(p.col1.y*d.x+p.col2.y*d.y),d=D,p=i.R,r=i.position.x+(p.col1.x*d.x+p.col2.x*d.y),_=i.position.y+(p.col1.y*d.x+p.col2.y*d.y),B=(r-h)*y+(_-x)*u,0>B&&this.m_axis.negativeSelf();else{m=this.m_proxyA.getVertex(t.indexA[0]),a=this.m_proxyA.getVertex(t.indexA[1]),c=this.m_proxyB.getVertex(t.indexB[0]),l=this.m_proxyB.getVertex(t.indexB[1]);var g=(box2D.common.math.B2Math.mulX(i,D),box2D.common.math.B2Math.mulMV(i.R,box2D.common.math.B2Math.subtractVV(a,m))),v=(box2D.common.math.B2Math.mulX(n,f),box2D.common.math.B2Math.mulMV(n.R,box2D.common.math.B2Math.subtractVV(l,c))),A=g.x*g.x+g.y*g.y,w=v.x*v.x+v.y*v.y,V=box2D.common.math.B2Math.subtractVV(v,g),C=g.x*V.x+g.y*V.y,M=v.x*V.x+v.y*V.y,S=g.x*v.x+g.y*v.y,I=A*w-S*S;B=0,0!=I&&(B=box2D.common.math.B2Math.clamp((S*M-C*w)/I,0,1));var j=(S*B+M)/w;0>j&&(j=0,B=box2D.common.math.B2Math.clamp((S-C)/A,0,1)),D=new box2D.common.math.B2Vec2,D.x=m.x+B*(a.x-m.x),D.y=m.y+B*(a.y-m.y),f=new box2D.common.math.B2Vec2,f.x=c.x+B*(l.x-c.x),f.y=c.y+B*(l.y-c.y),0==B||1==B?(this.m_type=box2D.collision.B2SeparationFunction.e_faceB,this.m_axis=box2D.common.math.B2Math.crossVF(box2D.common.math.B2Math.subtractVV(l,c),1),this.m_axis.normalize(),this.m_localPoint=f,d=this.m_axis,p=n.R,y=p.col1.x*d.x+p.col2.x*d.y,u=p.col1.y*d.x+p.col2.y*d.y,d=this.m_localPoint,p=n.R,h=n.position.x+(p.col1.x*d.x+p.col2.x*d.y),x=n.position.y+(p.col1.y*d.x+p.col2.y*d.y),d=D,p=i.R,r=i.position.x+(p.col1.x*d.x+p.col2.x*d.y),_=i.position.y+(p.col1.y*d.x+p.col2.y*d.y),b=(r-h)*y+(_-x)*u,0>B&&this.m_axis.negativeSelf()):(this.m_type=box2D.collision.B2SeparationFunction.e_faceA,this.m_axis=box2D.common.math.B2Math.crossVF(box2D.common.math.B2Math.subtractVV(a,m),1),this.m_localPoint=D,d=this.m_axis,p=i.R,y=p.col1.x*d.x+p.col2.x*d.y,u=p.col1.y*d.x+p.col2.y*d.y,d=this.m_localPoint,p=i.R,r=i.position.x+(p.col1.x*d.x+p.col2.x*d.y),_=i.position.y+(p.col1.y*d.x+p.col2.y*d.y),d=f,p=n.R,h=n.position.x+(p.col1.x*d.x+p.col2.x*d.y),x=n.position.y+(p.col1.y*d.x+p.col2.y*d.y),b=(h-r)*y+(x-_)*u,0>B&&this.m_axis.negativeSelf())}},evaluate:function(t,o){var i,s,n,e,m,a,c,l;return this.m_type==box2D.collision.B2SeparationFunction.e_points?(i=box2D.common.math.B2Math.mulTMV(t.R,this.m_axis),s=box2D.common.math.B2Math.mulTMV(o.R,this.m_axis.getNegative()),n=this.m_proxyA.getSupportVertex(i),e=this.m_proxyB.getSupportVertex(s),m=box2D.common.math.B2Math.mulX(t,n),a=box2D.common.math.B2Math.mulX(o,e),c=(a.x-m.x)*this.m_axis.x+(a.y-m.y)*this.m_axis.y):this.m_type==box2D.collision.B2SeparationFunction.e_faceA?(l=box2D.common.math.B2Math.mulMV(t.R,this.m_axis),m=box2D.common.math.B2Math.mulX(t,this.m_localPoint),s=box2D.common.math.B2Math.mulTMV(o.R,l.getNegative()),e=this.m_proxyB.getSupportVertex(s),a=box2D.common.math.B2Math.mulX(o,e),c=(a.x-m.x)*l.x+(a.y-m.y)*l.y):this.m_type==box2D.collision.B2SeparationFunction.e_faceB?(l=box2D.common.math.B2Math.mulMV(o.R,this.m_axis),a=box2D.common.math.B2Math.mulX(o,this.m_localPoint),i=box2D.common.math.B2Math.mulTMV(t.R,l.getNegative()),n=this.m_proxyA.getSupportVertex(i),m=box2D.common.math.B2Math.mulX(t,n),c=(m.x-a.x)*l.x+(m.y-a.y)*l.y):0},__class__:box2D.collision.B2SeparationFunction},box2D.collision.B2SimplexCache=function(){this.indexA=new Array,this.indexB=new Array},box2D.collision.B2SimplexCache.__name__=!0,box2D.collision.B2SimplexCache.prototype={__class__:box2D.collision.B2SimplexCache},box2D.collision.B2TOIInput=function(){this.proxyA=new box2D.collision.B2DistanceProxy,this.proxyB=new box2D.collision.B2DistanceProxy,this.sweepA=new box2D.common.math.B2Sweep,this.sweepB=new box2D.common.math.B2Sweep},box2D.collision.B2TOIInput.__name__=!0,box2D.collision.B2TOIInput.prototype={__class__:box2D.collision.B2TOIInput},box2D.common.math.B2Transform=function(t,o){this.position=new box2D.common.math.B2Vec2,this.R=new box2D.common.math.B2Mat22,null!=t&&(this.position.setV(t),this.R.setM(o))},box2D.common.math.B2Transform.__name__=!0,box2D.common.math.B2Transform.prototype={initialize:function(t,o){this.position.setV(t),this.R.setM(o)},setIdentity:function(){this.position.setZero(),this.R.setIdentity()},set:function(t){this.position.setV(t.position),this.R.setM(t.R)},getAngle:function(){return Math.atan2(this.R.col1.y,this.R.col1.x)},__class__:box2D.common.math.B2Transform},box2D.common.math.B2Mat22=function(){this.col1=new box2D.common.math.B2Vec2(0,1),this.col2=new box2D.common.math.B2Vec2(0,1)},box2D.common.math.B2Mat22.__name__=!0,box2D.common.math.B2Mat22.fromAngle=function(t){var o=new box2D.common.math.B2Mat22;return o.set(t),o},box2D.common.math.B2Mat22.fromVV=function(t,o){var i=new box2D.common.math.B2Mat22;return i.setVV(t,o),i},box2D.common.math.B2Mat22.prototype={set:function(t){var o=Math.cos(t),i=Math.sin(t);this.col1.x=o,this.col2.x=-i,this.col1.y=i,this.col2.y=o},setVV:function(t,o){this.col1.setV(t),this.col2.setV(o)},copy:function(){var t=new box2D.common.math.B2Mat22;return t.setM(this),t},setM:function(t){this.col1.setV(t.col1),this.col2.setV(t.col2)},addM:function(t){this.col1.x+=t.col1.x,this.col1.y+=t.col1.y,this.col2.x+=t.col2.x,this.col2.y+=t.col2.y},setIdentity:function(){this.col1.x=1,this.col2.x=0,this.col1.y=0,this.col2.y=1},setZero:function(){this.col1.x=0,this.col2.x=0,this.col1.y=0,this.col2.y=0},getAngle:function(){return Math.atan2(this.col1.y,this.col1.x)},getInverse:function(t){var o=this.col1.x,i=this.col2.x,s=this.col1.y,n=this.col2.y,e=o*n-i*s;return 0!=e&&(e=1/e),t.col1.x=e*n,t.col2.x=-e*i,t.col1.y=-e*s,t.col2.y=e*o,t},solve:function(t,o,i){var s=this.col1.x,n=this.col2.x,e=this.col1.y,m=this.col2.y,a=s*m-n*e;return 0!=a&&(a=1/a),t.x=a*(m*o-n*i),t.y=a*(s*i-e*o),t},abs:function(){this.col1.abs(),this.col2.abs()},__class__:box2D.common.math.B2Mat22},box2D.collision.B2TimeOfImpact=function(){},box2D.collision.B2TimeOfImpact.__name__=!0,box2D.collision.B2TimeOfImpact.timeOfImpact=function(t){++box2D.collision.B2TimeOfImpact.b2_toiCalls;var o=t.proxyA,i=t.proxyB,s=t.sweepA,n=t.sweepB;box2D.common.B2Settings.b2Assert(s.t0==n.t0),box2D.common.B2Settings.b2Assert(1-s.t0>2.2250738585072014e-308);var e=o.m_radius+i.m_radius,m=t.tolerance,a=0,c=1e3,l=0,r=0;for(box2D.collision.B2TimeOfImpact.s_cache.count=0,box2D.collision.B2TimeOfImpact.s_distanceInput.useRadii=!1;;){if(s.getTransform(box2D.collision.B2TimeOfImpact.s_xfA,a),n.getTransform(box2D.collision.B2TimeOfImpact.s_xfB,a),box2D.collision.B2TimeOfImpact.s_distanceInput.proxyA=o,box2D.collision.B2TimeOfImpact.s_distanceInput.proxyB=i,box2D.collision.B2TimeOfImpact.s_distanceInput.transformA=box2D.collision.B2TimeOfImpact.s_xfA,box2D.collision.B2TimeOfImpact.s_distanceInput.transformB=box2D.collision.B2TimeOfImpact.s_xfB,box2D.collision.B2Distance.distance(box2D.collision.B2TimeOfImpact.s_distanceOutput,box2D.collision.B2TimeOfImpact.s_cache,box2D.collision.B2TimeOfImpact.s_distanceInput),box2D.collision.B2TimeOfImpact.s_distanceOutput.distance<=0){a=1;break}box2D.collision.B2TimeOfImpact.s_fcn.initialize(box2D.collision.B2TimeOfImpact.s_cache,o,box2D.collision.B2TimeOfImpact.s_xfA,i,box2D.collision.B2TimeOfImpact.s_xfB);var _=box2D.collision.B2TimeOfImpact.s_fcn.evaluate(box2D.collision.B2TimeOfImpact.s_xfA,box2D.collision.B2TimeOfImpact.s_xfB);if(0>=_){a=1;break}if(0==l&&(r=_>e?box2D.common.math.B2Math.max(e-m,.75*e):box2D.common.math.B2Math.max(_-m,.02*e)),.5*m>_-r){if(0==l){a=1;break}break}var h=a,x=a,y=1,u=_;s.getTransform(box2D.collision.B2TimeOfImpact.s_xfA,y),n.getTransform(box2D.collision.B2TimeOfImpact.s_xfB,y);var p=box2D.collision.B2TimeOfImpact.s_fcn.evaluate(box2D.collision.B2TimeOfImpact.s_xfA,box2D.collision.B2TimeOfImpact.s_xfB);if(p>=r){a=1;break}for(var d=0;;){var B;B=0!=(1&d)?x+(r-u)*(y-x)/(p-u):.5*(x+y),s.getTransform(box2D.collision.B2TimeOfImpact.s_xfA,B),n.getTransform(box2D.collision.B2TimeOfImpact.s_xfB,B);var b=box2D.collision.B2TimeOfImpact.s_fcn.evaluate(box2D.collision.B2TimeOfImpact.s_xfA,box2D.collision.B2TimeOfImpact.s_xfB);if(box2D.common.math.B2Math.abs(b-r)<.025*m){h=B;break}if(b>r?(x=B,u=b):(y=B,p=b),++d,++box2D.collision.B2TimeOfImpact.b2_toiRootIters,50==d)break}var B=box2D.common.math.B2Math.max(box2D.collision.B2TimeOfImpact.b2_toiMaxRootIters,d);if(box2D.collision.B2TimeOfImpact.b2_toiMaxRootIters=0|B,a>h)break;if(a=h,l++,++box2D.collision.B2TimeOfImpact.b2_toiIters,l==c)break}var B=box2D.common.math.B2Math.max(box2D.collision.B2TimeOfImpact.b2_toiMaxIters,l);return box2D.collision.B2TimeOfImpact.b2_toiMaxIters=0|B,a},box2D.collision.B2WorldManifold=function(){this.m_normal=new box2D.common.math.B2Vec2,this.m_points=new Array;for(var t=0,o=box2D.common.B2Settings.b2_maxManifoldPoints;o>t;){var i=t++;this.m_points[i]=new box2D.common.math.B2Vec2}},box2D.collision.B2WorldManifold.__name__=!0,box2D.collision.B2WorldManifold.prototype={initialize:function(t,o,i,s,n){if(0!=t.m_pointCount){var e,m,a,c,l,r,_,h,x=t.m_type;switch(x){case box2D.collision.B2Manifold.e_circles:m=o.R,e=t.m_localPoint;var y=o.position.x+m.col1.x*e.x+m.col2.x*e.y,u=o.position.y+m.col1.y*e.x+m.col2.y*e.y;m=s.R,e=t.m_points[0].m_localPoint;var p=s.position.x+m.col1.x*e.x+m.col2.x*e.y,d=s.position.y+m.col1.y*e.x+m.col2.y*e.y,B=p-y,b=d-u,D=B*B+b*b;if(D>0){var f=Math.sqrt(D);this.m_normal.x=B/f,this.m_normal.y=b/f}else this.m_normal.x=1,this.m_normal.y=0;var g=y+i*this.m_normal.x,v=u+i*this.m_normal.y,A=p-n*this.m_normal.x,w=d-n*this.m_normal.y;this.m_points[0].x=.5*(g+A),this.m_points[0].y=.5*(v+w);break;case box2D.collision.B2Manifold.e_faceA:m=o.R,e=t.m_localPlaneNormal,a=m.col1.x*e.x+m.col2.x*e.y,c=m.col1.y*e.x+m.col2.y*e.y,m=o.R,e=t.m_localPoint,l=o.position.x+m.col1.x*e.x+m.col2.x*e.y,r=o.position.y+m.col1.y*e.x+m.col2.y*e.y,this.m_normal.x=a,this.m_normal.y=c;for(var V=0,C=t.m_pointCount;C>V;){var M=V++;m=s.R,e=t.m_points[M].m_localPoint,_=s.position.x+m.col1.x*e.x+m.col2.x*e.y,h=s.position.y+m.col1.y*e.x+m.col2.y*e.y,this.m_points[M].x=_+.5*(i-(_-l)*a-(h-r)*c-n)*a,this.m_points[M].y=h+.5*(i-(_-l)*a-(h-r)*c-n)*c}break;case box2D.collision.B2Manifold.e_faceB:m=s.R,e=t.m_localPlaneNormal,a=m.col1.x*e.x+m.col2.x*e.y,c=m.col1.y*e.x+m.col2.y*e.y,m=s.R,e=t.m_localPoint,l=s.position.x+m.col1.x*e.x+m.col2.x*e.y,r=s.position.y+m.col1.y*e.x+m.col2.y*e.y,this.m_normal.x=-a,this.m_normal.y=-c;for(var V=0,C=t.m_pointCount;C>V;){var M=V++;m=o.R,e=t.m_points[M].m_localPoint,_=o.position.x+m.col1.x*e.x+m.col2.x*e.y,h=o.position.y+m.col1.y*e.x+m.col2.y*e.y,this.m_points[M].x=_+.5*(n-(_-l)*a-(h-r)*c-i)*a,this.m_points[M].y=h+.5*(n-(_-l)*a-(h-r)*c-i)*c}}}},__class__:box2D.collision.B2WorldManifold},box2D.collision.shapes={},box2D.collision.shapes.B2Shape=function(){this.m_type=box2D.collision.shapes.B2Shape.e_unknownShape,this.m_radius=box2D.common.B2Settings.b2_linearSlop},box2D.collision.shapes.B2Shape.__name__=!0,box2D.collision.shapes.B2Shape.testOverlap=function(t,o,i,s){var n=new box2D.collision.B2DistanceInput;n.proxyA=new box2D.collision.B2DistanceProxy,n.proxyA.set(t),n.proxyB=new box2D.collision.B2DistanceProxy,n.proxyB.set(i),n.transformA=o,n.transformB=s,n.useRadii=!0;var e=new box2D.collision.B2SimplexCache;e.count=0;var m=new box2D.collision.B2DistanceOutput;return box2D.collision.B2Distance.distance(m,e,n),m.distance<2.2250738585072014e-307},box2D.collision.shapes.B2Shape.prototype={copy:function(){return null},set:function(t){this.m_radius=t.m_radius},getType:function(){return this.m_type},testPoint:function(){return!1},rayCast:function(){return!1},computeAABB:function(){},computeMass:function(){},computeSubmergedArea:function(){return 0},__class__:box2D.collision.shapes.B2Shape},box2D.collision.shapes.B2CircleShape=function(t){null==t&&(t=0),box2D.collision.shapes.B2Shape.call(this),this.m_p=new box2D.common.math.B2Vec2,this.m_type=box2D.collision.shapes.B2Shape.e_circleShape,this.m_radius=t},box2D.collision.shapes.B2CircleShape.__name__=!0,box2D.collision.shapes.B2CircleShape.__super__=box2D.collision.shapes.B2Shape,box2D.collision.shapes.B2CircleShape.prototype=$extend(box2D.collision.shapes.B2Shape.prototype,{copy:function(){var t=new box2D.collision.shapes.B2CircleShape;return t.set(this),t},set:function(t){if(box2D.collision.shapes.B2Shape.prototype.set.call(this,t),js.Boot.__instanceof(t,box2D.collision.shapes.B2CircleShape)){var o;o=js.Boot.__cast(t,box2D.collision.shapes.B2CircleShape),this.m_p.setV(o.m_p)}},testPoint:function(t,o){var i=t.R,s=t.position.x+(i.col1.x*this.m_p.x+i.col2.x*this.m_p.y),n=t.position.y+(i.col1.y*this.m_p.x+i.col2.y*this.m_p.y);return s=o.x-s,n=o.y-n,s*s+n*n<=this.m_radius*this.m_radius},rayCast:function(t,o,i){var s=i.R,n=i.position.x+(s.col1.x*this.m_p.x+s.col2.x*this.m_p.y),e=i.position.y+(s.col1.y*this.m_p.x+s.col2.y*this.m_p.y),m=o.p1.x-n,a=o.p1.y-e,c=m*m+a*a-this.m_radius*this.m_radius,l=o.p2.x-o.p1.x,r=o.p2.y-o.p1.y,_=m*l+a*r,h=l*l+r*r,x=_*_-h*c;if(0>x||2.2250738585072014e-308>h)return!1;var y=-(_+Math.sqrt(x));return y>=0&&y<=o.maxFraction*h?(y/=h,t.fraction=y,t.normal.x=m+y*l,t.normal.y=a+y*r,t.normal.normalize(),!0):!1},computeAABB:function(t,o){var i=o.R,s=o.position.x+(i.col1.x*this.m_p.x+i.col2.x*this.m_p.y),n=o.position.y+(i.col1.y*this.m_p.x+i.col2.y*this.m_p.y);t.lowerBound.set(s-this.m_radius,n-this.m_radius),t.upperBound.set(s+this.m_radius,n+this.m_radius)},computeMass:function(t,o){t.mass=o*box2D.common.B2Settings.b2_pi*this.m_radius*this.m_radius,t.center.setV(this.m_p),t.I=t.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))},computeSubmergedArea:function(t,o,i,s){var n=box2D.common.math.B2Math.mulX(i,this.m_p),e=-(box2D.common.math.B2Math.dot(t,n)-o);if(e<-this.m_radius+2.2250738585072014e-308)return 0;if(e>this.m_radius)return s.setV(n),Math.PI*this.m_radius*this.m_radius;var m=this.m_radius*this.m_radius,a=e*e,c=m*(Math.asin(e/this.m_radius)+Math.PI/2)+e*Math.sqrt(m-a),l=-.6666666666666666*Math.pow(m-a,1.5)/c;return s.x=n.x+t.x*l,s.y=n.y+t.y*l,c},getLocalPosition:function(){return this.m_p},setLocalPosition:function(t){this.m_p.setV(t)},getRadius:function(){return this.m_radius},setRadius:function(t){this.m_radius=t},__class__:box2D.collision.shapes.B2CircleShape}),box2D.collision.shapes.B2EdgeShape=function(t,o){box2D.collision.shapes.B2Shape.call(this),this.s_supportVec=new box2D.common.math.B2Vec2,this.m_v1=new box2D.common.math.B2Vec2,this.m_v2=new box2D.common.math.B2Vec2,this.m_coreV1=new box2D.common.math.B2Vec2,this.m_coreV2=new box2D.common.math.B2Vec2,this.m_normal=new box2D.common.math.B2Vec2,this.m_direction=new box2D.common.math.B2Vec2,this.m_cornerDir1=new box2D.common.math.B2Vec2,this.m_cornerDir2=new box2D.common.math.B2Vec2,this.m_type=box2D.collision.shapes.B2Shape.e_edgeShape,this.m_prevEdge=null,this.m_nextEdge=null,this.m_v1=t,this.m_v2=o,this.m_direction.set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y),this.m_length=this.m_direction.normalize(),this.m_normal.set(this.m_direction.y,-this.m_direction.x),this.m_coreV1.set(-box2D.common.B2Settings.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-box2D.common.B2Settings.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y),this.m_coreV2.set(-box2D.common.B2Settings.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-box2D.common.B2Settings.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y),this.m_cornerDir1=this.m_normal,this.m_cornerDir2.set(-this.m_normal.x,-this.m_normal.y)},box2D.collision.shapes.B2EdgeShape.__name__=!0,box2D.collision.shapes.B2EdgeShape.__super__=box2D.collision.shapes.B2Shape,box2D.collision.shapes.B2EdgeShape.prototype=$extend(box2D.collision.shapes.B2Shape.prototype,{testPoint:function(){return!1},rayCast:function(t,o,i){var s,n=o.p2.x-o.p1.x,e=o.p2.y-o.p1.y;s=i.R;var m=i.position.x+(s.col1.x*this.m_v1.x+s.col2.x*this.m_v1.y),a=i.position.y+(s.col1.y*this.m_v1.x+s.col2.y*this.m_v1.y),c=i.position.y+(s.col1.y*this.m_v2.x+s.col2.y*this.m_v2.y)-a,l=-(i.position.x+(s.col1.x*this.m_v2.x+s.col2.x*this.m_v2.y)-m),r=2.2250738585072014e-306,_=-(n*c+e*l);if(_>r){var h=o.p1.x-m,x=o.p1.y-a,y=h*c+x*l;if(y>=0&&y<=o.maxFraction*_){var u=-n*x+e*h;if(u>=-r*_&&_*(1+r)>=u){y/=_,t.fraction=y;var p=Math.sqrt(c*c+l*l);return t.normal.x=c/p,t.normal.y=l/p,!0}}}return!1},computeAABB:function(t,o){var i=o.R,s=o.position.x+(i.col1.x*this.m_v1.x+i.col2.x*this.m_v1.y),n=o.position.y+(i.col1.y*this.m_v1.x+i.col2.y*this.m_v1.y),e=o.position.x+(i.col1.x*this.m_v2.x+i.col2.x*this.m_v2.y),m=o.position.y+(i.col1.y*this.m_v2.x+i.col2.y*this.m_v2.y);e>s?(t.lowerBound.x=s,t.upperBound.x=e):(t.lowerBound.x=e,t.upperBound.x=s),m>n?(t.lowerBound.y=n,t.upperBound.y=m):(t.lowerBound.y=m,t.upperBound.y=n)},computeMass:function(t){t.mass=0,t.center.setV(this.m_v1),t.I=0},computeSubmergedArea:function(t,o,i,s){var n=new box2D.common.math.B2Vec2(t.x*o,t.y*o),e=box2D.common.math.B2Math.mulX(i,this.m_v1),m=box2D.common.math.B2Math.mulX(i,this.m_v2),a=box2D.common.math.B2Math.dot(t,e)-o,c=box2D.common.math.B2Math.dot(t,m)-o;if(a>0){if(c>0)return 0;e.x=-c/(a-c)*e.x+a/(a-c)*m.x,e.y=-c/(a-c)*e.y+a/(a-c)*m.y}else c>0&&(m.x=-c/(a-c)*e.x+a/(a-c)*m.x,m.y=-c/(a-c)*e.y+a/(a-c)*m.y);return s.x=(n.x+e.x+m.x)/3,s.y=(n.y+e.y+m.y)/3,.5*((e.x-n.x)*(m.y-n.y)-(e.y-n.y)*(m.x-n.x))},getLength:function(){return this.m_length},getVertex1:function(){return this.m_v1},getVertex2:function(){return this.m_v2},getCoreVertex1:function(){return this.m_coreV1},getCoreVertex2:function(){return this.m_coreV2},getNormalVector:function(){return this.m_normal},getDirectionVector:function(){return this.m_direction},getCorner1Vector:function(){return this.m_cornerDir1},getCorner2Vector:function(){return this.m_cornerDir2},corner1IsConvex:function(){return this.m_cornerConvex1},corner2IsConvex:function(){return this.m_cornerConvex2},getFirstVertex:function(t){var o=t.R;return new box2D.common.math.B2Vec2(t.position.x+(o.col1.x*this.m_coreV1.x+o.col2.x*this.m_coreV1.y),t.position.y+(o.col1.y*this.m_coreV1.x+o.col2.y*this.m_coreV1.y))},getNextEdge:function(){return this.m_nextEdge},getPrevEdge:function(){return this.m_prevEdge},support:function(t,o,i){var s=t.R,n=t.position.x+(s.col1.x*this.m_coreV1.x+s.col2.x*this.m_coreV1.y),e=t.position.y+(s.col1.y*this.m_coreV1.x+s.col2.y*this.m_coreV1.y),m=t.position.x+(s.col1.x*this.m_coreV2.x+s.col2.x*this.m_coreV2.y),a=t.position.y+(s.col1.y*this.m_coreV2.x+s.col2.y*this.m_coreV2.y);return n*o+e*i>m*o+a*i?(this.s_supportVec.x=n,this.s_supportVec.y=e):(this.s_supportVec.x=m,this.s_supportVec.y=a),this.s_supportVec},setPrevEdge:function(t,o,i,s){this.m_prevEdge=t,this.m_coreV1=o,this.m_cornerDir1=i,this.m_cornerConvex1=s},setNextEdge:function(t,o,i,s){this.m_nextEdge=t,this.m_coreV2=o,this.m_cornerDir2=i,this.m_cornerConvex2=s},__class__:box2D.collision.shapes.B2EdgeShape}),box2D.collision.shapes.B2MassData=function(){this.mass=0,this.center=new box2D.common.math.B2Vec2(0,0),this.I=0},box2D.collision.shapes.B2MassData.__name__=!0,box2D.collision.shapes.B2MassData.prototype={__class__:box2D.collision.shapes.B2MassData},box2D.collision.shapes.B2PolygonShape=function(){box2D.collision.shapes.B2Shape.call(this),this.m_type=box2D.collision.shapes.B2Shape.e_polygonShape,this.m_centroid=new box2D.common.math.B2Vec2,this.m_vertices=new Array,this.m_normals=new Array},box2D.collision.shapes.B2PolygonShape.__name__=!0,box2D.collision.shapes.B2PolygonShape.asArray=function(t,o){var i=new box2D.collision.shapes.B2PolygonShape;return i.setAsArray(t,o),i},box2D.collision.shapes.B2PolygonShape.asVector=function(t,o){var i=new box2D.collision.shapes.B2PolygonShape;return i.setAsVector(t,o),i},box2D.collision.shapes.B2PolygonShape.asBox=function(t,o){var i=new box2D.collision.shapes.B2PolygonShape;return i.setAsBox(t,o),i},box2D.collision.shapes.B2PolygonShape.asOrientedBox=function(t,o,i,s){null==s&&(s=0);var n=new box2D.collision.shapes.B2PolygonShape;return n.setAsOrientedBox(t,o,i,s),n},box2D.collision.shapes.B2PolygonShape.asEdge=function(t,o){var i=new box2D.collision.shapes.B2PolygonShape;return i.setAsEdge(t,o),i},box2D.collision.shapes.B2PolygonShape.computeCentroid=function(t,o){for(var i=new box2D.common.math.B2Vec2,s=0,n=0,e=0,m=.3333333333333333,a=0;o>a;){var c,l=a++,r=t[l];c=o>l+1?t[l+1|0]:t[0];var _=r.x-n,h=r.y-e,x=c.x-n,y=c.y-e,u=_*y-h*x,p=.5*u;s+=p,i.x+=p*m*(n+r.x+c.x),i.y+=p*m*(e+r.y+c.y)}return i.x*=1/s,i.y*=1/s,i},box2D.collision.shapes.B2PolygonShape.computeOBB=function(t,o,i){for(var s=new Array,n=0;i>n;){var e=n++;s[e]=o[e]}s[i]=s[0];for(var m=1.7976931348623157e308,a=1,n=i+1;n>a;){var e=a++,c=s[e-1|0],l=s[e].x-c.x,r=s[e].y-c.y,_=Math.sqrt(l*l+r*r);l/=_,r/=_;for(var h=-r,x=l,y=1.7976931348623157e308,u=1.7976931348623157e308,p=-1.7976931348623157e308,d=-1.7976931348623157e308,B=0;i>B;){var b=B++,D=s[b].x-c.x,f=s[b].y-c.y,g=l*D+r*f,v=h*D+x*f;y>g&&(y=g),u>v&&(u=v),g>p&&(p=g),v>d&&(d=v)}var A=(p-y)*(d-u);if(.95*m>A){m=A,t.R.col1.x=l,t.R.col1.y=r,t.R.col2.x=h,t.R.col2.y=x;var w=.5*(y+p),V=.5*(u+d),C=t.R;t.center.x=c.x+(C.col1.x*w+C.col2.x*V),t.center.y=c.y+(C.col1.y*w+C.col2.y*V),t.extents.x=.5*(p-y),t.extents.y=.5*(d-u)}}},box2D.collision.shapes.B2PolygonShape.__super__=box2D.collision.shapes.B2Shape,box2D.collision.shapes.B2PolygonShape.prototype=$extend(box2D.collision.shapes.B2Shape.prototype,{copy:function(){var t=new box2D.collision.shapes.B2PolygonShape;return t.set(this),t},set:function(t){if(box2D.collision.shapes.B2Shape.prototype.set.call(this,t),js.Boot.__instanceof(t,box2D.collision.shapes.B2PolygonShape)){var o;o=js.Boot.__cast(t,box2D.collision.shapes.B2PolygonShape),this.m_centroid.setV(o.m_centroid),this.m_vertexCount=o.m_vertexCount,this.reserve(this.m_vertexCount);for(var i=0,s=this.m_vertexCount;s>i;){var n=i++;this.m_vertices[n].setV(o.m_vertices[n]),this.m_normals[n].setV(o.m_normals[n])}}},setAsArray:function(t,o){null==o&&(o=0);for(var i=new Array,s=0;s<t.length;){var n=t[s];++s,i.push(n)}this.setAsVector(i,o)},setAsVector:function(t,o){null==o&&(o=0),0==o&&(o=t.length),box2D.common.B2Settings.b2Assert(o>=2),this.m_vertexCount=0|o,this.reserve(0|o);for(var i=0,s=this.m_vertexCount;s>i;){var n=i++;this.m_vertices[n].setV(t[n])}for(var i=0,s=this.m_vertexCount;s>i;){var e,n=i++,m=n;e=n+1<this.m_vertexCount?n+1:0;var a=box2D.common.math.B2Math.subtractVV(this.m_vertices[e],this.m_vertices[m]);box2D.common.B2Settings.b2Assert(a.lengthSquared()>2.2250738585072014e-308),this.m_normals[n].setV(box2D.common.math.B2Math.crossVF(a,1)),this.m_normals[n].normalize()}this.m_centroid=box2D.collision.shapes.B2PolygonShape.computeCentroid(this.m_vertices,this.m_vertexCount)},setAsBox:function(t,o){this.m_vertexCount=4,this.reserve(4),this.m_vertices[0].set(-t,-o),this.m_vertices[1].set(t,-o),this.m_vertices[2].set(t,o),this.m_vertices[3].set(-t,o),this.m_normals[0].set(0,-1),this.m_normals[1].set(1,0),this.m_normals[2].set(0,1),this.m_normals[3].set(-1,0),this.m_centroid.setZero()},setAsOrientedBox:function(t,o,i,s){null==s&&(s=0),this.m_vertexCount=4,this.reserve(4),this.m_vertices[0].set(-t,-o),this.m_vertices[1].set(t,-o),this.m_vertices[2].set(t,o),this.m_vertices[3].set(-t,o),this.m_normals[0].set(0,-1),this.m_normals[1].set(1,0),this.m_normals[2].set(0,1),this.m_normals[3].set(-1,0),this.m_centroid=i;var n=new box2D.common.math.B2Transform;n.position=i,n.R.set(s);for(var e=0,m=this.m_vertexCount;m>e;){var a=e++;this.m_vertices[a]=box2D.common.math.B2Math.mulX(n,this.m_vertices[a]),this.m_normals[a]=box2D.common.math.B2Math.mulMV(n.R,this.m_normals[a])}},setAsEdge:function(t,o){this.m_vertexCount=2,this.reserve(2),this.m_vertices[0].setV(t),this.m_vertices[1].setV(o),this.m_centroid.x=.5*(t.x+o.x),this.m_centroid.y=.5*(t.y+o.y),this.m_normals[0]=box2D.common.math.B2Math.crossVF(box2D.common.math.B2Math.subtractVV(o,t),1),this.m_normals[0].normalize(),this.m_normals[1].x=-this.m_normals[0].x,this.m_normals[1].y=-this.m_normals[0].y},testPoint:function(t,o){for(var i,s=t.R,n=o.x-t.position.x,e=o.y-t.position.y,m=n*s.col1.x+e*s.col1.y,a=n*s.col2.x+e*s.col2.y,c=0,l=this.m_vertexCount;l>c;){var r=c++;i=this.m_vertices[r],n=m-i.x,e=a-i.y,i=this.m_normals[r];var _=i.x*n+i.y*e;if(_>0)return!1}return!0},rayCast:function(t,o,i){var s,n,e,m,a=0,c=o.maxFraction;s=o.p1.x-i.position.x,n=o.p1.y-i.position.y,e=i.R;var l=s*e.col1.x+n*e.col1.y,r=s*e.col2.x+n*e.col2.y;s=o.p2.x-i.position.x,n=o.p2.y-i.position.y,e=i.R;for(var _=s*e.col1.x+n*e.col1.y,h=s*e.col2.x+n*e.col2.y,x=_-l,y=h-r,u=-1,p=0,d=this.m_vertexCount;d>p;){var B=p++;m=this.m_vertices[B],s=m.x-l,n=m.y-r,m=this.m_normals[B];var b=m.x*s+m.y*n,D=m.x*x+m.y*y;if(0==D){if(0>b)return!1}else 0>D&&a*D>b?(a=b/D,u=B):D>0&&c*D>b&&(c=b/D);if(a-2.2250738585072014e-308>c)return!1}return u>=0?(t.fraction=a,e=i.R,m=this.m_normals[u],t.normal.x=e.col1.x*m.x+e.col2.x*m.y,t.normal.y=e.col1.y*m.x+e.col2.y*m.y,!0):!1},computeAABB:function(t,o){for(var i=o.R,s=this.m_vertices[0],n=o.position.x+(i.col1.x*s.x+i.col2.x*s.y),e=o.position.y+(i.col1.y*s.x+i.col2.y*s.y),m=n,a=e,c=1,l=this.m_vertexCount;l>c;){var r=c++;s=this.m_vertices[r];var _=o.position.x+(i.col1.x*s.x+i.col2.x*s.y),h=o.position.y+(i.col1.y*s.x+i.col2.y*s.y);n=_>n?n:_,e=h>e?e:h,m=m>_?m:_,a=a>h?a:h}t.lowerBound.x=n-this.m_radius,t.lowerBound.y=e-this.m_radius,t.upperBound.x=m+this.m_radius,t.upperBound.y=a+this.m_radius},computeMass:function(t,o){if(2==this.m_vertexCount)return t.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),t.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),t.mass=0,void(t.I=0);for(var i=0,s=0,n=0,e=0,m=0,a=0,c=.3333333333333333,l=0,r=this.m_vertexCount;r>l;){var _,h=l++,x=this.m_vertices[h];_=h+1<this.m_vertexCount?this.m_vertices[h+1|0]:this.m_vertices[0];var y=x.x-m,u=x.y-a,p=_.x-m,d=_.y-a,B=y*d-u*p,b=.5*B;n+=b,i+=b*c*(m+x.x+_.x),s+=b*c*(a+x.y+_.y);var D=m,f=a,g=y,v=u,A=p,w=d,V=c*(.25*(g*g+A*g+A*A)+(D*g+D*A))+.5*D*D,C=c*(.25*(v*v+w*v+w*w)+(f*v+f*w))+.5*f*f;e+=B*(V+C)}t.mass=o*n,i*=1/n,s*=1/n,t.center.set(i,s),t.I=o*e},computeSubmergedArea:function(t,o,i,s){for(var n,e=box2D.common.math.B2Math.mulTMV(i.R,t),m=o-box2D.common.math.B2Math.dot(t,i.position),a=new Array,c=0,l=-1,r=-1,_=!1,h=0,x=this.m_vertexCount;x>h;){var y=h++;a[y]=box2D.common.math.B2Math.dot(e,this.m_vertices[y])-m;var u=a[y]<-2.2250738585072014e-308;y>0&&(u?_||(l=y-1,c++):_&&(r=y-1,c++)),_=u}switch(c){case 0:if(_){var p=new box2D.collision.shapes.B2MassData;return this.computeMass(p,1),s.setV(box2D.common.math.B2Math.mulX(i,p.center)),p.mass}return 0;case 1:-1==l?l=this.m_vertexCount-1:r=this.m_vertexCount-1}var d,B=(l+1)%this.m_vertexCount,b=(r+1)%this.m_vertexCount,D=(0-a[l])/(a[B]-a[l]),f=(0-a[r])/(a[b]-a[r]),g=new box2D.common.math.B2Vec2(this.m_vertices[l].x*(1-D)+this.m_vertices[B].x*D,this.m_vertices[l].y*(1-D)+this.m_vertices[B].y*D),v=new box2D.common.math.B2Vec2(this.m_vertices[r].x*(1-f)+this.m_vertices[b].x*f,this.m_vertices[r].y*(1-f)+this.m_vertices[b].y*f),A=0,w=new box2D.common.math.B2Vec2,V=this.m_vertices[B];for(n=B;n!=b;){n=(n+1)%this.m_vertexCount,d=n==b?v:this.m_vertices[n];var C=.5*((V.x-g.x)*(d.y-g.y)-(V.y-g.y)*(d.x-g.x));A+=C,w.x+=C*(g.x+V.x+d.x)/3,w.y+=C*(g.y+V.y+d.y)/3,V=d}return w.multiply(1/A),s.setV(box2D.common.math.B2Math.mulX(i,w)),A},getVertexCount:function(){return this.m_vertexCount},getVertices:function(){return this.m_vertices},getNormals:function(){return this.m_normals},getSupport:function(t){for(var o=0,i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,s=1,n=this.m_vertexCount;n>s;){var e=s++,m=this.m_vertices[e].x*t.x+this.m_vertices[e].y*t.y;m>i&&(o=e,i=m)}return o},getSupportVertex:function(t){for(var o=0,i=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,s=1,n=this.m_vertexCount;n>s;){var e=s++,m=this.m_vertices[e].x*t.x+this.m_vertices[e].y*t.y;m>i&&(o=e,i=m)}return this.m_vertices[o]},validate:function(){return!1},reserve:function(t){for(var o=this.m_vertices.length;t>o;){var i=o++;this.m_vertices[i]=new box2D.common.math.B2Vec2,this.m_normals[i]=new box2D.common.math.B2Vec2}},__class__:box2D.collision.shapes.B2PolygonShape}),box2D.common.B2Color=function(t,o,i){var s=255*box2D.common.math.B2Math.clamp(t,0,1);this._r=0|s;var s=255*box2D.common.math.B2Math.clamp(o,0,1);this._g=0|s;var s=255*box2D.common.math.B2Math.clamp(i,0,1);this._b=0|s},box2D.common.B2Color.__name__=!0,box2D.common.B2Color.prototype={set:function(t,o,i){var s=255*box2D.common.math.B2Math.clamp(t,0,1);this._r=0|s;var s=255*box2D.common.math.B2Math.clamp(o,0,1);this._g=0|s;var s=255*box2D.common.math.B2Math.clamp(i,0,1);this._b=0|s},set_r:function(t){return function(o){var i,s=255*box2D.common.math.B2Math.clamp(t,0,1);return i=o._r=0|s}(this)},set_g:function(t){return function(o){var i,s=255*box2D.common.math.B2Math.clamp(t,0,1);return i=o._g=0|s}(this)},set_b:function(t){return function(o){var i,s=255*box2D.common.math.B2Math.clamp(t,0,1);return i=o._b=0|s}(this)},get_color:function(){return this._r<<16|this._g<<8|this._b},__class__:box2D.common.B2Color},box2D.common.B2Settings=function(){},box2D.common.B2Settings.__name__=!0,box2D.common.B2Settings.b2MixFriction=function(t,o){return Math.sqrt(t*o)},box2D.common.B2Settings.b2MixRestitution=function(t,o){return t>o?t:o},box2D.common.B2Settings.b2Assert=function(t){if(!t)throw"Assertion Failed"},box2D.common.math.B2Mat33=function(t,o,i){this.col1=new box2D.common.math.B2Vec3,this.col2=new box2D.common.math.B2Vec3,this.col3=new box2D.common.math.B2Vec3,null==t&&null==o&&null==i?(this.col1.setZero(),this.col2.setZero(),this.col3.setZero()):(this.col1.setV(t),this.col2.setV(o),this.col3.setV(i))},box2D.common.math.B2Mat33.__name__=!0,box2D.common.math.B2Mat33.prototype={setVVV:function(t,o,i){this.col1.setV(t),this.col2.setV(o),this.col3.setV(i)},copy:function(){return new box2D.common.math.B2Mat33(this.col1,this.col2,this.col3)},setM:function(t){this.col1.setV(t.col1),this.col2.setV(t.col2),this.col3.setV(t.col3)},addM:function(t){this.col1.x+=t.col1.x,this.col1.y+=t.col1.y,this.col1.z+=t.col1.z,this.col2.x+=t.col2.x,this.col2.y+=t.col2.y,this.col2.z+=t.col2.z,this.col3.x+=t.col3.x,this.col3.y+=t.col3.y,this.col3.z+=t.col3.z},setIdentity:function(){this.col1.x=1,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=1,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=1},setZero:function(){this.col1.x=0,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=0,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=0},solve22:function(t,o,i){var s=this.col1.x,n=this.col2.x,e=this.col1.y,m=this.col2.y,a=s*m-n*e;return 0!=a&&(a=1/a),t.x=a*(m*o-n*i),t.y=a*(s*i-e*o),t},solve33:function(t,o,i,s){var n=this.col1.x,e=this.col1.y,m=this.col1.z,a=this.col2.x,c=this.col2.y,l=this.col2.z,r=this.col3.x,_=this.col3.y,h=this.col3.z,x=n*(c*h-l*_)+e*(l*r-a*h)+m*(a*_-c*r);
return 0!=x&&(x=1/x),t.x=x*(o*(c*h-l*_)+i*(l*r-a*h)+s*(a*_-c*r)),t.y=x*(n*(i*h-s*_)+e*(s*r-o*h)+m*(o*_-i*r)),t.z=x*(n*(c*s-l*i)+e*(l*o-a*s)+m*(a*i-c*o)),t},__class__:box2D.common.math.B2Mat33},box2D.common.math.B2Math=function(){},box2D.common.math.B2Math.__name__=!0,box2D.common.math.B2Math.isValid=function(t){return Math.isNaN(t)||t==Math.NEGATIVE_INFINITY||t==Math.POSITIVE_INFINITY?!1:!0},box2D.common.math.B2Math.dot=function(t,o){return t.x*o.x+t.y*o.y},box2D.common.math.B2Math.crossVV=function(t,o){return t.x*o.y-t.y*o.x},box2D.common.math.B2Math.crossVF=function(t,o){var i=new box2D.common.math.B2Vec2(o*t.y,-o*t.x);return i},box2D.common.math.B2Math.crossFV=function(t,o){var i=new box2D.common.math.B2Vec2(-t*o.y,t*o.x);return i},box2D.common.math.B2Math.mulMV=function(t,o){var i=new box2D.common.math.B2Vec2(t.col1.x*o.x+t.col2.x*o.y,t.col1.y*o.x+t.col2.y*o.y);return i},box2D.common.math.B2Math.mulTMV=function(t,o){var i=new box2D.common.math.B2Vec2(box2D.common.math.B2Math.dot(o,t.col1),box2D.common.math.B2Math.dot(o,t.col2));return i},box2D.common.math.B2Math.mulX=function(t,o){var i=box2D.common.math.B2Math.mulMV(t.R,o);return i.x+=t.position.x,i.y+=t.position.y,i},box2D.common.math.B2Math.mulXT=function(t,o){var i=box2D.common.math.B2Math.subtractVV(o,t.position),s=i.x*t.R.col1.x+i.y*t.R.col1.y;return i.y=i.x*t.R.col2.x+i.y*t.R.col2.y,i.x=s,i},box2D.common.math.B2Math.addVV=function(t,o){var i=new box2D.common.math.B2Vec2(t.x+o.x,t.y+o.y);return i},box2D.common.math.B2Math.subtractVV=function(t,o){var i=new box2D.common.math.B2Vec2(t.x-o.x,t.y-o.y);return i},box2D.common.math.B2Math.distance=function(t,o){var i=t.x-o.x,s=t.y-o.y;return Math.sqrt(i*i+s*s)},box2D.common.math.B2Math.distanceSquared=function(t,o){var i=t.x-o.x,s=t.y-o.y;return i*i+s*s},box2D.common.math.B2Math.mulFV=function(t,o){var i=new box2D.common.math.B2Vec2(t*o.x,t*o.y);return i},box2D.common.math.B2Math.addMM=function(t,o){var i=box2D.common.math.B2Mat22.fromVV(box2D.common.math.B2Math.addVV(t.col1,o.col1),box2D.common.math.B2Math.addVV(t.col2,o.col2));return i},box2D.common.math.B2Math.mulMM=function(t,o){var i=box2D.common.math.B2Mat22.fromVV(box2D.common.math.B2Math.mulMV(t,o.col1),box2D.common.math.B2Math.mulMV(t,o.col2));return i},box2D.common.math.B2Math.mulTMM=function(t,o){var i=new box2D.common.math.B2Vec2(box2D.common.math.B2Math.dot(t.col1,o.col1),box2D.common.math.B2Math.dot(t.col2,o.col1)),s=new box2D.common.math.B2Vec2(box2D.common.math.B2Math.dot(t.col1,o.col2),box2D.common.math.B2Math.dot(t.col2,o.col2)),n=box2D.common.math.B2Mat22.fromVV(i,s);return n},box2D.common.math.B2Math.abs=function(t){return t>0?t:-t},box2D.common.math.B2Math.absV=function(t){var o=new box2D.common.math.B2Vec2(box2D.common.math.B2Math.abs(t.x),box2D.common.math.B2Math.abs(t.y));return o},box2D.common.math.B2Math.absM=function(t){var o=box2D.common.math.B2Mat22.fromVV(box2D.common.math.B2Math.absV(t.col1),box2D.common.math.B2Math.absV(t.col2));return o},box2D.common.math.B2Math.min=function(t,o){return o>t?t:o},box2D.common.math.B2Math.minV=function(t,o){var i=new box2D.common.math.B2Vec2(box2D.common.math.B2Math.min(t.x,o.x),box2D.common.math.B2Math.min(t.y,o.y));return i},box2D.common.math.B2Math.max=function(t,o){return t>o?t:o},box2D.common.math.B2Math.maxV=function(t,o){var i=new box2D.common.math.B2Vec2(box2D.common.math.B2Math.max(t.x,o.x),box2D.common.math.B2Math.max(t.y,o.y));return i},box2D.common.math.B2Math.clamp=function(t,o,i){return o>t?o:t>i?i:t},box2D.common.math.B2Math.clampV=function(t,o,i){return box2D.common.math.B2Math.maxV(o,box2D.common.math.B2Math.minV(t,i))},box2D.common.math.B2Math.swap=function(t,o){var i=t[0];t[0]=o[0],o[0]=i},box2D.common.math.B2Math.random=function(){return 2*Math.random()-1},box2D.common.math.B2Math.randomRange=function(t,o){var i=Math.random();return i=(o-t)*i+t},box2D.common.math.B2Math.nextPowerOfTwo=function(t){return t|=t>>1&2147483647,t|=t>>2&1073741823,t|=t>>4&268435455,t|=t>>8&16777215,t|=t>>16&65535,t+1},box2D.common.math.B2Math.isPowerOfTwo=function(t){var o=t>0&&0==(t&t-1);return o},box2D.common.math.B2Sweep=function(){this.localCenter=new box2D.common.math.B2Vec2,this.c0=new box2D.common.math.B2Vec2,this.c=new box2D.common.math.B2Vec2},box2D.common.math.B2Sweep.__name__=!0,box2D.common.math.B2Sweep.prototype={set:function(t){this.localCenter.setV(t.localCenter),this.c0.setV(t.c0),this.c.setV(t.c),this.a0=t.a0,this.a=t.a,this.t0=t.t0},copy:function(){var t=new box2D.common.math.B2Sweep;return t.localCenter.setV(this.localCenter),t.c0.setV(this.c0),t.c.setV(this.c),t.a0=this.a0,t.a=this.a,t.t0=this.t0,t},getTransform:function(t,o){t.position.x=(1-o)*this.c0.x+o*this.c.x,t.position.y=(1-o)*this.c0.y+o*this.c.y;var i=(1-o)*this.a0+o*this.a;t.R.set(i);var s=t.R;t.position.x-=s.col1.x*this.localCenter.x+s.col2.x*this.localCenter.y,t.position.y-=s.col1.y*this.localCenter.x+s.col2.y*this.localCenter.y},advance:function(t){if(this.t0<t&&1-this.t0>2.2250738585072014e-308){var o=(t-this.t0)/(1-this.t0);this.c0.x=(1-o)*this.c0.x+o*this.c.x,this.c0.y=(1-o)*this.c0.y+o*this.c.y,this.a0=(1-o)*this.a0+o*this.a,this.t0=t}},__class__:box2D.common.math.B2Sweep},box2D.common.math.B2Vec3=function(t,o,i){null==i&&(i=0),null==o&&(o=0),null==t&&(t=0),this.x=t,this.y=o,this.z=i},box2D.common.math.B2Vec3.__name__=!0,box2D.common.math.B2Vec3.prototype={setZero:function(){this.x=this.y=this.z=0},set:function(t,o,i){this.x=t,this.y=o,this.z=i},setV:function(t){this.x=t.x,this.y=t.y,this.z=t.z},getNegative:function(){return new box2D.common.math.B2Vec3(-this.x,-this.y,-this.z)},negativeSelf:function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},copy:function(){return new box2D.common.math.B2Vec3(this.x,this.y,this.z)},add:function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},subtract:function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z},multiply:function(t){this.x*=t,this.y*=t,this.z*=t},__class__:box2D.common.math.B2Vec3},box2D.dynamics={},box2D.dynamics.B2Body=function(t,o){this.m_xf=new box2D.common.math.B2Transform,this.m_sweep=new box2D.common.math.B2Sweep,this.m_linearVelocity=new box2D.common.math.B2Vec2,this.m_force=new box2D.common.math.B2Vec2,this.m_flags=0,t.bullet&&(this.m_flags|=box2D.dynamics.B2Body.e_bulletFlag),t.fixedRotation&&(this.m_flags|=box2D.dynamics.B2Body.e_fixedRotationFlag),t.allowSleep&&(this.m_flags|=box2D.dynamics.B2Body.e_allowSleepFlag),t.awake&&(this.m_flags|=box2D.dynamics.B2Body.e_awakeFlag),t.active&&(this.m_flags|=box2D.dynamics.B2Body.e_activeFlag),this.m_world=o,this.m_xf.position.setV(t.position),this.m_xf.R.set(t.angle),this.m_sweep.localCenter.setZero(),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=t.angle;var i=this.m_xf.R,s=this.m_sweep.localCenter;this.m_sweep.c.x=i.col1.x*s.x+i.col2.x*s.y,this.m_sweep.c.y=i.col1.y*s.x+i.col2.y*s.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.setV(this.m_sweep.c),this.m_jointList=null,this.m_controllerList=null,this.m_contactList=null,this.m_controllerCount=0,this.m_prev=null,this.m_next=null,this.m_linearVelocity.setV(t.linearVelocity),this.m_angularVelocity=t.angularVelocity,this.m_linearDamping=t.linearDamping,this.m_angularDamping=t.angularDamping,this.m_force.set(0,0),this.m_torque=0,this.m_sleepTime=0,this.m_type=t.type,this.m_type==box2D.dynamics.B2Body.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_inertiaScale=t.inertiaScale,this.m_userData=t.userData,this.m_fixtureList=null,this.m_fixtureCount=0},box2D.dynamics.B2Body.__name__=!0,box2D.dynamics.B2Body.prototype={connectEdges:function(t,o,i){var s=Math.atan2(o.getDirectionVector().y,o.getDirectionVector().x),n=Math.tan(.5*(s-i)),e=box2D.common.math.B2Math.mulFV(n,o.getDirectionVector());e=box2D.common.math.B2Math.subtractVV(e,o.getNormalVector()),e=box2D.common.math.B2Math.mulFV(box2D.common.B2Settings.b2_toiSlop,e),e=box2D.common.math.B2Math.addVV(e,o.getVertex1());var m=box2D.common.math.B2Math.addVV(t.getDirectionVector(),o.getDirectionVector());m.normalize();var a=box2D.common.math.B2Math.dot(t.getDirectionVector(),o.getNormalVector())>0;return t.setNextEdge(o,e,m,a),o.setPrevEdge(t,e,m,a),s},createFixture:function(t){if(1==this.m_world.isLocked())return null;var o=new box2D.dynamics.B2Fixture;if(o.create(this,this.m_xf,t),0!=(this.m_flags&box2D.dynamics.B2Body.e_activeFlag)){var i=this.m_world.m_contactManager.m_broadPhase;o.createProxy(i,this.m_xf)}return o.m_next=this.m_fixtureList,this.m_fixtureList=o,++this.m_fixtureCount,o.m_body=this,o.m_density>0&&this.resetMassData(),this.m_world.m_flags|=box2D.dynamics.B2World.e_newFixture,o},createFixture2:function(t,o){null==o&&(o=0);var i=new box2D.dynamics.B2FixtureDef;return i.shape=t,i.density=o,this.createFixture(i)},DestroyFixture:function(t){if(1!=this.m_world.isLocked()){for(var o=this.m_fixtureList,i=null,s=!1;null!=o;){if(o==t){null!=i?i.m_next=t.m_next:this.m_fixtureList=t.m_next,s=!0;break}i=o,o=o.m_next}for(var n=this.m_contactList;null!=n;){var e=n.contact;n=n.next;var m=e.getFixtureA(),a=e.getFixtureB();(t==m||t==a)&&this.m_world.m_contactManager.destroy(e)}if(0!=(this.m_flags&box2D.dynamics.B2Body.e_activeFlag)){var c=this.m_world.m_contactManager.m_broadPhase;t.destroyProxy(c)}t.destroy(),t.m_body=null,t.m_next=null,--this.m_fixtureCount,this.resetMassData()}},setPositionAndAngle:function(t,o){var i;if(1!=this.m_world.isLocked()){this.m_xf.R.set(o),this.m_xf.position.setV(t);var s=this.m_xf.R,n=this.m_sweep.localCenter;this.m_sweep.c.x=s.col1.x*n.x+s.col2.x*n.y,this.m_sweep.c.y=s.col1.y*n.x+s.col2.y*n.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.setV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=o;var e=this.m_world.m_contactManager.m_broadPhase;for(i=this.m_fixtureList;null!=i;)i.synchronize(e,this.m_xf,this.m_xf),i=i.m_next;this.m_world.m_contactManager.findNewContacts()}},setTransform:function(t){this.setPositionAndAngle(t.position,t.getAngle())},getTransform:function(){return this.m_xf},getPosition:function(){return this.m_xf.position},setPosition:function(t){this.setPositionAndAngle(t,this.getAngle())},getAngle:function(){return this.m_sweep.a},setAngle:function(t){this.setPositionAndAngle(this.getPosition(),t)},getWorldCenter:function(){return this.m_sweep.c},getLocalCenter:function(){return this.m_sweep.localCenter},setLinearVelocity:function(t){this.m_type!=box2D.dynamics.B2Body.b2_staticBody&&this.m_linearVelocity.setV(t)},getLinearVelocity:function(){return this.m_linearVelocity},setAngularVelocity:function(t){this.m_type!=box2D.dynamics.B2Body.b2_staticBody&&(this.m_angularVelocity=t)},getAngularVelocity:function(){return this.m_angularVelocity},getDefinition:function(){var t=new box2D.dynamics.B2BodyDef;return t.type=this.getType(),t.allowSleep=(this.m_flags&box2D.dynamics.B2Body.e_allowSleepFlag)==box2D.dynamics.B2Body.e_allowSleepFlag,t.angle=this.getAngle(),t.angularDamping=this.m_angularDamping,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=(this.m_flags&box2D.dynamics.B2Body.e_fixedRotationFlag)==box2D.dynamics.B2Body.e_fixedRotationFlag,t.bullet=(this.m_flags&box2D.dynamics.B2Body.e_bulletFlag)==box2D.dynamics.B2Body.e_bulletFlag,t.awake=(this.m_flags&box2D.dynamics.B2Body.e_awakeFlag)==box2D.dynamics.B2Body.e_awakeFlag,t.linearDamping=this.m_linearDamping,t.linearVelocity.setV(this.getLinearVelocity()),t.position=this.getPosition(),t.userData=this.getUserData(),t},applyForce:function(t,o){this.m_type==box2D.dynamics.B2Body.b2_dynamicBody&&(0==this.isAwake()&&this.setAwake(!0),this.m_force.x+=t.x,this.m_force.y+=t.y,this.m_torque+=(o.x-this.m_sweep.c.x)*t.y-(o.y-this.m_sweep.c.y)*t.x)},applyTorque:function(t){this.m_type==box2D.dynamics.B2Body.b2_dynamicBody&&(0==this.isAwake()&&this.setAwake(!0),this.m_torque+=t)},applyImpulse:function(t,o){this.m_type==box2D.dynamics.B2Body.b2_dynamicBody&&(0==this.isAwake()&&this.setAwake(!0),this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y,this.m_angularVelocity+=this.m_invI*((o.x-this.m_sweep.c.x)*t.y-(o.y-this.m_sweep.c.y)*t.x))},split:function(t){for(var o=this.getLinearVelocity().copy(),i=this.getAngularVelocity(),s=this.getWorldCenter(),n=this,e=this.m_world.createBody(this.getDefinition()),m=null,a=n.m_fixtureList;null!=a;)if(t(a)){var c=a.m_next;null!=m?m.m_next=c:n.m_fixtureList=c,n.m_fixtureCount--,a.m_next=e.m_fixtureList,e.m_fixtureList=a,e.m_fixtureCount++,a.m_body=e,a=c}else m=a,a=a.m_next;n.resetMassData(),e.resetMassData();var l=n.getWorldCenter(),r=e.getWorldCenter(),_=box2D.common.math.B2Math.addVV(o,box2D.common.math.B2Math.crossFV(i,box2D.common.math.B2Math.subtractVV(l,s))),h=box2D.common.math.B2Math.addVV(o,box2D.common.math.B2Math.crossFV(i,box2D.common.math.B2Math.subtractVV(r,s)));return n.setLinearVelocity(_),e.setLinearVelocity(h),n.setAngularVelocity(i),e.setAngularVelocity(i),n.synchronizeFixtures(),e.synchronizeFixtures(),e},merge:function(t){var o;o=t.m_fixtureList;for(var i=this,s=t;null!=o;){var n=o.m_next;t.m_fixtureCount--,o.m_next=this.m_fixtureList,this.m_fixtureList=o,this.m_fixtureCount++,o.m_body=s,o=n}i.m_fixtureCount=0;i.getWorldCenter(),s.getWorldCenter(),i.getLinearVelocity().copy(),s.getLinearVelocity().copy(),i.getAngularVelocity(),s.getAngularVelocity();i.resetMassData(),this.synchronizeFixtures()},getMass:function(){return this.m_mass},getInertia:function(){return this.m_I},getMassData:function(t){t.mass=this.m_mass,t.I=this.m_I,t.center.setV(this.m_sweep.localCenter)},setMassData:function(t){if(box2D.common.B2Settings.b2Assert(0==this.m_world.isLocked()),1!=this.m_world.isLocked()&&this.m_type==box2D.dynamics.B2Body.b2_dynamicBody){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,t.I>0&&0==(this.m_flags&box2D.dynamics.B2Body.e_fixedRotationFlag)&&(this.m_I=t.I-this.m_mass*(t.center.x*t.center.x+t.center.y*t.center.y),this.m_invI=1/this.m_I);var o=this.m_sweep.c.copy();this.m_sweep.localCenter.setV(t.center),this.m_sweep.c0.setV(box2D.common.math.B2Math.mulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.setV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-o.y),this.m_linearVelocity.y+=this.m_angularVelocity*(this.m_sweep.c.x-o.x)}},resetMassData:function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.setZero(),this.m_type!=box2D.dynamics.B2Body.b2_staticBody&&this.m_type!=box2D.dynamics.B2Body.b2_kinematicBody){for(var t=box2D.common.math.B2Vec2.make(0,0),o=this.m_fixtureList;null!=o;)if(0!=o.m_density){var i=o.getMassData();this.m_mass+=i.mass,t.x+=i.center.x*i.mass,t.y+=i.center.y*i.mass,this.m_I+=i.I,o=o.m_next}this.m_mass>0?(this.m_invMass=1/this.m_mass,t.x*=this.m_invMass,t.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&0==(this.m_flags&box2D.dynamics.B2Body.e_fixedRotationFlag)?(this.m_I-=this.m_mass*(t.x*t.x+t.y*t.y),this.m_I*=this.m_inertiaScale,box2D.common.B2Settings.b2Assert(this.m_I>0),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var s=this.m_sweep.c.copy();this.m_sweep.localCenter.setV(t),this.m_sweep.c0.setV(box2D.common.math.B2Math.mulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.setV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-s.y),this.m_linearVelocity.y+=this.m_angularVelocity*(this.m_sweep.c.x-s.x)}},getWorldPoint:function(t){var o=this.m_xf.R,i=new box2D.common.math.B2Vec2(o.col1.x*t.x+o.col2.x*t.y,o.col1.y*t.x+o.col2.y*t.y);return i.x+=this.m_xf.position.x,i.y+=this.m_xf.position.y,i},getWorldVector:function(t){return box2D.common.math.B2Math.mulMV(this.m_xf.R,t)},getLocalPoint:function(t){return box2D.common.math.B2Math.mulXT(this.m_xf,t)},getLocalVector:function(t){return box2D.common.math.B2Math.mulTMV(this.m_xf.R,t)},getLinearVelocityFromWorldPoint:function(t){return new box2D.common.math.B2Vec2(this.m_linearVelocity.x-this.m_angularVelocity*(t.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(t.x-this.m_sweep.c.x))},getLinearVelocityFromLocalPoint:function(t){var o=this.m_xf.R,i=new box2D.common.math.B2Vec2(o.col1.x*t.x+o.col2.x*t.y,o.col1.y*t.x+o.col2.y*t.y);return i.x+=this.m_xf.position.x,i.y+=this.m_xf.position.y,new box2D.common.math.B2Vec2(this.m_linearVelocity.x-this.m_angularVelocity*(i.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(i.x-this.m_sweep.c.x))},getLinearDamping:function(){return this.m_linearDamping},setLinearDamping:function(t){this.m_linearDamping=t},getAngularDamping:function(){return this.m_angularDamping},setAngularDamping:function(t){this.m_angularDamping=t},setType:function(t){if(this.m_type!=t){this.m_type=t,this.resetMassData(),this.m_type==box2D.dynamics.B2Body.b2_staticBody&&(this.m_linearVelocity.setZero(),this.m_angularVelocity=0),this.setAwake(!0),this.m_force.setZero(),this.m_torque=0;for(var o=this.m_contactList;null!=o;)o.contact.flagForFiltering(),o=o.next}},getType:function(){return this.m_type},setBullet:function(t){t?this.m_flags|=box2D.dynamics.B2Body.e_bulletFlag:this.m_flags&=~box2D.dynamics.B2Body.e_bulletFlag},isBullet:function(){return(this.m_flags&box2D.dynamics.B2Body.e_bulletFlag)==box2D.dynamics.B2Body.e_bulletFlag},setSleepingAllowed:function(t){t?this.m_flags|=box2D.dynamics.B2Body.e_allowSleepFlag:(this.m_flags&=~box2D.dynamics.B2Body.e_allowSleepFlag,this.setAwake(!0))},setAwake:function(t){t?(this.m_flags|=box2D.dynamics.B2Body.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~box2D.dynamics.B2Body.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_force.setZero(),this.m_torque=0)},isAwake:function(){return(this.m_flags&box2D.dynamics.B2Body.e_awakeFlag)==box2D.dynamics.B2Body.e_awakeFlag},setFixedRotation:function(t){t?this.m_flags|=box2D.dynamics.B2Body.e_fixedRotationFlag:this.m_flags&=~box2D.dynamics.B2Body.e_fixedRotationFlag,this.resetMassData()},isFixedRotation:function(){return(this.m_flags&box2D.dynamics.B2Body.e_fixedRotationFlag)==box2D.dynamics.B2Body.e_fixedRotationFlag},setActive:function(t){if(t!=this.isActive()){var o,i;if(t)for(this.m_flags|=box2D.dynamics.B2Body.e_activeFlag,o=this.m_world.m_contactManager.m_broadPhase,i=this.m_fixtureList;null!=i;)i.createProxy(o,this.m_xf),i=i.m_next;else{for(this.m_flags&=~box2D.dynamics.B2Body.e_activeFlag,o=this.m_world.m_contactManager.m_broadPhase,i=this.m_fixtureList;null!=i;)i.destroyProxy(o),i=i.m_next;for(var s=this.m_contactList;null!=s;){var n=s;s=s.next,this.m_world.m_contactManager.destroy(n.contact)}this.m_contactList=null}}},isActive:function(){return(this.m_flags&box2D.dynamics.B2Body.e_activeFlag)==box2D.dynamics.B2Body.e_activeFlag},isSleepingAllowed:function(){return(this.m_flags&box2D.dynamics.B2Body.e_allowSleepFlag)==box2D.dynamics.B2Body.e_allowSleepFlag},getFixtureList:function(){return this.m_fixtureList},getJointList:function(){return this.m_jointList},getControllerList:function(){return this.m_controllerList},getContactList:function(){return this.m_contactList},getNext:function(){return this.m_next},getUserData:function(){return this.m_userData},setUserData:function(t){this.m_userData=t},getWorld:function(){return this.m_world},synchronizeFixtures:function(){var t=box2D.dynamics.B2Body.s_xf1;t.R.set(this.m_sweep.a0);var o=t.R,i=this.m_sweep.localCenter;t.position.x=this.m_sweep.c0.x-(o.col1.x*i.x+o.col2.x*i.y),t.position.y=this.m_sweep.c0.y-(o.col1.y*i.x+o.col2.y*i.y);var s,n=this.m_world.m_contactManager.m_broadPhase;for(s=this.m_fixtureList;null!=s;)s.synchronize(n,t,this.m_xf),s=s.m_next},synchronizeTransform:function(){this.m_xf.R.set(this.m_sweep.a);var t=this.m_xf.R,o=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(t.col1.x*o.x+t.col2.x*o.y),this.m_xf.position.y=this.m_sweep.c.y-(t.col1.y*o.x+t.col2.y*o.y)},shouldCollide:function(t){if(this.m_type!=box2D.dynamics.B2Body.b2_dynamicBody&&t.m_type!=box2D.dynamics.B2Body.b2_dynamicBody)return!1;for(var o=this.m_jointList;null!=o;){if(o.other==t&&0==o.joint.m_collideConnected)return!1;o=o.next}return!0},advance:function(t){this.m_sweep.advance(t),this.m_sweep.c.setV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.synchronizeTransform()},__class__:box2D.dynamics.B2Body},box2D.dynamics.B2BodyDef=function(){this.position=new box2D.common.math.B2Vec2,this.linearVelocity=new box2D.common.math.B2Vec2,this.userData=null,this.angle=0,this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.type=box2D.dynamics.B2Body.b2_staticBody,this.active=!0,this.inertiaScale=1},box2D.dynamics.B2BodyDef.__name__=!0,box2D.dynamics.B2BodyDef.prototype={__class__:box2D.dynamics.B2BodyDef},box2D.dynamics.B2ContactFilter=function(){},box2D.dynamics.B2ContactFilter.__name__=!0,box2D.dynamics.B2ContactFilter.prototype={shouldCollide:function(t,o){var i=t.getFilterData(),s=o.getFilterData();if(i.groupIndex==s.groupIndex&&0!=i.groupIndex)return i.groupIndex>0;var n=0!=(i.maskBits&s.categoryBits)&&0!=(i.categoryBits&s.maskBits);return n},rayCollide:function(t,o){return null==t?!0:this.shouldCollide(js.Boot.__cast(t,box2D.dynamics.B2Fixture),o)},__class__:box2D.dynamics.B2ContactFilter},box2D.dynamics.B2ContactImpulse=function(){this.normalImpulses=new Array,this.tangentImpulses=new Array},box2D.dynamics.B2ContactImpulse.__name__=!0,box2D.dynamics.B2ContactImpulse.prototype={__class__:box2D.dynamics.B2ContactImpulse},box2D.dynamics.B2ContactListener=function(){},box2D.dynamics.B2ContactListener.__name__=!0,box2D.dynamics.B2ContactListener.prototype={beginContact:function(){},endContact:function(){},preSolve:function(){},postSolve:function(){},__class__:box2D.dynamics.B2ContactListener},box2D.dynamics.B2ContactManager=function(){this.m_world=null,this.m_contactCount=0,this.m_contactFilter=box2D.dynamics.B2ContactFilter.b2_defaultFilter,this.m_contactListener=box2D.dynamics.B2ContactListener.b2_defaultListener,this.m_contactFactory=new box2D.dynamics.contacts.B2ContactFactory(this.m_allocator),this.m_broadPhase=new box2D.collision.B2DynamicTreeBroadPhase},box2D.dynamics.B2ContactManager.__name__=!0,box2D.dynamics.B2ContactManager.prototype={addPair:function(t,o){var i;i=js.Boot.__cast(t,box2D.dynamics.B2Fixture);var s;s=js.Boot.__cast(o,box2D.dynamics.B2Fixture);var n=i.getBody(),e=s.getBody();if(n!=e){for(var m=e.getContactList();null!=m;){if(m.other==n){var a=m.contact.getFixtureA(),c=m.contact.getFixtureB();if(a==i&&c==s)return;if(a==s&&c==i)return}m=m.next}if(0!=e.shouldCollide(n)&&0!=this.m_contactFilter.shouldCollide(i,s)){var l=this.m_contactFactory.create(i,s);i=l.getFixtureA(),s=l.getFixtureB(),n=i.m_body,e=s.m_body,l.m_prev=null,l.m_next=this.m_world.m_contactList,null!=this.m_world.m_contactList&&(this.m_world.m_contactList.m_prev=l),this.m_world.m_contactList=l,l.m_nodeA.contact=l,l.m_nodeA.other=e,l.m_nodeA.prev=null,l.m_nodeA.next=n.m_contactList,null!=n.m_contactList&&(n.m_contactList.prev=l.m_nodeA),n.m_contactList=l.m_nodeA,l.m_nodeB.contact=l,l.m_nodeB.other=n,l.m_nodeB.prev=null,l.m_nodeB.next=e.m_contactList,null!=e.m_contactList&&(e.m_contactList.prev=l.m_nodeB),e.m_contactList=l.m_nodeB,++this.m_world.m_contactCount}}},findNewContacts:function(){this.m_broadPhase.updatePairs($bind(this,this.addPair))},destroy:function(t){var o=t.getFixtureA(),i=t.getFixtureB(),s=o.getBody(),n=i.getBody();t.isTouching()&&this.m_contactListener.endContact(t),null!=t.m_prev&&(t.m_prev.m_next=t.m_next),null!=t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_world.m_contactList&&(this.m_world.m_contactList=t.m_next),null!=t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),null!=t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA==s.m_contactList&&(s.m_contactList=t.m_nodeA.next),null!=t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),null!=t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB==n.m_contactList&&(n.m_contactList=t.m_nodeB.next),this.m_contactFactory.destroy(t),--this.m_contactCount},collide:function(){for(var t=this.m_world.m_contactList;null!=t;){var o=t.getFixtureA(),i=t.getFixtureB(),s=o.getBody(),n=i.getBody();if(0!=s.isAwake()||0!=n.isAwake()){if(0!=(t.m_flags&box2D.dynamics.contacts.B2Contact.e_filterFlag)){if(0==n.shouldCollide(s)){var e=t;t=e.getNext(),this.destroy(e);continue}if(0==this.m_contactFilter.shouldCollide(o,i)){var e=t;t=e.getNext(),this.destroy(e);continue}t.m_flags&=~box2D.dynamics.contacts.B2Contact.e_filterFlag}var m=o.m_proxy,a=i.m_proxy,c=this.m_broadPhase.testOverlap(m,a);if(0!=c)t.update(this.m_contactListener),t=t.getNext();else{var e=t;t=e.getNext(),this.destroy(e)}}else t=t.getNext()}},__class__:box2D.dynamics.B2ContactManager},box2D.dynamics.B2DebugDraw=function(){this.m_drawScale=1,this.m_lineThickness=1,this.m_alpha=1,this.m_fillAlpha=1,this.m_xformScale=1,this.m_drawFlags=0},box2D.dynamics.B2DebugDraw.__name__=!0,box2D.dynamics.B2DebugDraw.prototype={setFlags:function(t){this.m_drawFlags=t},getFlags:function(){return this.m_drawFlags},appendFlags:function(t){this.m_drawFlags|=t},clearFlags:function(t){this.m_drawFlags&=~t},setCanvas:function(t){this.m_canvas=t,this.m_ctx=t.getContext("2d")},setDrawScale:function(t){this.m_drawScale=t},getDrawScale:function(){return this.m_drawScale},setLineThickness:function(t){this.m_lineThickness=t},getLineThickness:function(){return this.m_lineThickness},setAlpha:function(t){this.m_alpha=t},getAlpha:function(){return this.m_alpha},setFillAlpha:function(t){this.m_fillAlpha=t},getFillAlpha:function(){return this.m_fillAlpha},setXFormScale:function(t){this.m_xformScale=t},getXFormScale:function(){return this.m_xformScale},drawPolygon:function(t,o,i){this.m_ctx.beginPath(),this.m_ctx.moveTo(t[0].x*this.m_drawScale,t[0].y*this.m_drawScale);for(var s=1;o>s;){var n=s++;this.m_ctx.lineTo(t[n].x*this.m_drawScale,t[n].y*this.m_drawScale)}this.m_ctx.lineTo(t[0].x*this.m_drawScale,t[0].y*this.m_drawScale),this.m_ctx.closePath(),this.m_ctx.globalAlpha=this.m_alpha,this.m_ctx.strokeStyle="#"+StringTools.hex(i.get_color()),this.m_ctx.lineWidth=this.m_lineThickness,this.m_ctx.stroke()},drawSolidPolygon:function(t,o,i){this.m_ctx.beginPath(),this.m_ctx.moveTo(t[0].x*this.m_drawScale,t[0].y*this.m_drawScale);for(var s=1;o>s;){var n=s++;this.m_ctx.lineTo(t[n].x*this.m_drawScale,t[n].y*this.m_drawScale)}this.m_ctx.lineTo(t[0].x*this.m_drawScale,t[0].y*this.m_drawScale),this.m_ctx.closePath(),this.m_ctx.globalAlpha=this.m_alpha,this.m_ctx.strokeStyle="#"+StringTools.hex(i.get_color()),this.m_ctx.lineWidth=this.m_lineThickness,this.m_ctx.stroke(),this.m_ctx.globalAlpha=this.m_fillAlpha,this.m_ctx.fillStyle="#"+StringTools.hex(i.get_color()),this.m_ctx.fill()},drawCircle:function(t,o,i){this.m_ctx.beginPath(),this.m_ctx.arc(t.x*this.m_drawScale,t.y*this.m_drawScale,o*this.m_drawScale,0,2*Math.PI,!0),this.m_ctx.closePath(),this.m_ctx.globalAlpha=this.m_alpha,this.m_ctx.lineWidth=this.m_lineThickness,this.m_ctx.strokeStyle="#"+StringTools.hex(i.get_color()),this.m_ctx.stroke()},drawSolidCircle:function(t,o,i,s){this.m_ctx.beginPath(),this.m_ctx.arc(t.x*this.m_drawScale,t.y*this.m_drawScale,o*this.m_drawScale,0,2*Math.PI,!0),this.m_ctx.closePath(),this.m_ctx.globalAlpha=this.m_fillAlpha,this.m_ctx.fillStyle="#"+StringTools.hex(s.get_color()),this.m_ctx.fill(),this.m_ctx.globalAlpha=this.m_alpha,this.m_ctx.lineWidth=this.m_lineThickness,this.m_ctx.strokeStyle="#"+StringTools.hex(s.get_color()),this.m_ctx.stroke(),this.m_ctx.beginPath(),this.m_ctx.moveTo(t.x*this.m_drawScale,t.y*this.m_drawScale),this.m_ctx.lineTo((t.x+i.x*o)*this.m_drawScale,(t.y+i.y*o)*this.m_drawScale),this.m_ctx.closePath(),this.m_ctx.stroke()},drawSegment:function(t,o,i){this.m_ctx.beginPath(),this.m_ctx.moveTo(t.x*this.m_drawScale,t.y*this.m_drawScale),this.m_ctx.lineTo(o.x*this.m_drawScale,o.y*this.m_drawScale),this.m_ctx.closePath(),this.m_ctx.globalAlpha=this.m_alpha,this.m_ctx.strokeStyle="#"+StringTools.hex(i.get_color()),this.m_ctx.lineWidth=this.m_lineThickness,this.m_ctx.stroke()},drawTransform:function(){},__class__:box2D.dynamics.B2DebugDraw},box2D.dynamics.B2DestructionListener=function(){},box2D.dynamics.B2DestructionListener.__name__=!0,box2D.dynamics.B2DestructionListener.prototype={sayGoodbyeJoint:function(){},sayGoodbyeFixture:function(){},__class__:box2D.dynamics.B2DestructionListener},box2D.dynamics.B2FilterData=function(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0},box2D.dynamics.B2FilterData.__name__=!0,box2D.dynamics.B2FilterData.prototype={copy:function(){var t=new box2D.dynamics.B2FilterData;return t.categoryBits=this.categoryBits,t.maskBits=this.maskBits,t.groupIndex=this.groupIndex,t},__class__:box2D.dynamics.B2FilterData},box2D.dynamics.B2Fixture=function(){this.m_filter=new box2D.dynamics.B2FilterData,this.m_aabb=new box2D.collision.B2AABB,this.m_userData=null,this.m_body=null,this.m_next=null,this.m_shape=null,this.m_density=0,this.m_friction=0,this.m_restitution=0},box2D.dynamics.B2Fixture.__name__=!0,box2D.dynamics.B2Fixture.prototype={getType:function(){return this.m_shape.getType()},getShape:function(){return this.m_shape},setSensor:function(t){if(this.m_isSensor!=t&&(this.m_isSensor=t,null!=this.m_body))for(var o=this.m_body.getContactList();null!=o;){var i=o.contact,s=i.getFixtureA(),n=i.getFixtureB();(s==this||n==this)&&i.setSensor(s.isSensor()||n.isSensor()),o=o.next}},isSensor:function(){return this.m_isSensor},setFilterData:function(t){if(this.m_filter=t.copy(),null==this.m_body)for(var o=this.m_body.getContactList();null!=o;){var i=o.contact,s=i.getFixtureA(),n=i.getFixtureB();(s==this||n==this)&&i.flagForFiltering(),o=o.next}},getFilterData:function(){return this.m_filter.copy()},getBody:function(){return this.m_body},getNext:function(){return this.m_next},getUserData:function(){return this.m_userData},SetUserData:function(t){this.m_userData=t},testPoint:function(t){return this.m_shape.testPoint(this.m_body.getTransform(),t)},rayCast:function(t,o){return this.m_shape.rayCast(t,o,this.m_body.getTransform())},getMassData:function(t){return null==t&&(t=new box2D.collision.shapes.B2MassData),this.m_shape.computeMass(t,this.m_density),t},setDensity:function(t){this.m_density=t},getDensity:function(){return this.m_density},getFriction:function(){return this.m_friction},setFriction:function(t){this.m_friction=t},getRestitution:function(){return this.m_restitution},setRestitution:function(t){this.m_restitution=t},getAABB:function(){return this.m_aabb},create:function(t,o,i){this.m_userData=i.userData,this.m_friction=i.friction,this.m_restitution=i.restitution,this.m_body=t,this.m_next=null,this.m_filter=i.filter.copy(),this.m_isSensor=i.isSensor,this.m_shape=i.shape.copy(),this.m_density=i.density},destroy:function(){this.m_shape=null},createProxy:function(t,o){this.m_shape.computeAABB(this.m_aabb,o),this.m_proxy=t.createProxy(this.m_aabb,this)},destroyProxy:function(t){null!=this.m_proxy&&(t.destroyProxy(this.m_proxy),this.m_proxy=null)},synchronize:function(t,o,i){if(null!=this.m_proxy){var s=new box2D.collision.B2AABB,n=new box2D.collision.B2AABB;this.m_shape.computeAABB(s,o),this.m_shape.computeAABB(n,i),this.m_aabb.combine(s,n);var e=box2D.common.math.B2Math.subtractVV(i.position,o.position);t.moveProxy(this.m_proxy,this.m_aabb,e)}},__class__:box2D.dynamics.B2Fixture},box2D.dynamics.B2FixtureDef=function(){this.filter=new box2D.dynamics.B2FilterData,this.shape=null,this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.filter.categoryBits=1,this.filter.maskBits=65535,this.filter.groupIndex=0,this.isSensor=!1},box2D.dynamics.B2FixtureDef.__name__=!0,box2D.dynamics.B2FixtureDef.prototype={__class__:box2D.dynamics.B2FixtureDef},box2D.dynamics.B2Island=function(){this.m_bodies=new Array,this.m_contacts=new Array,this.m_joints=new Array},box2D.dynamics.B2Island.__name__=!0,box2D.dynamics.B2Island.prototype={initialize:function(t,o,i,s,n,e){this.m_bodyCapacity=t,this.m_contactCapacity=o,this.m_jointCapacity=i,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=s,this.m_listener=n,this.m_contactSolver=e;
for(var m=this.m_bodies.length;t>m;){var a=m++;this.m_bodies[a]=null}for(var m=this.m_contacts.length;o>m;){var a=m++;this.m_contacts[a]=null}for(var m=this.m_joints.length;i>m;){var a=m++;this.m_joints[a]=null}},clear:function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},solve:function(t,o,i){for(var s,n,e=0,m=this.m_bodyCount;m>e;){var a=e++;s=this.m_bodies[a],s.getType()==box2D.dynamics.B2Body.b2_dynamicBody&&(s.m_linearVelocity.x+=t.dt*(o.x+s.m_invMass*s.m_force.x),s.m_linearVelocity.y+=t.dt*(o.y+s.m_invMass*s.m_force.y),s.m_angularVelocity+=t.dt*s.m_invI*s.m_torque,s.m_linearVelocity.multiply(box2D.common.math.B2Math.clamp(1-t.dt*s.m_linearDamping,0,1)),s.m_angularVelocity*=box2D.common.math.B2Math.clamp(1-t.dt*s.m_angularDamping,0,1))}this.m_contactSolver.initialize(t,this.m_contacts,this.m_contactCount,this.m_allocator);var c=this.m_contactSolver;c.initVelocityConstraints(t);for(var e=0,m=this.m_jointCount;m>e;){var a=e++;n=this.m_joints[a],n.initVelocityConstraints(t)}for(var e=0,m=t.velocityIterations;m>e;){for(var a=e++,l=0,r=this.m_jointCount;r>l;){var _=l++;n=this.m_joints[_],n.solveVelocityConstraints(t)}c.solveVelocityConstraints()}for(var e=0,m=this.m_jointCount;m>e;){var a=e++;n=this.m_joints[a],n.finalizeVelocityConstraints()}c.finalizeVelocityConstraints();for(var e=0,m=this.m_bodyCount;m>e;){var a=e++;if(s=this.m_bodies[a],s.getType()!=box2D.dynamics.B2Body.b2_staticBody){var h=t.dt*s.m_linearVelocity.x,x=t.dt*s.m_linearVelocity.y;h*h+x*x>box2D.common.B2Settings.b2_maxTranslationSquared&&(s.m_linearVelocity.normalize(),s.m_linearVelocity.x*=box2D.common.B2Settings.b2_maxTranslation*t.inv_dt,s.m_linearVelocity.y*=box2D.common.B2Settings.b2_maxTranslation*t.inv_dt);var y=t.dt*s.m_angularVelocity;y*y>box2D.common.B2Settings.b2_maxRotationSquared&&(s.m_angularVelocity=s.m_angularVelocity<0?-box2D.common.B2Settings.b2_maxRotation*t.inv_dt:box2D.common.B2Settings.b2_maxRotation*t.inv_dt),s.m_sweep.c0.setV(s.m_sweep.c),s.m_sweep.a0=s.m_sweep.a,s.m_sweep.c.x+=t.dt*s.m_linearVelocity.x,s.m_sweep.c.y+=t.dt*s.m_linearVelocity.y,s.m_sweep.a+=t.dt*s.m_angularVelocity,s.synchronizeTransform()}}for(var e=0,m=t.positionIterations;m>e;){for(var a=e++,u=c.solvePositionConstraints(box2D.common.B2Settings.b2_contactBaumgarte),p=!0,l=0,r=this.m_jointCount;r>l;){var _=l++;n=this.m_joints[_];var d=n.solvePositionConstraints(box2D.common.B2Settings.b2_contactBaumgarte);p=p&&d}if(u&&p)break}if(this.report(c.m_constraints),i){for(var B=1.7976931348623157e308,b=box2D.common.B2Settings.b2_linearSleepTolerance*box2D.common.B2Settings.b2_linearSleepTolerance,D=box2D.common.B2Settings.b2_angularSleepTolerance*box2D.common.B2Settings.b2_angularSleepTolerance,e=0,m=this.m_bodyCount;m>e;){var a=e++;s=this.m_bodies[a],s.getType()!=box2D.dynamics.B2Body.b2_staticBody&&(0==(s.m_flags&box2D.dynamics.B2Body.e_allowSleepFlag)&&(s.m_sleepTime=0,B=0),0==(s.m_flags&box2D.dynamics.B2Body.e_allowSleepFlag)||s.m_angularVelocity*s.m_angularVelocity>D||box2D.common.math.B2Math.dot(s.m_linearVelocity,s.m_linearVelocity)>b?(s.m_sleepTime=0,B=0):(s.m_sleepTime+=t.dt,B=box2D.common.math.B2Math.min(B,s.m_sleepTime)))}if(B>=box2D.common.B2Settings.b2_timeToSleep)for(var e=0,m=this.m_bodyCount;m>e;){var a=e++;s=this.m_bodies[a],s.setAwake(!1)}}},solveTOI:function(t){this.m_contactSolver.initialize(t,this.m_contacts,this.m_contactCount,this.m_allocator);for(var o=this.m_contactSolver,i=0,s=this.m_jointCount;s>i;){var n=i++;this.m_joints[n].initVelocityConstraints(t)}for(var i=0,s=t.velocityIterations;s>i;){var n=i++;o.solveVelocityConstraints();for(var e=0,m=this.m_jointCount;m>e;){var a=e++;this.m_joints[a].solveVelocityConstraints(t)}}for(var i=0,s=this.m_bodyCount;s>i;){var n=i++,c=this.m_bodies[n];if(c.getType()!=box2D.dynamics.B2Body.b2_staticBody){var l=t.dt*c.m_linearVelocity.x,r=t.dt*c.m_linearVelocity.y;l*l+r*r>box2D.common.B2Settings.b2_maxTranslationSquared&&(c.m_linearVelocity.normalize(),c.m_linearVelocity.x*=box2D.common.B2Settings.b2_maxTranslation*t.inv_dt,c.m_linearVelocity.y*=box2D.common.B2Settings.b2_maxTranslation*t.inv_dt);var _=t.dt*c.m_angularVelocity;_*_>box2D.common.B2Settings.b2_maxRotationSquared&&(c.m_angularVelocity=c.m_angularVelocity<0?-box2D.common.B2Settings.b2_maxRotation*t.inv_dt:box2D.common.B2Settings.b2_maxRotation*t.inv_dt),c.m_sweep.c0.setV(c.m_sweep.c),c.m_sweep.a0=c.m_sweep.a,c.m_sweep.c.x+=t.dt*c.m_linearVelocity.x,c.m_sweep.c.y+=t.dt*c.m_linearVelocity.y,c.m_sweep.a+=t.dt*c.m_angularVelocity,c.synchronizeTransform()}}for(var h=.75,i=0,s=t.positionIterations;s>i;){for(var n=i++,x=o.solvePositionConstraints(h),y=!0,e=0,m=this.m_jointCount;m>e;){var a=e++,u=this.m_joints[a].solvePositionConstraints(box2D.common.B2Settings.b2_contactBaumgarte);y=y&&u}if(x&&y)break}this.report(o.m_constraints)},report:function(t){if(null!=this.m_listener)for(var o=0,i=this.m_contactCount;i>o;){for(var s=o++,n=this.m_contacts[s],e=t[s],m=0,a=e.pointCount;a>m;){var c=m++;box2D.dynamics.B2Island.s_impulse.normalImpulses[c]=e.points[c].normalImpulse,box2D.dynamics.B2Island.s_impulse.tangentImpulses[c]=e.points[c].tangentImpulse}this.m_listener.postSolve(n,box2D.dynamics.B2Island.s_impulse)}},addBody:function(t){t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=t},addContact:function(t){this.m_contacts[this.m_contactCount++]=t},addJoint:function(t){this.m_joints[this.m_jointCount++]=t},__class__:box2D.dynamics.B2Island},box2D.dynamics.B2TimeStep=function(){},box2D.dynamics.B2TimeStep.__name__=!0,box2D.dynamics.B2TimeStep.prototype={set:function(t){this.dt=t.dt,this.inv_dt=t.inv_dt,this.positionIterations=t.positionIterations,this.velocityIterations=t.velocityIterations,this.warmStarting=t.warmStarting},__class__:box2D.dynamics.B2TimeStep},box2D.dynamics.B2World=function(t,o){this.s_stack=new Array,this.m_contactManager=new box2D.dynamics.B2ContactManager,this.m_contactSolver=new box2D.dynamics.contacts.B2ContactSolver,this.m_island=new box2D.dynamics.B2Island,this.m_destructionListener=null,this.m_debugDraw=null,this.m_bodyList=null,this.m_contactList=null,this.m_jointList=null,this.m_controllerList=null,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_controllerCount=0,box2D.dynamics.B2World.m_warmStarting=!0,box2D.dynamics.B2World.m_continuousPhysics=!0,this.m_allowSleep=o,this.m_gravity=t,this.m_inv_dt0=0,this.m_contactManager.m_world=this;var i=new box2D.dynamics.B2BodyDef;this.m_groundBody=this.createBody(i)},box2D.dynamics.B2World.__name__=!0,box2D.dynamics.B2World.prototype={setDestructionListener:function(t){this.m_destructionListener=t},setContactFilter:function(t){this.m_contactManager.m_contactFilter=t},setContactListener:function(t){this.m_contactManager.m_contactListener=t},setDebugDraw:function(t){this.m_debugDraw=t},setBroadPhase:function(t){var o=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=t;for(var i=this.m_bodyList;null!=i;){for(var s=i.m_fixtureList;null!=s;)s.m_proxy=t.createProxy(o.getFatAABB(s.m_proxy),s),s=s.m_next;i=i.m_next}},validate:function(){this.m_contactManager.m_broadPhase.validate()},getProxyCount:function(){return this.m_contactManager.m_broadPhase.getProxyCount()},createBody:function(t){if(1==this.isLocked())return null;var o=new box2D.dynamics.B2Body(t,this);return o.m_prev=null,o.m_next=this.m_bodyList,null!=this.m_bodyList&&(this.m_bodyList.m_prev=o),this.m_bodyList=o,++this.m_bodyCount,o},destroyBody:function(t){if(1!=this.isLocked()){for(var o=t.m_jointList;null!=o;){var i=o;o=o.next,null!=this.m_destructionListener&&this.m_destructionListener.sayGoodbyeJoint(i.joint),this.destroyJoint(i.joint)}for(var s=t.m_controllerList;null!=s;){var n=s;s=s.nextController,n.controller.removeBody(t)}for(var e=t.m_contactList;null!=e;){var m=e;e=e.next,this.m_contactManager.destroy(m.contact)}t.m_contactList=null;for(var a=t.m_fixtureList;null!=a;){var c=a;a=a.m_next,null!=this.m_destructionListener&&this.m_destructionListener.sayGoodbyeFixture(c),c.destroyProxy(this.m_contactManager.m_broadPhase),c.destroy()}t.m_fixtureList=null,t.m_fixtureCount=0,null!=t.m_prev&&(t.m_prev.m_next=t.m_next),null!=t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount}},createJoint:function(t){var o=box2D.dynamics.joints.B2Joint.create(t,null);o.m_prev=null,o.m_next=this.m_jointList,null!=this.m_jointList&&(this.m_jointList.m_prev=o),this.m_jointList=o,++this.m_jointCount,o.m_edgeA.joint=o,o.m_edgeA.other=o.m_bodyB,o.m_edgeA.prev=null,o.m_edgeA.next=o.m_bodyA.m_jointList,null!=o.m_bodyA.m_jointList&&(o.m_bodyA.m_jointList.prev=o.m_edgeA),o.m_bodyA.m_jointList=o.m_edgeA,o.m_edgeB.joint=o,o.m_edgeB.other=o.m_bodyA,o.m_edgeB.prev=null,o.m_edgeB.next=o.m_bodyB.m_jointList,null!=o.m_bodyB.m_jointList&&(o.m_bodyB.m_jointList.prev=o.m_edgeB),o.m_bodyB.m_jointList=o.m_edgeB;var i=t.bodyA,s=t.bodyB;if(0==t.collideConnected)for(var n=s.getContactList();null!=n;)n.other==i&&n.contact.flagForFiltering(),n=n.next;return o},destroyJoint:function(t){var o=t.m_collideConnected;null!=t.m_prev&&(t.m_prev.m_next=t.m_next),null!=t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var i=t.m_bodyA,s=t.m_bodyB;if(i.setAwake(!0),s.setAwake(!0),null!=t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),null!=t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA==i.m_jointList&&(i.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,null!=t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),null!=t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB==s.m_jointList&&(s.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,box2D.dynamics.joints.B2Joint.destroy(t,null),--this.m_jointCount,0==o)for(var n=s.getContactList();null!=n;)n.other==i&&n.contact.flagForFiltering(),n=n.next},addController:function(t){return t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList=t,t.m_world=this,this.m_controllerCount++,t},removeController:function(t){null!=t.m_prev&&(t.m_prev.m_next=t.m_next),null!=t.m_next&&(t.m_next.m_prev=t.m_prev),this.m_controllerList==t&&(this.m_controllerList=t.m_next),this.m_controllerCount--},createController:function(t){if(t.m_world!=this)throw"Controller can only be a member of one world";return t.m_next=this.m_controllerList,t.m_prev=null,null!=this.m_controllerList&&(this.m_controllerList.m_prev=t),this.m_controllerList=t,++this.m_controllerCount,t.m_world=this,t},destroyController:function(t){t.clear(),null!=t.m_next&&(t.m_next.m_prev=t.m_prev),null!=t.m_prev&&(t.m_prev.m_next=t.m_next),t==this.m_controllerList&&(this.m_controllerList=t.m_next),--this.m_controllerCount},setWarmStarting:function(t){box2D.dynamics.B2World.m_warmStarting=t},setContinuousPhysics:function(t){box2D.dynamics.B2World.m_continuousPhysics=t},getBodyCount:function(){return this.m_bodyCount},getJointCount:function(){return this.m_jointCount},getContactCount:function(){return this.m_contactCount},setGravity:function(t){this.m_gravity=t},getGravity:function(){return this.m_gravity},getGroundBody:function(){return this.m_groundBody},step:function(t,o,i){0!=(this.m_flags&box2D.dynamics.B2World.e_newFixture)&&(this.m_contactManager.findNewContacts(),this.m_flags&=~box2D.dynamics.B2World.e_newFixture),this.m_flags|=box2D.dynamics.B2World.e_locked;var s=box2D.dynamics.B2World.s_timestep2;s.dt=t,s.velocityIterations=o,s.positionIterations=i,s.inv_dt=t>0?1/t:0,s.dtRatio=this.m_inv_dt0*t,s.warmStarting=box2D.dynamics.B2World.m_warmStarting,this.m_contactManager.collide(),s.dt>0&&this.solve(s),box2D.dynamics.B2World.m_continuousPhysics&&s.dt>0&&this.solveTOI(s),s.dt>0&&(this.m_inv_dt0=s.inv_dt),this.m_flags&=~box2D.dynamics.B2World.e_locked},clearForces:function(){for(var t=this.m_bodyList;null!=t;)t.m_force.setZero(),t.m_torque=0,t=t.m_next},drawDebugData:function(){if(null!=this.m_debugDraw){this.m_debugDraw.m_ctx.clearRect(0,0,1e3,1e3);var t,o,i,s,n,e,m=this.m_debugDraw.getFlags(),a=(new box2D.common.math.B2Vec2,new box2D.common.math.B2Vec2,new box2D.common.math.B2Vec2,new box2D.collision.B2AABB,new box2D.collision.B2AABB,[new box2D.common.math.B2Vec2,new box2D.common.math.B2Vec2,new box2D.common.math.B2Vec2,new box2D.common.math.B2Vec2]),c=new box2D.common.B2Color(0,0,0);if(0!=(m&box2D.dynamics.B2DebugDraw.e_shapeBit))for(t=this.m_bodyList;null!=t;){for(e=t.m_xf,o=t.getFixtureList();null!=o;)i=o.getShape(),0==t.isActive()?(c.set(.5,.5,.3),this.drawShape(i,e,c)):t.getType()==box2D.dynamics.B2Body.b2_staticBody?(c.set(.5,.9,.5),this.drawShape(i,e,c)):t.getType()==box2D.dynamics.B2Body.b2_kinematicBody?(c.set(.5,.5,.9),this.drawShape(i,e,c)):0==t.isAwake()?(c.set(.6,.6,.6),this.drawShape(i,e,c)):(c.set(.9,.7,.7),this.drawShape(i,e,c)),o=o.m_next;t=t.m_next}if(0!=(m&box2D.dynamics.B2DebugDraw.e_jointBit))for(s=this.m_jointList;null!=s;)this.drawJoint(s),s=s.m_next;if(0!=(m&box2D.dynamics.B2DebugDraw.e_controllerBit))for(var l=this.m_controllerList;null!=l;)l.draw(this.m_debugDraw),l=l.m_next;if(0!=(m&box2D.dynamics.B2DebugDraw.e_pairBit)){c.set(.3,.9,.9);for(var r=this.m_contactManager.m_contactList;null!=r;){var _=r.getFixtureA(),h=r.getFixtureB(),x=_.getAABB().getCenter(),y=h.getAABB().getCenter();this.m_debugDraw.drawSegment(x,y,c),r=r.getNext()}}if(0!=(m&box2D.dynamics.B2DebugDraw.e_aabbBit))for(n=this.m_contactManager.m_broadPhase,a=[new box2D.common.math.B2Vec2,new box2D.common.math.B2Vec2,new box2D.common.math.B2Vec2,new box2D.common.math.B2Vec2],t=this.m_bodyList;null!=t;)if(0!=t.isActive()){for(o=t.getFixtureList();null!=o;){var u=n.getFatAABB(o.m_proxy);a[0].set(u.lowerBound.x,u.lowerBound.y),a[1].set(u.upperBound.x,u.lowerBound.y),a[2].set(u.upperBound.x,u.upperBound.y),a[3].set(u.lowerBound.x,u.upperBound.y),this.m_debugDraw.drawPolygon(a,4,c),o=o.getNext()}t=t.getNext()}else t=t.getNext();if(0!=(m&box2D.dynamics.B2DebugDraw.e_centerOfMassBit))for(t=this.m_bodyList;null!=t;)e=box2D.dynamics.B2World.s_xf,e.R=t.m_xf.R,e.position=t.getWorldCenter(),this.m_debugDraw.drawTransform(e),t=t.m_next}},queryAABB:function(t,o){var i=this.m_contactManager.m_broadPhase,s=function(o){return t(i.getUserData(o))};i.query(s,o)},queryShape:function(t,o,i){null==i&&(i=new box2D.common.math.B2Transform,i.setIdentity());var s=this.m_contactManager.m_broadPhase,n=function(n){var e;return e=js.Boot.__cast(s.getUserData(n),box2D.dynamics.B2Fixture),box2D.collision.shapes.B2Shape.testOverlap(o,i,e.getShape(),e.getBody().getTransform())?t(e):!0},e=new box2D.collision.B2AABB;o.computeAABB(e,i),s.query(n,e)},queryPoint:function(t,o){var i=this.m_contactManager.m_broadPhase,s=function(s){var n;return n=js.Boot.__cast(i.getUserData(s),box2D.dynamics.B2Fixture),n.testPoint(o)?t(n):!0},n=new box2D.collision.B2AABB;n.lowerBound.set(o.x-box2D.common.B2Settings.b2_linearSlop,o.y-box2D.common.B2Settings.b2_linearSlop),n.upperBound.set(o.x+box2D.common.B2Settings.b2_linearSlop,o.y+box2D.common.B2Settings.b2_linearSlop),i.query(s,n)},rayCast:function(t,o,i){var s=this.m_contactManager.m_broadPhase,n=new box2D.collision.B2RayCastOutput,e=function(e,m){var a,c=s.getUserData(m);a=js.Boot.__cast(c,box2D.dynamics.B2Fixture);var l=a.rayCast(n,e);if(l){var r=n.fraction,_=new box2D.common.math.B2Vec2((1-r)*o.x+r*i.x,(1-r)*o.y+r*i.y);return t(a,_,n.normal,r)}return e.maxFraction},m=new box2D.collision.B2RayCastInput(o,i);s.rayCast(e,m)},rayCastOne:function(t,o){var i,s=function(t,o,s,n){return i=t,n};return this.rayCast(s,t,o),i},rayCastAll:function(t,o){var i=new Array,s=function(t){return i[i.length]=t,1};return this.rayCast(s,t,o),i},getBodyList:function(){return this.m_bodyList},getJointList:function(){return this.m_jointList},getContactList:function(){return this.m_contactList},isLocked:function(){return(this.m_flags&box2D.dynamics.B2World.e_locked)>0},solve:function(t){for(var o,i=this.m_controllerList;null!=i;)i.step(t),i=i.m_next;var s=this.m_island;for(s.initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver),o=this.m_bodyList;null!=o;)o.m_flags&=~box2D.dynamics.B2Body.e_islandFlag,o=o.m_next;for(var n=this.m_contactList;null!=n;)n.m_flags&=~box2D.dynamics.contacts.B2Contact.e_islandFlag,n=n.m_next;for(var e=this.m_jointList;null!=e;)e.m_islandFlag=!1,e=e.m_next;for(var m=(this.m_bodyCount,this.s_stack),a=this.m_bodyList;null!=a;)if(0==(a.m_flags&box2D.dynamics.B2Body.e_islandFlag))if(0!=a.isAwake()&&0!=a.isActive())if(a.getType()!=box2D.dynamics.B2Body.b2_staticBody){s.clear();var c=0;for(m[c++]=a,a.m_flags|=box2D.dynamics.B2Body.e_islandFlag;c>0;)if(o=m[--c],s.addBody(o),0==o.isAwake()&&o.setAwake(!0),o.getType()!=box2D.dynamics.B2Body.b2_staticBody){for(var l,r=o.m_contactList;null!=r;)0==(r.contact.m_flags&box2D.dynamics.contacts.B2Contact.e_islandFlag)&&1!=r.contact.isSensor()&&0!=r.contact.isEnabled()&&0!=r.contact.isTouching()?(s.addContact(r.contact),r.contact.m_flags|=box2D.dynamics.contacts.B2Contact.e_islandFlag,l=r.other,0==(l.m_flags&box2D.dynamics.B2Body.e_islandFlag)?(m[c++]=l,l.m_flags|=box2D.dynamics.B2Body.e_islandFlag,r=r.next):r=r.next):r=r.next;for(var _=o.m_jointList;null!=_;)1!=_.joint.m_islandFlag?(l=_.other,0!=l.isActive()?(s.addJoint(_.joint),_.joint.m_islandFlag=!0,0==(l.m_flags&box2D.dynamics.B2Body.e_islandFlag)?(m[c++]=l,l.m_flags|=box2D.dynamics.B2Body.e_islandFlag,_=_.next):_=_.next):_=_.next):_=_.next}s.solve(t,this.m_gravity,this.m_allowSleep);for(var h=0,x=s.m_bodyCount;x>h;){var y=h++;o=s.m_bodies[y],o.getType()==box2D.dynamics.B2Body.b2_staticBody&&(o.m_flags&=~box2D.dynamics.B2Body.e_islandFlag)}a=a.m_next}else a=a.m_next;else a=a.m_next;else a=a.m_next;for(var h=0,x=m.length;x>h;){var y=h++;if(null==m[y])break;m[y]=null}for(o=this.m_bodyList;null!=o;)0!=o.isAwake()&&0!=o.isActive()&&o.getType()!=box2D.dynamics.B2Body.b2_staticBody?(o.synchronizeFixtures(),o=o.m_next):o=o.m_next;this.m_contactManager.findNewContacts()},solveTOI:function(t){var o,i,s,n,e,m,a,c=this.m_island;c.initialize(this.m_bodyCount,box2D.common.B2Settings.b2_maxTOIContactsPerIsland,box2D.common.B2Settings.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var l=box2D.dynamics.B2World.s_queue;for(o=this.m_bodyList;null!=o;)o.m_flags&=~box2D.dynamics.B2Body.e_islandFlag,o.m_sweep.t0=0,o=o.m_next;for(var r=this.m_contactList;null!=r;)r.m_flags&=~(box2D.dynamics.contacts.B2Contact.e_toiFlag|box2D.dynamics.contacts.B2Contact.e_islandFlag),r=r.m_next;for(a=this.m_jointList;null!=a;)a.m_islandFlag=!1,a=a.m_next;for(;;){var _=null,h=1;for(r=this.m_contactList;null!=r;)if(1!=r.isSensor()&&0!=r.isEnabled()&&0!=r.isContinuous()){var x=1;if(0!=(r.m_flags&box2D.dynamics.contacts.B2Contact.e_toiFlag))x=r.m_toi;else{if(i=r.m_fixtureA,s=r.m_fixtureB,n=i.m_body,e=s.m_body,!(n.getType()==box2D.dynamics.B2Body.b2_dynamicBody&&0!=n.isAwake()||e.getType()==box2D.dynamics.B2Body.b2_dynamicBody&&0!=e.isAwake())){r=r.m_next;continue}var y=n.m_sweep.t0;n.m_sweep.t0<e.m_sweep.t0?(y=e.m_sweep.t0,n.m_sweep.advance(y)):e.m_sweep.t0<n.m_sweep.t0&&(y=n.m_sweep.t0,e.m_sweep.advance(y)),x=r.computeTOI(n.m_sweep,e.m_sweep),box2D.common.B2Settings.b2Assert(x>=0&&1>=x),x>0&&1>x&&(x=(1-x)*y+x,x>1&&(x=1)),r.m_toi=x,r.m_flags|=box2D.dynamics.contacts.B2Contact.e_toiFlag}x>2.2250738585072014e-308&&h>x&&(_=r,h=x),r=r.m_next}else r=r.m_next;if(null==_||h>1)break;if(i=_.m_fixtureA,s=_.m_fixtureB,n=i.m_body,e=s.m_body,box2D.dynamics.B2World.s_backupA.set(n.m_sweep),box2D.dynamics.B2World.s_backupB.set(e.m_sweep),n.advance(h),e.advance(h),_.update(this.m_contactManager.m_contactListener),_.m_flags&=~box2D.dynamics.contacts.B2Contact.e_toiFlag,1!=_.isSensor()&&0!=_.isEnabled()){if(0!=_.isTouching()){var u=n;u.getType()!=box2D.dynamics.B2Body.b2_dynamicBody&&(u=e),c.clear();var p=0,d=0;for(l[p+d++]=u,u.m_flags|=box2D.dynamics.B2Body.e_islandFlag;d>0;)if(o=l[p++],--d,c.addBody(o),0==o.isAwake()&&o.setAwake(!0),o.getType()==box2D.dynamics.B2Body.b2_dynamicBody){m=o.m_contactList;for(var B;null!=m;){if(c.m_contactCount==c.m_contactCapacity){m=m.next;break}0==(m.contact.m_flags&box2D.dynamics.contacts.B2Contact.e_islandFlag)&&1!=m.contact.isSensor()&&0!=m.contact.isEnabled()&&0!=m.contact.isTouching()?(c.addContact(m.contact),m.contact.m_flags|=box2D.dynamics.contacts.B2Contact.e_islandFlag,B=m.other,0==(B.m_flags&box2D.dynamics.B2Body.e_islandFlag)?(B.getType()!=box2D.dynamics.B2Body.b2_staticBody&&(B.advance(h),B.setAwake(!0)),l[p+d]=B,++d,B.m_flags|=box2D.dynamics.B2Body.e_islandFlag,m=m.next):m=m.next):m=m.next}for(var b=o.m_jointList;null!=b;)c.m_jointCount!=c.m_jointCapacity&&1!=b.joint.m_islandFlag?(B=b.other,0!=B.isActive()?(c.addJoint(b.joint),b.joint.m_islandFlag=!0,0==(B.m_flags&box2D.dynamics.B2Body.e_islandFlag)?(B.getType()!=box2D.dynamics.B2Body.b2_staticBody&&(B.advance(h),B.setAwake(!0)),l[p+d]=B,++d,B.m_flags|=box2D.dynamics.B2Body.e_islandFlag,b=b.next):b=b.next):b=b.next):b=b.next}var D=box2D.dynamics.B2World.s_timestep;D.warmStarting=!1,D.dt=(1-h)*t.dt,D.inv_dt=1/D.dt,D.dtRatio=0,D.velocityIterations=t.velocityIterations,D.positionIterations=t.positionIterations,c.solveTOI(D);for(var f=0,g=c.m_bodyCount;g>f;){var v=f++;if(o=c.m_bodies[v],o.m_flags&=~box2D.dynamics.B2Body.e_islandFlag,0!=o.isAwake()&&o.getType()==box2D.dynamics.B2Body.b2_dynamicBody)for(o.synchronizeFixtures(),m=o.m_contactList;null!=m;)m.contact.m_flags&=~box2D.dynamics.contacts.B2Contact.e_toiFlag,m=m.next}for(var f=0,g=c.m_contactCount;g>f;){var v=f++;r=c.m_contacts[v],r.m_flags&=~(box2D.dynamics.contacts.B2Contact.e_toiFlag|box2D.dynamics.contacts.B2Contact.e_islandFlag)}for(var f=0,g=c.m_jointCount;g>f;){var v=f++;a=c.m_joints[v],a.m_islandFlag=!1}this.m_contactManager.findNewContacts()}}else n.m_sweep.set(box2D.dynamics.B2World.s_backupA),e.m_sweep.set(box2D.dynamics.B2World.s_backupB),n.synchronizeTransform(),e.synchronizeTransform()}},drawJoint:function(t){var o=t.getBodyA(),i=t.getBodyB(),s=o.m_xf,n=i.m_xf,e=s.position,m=n.position,a=t.getAnchorA(),c=t.getAnchorB(),l=box2D.dynamics.B2World.s_jointColor,r=t.m_type;switch(r){case box2D.dynamics.joints.B2Joint.e_distanceJoint:this.m_debugDraw.drawSegment(a,c,l);break;case box2D.dynamics.joints.B2Joint.e_pulleyJoint:var _;_=js.Boot.__cast(t,box2D.dynamics.joints.B2PulleyJoint);var h=_.getGroundAnchorA(),x=_.getGroundAnchorB();this.m_debugDraw.drawSegment(h,a,l),this.m_debugDraw.drawSegment(x,c,l),this.m_debugDraw.drawSegment(h,x,l);break;case box2D.dynamics.joints.B2Joint.e_mouseJoint:this.m_debugDraw.drawSegment(a,c,l);break;default:o!=this.m_groundBody&&this.m_debugDraw.drawSegment(e,a,l),this.m_debugDraw.drawSegment(a,c,l),i!=this.m_groundBody&&this.m_debugDraw.drawSegment(m,c,l)}},drawShape:function(t,o,i){var s=t.m_type;switch(s){case box2D.collision.shapes.B2Shape.e_circleShape:var n;n=js.Boot.__cast(t,box2D.collision.shapes.B2CircleShape);var e=box2D.common.math.B2Math.mulX(o,n.m_p),m=n.m_radius,a=o.R.col1;this.m_debugDraw.drawSolidCircle(e,m,a,i);break;case box2D.collision.shapes.B2Shape.e_polygonShape:var c;c=js.Boot.__cast(t,box2D.collision.shapes.B2PolygonShape);for(var l=c.getVertexCount(),r=c.getVertices(),_=new Array,h=0;l>h;){var x=h++;_[x]=box2D.common.math.B2Math.mulX(o,r[x])}this.m_debugDraw.drawSolidPolygon(_,l,i);break;case box2D.collision.shapes.B2Shape.e_edgeShape:var y;y=js.Boot.__cast(t,box2D.collision.shapes.B2EdgeShape),this.m_debugDraw.drawSegment(box2D.common.math.B2Math.mulX(o,y.getVertex1()),box2D.common.math.B2Math.mulX(o,y.getVertex2()),i)}},__class__:box2D.dynamics.B2World},box2D.dynamics.contacts={},box2D.dynamics.contacts.B2Contact=function(){this.m_nodeA=new box2D.dynamics.contacts.B2ContactEdge,this.m_nodeB=new box2D.dynamics.contacts.B2ContactEdge,this.m_manifold=new box2D.collision.B2Manifold,this.m_oldManifold=new box2D.collision.B2Manifold},box2D.dynamics.contacts.B2Contact.__name__=!0,box2D.dynamics.contacts.B2Contact.prototype={getManifold:function(){return this.m_manifold},getWorldManifold:function(t){var o=this.m_fixtureA.getBody(),i=this.m_fixtureB.getBody(),s=this.m_fixtureA.getShape(),n=this.m_fixtureB.getShape();t.initialize(this.m_manifold,o.getTransform(),s.m_radius,i.getTransform(),n.m_radius)},isTouching:function(){return(this.m_flags&box2D.dynamics.contacts.B2Contact.e_touchingFlag)==box2D.dynamics.contacts.B2Contact.e_touchingFlag},isContinuous:function(){return(this.m_flags&box2D.dynamics.contacts.B2Contact.e_continuousFlag)==box2D.dynamics.contacts.B2Contact.e_continuousFlag},setSensor:function(t){t?this.m_flags|=box2D.dynamics.contacts.B2Contact.e_sensorFlag:this.m_flags&=~box2D.dynamics.contacts.B2Contact.e_sensorFlag},isSensor:function(){return(this.m_flags&box2D.dynamics.contacts.B2Contact.e_sensorFlag)==box2D.dynamics.contacts.B2Contact.e_sensorFlag},setEnabled:function(t){t?this.m_flags|=box2D.dynamics.contacts.B2Contact.e_enabledFlag:this.m_flags&=~box2D.dynamics.contacts.B2Contact.e_enabledFlag},isEnabled:function(){return(this.m_flags&box2D.dynamics.contacts.B2Contact.e_enabledFlag)==box2D.dynamics.contacts.B2Contact.e_enabledFlag},getNext:function(){return this.m_next},getFixtureA:function(){return this.m_fixtureA},getFixtureB:function(){return this.m_fixtureB},flagForFiltering:function(){this.m_flags|=box2D.dynamics.contacts.B2Contact.e_filterFlag},reset:function(t,o){if(this.m_flags=box2D.dynamics.contacts.B2Contact.e_enabledFlag,null==t||null==o)return this.m_fixtureA=null,void(this.m_fixtureB=null);(t.isSensor()||o.isSensor())&&(this.m_flags|=box2D.dynamics.contacts.B2Contact.e_sensorFlag);var i=t.getBody(),s=o.getBody();(i.getType()!=box2D.dynamics.B2Body.b2_dynamicBody||i.isBullet()||s.getType()!=box2D.dynamics.B2Body.b2_dynamicBody||s.isBullet())&&(this.m_flags|=box2D.dynamics.contacts.B2Contact.e_continuousFlag),this.m_fixtureA=t,this.m_fixtureB=o,this.m_manifold.m_pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null},update:function(t){var o=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=o,this.m_flags|=box2D.dynamics.contacts.B2Contact.e_enabledFlag;var i=!1,s=(this.m_flags&box2D.dynamics.contacts.B2Contact.e_touchingFlag)==box2D.dynamics.contacts.B2Contact.e_touchingFlag,n=this.m_fixtureA.m_body,e=this.m_fixtureB.m_body,m=this.m_fixtureA.m_aabb.testOverlap(this.m_fixtureB.m_aabb);if(0!=(this.m_flags&box2D.dynamics.contacts.B2Contact.e_sensorFlag)){if(m){var a=this.m_fixtureA.getShape(),c=this.m_fixtureB.getShape(),l=n.getTransform(),r=e.getTransform();i=box2D.collision.shapes.B2Shape.testOverlap(a,l,c,r)}this.m_manifold.m_pointCount=0}else{if(n.getType()!=box2D.dynamics.B2Body.b2_dynamicBody||n.isBullet()||e.getType()!=box2D.dynamics.B2Body.b2_dynamicBody||e.isBullet()?this.m_flags|=box2D.dynamics.contacts.B2Contact.e_continuousFlag:this.m_flags&=~box2D.dynamics.contacts.B2Contact.e_continuousFlag,m){this.evaluate(),i=this.m_manifold.m_pointCount>0;for(var _=0,h=this.m_manifold.m_pointCount;h>_;){var x=_++,y=this.m_manifold.m_points[x];y.m_normalImpulse=0,y.m_tangentImpulse=0;for(var u=y.m_id,p=0,d=this.m_oldManifold.m_pointCount;d>p;){var B=p++,b=this.m_oldManifold.m_points[B];if(b.m_id.get_key()==u.get_key()){y.m_normalImpulse=b.m_normalImpulse,y.m_tangentImpulse=b.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;i!=s&&(n.setAwake(!0),e.setAwake(!0))}i?this.m_flags|=box2D.dynamics.contacts.B2Contact.e_touchingFlag:this.m_flags&=~box2D.dynamics.contacts.B2Contact.e_touchingFlag,0==s&&1==i&&t.beginContact(this),1==s&&0==i&&t.endContact(this),0==(this.m_flags&box2D.dynamics.contacts.B2Contact.e_sensorFlag)&&t.preSolve(this,this.m_oldManifold)},evaluate:function(){},computeTOI:function(t,o){return box2D.dynamics.contacts.B2Contact.s_input.proxyA.set(this.m_fixtureA.getShape()),box2D.dynamics.contacts.B2Contact.s_input.proxyB.set(this.m_fixtureB.getShape()),box2D.dynamics.contacts.B2Contact.s_input.sweepA=t,box2D.dynamics.contacts.B2Contact.s_input.sweepB=o,box2D.dynamics.contacts.B2Contact.s_input.tolerance=box2D.common.B2Settings.b2_linearSlop,box2D.collision.B2TimeOfImpact.timeOfImpact(box2D.dynamics.contacts.B2Contact.s_input)},__class__:box2D.dynamics.contacts.B2Contact},box2D.dynamics.contacts.B2CircleContact=function(){box2D.dynamics.contacts.B2Contact.call(this)},box2D.dynamics.contacts.B2CircleContact.__name__=!0,box2D.dynamics.contacts.B2CircleContact.create=function(){return new box2D.dynamics.contacts.B2CircleContact},box2D.dynamics.contacts.B2CircleContact.destroy=function(){},box2D.dynamics.contacts.B2CircleContact.__super__=box2D.dynamics.contacts.B2Contact,box2D.dynamics.contacts.B2CircleContact.prototype=$extend(box2D.dynamics.contacts.B2Contact.prototype,{reset:function(t,o){box2D.dynamics.contacts.B2Contact.prototype.reset.call(this,t,o)},evaluate:function(){var t=this.m_fixtureA.getBody(),o=this.m_fixtureB.getBody();box2D.collision.B2Collision.collideCircles(this.m_manifold,js.Boot.__cast(this.m_fixtureA.getShape(),box2D.collision.shapes.B2CircleShape),t.m_xf,js.Boot.__cast(this.m_fixtureB.getShape(),box2D.collision.shapes.B2CircleShape),o.m_xf)},__class__:box2D.dynamics.contacts.B2CircleContact}),box2D.dynamics.contacts.B2ContactConstraint=function(){this.localPlaneNormal=new box2D.common.math.B2Vec2,this.localPoint=new box2D.common.math.B2Vec2,this.normal=new box2D.common.math.B2Vec2,this.normalMass=new box2D.common.math.B2Mat22,this.K=new box2D.common.math.B2Mat22,this.points=new Array;for(var t=0,o=box2D.common.B2Settings.b2_maxManifoldPoints;o>t;){var i=t++;this.points[i]=new box2D.dynamics.contacts.B2ContactConstraintPoint}},box2D.dynamics.contacts.B2ContactConstraint.__name__=!0,box2D.dynamics.contacts.B2ContactConstraint.prototype={__class__:box2D.dynamics.contacts.B2ContactConstraint},box2D.dynamics.contacts.B2ContactConstraintPoint=function(){this.localPoint=new box2D.common.math.B2Vec2,this.rA=new box2D.common.math.B2Vec2,this.rB=new box2D.common.math.B2Vec2},box2D.dynamics.contacts.B2ContactConstraintPoint.__name__=!0,box2D.dynamics.contacts.B2ContactConstraintPoint.prototype={__class__:box2D.dynamics.contacts.B2ContactConstraintPoint},box2D.dynamics.contacts.B2ContactEdge=function(){},box2D.dynamics.contacts.B2ContactEdge.__name__=!0,box2D.dynamics.contacts.B2ContactEdge.prototype={__class__:box2D.dynamics.contacts.B2ContactEdge},box2D.dynamics.contacts.B2ContactFactory=function(t){this.m_allocator=t,this.initializeRegisters()},box2D.dynamics.contacts.B2ContactFactory.__name__=!0,box2D.dynamics.contacts.B2ContactFactory.prototype={addType:function(t,o,i,s){this.m_registers[i][s].createFcn=t,this.m_registers[i][s].destroyFcn=o,this.m_registers[i][s].primary=!0,i!=s&&(this.m_registers[s][i].createFcn=t,this.m_registers[s][i].destroyFcn=o,this.m_registers[s][i].primary=!1)},initializeRegisters:function(){this.m_registers=new Array;for(var t=0,o=box2D.collision.shapes.B2Shape.e_shapeTypeCount;o>t;){var i=t++;this.m_registers[i]=new Array;for(var s=0,n=box2D.collision.shapes.B2Shape.e_shapeTypeCount;n>s;){var e=s++;this.m_registers[i][e]=new box2D.dynamics.contacts.B2ContactRegister}}this.addType(box2D.dynamics.contacts.B2CircleContact.create,box2D.dynamics.contacts.B2CircleContact.destroy,box2D.collision.shapes.B2Shape.e_circleShape,box2D.collision.shapes.B2Shape.e_circleShape),this.addType(box2D.dynamics.contacts.B2PolyAndCircleContact.create,box2D.dynamics.contacts.B2PolyAndCircleContact.destroy,box2D.collision.shapes.B2Shape.e_polygonShape,box2D.collision.shapes.B2Shape.e_circleShape),this.addType(box2D.dynamics.contacts.B2PolygonContact.create,box2D.dynamics.contacts.B2PolygonContact.destroy,box2D.collision.shapes.B2Shape.e_polygonShape,box2D.collision.shapes.B2Shape.e_polygonShape),this.addType(box2D.dynamics.contacts.B2EdgeAndCircleContact.create,box2D.dynamics.contacts.B2EdgeAndCircleContact.destroy,box2D.collision.shapes.B2Shape.e_edgeShape,box2D.collision.shapes.B2Shape.e_circleShape),this.addType(box2D.dynamics.contacts.B2PolyAndEdgeContact.create,box2D.dynamics.contacts.B2PolyAndEdgeContact.destroy,box2D.collision.shapes.B2Shape.e_polygonShape,box2D.collision.shapes.B2Shape.e_edgeShape)
},create:function(t,o){var i,s=t.getType(),n=o.getType(),e=this.m_registers[s][n];if(null!=e.pool)return i=e.pool,e.pool=i.m_next,e.poolCount--,i.reset(t,o),i;var m=e.createFcn;return null!=m?e.primary?(i=m(this.m_allocator),i.reset(t,o),i):(i=m(this.m_allocator),i.reset(o,t),i):null},destroy:function(t){t.m_manifold.m_pointCount>0&&(t.m_fixtureA.m_body.setAwake(!0),t.m_fixtureB.m_body.setAwake(!0));var o=t.m_fixtureA.getType(),i=t.m_fixtureB.getType(),s=this.m_registers[o][i];s.poolCount++,t.m_next=s.pool,s.pool=t;var n=s.destroyFcn;n(t,this.m_allocator)},__class__:box2D.dynamics.contacts.B2ContactFactory},box2D.dynamics.contacts.B2ContactRegister=function(){},box2D.dynamics.contacts.B2ContactRegister.__name__=!0,box2D.dynamics.contacts.B2ContactRegister.prototype={__class__:box2D.dynamics.contacts.B2ContactRegister},box2D.dynamics.contacts.B2PositionSolverManifold=function(){this.m_normal=new box2D.common.math.B2Vec2,this.m_separations=new Array,this.m_points=new Array;for(var t=0,o=box2D.common.B2Settings.b2_maxManifoldPoints;o>t;){var i=t++;this.m_points[i]=new box2D.common.math.B2Vec2}},box2D.dynamics.contacts.B2PositionSolverManifold.__name__=!0,box2D.dynamics.contacts.B2PositionSolverManifold.prototype={initialize:function(t){box2D.common.B2Settings.b2Assert(t.pointCount>0);var o,i,s,n,e,m,a=t.type;switch(a){case box2D.collision.B2Manifold.e_circles:s=t.bodyA.m_xf.R,n=t.localPoint;var c=t.bodyA.m_xf.position.x+(s.col1.x*n.x+s.col2.x*n.y),l=t.bodyA.m_xf.position.y+(s.col1.y*n.x+s.col2.y*n.y);s=t.bodyB.m_xf.R,n=t.points[0].localPoint;var r=t.bodyB.m_xf.position.x+(s.col1.x*n.x+s.col2.x*n.y),_=t.bodyB.m_xf.position.y+(s.col1.y*n.x+s.col2.y*n.y),h=r-c,x=_-l,y=h*h+x*x;if(y>0){var u=Math.sqrt(y);this.m_normal.x=h/u,this.m_normal.y=x/u}else this.m_normal.x=1,this.m_normal.y=0;this.m_points[0].x=.5*(c+r),this.m_points[0].y=.5*(l+_),this.m_separations[0]=h*this.m_normal.x+x*this.m_normal.y-t.radius;break;case box2D.collision.B2Manifold.e_faceA:s=t.bodyA.m_xf.R,n=t.localPlaneNormal,this.m_normal.x=s.col1.x*n.x+s.col2.x*n.y,this.m_normal.y=s.col1.y*n.x+s.col2.y*n.y,s=t.bodyA.m_xf.R,n=t.localPoint,e=t.bodyA.m_xf.position.x+(s.col1.x*n.x+s.col2.x*n.y),m=t.bodyA.m_xf.position.y+(s.col1.y*n.x+s.col2.y*n.y),s=t.bodyB.m_xf.R;for(var p=0,d=t.pointCount;d>p;){var B=p++;n=t.points[B].localPoint,o=t.bodyB.m_xf.position.x+(s.col1.x*n.x+s.col2.x*n.y),i=t.bodyB.m_xf.position.y+(s.col1.y*n.x+s.col2.y*n.y),this.m_separations[B]=(o-e)*this.m_normal.x+(i-m)*this.m_normal.y-t.radius,this.m_points[B].x=o,this.m_points[B].y=i}break;case box2D.collision.B2Manifold.e_faceB:s=t.bodyB.m_xf.R,n=t.localPlaneNormal,this.m_normal.x=s.col1.x*n.x+s.col2.x*n.y,this.m_normal.y=s.col1.y*n.x+s.col2.y*n.y,s=t.bodyB.m_xf.R,n=t.localPoint,e=t.bodyB.m_xf.position.x+(s.col1.x*n.x+s.col2.x*n.y),m=t.bodyB.m_xf.position.y+(s.col1.y*n.x+s.col2.y*n.y),s=t.bodyA.m_xf.R;for(var p=0,d=t.pointCount;d>p;){var B=p++;n=t.points[B].localPoint,o=t.bodyA.m_xf.position.x+(s.col1.x*n.x+s.col2.x*n.y),i=t.bodyA.m_xf.position.y+(s.col1.y*n.x+s.col2.y*n.y),this.m_separations[B]=(o-e)*this.m_normal.x+(i-m)*this.m_normal.y-t.radius,this.m_points[B].set(o,i)}this.m_normal.x*=-1,this.m_normal.y*=-1}},__class__:box2D.dynamics.contacts.B2PositionSolverManifold},box2D.dynamics.contacts.B2ContactSolver=function(){this.m_step=new box2D.dynamics.B2TimeStep,this.m_constraints=new Array},box2D.dynamics.contacts.B2ContactSolver.__name__=!0,box2D.dynamics.contacts.B2ContactSolver.prototype={initialize:function(t,o,i,s){var n;this.m_step.set(t),this.m_allocator=s;for(this.m_constraintCount=i;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new box2D.dynamics.contacts.B2ContactConstraint;for(var e=0;i>e;){var m=e++;n=o[m];var a=n.m_fixtureA,c=n.m_fixtureB,l=a.m_shape,r=c.m_shape,_=l.m_radius,h=r.m_radius,x=a.m_body,y=c.m_body,u=n.getManifold(),p=box2D.common.B2Settings.b2MixFriction(a.getFriction(),c.getFriction()),d=box2D.common.B2Settings.b2MixRestitution(a.getRestitution(),c.getRestitution()),B=x.m_linearVelocity.x,b=x.m_linearVelocity.y,D=y.m_linearVelocity.x,f=y.m_linearVelocity.y,g=x.m_angularVelocity,v=y.m_angularVelocity;box2D.common.B2Settings.b2Assert(u.m_pointCount>0),box2D.dynamics.contacts.B2ContactSolver.s_worldManifold.initialize(u,x.m_xf,_,y.m_xf,h);var A=box2D.dynamics.contacts.B2ContactSolver.s_worldManifold.m_normal.x,w=box2D.dynamics.contacts.B2ContactSolver.s_worldManifold.m_normal.y,V=this.m_constraints[m];V.bodyA=x,V.bodyB=y,V.manifold=u,V.normal.x=A,V.normal.y=w,V.pointCount=u.m_pointCount,V.friction=p,V.restitution=d,V.localPlaneNormal.x=u.m_localPlaneNormal.x,V.localPlaneNormal.y=u.m_localPlaneNormal.y,V.localPoint.x=u.m_localPoint.x,V.localPoint.y=u.m_localPoint.y,V.radius=_+h,V.type=u.m_type;for(var C=0,M=V.pointCount;M>C;){var S=C++,I=u.m_points[S],j=V.points[S];j.normalImpulse=I.m_normalImpulse,j.tangentImpulse=I.m_tangentImpulse,j.localPoint.setV(I.m_localPoint);var L=j.rA.x=box2D.dynamics.contacts.B2ContactSolver.s_worldManifold.m_points[S].x-x.m_sweep.c.x,P=j.rA.y=box2D.dynamics.contacts.B2ContactSolver.s_worldManifold.m_points[S].y-x.m_sweep.c.y,J=j.rB.x=box2D.dynamics.contacts.B2ContactSolver.s_worldManifold.m_points[S].x-y.m_sweep.c.x,F=j.rB.y=box2D.dynamics.contacts.B2ContactSolver.s_worldManifold.m_points[S].y-y.m_sweep.c.y,T=L*w-P*A,R=J*w-F*A;T*=T,R*=R;var z=x.m_invMass+y.m_invMass+x.m_invI*T+y.m_invI*R;j.normalMass=1/z;var k=x.m_mass*x.m_invMass+y.m_mass*y.m_invMass;k+=x.m_mass*x.m_invI*T+y.m_mass*y.m_invI*R,j.equalizedMass=1/k;var q=w,E=-A,K=L*E-P*q,O=J*E-F*q;K*=K,O*=O;var W=x.m_invMass+y.m_invMass+x.m_invI*K+y.m_invI*O;j.tangentMass=1/W,j.velocityBias=0;var N=D+-v*F-B- -g*P,X=f+v*J-b-g*L,Z=V.normal.x*N+V.normal.y*X;Z<-box2D.common.B2Settings.b2_velocityThreshold&&(j.velocityBias+=-V.restitution*Z)}if(2==V.pointCount){var U=V.points[0],$=V.points[1],G=x.m_invMass,H=x.m_invI,Y=y.m_invMass,Q=y.m_invI,to=U.rA.x*w-U.rA.y*A,oo=U.rB.x*w-U.rB.y*A,io=$.rA.x*w-$.rA.y*A,so=$.rB.x*w-$.rB.y*A,no=G+Y+H*to*to+Q*oo*oo,eo=G+Y+H*io*io+Q*so*so,mo=G+Y+H*to*io+Q*oo*so,ao=100;ao*(no*eo-mo*mo)>no*no?(V.K.col1.set(no,mo),V.K.col2.set(mo,eo),V.K.getInverse(V.normalMass)):V.pointCount=1}}},initVelocityConstraints:function(t){for(var o=0,i=this.m_constraintCount;i>o;){var s,n=o++,e=this.m_constraints[n],m=e.bodyA,a=e.bodyB,c=m.m_invMass,l=m.m_invI,r=a.m_invMass,_=a.m_invI,h=e.normal.x,x=e.normal.y,y=x,u=-h;if(t.warmStarting){s=e.pointCount;for(var p=0;s>p;){var d=p++,B=e.points[d];B.normalImpulse*=t.dtRatio,B.tangentImpulse*=t.dtRatio;var b=B.normalImpulse*h+B.tangentImpulse*y,D=B.normalImpulse*x+B.tangentImpulse*u;m.m_angularVelocity-=l*(B.rA.x*D-B.rA.y*b),m.m_linearVelocity.x-=c*b,m.m_linearVelocity.y-=c*D,a.m_angularVelocity+=_*(B.rB.x*D-B.rB.y*b),a.m_linearVelocity.x+=r*b,a.m_linearVelocity.y+=r*D}}else{s=e.pointCount;for(var p=0;s>p;){var d=p++,f=e.points[d];f.normalImpulse=0,f.tangentImpulse=0}}}},solveVelocityConstraints:function(){for(var t,o,i,s,n,e,m,a,c,l,r,_,h,x,y,u,p,d=0,B=this.m_constraintCount;B>d;){for(var b=d++,D=this.m_constraints[b],f=D.bodyA,g=D.bodyB,v=f.m_angularVelocity,A=g.m_angularVelocity,w=f.m_linearVelocity,V=g.m_linearVelocity,C=f.m_invMass,M=f.m_invI,S=g.m_invMass,I=g.m_invI,j=D.normal.x,L=D.normal.y,P=L,J=-j,F=D.friction,T=0,R=D.pointCount;R>T;){var z=T++;t=D.points[z],o=V.x-A*t.rB.y-w.x+v*t.rA.y,i=V.y+A*t.rB.x-w.y-v*t.rA.x,n=o*P+i*J,e=t.tangentMass*-n,m=F*t.normalImpulse,a=box2D.common.math.B2Math.clamp(t.tangentImpulse+e,-m,m),e=a-t.tangentImpulse,c=e*P,l=e*J,w.x-=C*c,w.y-=C*l,v-=M*(t.rA.x*l-t.rA.y*c),V.x+=S*c,V.y+=S*l,A+=I*(t.rB.x*l-t.rB.y*c),t.tangentImpulse=a}{D.pointCount}if(1==D.pointCount)t=D.points[0],o=V.x+-A*t.rB.y-w.x- -v*t.rA.y,i=V.y+A*t.rB.x-w.y-v*t.rA.x,s=o*j+i*L,e=-t.normalMass*(s-t.velocityBias),a=t.normalImpulse+e,a=a>0?a:0,e=a-t.normalImpulse,c=e*j,l=e*L,w.x-=C*c,w.y-=C*l,v-=M*(t.rA.x*l-t.rA.y*c),V.x+=S*c,V.y+=S*l,A+=I*(t.rB.x*l-t.rB.y*c),t.normalImpulse=a;else{var k=D.points[0],q=D.points[1],E=k.normalImpulse,K=q.normalImpulse,O=V.x-A*k.rB.y-w.x+v*k.rA.y,W=V.y+A*k.rB.x-w.y-v*k.rA.x,N=V.x-A*q.rB.y-w.x+v*q.rA.y,X=V.y+A*q.rB.x-w.y-v*q.rA.x,Z=O*j+W*L,U=N*j+X*L,$=Z-k.velocityBias,G=U-q.velocityBias;p=D.K,$-=p.col1.x*E+p.col2.x*K,G-=p.col1.y*E+p.col2.y*K;for(var R=0;1>R;){{R++}p=D.normalMass;var H=-(p.col1.x*$+p.col2.x*G),Y=-(p.col1.y*$+p.col2.y*G);if(H>=0&&Y>=0){r=H-E,_=Y-K,h=r*j,x=r*L,y=_*j,u=_*L,w.x-=C*(h+y),w.y-=C*(x+u),v-=M*(k.rA.x*x-k.rA.y*h+q.rA.x*u-q.rA.y*y),V.x+=S*(h+y),V.y+=S*(x+u),A+=I*(k.rB.x*x-k.rB.y*h+q.rB.x*u-q.rB.y*y),k.normalImpulse=H,q.normalImpulse=Y;break}if(H=-k.normalMass*$,Y=0,Z=0,U=D.K.col1.y*H+G,H>=0&&U>=0){r=H-E,_=Y-K,h=r*j,x=r*L,y=_*j,u=_*L,w.x-=C*(h+y),w.y-=C*(x+u),v-=M*(k.rA.x*x-k.rA.y*h+q.rA.x*u-q.rA.y*y),V.x+=S*(h+y),V.y+=S*(x+u),A+=I*(k.rB.x*x-k.rB.y*h+q.rB.x*u-q.rB.y*y),k.normalImpulse=H,q.normalImpulse=Y;break}if(H=0,Y=-q.normalMass*G,Z=D.K.col2.x*Y+$,U=0,Y>=0&&Z>=0){r=H-E,_=Y-K,h=r*j,x=r*L,y=_*j,u=_*L,w.x-=C*(h+y),w.y-=C*(x+u),v-=M*(k.rA.x*x-k.rA.y*h+q.rA.x*u-q.rA.y*y),V.x+=S*(h+y),V.y+=S*(x+u),A+=I*(k.rB.x*x-k.rB.y*h+q.rB.x*u-q.rB.y*y),k.normalImpulse=H,q.normalImpulse=Y;break}if(H=0,Y=0,Z=$,U=G,Z>=0&&U>=0){r=H-E,_=Y-K,h=r*j,x=r*L,y=_*j,u=_*L,w.x-=C*(h+y),w.y-=C*(x+u),v-=M*(k.rA.x*x-k.rA.y*h+q.rA.x*u-q.rA.y*y),V.x+=S*(h+y),V.y+=S*(x+u),A+=I*(k.rB.x*x-k.rB.y*h+q.rB.x*u-q.rB.y*y),k.normalImpulse=H,q.normalImpulse=Y;break}break}}f.m_angularVelocity=v,g.m_angularVelocity=A}},finalizeVelocityConstraints:function(){for(var t=0,o=this.m_constraintCount;o>t;)for(var i=t++,s=this.m_constraints[i],n=s.manifold,e=0,m=s.pointCount;m>e;){var a=e++,c=n.m_points[a],l=s.points[a];c.m_normalImpulse=l.normalImpulse,c.m_tangentImpulse=l.tangentImpulse}},solvePositionConstraints:function(t){for(var o=0,i=0,s=this.m_constraintCount;s>i;){var n=i++,e=this.m_constraints[n],m=e.bodyA,a=e.bodyB,c=m.m_mass*m.m_invMass,l=m.m_mass*m.m_invI,r=a.m_mass*a.m_invMass,_=a.m_mass*a.m_invI;box2D.dynamics.contacts.B2ContactSolver.s_psm.initialize(e);for(var h=box2D.dynamics.contacts.B2ContactSolver.s_psm.m_normal,x=0,y=e.pointCount;y>x;){var u=x++,p=e.points[u],d=box2D.dynamics.contacts.B2ContactSolver.s_psm.m_points[u],B=box2D.dynamics.contacts.B2ContactSolver.s_psm.m_separations[u],b=d.x-m.m_sweep.c.x,D=d.y-m.m_sweep.c.y,f=d.x-a.m_sweep.c.x,g=d.y-a.m_sweep.c.y;o=B>o?o:B;var v=box2D.common.math.B2Math.clamp(t*(B+box2D.common.B2Settings.b2_linearSlop),-box2D.common.B2Settings.b2_maxLinearCorrection,0),A=-p.equalizedMass*v,w=A*h.x,V=A*h.y;m.m_sweep.c.x-=c*w,m.m_sweep.c.y-=c*V,m.m_sweep.a-=l*(b*V-D*w),m.synchronizeTransform(),a.m_sweep.c.x+=r*w,a.m_sweep.c.y+=r*V,a.m_sweep.a+=_*(f*V-g*w),a.synchronizeTransform()}}return o>-1.5*box2D.common.B2Settings.b2_linearSlop},__class__:box2D.dynamics.contacts.B2ContactSolver},box2D.dynamics.contacts.B2EdgeAndCircleContact=function(){box2D.dynamics.contacts.B2Contact.call(this)},box2D.dynamics.contacts.B2EdgeAndCircleContact.__name__=!0,box2D.dynamics.contacts.B2EdgeAndCircleContact.create=function(){return new box2D.dynamics.contacts.B2EdgeAndCircleContact},box2D.dynamics.contacts.B2EdgeAndCircleContact.destroy=function(){},box2D.dynamics.contacts.B2EdgeAndCircleContact.__super__=box2D.dynamics.contacts.B2Contact,box2D.dynamics.contacts.B2EdgeAndCircleContact.prototype=$extend(box2D.dynamics.contacts.B2Contact.prototype,{reset:function(t,o){box2D.dynamics.contacts.B2Contact.prototype.reset.call(this,t,o)},evaluate:function(){var t=this.m_fixtureA.getBody(),o=this.m_fixtureB.getBody();this.b2CollideEdgeAndCircle(this.m_manifold,js.Boot.__cast(this.m_fixtureA.getShape(),box2D.collision.shapes.B2EdgeShape),t.m_xf,js.Boot.__cast(this.m_fixtureB.getShape(),box2D.collision.shapes.B2CircleShape),o.m_xf)},b2CollideEdgeAndCircle:function(){},__class__:box2D.dynamics.contacts.B2EdgeAndCircleContact}),box2D.dynamics.contacts.B2PolyAndCircleContact=function(){box2D.dynamics.contacts.B2Contact.call(this)},box2D.dynamics.contacts.B2PolyAndCircleContact.__name__=!0,box2D.dynamics.contacts.B2PolyAndCircleContact.create=function(){return new box2D.dynamics.contacts.B2PolyAndCircleContact},box2D.dynamics.contacts.B2PolyAndCircleContact.destroy=function(){},box2D.dynamics.contacts.B2PolyAndCircleContact.__super__=box2D.dynamics.contacts.B2Contact,box2D.dynamics.contacts.B2PolyAndCircleContact.prototype=$extend(box2D.dynamics.contacts.B2Contact.prototype,{reset:function(t,o){box2D.dynamics.contacts.B2Contact.prototype.reset.call(this,t,o),box2D.common.B2Settings.b2Assert(t.getType()==box2D.collision.shapes.B2Shape.e_polygonShape),box2D.common.B2Settings.b2Assert(o.getType()==box2D.collision.shapes.B2Shape.e_circleShape)},evaluate:function(){var t=this.m_fixtureA.m_body,o=this.m_fixtureB.m_body;box2D.collision.B2Collision.collidePolygonAndCircle(this.m_manifold,js.Boot.__cast(this.m_fixtureA.getShape(),box2D.collision.shapes.B2PolygonShape),t.m_xf,js.Boot.__cast(this.m_fixtureB.getShape(),box2D.collision.shapes.B2CircleShape),o.m_xf)},__class__:box2D.dynamics.contacts.B2PolyAndCircleContact}),box2D.dynamics.contacts.B2PolyAndEdgeContact=function(){box2D.dynamics.contacts.B2Contact.call(this)},box2D.dynamics.contacts.B2PolyAndEdgeContact.__name__=!0,box2D.dynamics.contacts.B2PolyAndEdgeContact.create=function(){return new box2D.dynamics.contacts.B2PolyAndEdgeContact},box2D.dynamics.contacts.B2PolyAndEdgeContact.destroy=function(){},box2D.dynamics.contacts.B2PolyAndEdgeContact.__super__=box2D.dynamics.contacts.B2Contact,box2D.dynamics.contacts.B2PolyAndEdgeContact.prototype=$extend(box2D.dynamics.contacts.B2Contact.prototype,{reset:function(t,o){box2D.dynamics.contacts.B2Contact.prototype.reset.call(this,t,o),box2D.common.B2Settings.b2Assert(t.getType()==box2D.collision.shapes.B2Shape.e_polygonShape),box2D.common.B2Settings.b2Assert(o.getType()==box2D.collision.shapes.B2Shape.e_edgeShape)},evaluate:function(){var t=this.m_fixtureA.getBody(),o=this.m_fixtureB.getBody();this.b2CollidePolyAndEdge(this.m_manifold,js.Boot.__cast(this.m_fixtureA.getShape(),box2D.collision.shapes.B2PolygonShape),t.m_xf,js.Boot.__cast(this.m_fixtureB.getShape(),box2D.collision.shapes.B2EdgeShape),o.m_xf)},b2CollidePolyAndEdge:function(){},__class__:box2D.dynamics.contacts.B2PolyAndEdgeContact}),box2D.dynamics.contacts.B2PolygonContact=function(){box2D.dynamics.contacts.B2Contact.call(this)},box2D.dynamics.contacts.B2PolygonContact.__name__=!0,box2D.dynamics.contacts.B2PolygonContact.create=function(){return new box2D.dynamics.contacts.B2PolygonContact},box2D.dynamics.contacts.B2PolygonContact.destroy=function(){},box2D.dynamics.contacts.B2PolygonContact.__super__=box2D.dynamics.contacts.B2Contact,box2D.dynamics.contacts.B2PolygonContact.prototype=$extend(box2D.dynamics.contacts.B2Contact.prototype,{reset:function(t,o){box2D.dynamics.contacts.B2Contact.prototype.reset.call(this,t,o)},evaluate:function(){var t=this.m_fixtureA.getBody(),o=this.m_fixtureB.getBody();box2D.collision.B2Collision.collidePolygons(this.m_manifold,js.Boot.__cast(this.m_fixtureA.getShape(),box2D.collision.shapes.B2PolygonShape),t.m_xf,js.Boot.__cast(this.m_fixtureB.getShape(),box2D.collision.shapes.B2PolygonShape),o.m_xf)},__class__:box2D.dynamics.contacts.B2PolygonContact}),box2D.dynamics.controllers={},box2D.dynamics.controllers.B2Controller=function(){},box2D.dynamics.controllers.B2Controller.__name__=!0,box2D.dynamics.controllers.B2Controller.prototype={step:function(){},draw:function(){},addBody:function(t){var o=new box2D.dynamics.controllers.B2ControllerEdge;o.controller=this,o.body=t,o.nextBody=this.m_bodyList,o.prevBody=null,this.m_bodyList=o,null!=o.nextBody&&(o.nextBody.prevBody=o),this.m_bodyCount++,o.nextController=t.m_controllerList,o.prevController=null,t.m_controllerList=o,null!=o.nextController&&(o.nextController.prevController=o),t.m_controllerCount++},removeBody:function(t){for(var o=t.m_controllerList;null!=o&&o.controller!=this;)o=o.nextController;null!=o.prevBody&&(o.prevBody.nextBody=o.nextBody),null!=o.nextBody&&(o.nextBody.prevBody=o.prevBody),null!=o.nextController&&(o.nextController.prevController=o.prevController),null!=o.prevController&&(o.prevController.nextController=o.nextController),this.m_bodyList==o&&(this.m_bodyList=o.nextBody),t.m_controllerList==o&&(t.m_controllerList=o.nextController),t.m_controllerCount--,this.m_bodyCount--},clear:function(){for(;null!=this.m_bodyList;)this.removeBody(this.m_bodyList.body)},getNext:function(){return this.m_next},getWorld:function(){return this.m_world},getBodyList:function(){return this.m_bodyList},__class__:box2D.dynamics.controllers.B2Controller},box2D.dynamics.controllers.B2ControllerEdge=function(){},box2D.dynamics.controllers.B2ControllerEdge.__name__=!0,box2D.dynamics.controllers.B2ControllerEdge.prototype={__class__:box2D.dynamics.controllers.B2ControllerEdge},box2D.dynamics.joints={},box2D.dynamics.joints.B2Joint=function(t){this.m_edgeA=new box2D.dynamics.joints.B2JointEdge,this.m_edgeB=new box2D.dynamics.joints.B2JointEdge,this.m_localCenterA=new box2D.common.math.B2Vec2,this.m_localCenterB=new box2D.common.math.B2Vec2,box2D.common.B2Settings.b2Assert(t.bodyA!=t.bodyB),this.m_type=t.type,this.m_prev=null,this.m_next=null,this.m_bodyA=t.bodyA,this.m_bodyB=t.bodyB,this.m_collideConnected=t.collideConnected,this.m_islandFlag=!1,this.m_userData=t.userData},box2D.dynamics.joints.B2Joint.__name__=!0,box2D.dynamics.joints.B2Joint.create=function(t){var o=null;return t.type==box2D.dynamics.joints.B2Joint.e_distanceJoint?o=new box2D.dynamics.joints.B2DistanceJoint(js.Boot.__cast(t,box2D.dynamics.joints.B2DistanceJointDef)):t.type==box2D.dynamics.joints.B2Joint.e_mouseJoint?o=new box2D.dynamics.joints.B2MouseJoint(js.Boot.__cast(t,box2D.dynamics.joints.B2MouseJointDef)):t.type==box2D.dynamics.joints.B2Joint.e_prismaticJoint?o=new box2D.dynamics.joints.B2PrismaticJoint(js.Boot.__cast(t,box2D.dynamics.joints.B2PrismaticJointDef)):t.type==box2D.dynamics.joints.B2Joint.e_revoluteJoint?o=new box2D.dynamics.joints.B2RevoluteJoint(js.Boot.__cast(t,box2D.dynamics.joints.B2RevoluteJointDef)):t.type==box2D.dynamics.joints.B2Joint.e_pulleyJoint?o=new box2D.dynamics.joints.B2PulleyJoint(js.Boot.__cast(t,box2D.dynamics.joints.B2PulleyJointDef)):t.type==box2D.dynamics.joints.B2Joint.e_gearJoint?o=new box2D.dynamics.joints.B2GearJoint(js.Boot.__cast(t,box2D.dynamics.joints.B2GearJointDef)):t.type==box2D.dynamics.joints.B2Joint.e_lineJoint?o=new box2D.dynamics.joints.B2LineJoint(js.Boot.__cast(t,box2D.dynamics.joints.B2LineJointDef)):t.type==box2D.dynamics.joints.B2Joint.e_weldJoint?o=new box2D.dynamics.joints.B2WeldJoint(js.Boot.__cast(t,box2D.dynamics.joints.B2WeldJointDef)):t.type==box2D.dynamics.joints.B2Joint.e_frictionJoint&&(o=new box2D.dynamics.joints.B2FrictionJoint(js.Boot.__cast(t,box2D.dynamics.joints.B2FrictionJointDef))),o},box2D.dynamics.joints.B2Joint.destroy=function(){},box2D.dynamics.joints.B2Joint.prototype={getType:function(){return this.m_type},getAnchorA:function(){return null},getAnchorB:function(){return null},getReactionForce:function(){return null},getReactionTorque:function(){return 0},getBodyA:function(){return this.m_bodyA},getBodyB:function(){return this.m_bodyB},getNext:function(){return this.m_next},getUserData:function(){return this.m_userData},setUserData:function(t){this.m_userData=t},isActive:function(){return this.m_bodyA.isActive()&&this.m_bodyB.isActive()},initVelocityConstraints:function(){},solveVelocityConstraints:function(){},finalizeVelocityConstraints:function(){},solvePositionConstraints:function(){return!1},__class__:box2D.dynamics.joints.B2Joint},box2D.dynamics.joints.B2DistanceJoint=function(t){box2D.dynamics.joints.B2Joint.call(this,t),this.m_localAnchor1=new box2D.common.math.B2Vec2,this.m_localAnchor2=new box2D.common.math.B2Vec2,this.m_u=new box2D.common.math.B2Vec2;this.m_localAnchor1.setV(t.localAnchorA),this.m_localAnchor2.setV(t.localAnchorB),this.m_length=t.length,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_impulse=0,this.m_gamma=0,this.m_bias=0},box2D.dynamics.joints.B2DistanceJoint.__name__=!0,box2D.dynamics.joints.B2DistanceJoint.__super__=box2D.dynamics.joints.B2Joint,box2D.dynamics.joints.B2DistanceJoint.prototype=$extend(box2D.dynamics.joints.B2Joint.prototype,{getAnchorA:function(){return this.m_bodyA.getWorldPoint(this.m_localAnchor1)},getAnchorB:function(){return this.m_bodyB.getWorldPoint(this.m_localAnchor2)},getReactionForce:function(t){return new box2D.common.math.B2Vec2(t*this.m_impulse*this.m_u.x,t*this.m_impulse*this.m_u.y)},getReactionTorque:function(){return 0},getLength:function(){return this.m_length},setLength:function(t){this.m_length=t},getFrequency:function(){return this.m_frequencyHz},setFrequency:function(t){this.m_frequencyHz=t},getDampingRatio:function(){return this.m_dampingRatio},setDampingRatio:function(t){this.m_dampingRatio=t},initVelocityConstraints:function(t){var o,i,s=this.m_bodyA,n=this.m_bodyB;o=s.m_xf.R;var e=this.m_localAnchor1.x-s.m_sweep.localCenter.x,m=this.m_localAnchor1.y-s.m_sweep.localCenter.y;i=o.col1.x*e+o.col2.x*m,m=o.col1.y*e+o.col2.y*m,e=i,o=n.m_xf.R;var a=this.m_localAnchor2.x-n.m_sweep.localCenter.x,c=this.m_localAnchor2.y-n.m_sweep.localCenter.y;i=o.col1.x*a+o.col2.x*c,c=o.col1.y*a+o.col2.y*c,a=i,this.m_u.x=n.m_sweep.c.x+a-s.m_sweep.c.x-e,this.m_u.y=n.m_sweep.c.y+c-s.m_sweep.c.y-m;var l=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);l>box2D.common.B2Settings.b2_linearSlop?this.m_u.multiply(1/l):this.m_u.setZero();var r=e*this.m_u.y-m*this.m_u.x,_=a*this.m_u.y-c*this.m_u.x,h=s.m_invMass+s.m_invI*r*r+n.m_invMass+n.m_invI*_*_;if(this.m_mass=0!=h?1/h:0,this.m_frequencyHz>0){var x=l-this.m_length,y=2*Math.PI*this.m_frequencyHz,u=2*this.m_mass*this.m_dampingRatio*y,p=this.m_mass*y*y;this.m_gamma=t.dt*(u+t.dt*p),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=x*t.dt*p*this.m_gamma,this.m_mass=h+this.m_gamma,this.m_mass=0!=this.m_mass?1/this.m_mass:0}if(t.warmStarting){this.m_impulse*=t.dtRatio;var d=this.m_impulse*this.m_u.x,B=this.m_impulse*this.m_u.y;s.m_linearVelocity.x-=s.m_invMass*d,s.m_linearVelocity.y-=s.m_invMass*B,s.m_angularVelocity-=s.m_invI*(e*B-m*d),n.m_linearVelocity.x+=n.m_invMass*d,n.m_linearVelocity.y+=n.m_invMass*B,n.m_angularVelocity+=n.m_invI*(a*B-c*d)}else this.m_impulse=0},solveVelocityConstraints:function(){var t,o=this.m_bodyA,i=this.m_bodyB;t=o.m_xf.R;var s=this.m_localAnchor1.x-o.m_sweep.localCenter.x,n=this.m_localAnchor1.y-o.m_sweep.localCenter.y,e=t.col1.x*s+t.col2.x*n;n=t.col1.y*s+t.col2.y*n,s=e,t=i.m_xf.R;var m=this.m_localAnchor2.x-i.m_sweep.localCenter.x,a=this.m_localAnchor2.y-i.m_sweep.localCenter.y;e=t.col1.x*m+t.col2.x*a,a=t.col1.y*m+t.col2.y*a,m=e;var c=o.m_linearVelocity.x+-o.m_angularVelocity*n,l=o.m_linearVelocity.y+o.m_angularVelocity*s,r=i.m_linearVelocity.x+-i.m_angularVelocity*a,_=i.m_linearVelocity.y+i.m_angularVelocity*m,h=this.m_u.x*(r-c)+this.m_u.y*(_-l),x=-this.m_mass*(h+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=x;var y=x*this.m_u.x,u=x*this.m_u.y;o.m_linearVelocity.x-=o.m_invMass*y,o.m_linearVelocity.y-=o.m_invMass*u,o.m_angularVelocity-=o.m_invI*(s*u-n*y),i.m_linearVelocity.x+=i.m_invMass*y,i.m_linearVelocity.y+=i.m_invMass*u,i.m_angularVelocity+=i.m_invI*(m*u-a*y)},solvePositionConstraints:function(){var t;if(this.m_frequencyHz>0)return!0;var o=this.m_bodyA,i=this.m_bodyB;t=o.m_xf.R;var s=this.m_localAnchor1.x-o.m_sweep.localCenter.x,n=this.m_localAnchor1.y-o.m_sweep.localCenter.y,e=t.col1.x*s+t.col2.x*n;n=t.col1.y*s+t.col2.y*n,s=e,t=i.m_xf.R;var m=this.m_localAnchor2.x-i.m_sweep.localCenter.x,a=this.m_localAnchor2.y-i.m_sweep.localCenter.y;e=t.col1.x*m+t.col2.x*a,a=t.col1.y*m+t.col2.y*a,m=e;var c=i.m_sweep.c.x+m-o.m_sweep.c.x-s,l=i.m_sweep.c.y+a-o.m_sweep.c.y-n,r=Math.sqrt(c*c+l*l);c/=r,l/=r;var _=r-this.m_length;_=box2D.common.math.B2Math.clamp(_,-box2D.common.B2Settings.b2_maxLinearCorrection,box2D.common.B2Settings.b2_maxLinearCorrection);var h=-this.m_mass*_;this.m_u.set(c,l);var x=h*this.m_u.x,y=h*this.m_u.y;return o.m_sweep.c.x-=o.m_invMass*x,o.m_sweep.c.y-=o.m_invMass*y,o.m_sweep.a-=o.m_invI*(s*y-n*x),i.m_sweep.c.x+=i.m_invMass*x,i.m_sweep.c.y+=i.m_invMass*y,i.m_sweep.a+=i.m_invI*(m*y-a*x),o.synchronizeTransform(),i.synchronizeTransform(),box2D.common.math.B2Math.abs(_)<box2D.common.B2Settings.b2_linearSlop},__class__:box2D.dynamics.joints.B2DistanceJoint}),box2D.dynamics.joints.B2JointDef=function(){this.type=box2D.dynamics.joints.B2Joint.e_unknownJoint,this.userData=null,this.bodyA=null,this.bodyB=null,this.collideConnected=!1},box2D.dynamics.joints.B2JointDef.__name__=!0,box2D.dynamics.joints.B2JointDef.prototype={__class__:box2D.dynamics.joints.B2JointDef},box2D.dynamics.joints.B2DistanceJointDef=function(){box2D.dynamics.joints.B2JointDef.call(this),this.localAnchorA=new box2D.common.math.B2Vec2,this.localAnchorB=new box2D.common.math.B2Vec2,this.type=box2D.dynamics.joints.B2Joint.e_distanceJoint,this.length=1,this.frequencyHz=0,this.dampingRatio=0},box2D.dynamics.joints.B2DistanceJointDef.__name__=!0,box2D.dynamics.joints.B2DistanceJointDef.__super__=box2D.dynamics.joints.B2JointDef,box2D.dynamics.joints.B2DistanceJointDef.prototype=$extend(box2D.dynamics.joints.B2JointDef.prototype,{initialize:function(t,o,i,s){this.bodyA=t,this.bodyB=o,this.localAnchorA.setV(this.bodyA.getLocalPoint(i)),this.localAnchorB.setV(this.bodyB.getLocalPoint(s));var n=s.x-i.x,e=s.y-i.y;this.length=Math.sqrt(n*n+e*e),this.frequencyHz=0,this.dampingRatio=0},__class__:box2D.dynamics.joints.B2DistanceJointDef}),box2D.dynamics.joints.B2FrictionJoint=function(t){box2D.dynamics.joints.B2Joint.call(this,t),this.m_localAnchorA=new box2D.common.math.B2Vec2,this.m_localAnchorB=new box2D.common.math.B2Vec2,this.m_linearMass=new box2D.common.math.B2Mat22,this.m_linearImpulse=new box2D.common.math.B2Vec2,this.m_localAnchorA.setV(t.localAnchorA),this.m_localAnchorB.setV(t.localAnchorB),this.m_linearMass.setZero(),this.m_angularMass=0,this.m_linearImpulse.setZero(),this.m_angularImpulse=0,this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque},box2D.dynamics.joints.B2FrictionJoint.__name__=!0,box2D.dynamics.joints.B2FrictionJoint.__super__=box2D.dynamics.joints.B2Joint,box2D.dynamics.joints.B2FrictionJoint.prototype=$extend(box2D.dynamics.joints.B2Joint.prototype,{getAnchorA:function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},getAnchorB:function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},getReactionForce:function(t){return new box2D.common.math.B2Vec2(t*this.m_linearImpulse.x,t*this.m_linearImpulse.y)},getReactionTorque:function(t){return t*this.m_angularImpulse},setMaxForce:function(t){this.m_maxForce=t},getMaxForce:function(){return this.m_maxForce},setMaxTorque:function(t){this.m_maxTorque=t},getMaxTorque:function(){return this.m_maxTorque},initVelocityConstraints:function(t){var o,i,s=this.m_bodyA,n=this.m_bodyB;o=s.m_xf.R;var e=this.m_localAnchorA.x-s.m_sweep.localCenter.x,m=this.m_localAnchorA.y-s.m_sweep.localCenter.y;i=o.col1.x*e+o.col2.x*m,m=o.col1.y*e+o.col2.y*m,e=i,o=n.m_xf.R;var a=this.m_localAnchorB.x-n.m_sweep.localCenter.x,c=this.m_localAnchorB.y-n.m_sweep.localCenter.y;i=o.col1.x*a+o.col2.x*c,c=o.col1.y*a+o.col2.y*c,a=i;var l=s.m_invMass,r=n.m_invMass,_=s.m_invI,h=n.m_invI,x=new box2D.common.math.B2Mat22;if(x.col1.x=l+r,x.col2.x=0,x.col1.y=0,x.col2.y=l+r,x.col1.x+=_*m*m,x.col2.x+=-_*e*m,x.col1.y+=-_*e*m,x.col2.y+=_*e*e,x.col1.x+=h*c*c,x.col2.x+=-h*a*c,x.col1.y+=-h*a*c,x.col2.y+=h*a*a,x.getInverse(this.m_linearMass),this.m_angularMass=_+h,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.warmStarting){this.m_linearImpulse.x*=t.dtRatio,this.m_linearImpulse.y*=t.dtRatio,this.m_angularImpulse*=t.dtRatio;var y=this.m_linearImpulse;s.m_linearVelocity.x-=l*y.x,s.m_linearVelocity.y-=l*y.y,s.m_angularVelocity-=_*(e*y.y-m*y.x+this.m_angularImpulse),n.m_linearVelocity.x+=r*y.x,n.m_linearVelocity.y+=r*y.y,n.m_angularVelocity+=h*(a*y.y-c*y.x+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0},solveVelocityConstraints:function(t){var o,i,s=this.m_bodyA,n=this.m_bodyB,e=s.m_linearVelocity,m=s.m_angularVelocity,a=n.m_linearVelocity,c=n.m_angularVelocity,l=s.m_invMass,r=n.m_invMass,_=s.m_invI,h=n.m_invI;o=s.m_xf.R;var x=this.m_localAnchorA.x-s.m_sweep.localCenter.x,y=this.m_localAnchorA.y-s.m_sweep.localCenter.y;i=o.col1.x*x+o.col2.x*y,y=o.col1.y*x+o.col2.y*y,x=i,o=n.m_xf.R;var u=this.m_localAnchorB.x-n.m_sweep.localCenter.x,p=this.m_localAnchorB.y-n.m_sweep.localCenter.y;i=o.col1.x*u+o.col2.x*p,p=o.col1.y*u+o.col2.y*p,u=i;var d,B=c-m,b=-this.m_angularMass*B,D=this.m_angularImpulse;d=t.dt*this.m_maxTorque,this.m_angularImpulse=box2D.common.math.B2Math.clamp(this.m_angularImpulse+b,-d,d),b=this.m_angularImpulse-D,m-=_*b,c+=h*b;var f=a.x-c*p-e.x+m*y,g=a.y+c*u-e.y-m*x,v=box2D.common.math.B2Math.mulMV(this.m_linearMass,new box2D.common.math.B2Vec2(-f,-g)),A=this.m_linearImpulse.copy();this.m_linearImpulse.add(v),d=t.dt*this.m_maxForce,this.m_linearImpulse.lengthSquared()>d*d&&(this.m_linearImpulse.normalize(),this.m_linearImpulse.multiply(d)),v=box2D.common.math.B2Math.subtractVV(this.m_linearImpulse,A),e.x-=l*v.x,e.y-=l*v.y,m-=_*(x*v.y-y*v.x),a.x+=r*v.x,a.y+=r*v.y,c+=h*(u*v.y-p*v.x),s.m_angularVelocity=m,n.m_angularVelocity=c},solvePositionConstraints:function(){return!0},__class__:box2D.dynamics.joints.B2FrictionJoint}),box2D.dynamics.joints.B2FrictionJointDef=function(){box2D.dynamics.joints.B2JointDef.call(this),this.localAnchorA=new box2D.common.math.B2Vec2,this.localAnchorB=new box2D.common.math.B2Vec2,this.type=box2D.dynamics.joints.B2Joint.e_frictionJoint,this.maxForce=0,this.maxTorque=0},box2D.dynamics.joints.B2FrictionJointDef.__name__=!0,box2D.dynamics.joints.B2FrictionJointDef.__super__=box2D.dynamics.joints.B2JointDef,box2D.dynamics.joints.B2FrictionJointDef.prototype=$extend(box2D.dynamics.joints.B2JointDef.prototype,{initialize:function(t,o,i){this.bodyA=t,this.bodyB=o,this.localAnchorA.setV(this.bodyA.getLocalPoint(i)),this.localAnchorB.setV(this.bodyB.getLocalPoint(i))},__class__:box2D.dynamics.joints.B2FrictionJointDef}),box2D.dynamics.joints.B2GearJoint=function(t){box2D.dynamics.joints.B2Joint.call(this,t),this.m_groundAnchor1=new box2D.common.math.B2Vec2,this.m_groundAnchor2=new box2D.common.math.B2Vec2,this.m_localAnchor1=new box2D.common.math.B2Vec2,this.m_localAnchor2=new box2D.common.math.B2Vec2,this.m_J=new box2D.dynamics.joints.B2Jacobian;var o=t.joint1.m_type,i=t.joint2.m_type;this.m_revolute1=null,this.m_prismatic1=null,this.m_revolute2=null,this.m_prismatic2=null;var s,n;this.m_ground1=t.joint1.getBodyA(),this.m_bodyA=t.joint1.getBodyB(),o==box2D.dynamics.joints.B2Joint.e_revoluteJoint?(this.m_revolute1=js.Boot.__cast(t.joint1,box2D.dynamics.joints.B2RevoluteJoint),this.m_groundAnchor1.setV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.setV(this.m_revolute1.m_localAnchor2),s=this.m_revolute1.getJointAngle()):(this.m_prismatic1=js.Boot.__cast(t.joint1,box2D.dynamics.joints.B2PrismaticJoint),this.m_groundAnchor1.setV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.setV(this.m_prismatic1.m_localAnchor2),s=this.m_prismatic1.getJointTranslation()),this.m_ground2=t.joint2.getBodyA(),this.m_bodyB=t.joint2.getBodyB(),i==box2D.dynamics.joints.B2Joint.e_revoluteJoint?(this.m_revolute2=js.Boot.__cast(t.joint2,box2D.dynamics.joints.B2RevoluteJoint),this.m_groundAnchor2.setV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.setV(this.m_revolute2.m_localAnchor2),n=this.m_revolute2.getJointAngle()):(this.m_prismatic2=js.Boot.__cast(t.joint2,box2D.dynamics.joints.B2PrismaticJoint),this.m_groundAnchor2.setV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.setV(this.m_prismatic2.m_localAnchor2),n=this.m_prismatic2.getJointTranslation()),this.m_ratio=t.ratio,this.m_constant=s+this.m_ratio*n,this.m_impulse=0},box2D.dynamics.joints.B2GearJoint.__name__=!0,box2D.dynamics.joints.B2GearJoint.__super__=box2D.dynamics.joints.B2Joint,box2D.dynamics.joints.B2GearJoint.prototype=$extend(box2D.dynamics.joints.B2Joint.prototype,{getAnchorA:function(){return this.m_bodyA.getWorldPoint(this.m_localAnchor1)
},getAnchorB:function(){return this.m_bodyB.getWorldPoint(this.m_localAnchor2)},getReactionForce:function(t){return new box2D.common.math.B2Vec2(t*this.m_impulse*this.m_J.linearB.x,t*this.m_impulse*this.m_J.linearB.y)},getReactionTorque:function(t){var o=this.m_bodyB.m_xf.R,i=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,s=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,n=o.col1.x*i+o.col2.x*s;s=o.col1.y*i+o.col2.y*s,i=n;var e=this.m_impulse*this.m_J.linearB.x,m=this.m_impulse*this.m_J.linearB.y;return t*(this.m_impulse*this.m_J.angularB-i*m+s*e)},getRatio:function(){return this.m_ratio},setRatio:function(t){this.m_ratio=t},initVelocityConstraints:function(t){var o,i,s,n,e,m,a,c,l=this.m_ground1,r=this.m_ground2,_=this.m_bodyA,h=this.m_bodyB,x=0;this.m_J.setZero(),null!=this.m_revolute1?(this.m_J.angularA=-1,x+=_.m_invI):(e=l.m_xf.R,m=this.m_prismatic1.m_localXAxis1,o=e.col1.x*m.x+e.col2.x*m.y,i=e.col1.y*m.x+e.col2.y*m.y,e=_.m_xf.R,s=this.m_localAnchor1.x-_.m_sweep.localCenter.x,n=this.m_localAnchor1.y-_.m_sweep.localCenter.y,c=e.col1.x*s+e.col2.x*n,n=e.col1.y*s+e.col2.y*n,s=c,a=s*i-n*o,this.m_J.linearA.set(-o,-i),this.m_J.angularA=-a,x+=_.m_invMass+_.m_invI*a*a),null!=this.m_revolute2?(this.m_J.angularB=-this.m_ratio,x+=this.m_ratio*this.m_ratio*h.m_invI):(e=r.m_xf.R,m=this.m_prismatic2.m_localXAxis1,o=e.col1.x*m.x+e.col2.x*m.y,i=e.col1.y*m.x+e.col2.y*m.y,e=h.m_xf.R,s=this.m_localAnchor2.x-h.m_sweep.localCenter.x,n=this.m_localAnchor2.y-h.m_sweep.localCenter.y,c=e.col1.x*s+e.col2.x*n,n=e.col1.y*s+e.col2.y*n,s=c,a=s*i-n*o,this.m_J.linearB.set(-this.m_ratio*o,-this.m_ratio*i),this.m_J.angularB=-this.m_ratio*a,x+=this.m_ratio*this.m_ratio*(h.m_invMass+h.m_invI*a*a)),this.m_mass=x>0?1/x:0,t.warmStarting?(_.m_linearVelocity.x+=_.m_invMass*this.m_impulse*this.m_J.linearA.x,_.m_linearVelocity.y+=_.m_invMass*this.m_impulse*this.m_J.linearA.y,_.m_angularVelocity+=_.m_invI*this.m_impulse*this.m_J.angularA,h.m_linearVelocity.x+=h.m_invMass*this.m_impulse*this.m_J.linearB.x,h.m_linearVelocity.y+=h.m_invMass*this.m_impulse*this.m_J.linearB.y,h.m_angularVelocity+=h.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},solveVelocityConstraints:function(){var t=this.m_bodyA,o=this.m_bodyB,i=this.m_J.compute(t.m_linearVelocity,t.m_angularVelocity,o.m_linearVelocity,o.m_angularVelocity),s=-this.m_mass*i;this.m_impulse+=s,t.m_linearVelocity.x+=t.m_invMass*s*this.m_J.linearA.x,t.m_linearVelocity.y+=t.m_invMass*s*this.m_J.linearA.y,t.m_angularVelocity+=t.m_invI*s*this.m_J.angularA,o.m_linearVelocity.x+=o.m_invMass*s*this.m_J.linearB.x,o.m_linearVelocity.y+=o.m_invMass*s*this.m_J.linearB.y,o.m_angularVelocity+=o.m_invI*s*this.m_J.angularB},solvePositionConstraints:function(){var t,o,i=0,s=this.m_bodyA,n=this.m_bodyB;t=null!=this.m_revolute1?this.m_revolute1.getJointAngle():this.m_prismatic1.getJointTranslation(),o=null!=this.m_revolute2?this.m_revolute2.getJointAngle():this.m_prismatic2.getJointTranslation();var e=this.m_constant-(t+this.m_ratio*o),m=-this.m_mass*e;return s.m_sweep.c.x+=s.m_invMass*m*this.m_J.linearA.x,s.m_sweep.c.y+=s.m_invMass*m*this.m_J.linearA.y,s.m_sweep.a+=s.m_invI*m*this.m_J.angularA,n.m_sweep.c.x+=n.m_invMass*m*this.m_J.linearB.x,n.m_sweep.c.y+=n.m_invMass*m*this.m_J.linearB.y,n.m_sweep.a+=n.m_invI*m*this.m_J.angularB,s.synchronizeTransform(),n.synchronizeTransform(),i<box2D.common.B2Settings.b2_linearSlop},__class__:box2D.dynamics.joints.B2GearJoint}),box2D.dynamics.joints.B2GearJointDef=function(){box2D.dynamics.joints.B2JointDef.call(this),this.type=box2D.dynamics.joints.B2Joint.e_gearJoint,this.joint1=null,this.joint2=null,this.ratio=1},box2D.dynamics.joints.B2GearJointDef.__name__=!0,box2D.dynamics.joints.B2GearJointDef.__super__=box2D.dynamics.joints.B2JointDef,box2D.dynamics.joints.B2GearJointDef.prototype=$extend(box2D.dynamics.joints.B2JointDef.prototype,{__class__:box2D.dynamics.joints.B2GearJointDef}),box2D.dynamics.joints.B2Jacobian=function(){this.linearA=new box2D.common.math.B2Vec2,this.linearB=new box2D.common.math.B2Vec2},box2D.dynamics.joints.B2Jacobian.__name__=!0,box2D.dynamics.joints.B2Jacobian.prototype={setZero:function(){this.linearA.setZero(),this.angularA=0,this.linearB.setZero(),this.angularB=0},set:function(t,o,i,s){this.linearA.setV(t),this.angularA=o,this.linearB.setV(i),this.angularB=s},compute:function(t,o,i,s){return this.linearA.x*t.x+this.linearA.y*t.y+this.angularA*o+(this.linearB.x*i.x+this.linearB.y*i.y)+this.angularB*s},__class__:box2D.dynamics.joints.B2Jacobian},box2D.dynamics.joints.B2JointEdge=function(){},box2D.dynamics.joints.B2JointEdge.__name__=!0,box2D.dynamics.joints.B2JointEdge.prototype={__class__:box2D.dynamics.joints.B2JointEdge},box2D.dynamics.joints.B2LineJoint=function(t){box2D.dynamics.joints.B2Joint.call(this,t),this.m_localAnchor1=new box2D.common.math.B2Vec2,this.m_localAnchor2=new box2D.common.math.B2Vec2,this.m_localXAxis1=new box2D.common.math.B2Vec2,this.m_localYAxis1=new box2D.common.math.B2Vec2,this.m_axis=new box2D.common.math.B2Vec2,this.m_perp=new box2D.common.math.B2Vec2,this.m_K=new box2D.common.math.B2Mat22,this.m_impulse=new box2D.common.math.B2Vec2;this.m_localAnchor1.setV(t.localAnchorA),this.m_localAnchor2.setV(t.localAnchorB),this.m_localXAxis1.setV(t.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_impulse.setZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=box2D.dynamics.joints.B2Joint.e_inactiveLimit,this.m_axis.setZero(),this.m_perp.setZero()},box2D.dynamics.joints.B2LineJoint.__name__=!0,box2D.dynamics.joints.B2LineJoint.__super__=box2D.dynamics.joints.B2Joint,box2D.dynamics.joints.B2LineJoint.prototype=$extend(box2D.dynamics.joints.B2Joint.prototype,{getAnchorA:function(){return this.m_bodyA.getWorldPoint(this.m_localAnchor1)},getAnchorB:function(){return this.m_bodyB.getWorldPoint(this.m_localAnchor2)},getReactionForce:function(t){return new box2D.common.math.B2Vec2(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},getReactionTorque:function(t){return t*this.m_impulse.y},getJointTranslation:function(){var t=this.m_bodyA,o=this.m_bodyB,i=t.getWorldPoint(this.m_localAnchor1),s=o.getWorldPoint(this.m_localAnchor2),n=s.x-i.x,e=s.y-i.y,m=t.getWorldVector(this.m_localXAxis1),a=m.x*n+m.y*e;return a},getJointSpeed:function(){var t,o=this.m_bodyA,i=this.m_bodyB;t=o.m_xf.R;var s=this.m_localAnchor1.x-o.m_sweep.localCenter.x,n=this.m_localAnchor1.y-o.m_sweep.localCenter.y,e=t.col1.x*s+t.col2.x*n;n=t.col1.y*s+t.col2.y*n,s=e,t=i.m_xf.R;var m=this.m_localAnchor2.x-i.m_sweep.localCenter.x,a=this.m_localAnchor2.y-i.m_sweep.localCenter.y;e=t.col1.x*m+t.col2.x*a,a=t.col1.y*m+t.col2.y*a,m=e;var c=o.m_sweep.c.x+s,l=o.m_sweep.c.y+n,r=i.m_sweep.c.x+m,_=i.m_sweep.c.y+a,h=r-c,x=_-l,y=o.getWorldVector(this.m_localXAxis1),u=o.m_linearVelocity,p=i.m_linearVelocity,d=o.m_angularVelocity,B=i.m_angularVelocity,b=h*-d*y.y+x*d*y.x+(y.x*(p.x+-B*a-u.x- -d*n)+y.y*(p.y+B*m-u.y-d*s));return b},isLimitEnabled:function(){return this.m_enableLimit},enableLimit:function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=t},getLowerLimit:function(){return this.m_lowerTranslation},getUpperLimit:function(){return this.m_upperTranslation},setLimits:function(t,o){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=o},isMotorEnabled:function(){return this.m_enableMotor},enableMotor:function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t},setMotorSpeed:function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t},getMotorSpeed:function(){return this.m_motorSpeed},setMaxMotorForce:function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorForce=t},getMaxMotorForce:function(){return this.m_maxMotorForce},getMotorForce:function(){return this.m_motorImpulse},initVelocityConstraints:function(t){var o,i,s=this.m_bodyA,n=this.m_bodyB;this.m_localCenterA.setV(s.getLocalCenter()),this.m_localCenterB.setV(n.getLocalCenter());{var e=s.getTransform();n.getTransform()}o=s.m_xf.R;var m=this.m_localAnchor1.x-this.m_localCenterA.x,a=this.m_localAnchor1.y-this.m_localCenterA.y;i=o.col1.x*m+o.col2.x*a,a=o.col1.y*m+o.col2.y*a,m=i,o=n.m_xf.R;var c=this.m_localAnchor2.x-this.m_localCenterB.x,l=this.m_localAnchor2.y-this.m_localCenterB.y;i=o.col1.x*c+o.col2.x*l,l=o.col1.y*c+o.col2.y*l,c=i;var r=n.m_sweep.c.x+c-s.m_sweep.c.x-m,_=n.m_sweep.c.y+l-s.m_sweep.c.y-a;this.m_invMassA=s.m_invMass,this.m_invMassB=n.m_invMass,this.m_invIA=s.m_invI,this.m_invIB=n.m_invI,this.m_axis.setV(box2D.common.math.B2Math.mulMV(e.R,this.m_localXAxis1)),this.m_a1=(r+m)*this.m_axis.y-(_+a)*this.m_axis.x,this.m_a2=c*this.m_axis.y-l*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass=this.m_motorMass>2.2250738585072014e-308?1/this.m_motorMass:0,this.m_perp.setV(box2D.common.math.B2Math.mulMV(e.R,this.m_localYAxis1)),this.m_s1=(r+m)*this.m_perp.y-(_+a)*this.m_perp.x,this.m_s2=c*this.m_perp.y-l*this.m_perp.x;var h=this.m_invMassA,x=this.m_invMassB,y=this.m_invIA,u=this.m_invIB;if(this.m_K.col1.x=h+x+y*this.m_s1*this.m_s1+u*this.m_s2*this.m_s2,this.m_K.col1.y=y*this.m_s1*this.m_a1+u*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=h+x+y*this.m_a1*this.m_a1+u*this.m_a2*this.m_a2,this.m_enableLimit){var p=this.m_axis.x*r+this.m_axis.y*_;box2D.common.math.B2Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*box2D.common.B2Settings.b2_linearSlop?this.m_limitState=box2D.dynamics.joints.B2Joint.e_equalLimits:p<=this.m_lowerTranslation?this.m_limitState!=box2D.dynamics.joints.B2Joint.e_atLowerLimit&&(this.m_limitState=box2D.dynamics.joints.B2Joint.e_atLowerLimit,this.m_impulse.y=0):p>=this.m_upperTranslation?this.m_limitState!=box2D.dynamics.joints.B2Joint.e_atUpperLimit&&(this.m_limitState=box2D.dynamics.joints.B2Joint.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=box2D.dynamics.joints.B2Joint.e_inactiveLimit,this.m_impulse.y=0)}else this.m_limitState=box2D.dynamics.joints.B2Joint.e_inactiveLimit;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),t.warmStarting){this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_motorImpulse*=t.dtRatio;var d=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,B=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,b=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,D=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2;s.m_linearVelocity.x-=this.m_invMassA*d,s.m_linearVelocity.y-=this.m_invMassA*B,s.m_angularVelocity-=this.m_invIA*b,n.m_linearVelocity.x+=this.m_invMassB*d,n.m_linearVelocity.y+=this.m_invMassB*B,n.m_angularVelocity+=this.m_invIB*D}else this.m_impulse.setZero(),this.m_motorImpulse=0},solveVelocityConstraints:function(t){var o,i,s,n,e=this.m_bodyA,m=this.m_bodyB,a=e.m_linearVelocity,c=e.m_angularVelocity,l=m.m_linearVelocity,r=m.m_angularVelocity;if(this.m_enableMotor&&this.m_limitState!=box2D.dynamics.joints.B2Joint.e_equalLimits){var _=this.m_axis.x*(l.x-a.x)+this.m_axis.y*(l.y-a.y)+this.m_a2*r-this.m_a1*c,h=this.m_motorMass*(this.m_motorSpeed-_),x=this.m_motorImpulse,y=t.dt*this.m_maxMotorForce;this.m_motorImpulse=box2D.common.math.B2Math.clamp(this.m_motorImpulse+h,-y,y),h=this.m_motorImpulse-x,o=h*this.m_axis.x,i=h*this.m_axis.y,s=h*this.m_a1,n=h*this.m_a2,a.x-=this.m_invMassA*o,a.y-=this.m_invMassA*i,c-=this.m_invIA*s,l.x+=this.m_invMassB*o,l.y+=this.m_invMassB*i,r+=this.m_invIB*n}var u=this.m_perp.x*(l.x-a.x)+this.m_perp.y*(l.y-a.y)+this.m_s2*r-this.m_s1*c;if(this.m_enableLimit&&this.m_limitState!=box2D.dynamics.joints.B2Joint.e_inactiveLimit){var p=this.m_axis.x*(l.x-a.x)+this.m_axis.y*(l.y-a.y)+this.m_a2*r-this.m_a1*c,d=this.m_impulse.copy(),B=this.m_K.solve(new box2D.common.math.B2Vec2,-u,-p);this.m_impulse.add(B),this.m_limitState==box2D.dynamics.joints.B2Joint.e_atLowerLimit?this.m_impulse.y=box2D.common.math.B2Math.max(this.m_impulse.y,0):this.m_limitState==box2D.dynamics.joints.B2Joint.e_atUpperLimit&&(this.m_impulse.y=box2D.common.math.B2Math.min(this.m_impulse.y,0));var b,D=-u-(this.m_impulse.y-d.y)*this.m_K.col2.x;b=0!=this.m_K.col1.x?D/this.m_K.col1.x+d.x:d.x,this.m_impulse.x=b,B.x=this.m_impulse.x-d.x,B.y=this.m_impulse.y-d.y,o=B.x*this.m_perp.x+B.y*this.m_axis.x,i=B.x*this.m_perp.y+B.y*this.m_axis.y,s=B.x*this.m_s1+B.y*this.m_a1,n=B.x*this.m_s2+B.y*this.m_a2,a.x-=this.m_invMassA*o,a.y-=this.m_invMassA*i,c-=this.m_invIA*s,l.x+=this.m_invMassB*o,l.y+=this.m_invMassB*i,r+=this.m_invIB*n}else{var f;f=0!=this.m_K.col1.x?-u/this.m_K.col1.x:0,this.m_impulse.x+=f,o=f*this.m_perp.x,i=f*this.m_perp.y,s=f*this.m_s1,n=f*this.m_s2,a.x-=this.m_invMassA*o,a.y-=this.m_invMassA*i,c-=this.m_invIA*s,l.x+=this.m_invMassB*o,l.y+=this.m_invMassB*i,r+=this.m_invIB*n}e.m_linearVelocity.setV(a),e.m_angularVelocity=c,m.m_linearVelocity.setV(l),m.m_angularVelocity=r},solvePositionConstraints:function(){var t,o,i,s,n,e,m=this.m_bodyA,a=this.m_bodyB,c=m.m_sweep.c,l=m.m_sweep.a,r=a.m_sweep.c,_=a.m_sweep.a,h=0,x=0,y=!1,u=0,p=box2D.common.math.B2Mat22.fromAngle(l),d=box2D.common.math.B2Mat22.fromAngle(_);t=p;var B=this.m_localAnchor1.x-this.m_localCenterA.x,b=this.m_localAnchor1.y-this.m_localCenterA.y;o=t.col1.x*B+t.col2.x*b,b=t.col1.y*B+t.col2.y*b,B=o,t=d;var D=this.m_localAnchor2.x-this.m_localCenterB.x,f=this.m_localAnchor2.y-this.m_localCenterB.y;o=t.col1.x*D+t.col2.x*f,f=t.col1.y*D+t.col2.y*f,D=o;var g=r.x+D-c.x-B,v=r.y+f-c.y-b;if(this.m_enableLimit){this.m_axis=box2D.common.math.B2Math.mulMV(p,this.m_localXAxis1),this.m_a1=(g+B)*this.m_axis.y-(v+b)*this.m_axis.x,this.m_a2=D*this.m_axis.y-f*this.m_axis.x;var A=this.m_axis.x*g+this.m_axis.y*v;box2D.common.math.B2Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*box2D.common.B2Settings.b2_linearSlop?(u=box2D.common.math.B2Math.clamp(A,-box2D.common.B2Settings.b2_maxLinearCorrection,box2D.common.B2Settings.b2_maxLinearCorrection),h=box2D.common.math.B2Math.abs(A),y=!0):A<=this.m_lowerTranslation?(u=box2D.common.math.B2Math.clamp(A-this.m_lowerTranslation+box2D.common.B2Settings.b2_linearSlop,-box2D.common.B2Settings.b2_maxLinearCorrection,0),h=this.m_lowerTranslation-A,y=!0):A>=this.m_upperTranslation&&(u=box2D.common.math.B2Math.clamp(A-this.m_upperTranslation+box2D.common.B2Settings.b2_linearSlop,0,box2D.common.B2Settings.b2_maxLinearCorrection),h=A-this.m_upperTranslation,y=!0)}this.m_perp=box2D.common.math.B2Math.mulMV(p,this.m_localYAxis1),this.m_s1=(g+B)*this.m_perp.y-(v+b)*this.m_perp.x,this.m_s2=D*this.m_perp.y-f*this.m_perp.x;var w=new box2D.common.math.B2Vec2,V=this.m_perp.x*g+this.m_perp.y*v;if(h=box2D.common.math.B2Math.max(h,box2D.common.math.B2Math.abs(V)),x=0,y)i=this.m_invMassA,s=this.m_invMassB,n=this.m_invIA,e=this.m_invIB,this.m_K.col1.x=i+s+n*this.m_s1*this.m_s1+e*this.m_s2*this.m_s2,this.m_K.col1.y=n*this.m_s1*this.m_a1+e*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=i+s+n*this.m_a1*this.m_a1+e*this.m_a2*this.m_a2,this.m_K.solve(w,-V,-u);else{i=this.m_invMassA,s=this.m_invMassB,n=this.m_invIA,e=this.m_invIB;var C,M=i+s+n*this.m_s1*this.m_s1+e*this.m_s2*this.m_s2;C=0!=M?-V/M:0,w.x=C,w.y=0}var S=w.x*this.m_perp.x+w.y*this.m_axis.x,I=w.x*this.m_perp.y+w.y*this.m_axis.y,j=w.x*this.m_s1+w.y*this.m_a1,L=w.x*this.m_s2+w.y*this.m_a2;return c.x-=this.m_invMassA*S,c.y-=this.m_invMassA*I,l-=this.m_invIA*j,r.x+=this.m_invMassB*S,r.y+=this.m_invMassB*I,_+=this.m_invIB*L,m.m_sweep.a=l,a.m_sweep.a=_,m.synchronizeTransform(),a.synchronizeTransform(),h<=box2D.common.B2Settings.b2_linearSlop&&x<=box2D.common.B2Settings.b2_angularSlop},__class__:box2D.dynamics.joints.B2LineJoint}),box2D.dynamics.joints.B2LineJointDef=function(){box2D.dynamics.joints.B2JointDef.call(this)},box2D.dynamics.joints.B2LineJointDef.__name__=!0,box2D.dynamics.joints.B2LineJointDef.__super__=box2D.dynamics.joints.B2JointDef,box2D.dynamics.joints.B2LineJointDef.prototype=$extend(box2D.dynamics.joints.B2JointDef.prototype,{b2LineJointDef:function(){this.localAnchorA=new box2D.common.math.B2Vec2,this.localAnchorB=new box2D.common.math.B2Vec2,this.localAxisA=new box2D.common.math.B2Vec2,this.type=box2D.dynamics.joints.B2Joint.e_lineJoint,this.localAxisA.set(1,0),this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},initialize:function(t,o,i,s){this.bodyA=t,this.bodyB=o,this.localAnchorA=this.bodyA.getLocalPoint(i),this.localAnchorB=this.bodyB.getLocalPoint(i),this.localAxisA=this.bodyA.getLocalVector(s)},__class__:box2D.dynamics.joints.B2LineJointDef}),box2D.dynamics.joints.B2MouseJoint=function(t){box2D.dynamics.joints.B2Joint.call(this,t),this.K=new box2D.common.math.B2Mat22,this.K1=new box2D.common.math.B2Mat22,this.K2=new box2D.common.math.B2Mat22,this.m_localAnchor=new box2D.common.math.B2Vec2,this.m_target=new box2D.common.math.B2Vec2,this.m_impulse=new box2D.common.math.B2Vec2,this.m_mass=new box2D.common.math.B2Mat22,this.m_C=new box2D.common.math.B2Vec2,this.m_target.setV(t.target);var o=this.m_target.x-this.m_bodyB.m_xf.position.x,i=this.m_target.y-this.m_bodyB.m_xf.position.y,s=this.m_bodyB.m_xf.R;this.m_localAnchor.x=o*s.col1.x+i*s.col1.y,this.m_localAnchor.y=o*s.col2.x+i*s.col2.y,this.m_maxForce=t.maxForce,this.m_impulse.setZero(),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_beta=0,this.m_gamma=0},box2D.dynamics.joints.B2MouseJoint.__name__=!0,box2D.dynamics.joints.B2MouseJoint.__super__=box2D.dynamics.joints.B2Joint,box2D.dynamics.joints.B2MouseJoint.prototype=$extend(box2D.dynamics.joints.B2Joint.prototype,{getAnchorA:function(){return this.m_target},getAnchorB:function(){return this.m_bodyB.getWorldPoint(this.m_localAnchor)},getReactionForce:function(t){return new box2D.common.math.B2Vec2(t*this.m_impulse.x,t*this.m_impulse.y)},getReactionTorque:function(){return 0},getTarget:function(){return this.m_target},setTarget:function(t){0==this.m_bodyB.isAwake()&&this.m_bodyB.setAwake(!0),this.m_target=t},getMaxForce:function(){return this.m_maxForce},setMaxForce:function(t){this.m_maxForce=t},getFrequency:function(){return this.m_frequencyHz},setFrequency:function(t){this.m_frequencyHz=t},getDampingRatio:function(){return this.m_dampingRatio},setDampingRatio:function(t){this.m_dampingRatio=t},initVelocityConstraints:function(t){var o=this.m_bodyB,i=o.getMass(),s=2*Math.PI*this.m_frequencyHz,n=2*i*this.m_dampingRatio*s,e=i*s*s;this.m_gamma=t.dt*(n+t.dt*e),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_beta=t.dt*e*this.m_gamma;var m;m=o.m_xf.R;var a=this.m_localAnchor.x-o.m_sweep.localCenter.x,c=this.m_localAnchor.y-o.m_sweep.localCenter.y,l=m.col1.x*a+m.col2.x*c;c=m.col1.y*a+m.col2.y*c,a=l;var r=o.m_invMass,_=o.m_invI;this.K1.col1.x=r,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=r,this.K2.col1.x=_*c*c,this.K2.col2.x=-_*a*c,this.K2.col1.y=-_*a*c,this.K2.col2.y=_*a*a,this.K.setM(this.K1),this.K.addM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.getInverse(this.m_mass),this.m_C.x=o.m_sweep.c.x+a-this.m_target.x,this.m_C.y=o.m_sweep.c.y+c-this.m_target.y,o.m_angularVelocity*=.98,this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,o.m_linearVelocity.x+=r*this.m_impulse.x,o.m_linearVelocity.y+=r*this.m_impulse.y,o.m_angularVelocity+=_*(a*this.m_impulse.y-c*this.m_impulse.x)},solveVelocityConstraints:function(t){var o,i,s,n=this.m_bodyB;o=n.m_xf.R;var e=this.m_localAnchor.x-n.m_sweep.localCenter.x,m=this.m_localAnchor.y-n.m_sweep.localCenter.y;i=o.col1.x*e+o.col2.x*m,m=o.col1.y*e+o.col2.y*m,e=i;var a=n.m_linearVelocity.x+-n.m_angularVelocity*m,c=n.m_linearVelocity.y+n.m_angularVelocity*e;o=this.m_mass,i=a+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x,s=c+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;var l=-(o.col1.x*i+o.col2.x*s),r=-(o.col1.y*i+o.col2.y*s),_=this.m_impulse.x,h=this.m_impulse.y;this.m_impulse.x+=l,this.m_impulse.y+=r;var x=t.dt*this.m_maxForce;this.m_impulse.lengthSquared()>x*x&&this.m_impulse.multiply(x/this.m_impulse.length()),l=this.m_impulse.x-_,r=this.m_impulse.y-h,n.m_linearVelocity.x+=n.m_invMass*l,n.m_linearVelocity.y+=n.m_invMass*r,n.m_angularVelocity+=n.m_invI*(e*r-m*l)},solvePositionConstraints:function(){return!0},__class__:box2D.dynamics.joints.B2MouseJoint}),box2D.dynamics.joints.B2MouseJointDef=function(){box2D.dynamics.joints.B2JointDef.call(this),this.target=new box2D.common.math.B2Vec2,this.type=box2D.dynamics.joints.B2Joint.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7},box2D.dynamics.joints.B2MouseJointDef.__name__=!0,box2D.dynamics.joints.B2MouseJointDef.__super__=box2D.dynamics.joints.B2JointDef,box2D.dynamics.joints.B2MouseJointDef.prototype=$extend(box2D.dynamics.joints.B2JointDef.prototype,{__class__:box2D.dynamics.joints.B2MouseJointDef}),box2D.dynamics.joints.B2PrismaticJoint=function(t){box2D.dynamics.joints.B2Joint.call(this,t),this.m_localAnchor1=new box2D.common.math.B2Vec2,this.m_localAnchor2=new box2D.common.math.B2Vec2,this.m_localXAxis1=new box2D.common.math.B2Vec2,this.m_localYAxis1=new box2D.common.math.B2Vec2,this.m_axis=new box2D.common.math.B2Vec2,this.m_perp=new box2D.common.math.B2Vec2,this.m_K=new box2D.common.math.B2Mat33,this.m_impulse=new box2D.common.math.B2Vec3;this.m_localAnchor1.setV(t.localAnchorA),this.m_localAnchor2.setV(t.localAnchorB),this.m_localXAxis1.setV(t.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=t.referenceAngle,this.m_impulse.setZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=box2D.dynamics.joints.B2Joint.e_inactiveLimit,this.m_axis.setZero(),this.m_perp.setZero()},box2D.dynamics.joints.B2PrismaticJoint.__name__=!0,box2D.dynamics.joints.B2PrismaticJoint.__super__=box2D.dynamics.joints.B2Joint,box2D.dynamics.joints.B2PrismaticJoint.prototype=$extend(box2D.dynamics.joints.B2Joint.prototype,{getAnchorA:function(){return this.m_bodyA.getWorldPoint(this.m_localAnchor1)},getAnchorB:function(){return this.m_bodyB.getWorldPoint(this.m_localAnchor2)},getReactionForce:function(t){return new box2D.common.math.B2Vec2(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},getReactionTorque:function(t){return t*this.m_impulse.y},getJointTranslation:function(){var t=this.m_bodyA,o=this.m_bodyB,i=t.getWorldPoint(this.m_localAnchor1),s=o.getWorldPoint(this.m_localAnchor2),n=s.x-i.x,e=s.y-i.y,m=t.getWorldVector(this.m_localXAxis1),a=m.x*n+m.y*e;return a},getJointSpeed:function(){var t,o=this.m_bodyA,i=this.m_bodyB;t=o.m_xf.R;var s=this.m_localAnchor1.x-o.m_sweep.localCenter.x,n=this.m_localAnchor1.y-o.m_sweep.localCenter.y,e=t.col1.x*s+t.col2.x*n;n=t.col1.y*s+t.col2.y*n,s=e,t=i.m_xf.R;var m=this.m_localAnchor2.x-i.m_sweep.localCenter.x,a=this.m_localAnchor2.y-i.m_sweep.localCenter.y;e=t.col1.x*m+t.col2.x*a,a=t.col1.y*m+t.col2.y*a,m=e;var c=o.m_sweep.c.x+s,l=o.m_sweep.c.y+n,r=i.m_sweep.c.x+m,_=i.m_sweep.c.y+a,h=r-c,x=_-l,y=o.getWorldVector(this.m_localXAxis1),u=o.m_linearVelocity,p=i.m_linearVelocity,d=o.m_angularVelocity,B=i.m_angularVelocity,b=h*-d*y.y+x*d*y.x+(y.x*(p.x+-B*a-u.x- -d*n)+y.y*(p.y+B*m-u.y-d*s));return b},isLimitEnabled:function(){return this.m_enableLimit},enableLimit:function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=t},getLowerLimit:function(){return this.m_lowerTranslation},getUpperLimit:function(){return this.m_upperTranslation},setLimits:function(t,o){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=o},isMotorEnabled:function(){return this.m_enableMotor},enableMotor:function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t},setMotorSpeed:function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t},getMotorSpeed:function(){return this.m_motorSpeed},setMaxMotorForce:function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorForce=t},getMotorForce:function(){return this.m_motorImpulse},initVelocityConstraints:function(t){var o,i,s=this.m_bodyA,n=this.m_bodyB;this.m_localCenterA.setV(s.getLocalCenter()),this.m_localCenterB.setV(n.getLocalCenter());{var e=s.getTransform();n.getTransform()}o=s.m_xf.R;var m=this.m_localAnchor1.x-this.m_localCenterA.x,a=this.m_localAnchor1.y-this.m_localCenterA.y;i=o.col1.x*m+o.col2.x*a,a=o.col1.y*m+o.col2.y*a,m=i,o=n.m_xf.R;var c=this.m_localAnchor2.x-this.m_localCenterB.x,l=this.m_localAnchor2.y-this.m_localCenterB.y;i=o.col1.x*c+o.col2.x*l,l=o.col1.y*c+o.col2.y*l,c=i;var r=n.m_sweep.c.x+c-s.m_sweep.c.x-m,_=n.m_sweep.c.y+l-s.m_sweep.c.y-a;this.m_invMassA=s.m_invMass,this.m_invMassB=n.m_invMass,this.m_invIA=s.m_invI,this.m_invIB=n.m_invI,this.m_axis.setV(box2D.common.math.B2Math.mulMV(e.R,this.m_localXAxis1)),this.m_a1=(r+m)*this.m_axis.y-(_+a)*this.m_axis.x,this.m_a2=c*this.m_axis.y-l*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass>2.2250738585072014e-308&&(this.m_motorMass=1/this.m_motorMass),this.m_perp.setV(box2D.common.math.B2Math.mulMV(e.R,this.m_localYAxis1)),this.m_s1=(r+m)*this.m_perp.y-(_+a)*this.m_perp.x,this.m_s2=c*this.m_perp.y-l*this.m_perp.x;var h=this.m_invMassA,x=this.m_invMassB,y=this.m_invIA,u=this.m_invIB;if(this.m_K.col1.x=h+x+y*this.m_s1*this.m_s1+u*this.m_s2*this.m_s2,this.m_K.col1.y=y*this.m_s1+u*this.m_s2,this.m_K.col1.z=y*this.m_s1*this.m_a1+u*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=y+u,this.m_K.col2.z=y*this.m_a1+u*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=h+x+y*this.m_a1*this.m_a1+u*this.m_a2*this.m_a2,this.m_enableLimit){var p=this.m_axis.x*r+this.m_axis.y*_;box2D.common.math.B2Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*box2D.common.B2Settings.b2_linearSlop?this.m_limitState=box2D.dynamics.joints.B2Joint.e_equalLimits:p<=this.m_lowerTranslation?this.m_limitState!=box2D.dynamics.joints.B2Joint.e_atLowerLimit&&(this.m_limitState=box2D.dynamics.joints.B2Joint.e_atLowerLimit,this.m_impulse.z=0):p>=this.m_upperTranslation?this.m_limitState!=box2D.dynamics.joints.B2Joint.e_atUpperLimit&&(this.m_limitState=box2D.dynamics.joints.B2Joint.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=box2D.dynamics.joints.B2Joint.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=box2D.dynamics.joints.B2Joint.e_inactiveLimit;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),t.warmStarting){this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_motorImpulse*=t.dtRatio;var d=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,B=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,b=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,D=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;s.m_linearVelocity.x-=this.m_invMassA*d,s.m_linearVelocity.y-=this.m_invMassA*B,s.m_angularVelocity-=this.m_invIA*b,n.m_linearVelocity.x+=this.m_invMassB*d,n.m_linearVelocity.y+=this.m_invMassB*B,n.m_angularVelocity+=this.m_invIB*D}else this.m_impulse.setZero(),this.m_motorImpulse=0},solveVelocityConstraints:function(t){var o,i,s,n,e=this.m_bodyA,m=this.m_bodyB,a=e.m_linearVelocity,c=e.m_angularVelocity,l=m.m_linearVelocity,r=m.m_angularVelocity;if(this.m_enableMotor&&this.m_limitState!=box2D.dynamics.joints.B2Joint.e_equalLimits){var _=this.m_axis.x*(l.x-a.x)+this.m_axis.y*(l.y-a.y)+this.m_a2*r-this.m_a1*c,h=this.m_motorMass*(this.m_motorSpeed-_),x=this.m_motorImpulse,y=t.dt*this.m_maxMotorForce;this.m_motorImpulse=box2D.common.math.B2Math.clamp(this.m_motorImpulse+h,-y,y),h=this.m_motorImpulse-x,o=h*this.m_axis.x,i=h*this.m_axis.y,s=h*this.m_a1,n=h*this.m_a2,a.x-=this.m_invMassA*o,a.y-=this.m_invMassA*i,c-=this.m_invIA*s,l.x+=this.m_invMassB*o,l.y+=this.m_invMassB*i,r+=this.m_invIB*n}var u=this.m_perp.x*(l.x-a.x)+this.m_perp.y*(l.y-a.y)+this.m_s2*r-this.m_s1*c,p=r-c;if(this.m_enableLimit&&this.m_limitState!=box2D.dynamics.joints.B2Joint.e_inactiveLimit){var d=this.m_axis.x*(l.x-a.x)+this.m_axis.y*(l.y-a.y)+this.m_a2*r-this.m_a1*c,B=this.m_impulse.copy(),b=this.m_K.solve33(new box2D.common.math.B2Vec3,-u,-p,-d);this.m_impulse.add(b),this.m_limitState==box2D.dynamics.joints.B2Joint.e_atLowerLimit?this.m_impulse.z=box2D.common.math.B2Math.max(this.m_impulse.z,0):this.m_limitState==box2D.dynamics.joints.B2Joint.e_atUpperLimit&&(this.m_impulse.z=box2D.common.math.B2Math.min(this.m_impulse.z,0));var D=-u-(this.m_impulse.z-B.z)*this.m_K.col3.x,f=-p-(this.m_impulse.z-B.z)*this.m_K.col3.y,g=this.m_K.solve22(new box2D.common.math.B2Vec2,D,f);g.x+=B.x,g.y+=B.y,this.m_impulse.x=g.x,this.m_impulse.y=g.y,b.x=this.m_impulse.x-B.x,b.y=this.m_impulse.y-B.y,b.z=this.m_impulse.z-B.z,o=b.x*this.m_perp.x+b.z*this.m_axis.x,i=b.x*this.m_perp.y+b.z*this.m_axis.y,s=b.x*this.m_s1+b.y+b.z*this.m_a1,n=b.x*this.m_s2+b.y+b.z*this.m_a2,a.x-=this.m_invMassA*o,a.y-=this.m_invMassA*i,c-=this.m_invIA*s,l.x+=this.m_invMassB*o,l.y+=this.m_invMassB*i,r+=this.m_invIB*n}else{var v=this.m_K.solve22(new box2D.common.math.B2Vec2,-u,-p);this.m_impulse.x+=v.x,this.m_impulse.y+=v.y,o=v.x*this.m_perp.x,i=v.x*this.m_perp.y,s=v.x*this.m_s1+v.y,n=v.x*this.m_s2+v.y,a.x-=this.m_invMassA*o,a.y-=this.m_invMassA*i,c-=this.m_invIA*s,l.x+=this.m_invMassB*o,l.y+=this.m_invMassB*i,r+=this.m_invIB*n}e.m_linearVelocity.setV(a),e.m_angularVelocity=c,m.m_linearVelocity.setV(l),m.m_angularVelocity=r},solvePositionConstraints:function(){var t,o,i,s,n,e,m=this.m_bodyA,a=this.m_bodyB,c=m.m_sweep.c,l=m.m_sweep.a,r=a.m_sweep.c,_=a.m_sweep.a,h=0,x=0,y=!1,u=0,p=box2D.common.math.B2Mat22.fromAngle(l),d=box2D.common.math.B2Mat22.fromAngle(_);t=p;var B=this.m_localAnchor1.x-this.m_localCenterA.x,b=this.m_localAnchor1.y-this.m_localCenterA.y;o=t.col1.x*B+t.col2.x*b,b=t.col1.y*B+t.col2.y*b,B=o,t=d;var D=this.m_localAnchor2.x-this.m_localCenterB.x,f=this.m_localAnchor2.y-this.m_localCenterB.y;o=t.col1.x*D+t.col2.x*f,f=t.col1.y*D+t.col2.y*f,D=o;var g=r.x+D-c.x-B,v=r.y+f-c.y-b;if(this.m_enableLimit){this.m_axis=box2D.common.math.B2Math.mulMV(p,this.m_localXAxis1),this.m_a1=(g+B)*this.m_axis.y-(v+b)*this.m_axis.x,this.m_a2=D*this.m_axis.y-f*this.m_axis.x;var A=this.m_axis.x*g+this.m_axis.y*v;box2D.common.math.B2Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*box2D.common.B2Settings.b2_linearSlop?(u=box2D.common.math.B2Math.clamp(A,-box2D.common.B2Settings.b2_maxLinearCorrection,box2D.common.B2Settings.b2_maxLinearCorrection),h=box2D.common.math.B2Math.abs(A),y=!0):A<=this.m_lowerTranslation?(u=box2D.common.math.B2Math.clamp(A-this.m_lowerTranslation+box2D.common.B2Settings.b2_linearSlop,-box2D.common.B2Settings.b2_maxLinearCorrection,0),h=this.m_lowerTranslation-A,y=!0):A>=this.m_upperTranslation&&(u=box2D.common.math.B2Math.clamp(A-this.m_upperTranslation+box2D.common.B2Settings.b2_linearSlop,0,box2D.common.B2Settings.b2_maxLinearCorrection),h=A-this.m_upperTranslation,y=!0)}this.m_perp=box2D.common.math.B2Math.mulMV(p,this.m_localYAxis1),this.m_s1=(g+B)*this.m_perp.y-(v+b)*this.m_perp.x,this.m_s2=D*this.m_perp.y-f*this.m_perp.x;var w=new box2D.common.math.B2Vec3,V=this.m_perp.x*g+this.m_perp.y*v,C=_-l-this.m_refAngle;
if(h=box2D.common.math.B2Math.max(h,box2D.common.math.B2Math.abs(V)),x=box2D.common.math.B2Math.abs(C),y)i=this.m_invMassA,s=this.m_invMassB,n=this.m_invIA,e=this.m_invIB,this.m_K.col1.x=i+s+n*this.m_s1*this.m_s1+e*this.m_s2*this.m_s2,this.m_K.col1.y=n*this.m_s1+e*this.m_s2,this.m_K.col1.z=n*this.m_s1*this.m_a1+e*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=n+e,this.m_K.col2.z=n*this.m_a1+e*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=i+s+n*this.m_a1*this.m_a1+e*this.m_a2*this.m_a2,this.m_K.solve33(w,-V,-C,-u);else{i=this.m_invMassA,s=this.m_invMassB,n=this.m_invIA,e=this.m_invIB;var M=i+s+n*this.m_s1*this.m_s1+e*this.m_s2*this.m_s2,S=n*this.m_s1+e*this.m_s2,I=n+e;this.m_K.col1.set(M,S,0),this.m_K.col2.set(S,I,0);var j=this.m_K.solve22(new box2D.common.math.B2Vec2,-V,-C);w.x=j.x,w.y=j.y,w.z=0}var L=w.x*this.m_perp.x+w.z*this.m_axis.x,P=w.x*this.m_perp.y+w.z*this.m_axis.y,J=w.x*this.m_s1+w.y+w.z*this.m_a1,F=w.x*this.m_s2+w.y+w.z*this.m_a2;return c.x-=this.m_invMassA*L,c.y-=this.m_invMassA*P,l-=this.m_invIA*J,r.x+=this.m_invMassB*L,r.y+=this.m_invMassB*P,_+=this.m_invIB*F,m.m_sweep.a=l,a.m_sweep.a=_,m.synchronizeTransform(),a.synchronizeTransform(),h<=box2D.common.B2Settings.b2_linearSlop&&x<=box2D.common.B2Settings.b2_angularSlop},__class__:box2D.dynamics.joints.B2PrismaticJoint}),box2D.dynamics.joints.B2PrismaticJointDef=function(){box2D.dynamics.joints.B2JointDef.call(this),this.localAnchorA=new box2D.common.math.B2Vec2,this.localAnchorB=new box2D.common.math.B2Vec2,this.localAxisA=new box2D.common.math.B2Vec2,this.type=box2D.dynamics.joints.B2Joint.e_prismaticJoint,this.localAxisA.set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},box2D.dynamics.joints.B2PrismaticJointDef.__name__=!0,box2D.dynamics.joints.B2PrismaticJointDef.__super__=box2D.dynamics.joints.B2JointDef,box2D.dynamics.joints.B2PrismaticJointDef.prototype=$extend(box2D.dynamics.joints.B2JointDef.prototype,{initialize:function(t,o,i,s){this.bodyA=t,this.bodyB=o,this.localAnchorA=this.bodyA.getLocalPoint(i),this.localAnchorB=this.bodyB.getLocalPoint(i),this.localAxisA=this.bodyA.getLocalVector(s),this.referenceAngle=this.bodyB.getAngle()-this.bodyA.getAngle()},__class__:box2D.dynamics.joints.B2PrismaticJointDef}),box2D.dynamics.joints.B2PulleyJoint=function(t){box2D.dynamics.joints.B2Joint.call(this,t),this.m_groundAnchor1=new box2D.common.math.B2Vec2,this.m_groundAnchor2=new box2D.common.math.B2Vec2,this.m_localAnchor1=new box2D.common.math.B2Vec2,this.m_localAnchor2=new box2D.common.math.B2Vec2,this.m_u1=new box2D.common.math.B2Vec2,this.m_u2=new box2D.common.math.B2Vec2;this.m_ground=this.m_bodyA.m_world.m_groundBody,this.m_groundAnchor1.x=t.groundAnchorA.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=t.groundAnchorA.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=t.groundAnchorB.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=t.groundAnchorB.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.setV(t.localAnchorA),this.m_localAnchor2.setV(t.localAnchorB),this.m_ratio=t.ratio,this.m_constant=t.lengthA+this.m_ratio*t.lengthB,this.m_maxLength1=box2D.common.math.B2Math.min(t.maxLengthA,this.m_constant-this.m_ratio*box2D.dynamics.joints.B2PulleyJoint.b2_minPulleyLength),this.m_maxLength2=box2D.common.math.B2Math.min(t.maxLengthB,(this.m_constant-box2D.dynamics.joints.B2PulleyJoint.b2_minPulleyLength)/this.m_ratio),this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},box2D.dynamics.joints.B2PulleyJoint.__name__=!0,box2D.dynamics.joints.B2PulleyJoint.__super__=box2D.dynamics.joints.B2Joint,box2D.dynamics.joints.B2PulleyJoint.prototype=$extend(box2D.dynamics.joints.B2Joint.prototype,{getAnchorA:function(){return this.m_bodyA.getWorldPoint(this.m_localAnchor1)},getAnchorB:function(){return this.m_bodyB.getWorldPoint(this.m_localAnchor2)},getReactionForce:function(t){return new box2D.common.math.B2Vec2(t*this.m_impulse*this.m_u2.x,t*this.m_impulse*this.m_u2.y)},getReactionTorque:function(){return 0},getGroundAnchorA:function(){var t=this.m_ground.m_xf.position.copy();return t.add(this.m_groundAnchor1),t},getGroundAnchorB:function(){var t=this.m_ground.m_xf.position.copy();return t.add(this.m_groundAnchor2),t},getLength1:function(){var t=this.m_bodyA.getWorldPoint(this.m_localAnchor1),o=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,i=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,s=t.x-o,n=t.y-i;return Math.sqrt(s*s+n*n)},getLength2:function(){var t=this.m_bodyB.getWorldPoint(this.m_localAnchor2),o=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,i=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,s=t.x-o,n=t.y-i;return Math.sqrt(s*s+n*n)},getRatio:function(){return this.m_ratio},initVelocityConstraints:function(t){var o,i=this.m_bodyA,s=this.m_bodyB;o=i.m_xf.R;var n=this.m_localAnchor1.x-i.m_sweep.localCenter.x,e=this.m_localAnchor1.y-i.m_sweep.localCenter.y,m=o.col1.x*n+o.col2.x*e;e=o.col1.y*n+o.col2.y*e,n=m,o=s.m_xf.R;var a=this.m_localAnchor2.x-s.m_sweep.localCenter.x,c=this.m_localAnchor2.y-s.m_sweep.localCenter.y;m=o.col1.x*a+o.col2.x*c,c=o.col1.y*a+o.col2.y*c,a=m;var l=i.m_sweep.c.x+n,r=i.m_sweep.c.y+e,_=s.m_sweep.c.x+a,h=s.m_sweep.c.y+c,x=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,y=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,u=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,p=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.set(l-x,r-y),this.m_u2.set(_-u,h-p);var d=this.m_u1.length(),B=this.m_u2.length();d>box2D.common.B2Settings.b2_linearSlop?this.m_u1.multiply(1/d):this.m_u1.setZero(),B>box2D.common.B2Settings.b2_linearSlop?this.m_u2.multiply(1/B):this.m_u2.setZero();var b=this.m_constant-d-this.m_ratio*B;b>0?(this.m_state=box2D.dynamics.joints.B2Joint.e_inactiveLimit,this.m_impulse=0):this.m_state=box2D.dynamics.joints.B2Joint.e_atUpperLimit,d<this.m_maxLength1?(this.m_limitState1=box2D.dynamics.joints.B2Joint.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=box2D.dynamics.joints.B2Joint.e_atUpperLimit,B<this.m_maxLength2?(this.m_limitState2=box2D.dynamics.joints.B2Joint.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=box2D.dynamics.joints.B2Joint.e_atUpperLimit;var D=n*this.m_u1.y-e*this.m_u1.x,f=a*this.m_u2.y-c*this.m_u2.x;if(this.m_limitMass1=i.m_invMass+i.m_invI*D*D,this.m_limitMass2=s.m_invMass+s.m_invI*f*f,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass,t.warmStarting){this.m_impulse*=t.dtRatio,this.m_limitImpulse1*=t.dtRatio,this.m_limitImpulse2*=t.dtRatio;var g=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,v=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,A=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,w=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y;i.m_linearVelocity.x+=i.m_invMass*g,i.m_linearVelocity.y+=i.m_invMass*v,i.m_angularVelocity+=i.m_invI*(n*v-e*g),s.m_linearVelocity.x+=s.m_invMass*A,s.m_linearVelocity.y+=s.m_invMass*w,s.m_angularVelocity+=s.m_invI*(a*w-c*A)}else this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},solveVelocityConstraints:function(){var t,o=this.m_bodyA,i=this.m_bodyB;t=o.m_xf.R;var s=this.m_localAnchor1.x-o.m_sweep.localCenter.x,n=this.m_localAnchor1.y-o.m_sweep.localCenter.y,e=t.col1.x*s+t.col2.x*n;n=t.col1.y*s+t.col2.y*n,s=e,t=i.m_xf.R;var m=this.m_localAnchor2.x-i.m_sweep.localCenter.x,a=this.m_localAnchor2.y-i.m_sweep.localCenter.y;e=t.col1.x*m+t.col2.x*a,a=t.col1.y*m+t.col2.y*a,m=e;var c,l,r,_,h,x,y,u,p,d,B;this.m_state==box2D.dynamics.joints.B2Joint.e_atUpperLimit&&(c=o.m_linearVelocity.x+-o.m_angularVelocity*n,l=o.m_linearVelocity.y+o.m_angularVelocity*s,r=i.m_linearVelocity.x+-i.m_angularVelocity*a,_=i.m_linearVelocity.y+i.m_angularVelocity*m,p=-(this.m_u1.x*c+this.m_u1.y*l)-this.m_ratio*(this.m_u2.x*r+this.m_u2.y*_),d=this.m_pulleyMass*-p,B=this.m_impulse,this.m_impulse=box2D.common.math.B2Math.max(0,this.m_impulse+d),d=this.m_impulse-B,h=-d*this.m_u1.x,x=-d*this.m_u1.y,y=-this.m_ratio*d*this.m_u2.x,u=-this.m_ratio*d*this.m_u2.y,o.m_linearVelocity.x+=o.m_invMass*h,o.m_linearVelocity.y+=o.m_invMass*x,o.m_angularVelocity+=o.m_invI*(s*x-n*h),i.m_linearVelocity.x+=i.m_invMass*y,i.m_linearVelocity.y+=i.m_invMass*u,i.m_angularVelocity+=i.m_invI*(m*u-a*y)),this.m_limitState1==box2D.dynamics.joints.B2Joint.e_atUpperLimit&&(c=o.m_linearVelocity.x+-o.m_angularVelocity*n,l=o.m_linearVelocity.y+o.m_angularVelocity*s,p=-(this.m_u1.x*c+this.m_u1.y*l),d=-this.m_limitMass1*p,B=this.m_limitImpulse1,this.m_limitImpulse1=box2D.common.math.B2Math.max(0,this.m_limitImpulse1+d),d=this.m_limitImpulse1-B,h=-d*this.m_u1.x,x=-d*this.m_u1.y,o.m_linearVelocity.x+=o.m_invMass*h,o.m_linearVelocity.y+=o.m_invMass*x,o.m_angularVelocity+=o.m_invI*(s*x-n*h)),this.m_limitState2==box2D.dynamics.joints.B2Joint.e_atUpperLimit&&(r=i.m_linearVelocity.x+-i.m_angularVelocity*a,_=i.m_linearVelocity.y+i.m_angularVelocity*m,p=-(this.m_u2.x*r+this.m_u2.y*_),d=-this.m_limitMass2*p,B=this.m_limitImpulse2,this.m_limitImpulse2=box2D.common.math.B2Math.max(0,this.m_limitImpulse2+d),d=this.m_limitImpulse2-B,y=-d*this.m_u2.x,u=-d*this.m_u2.y,i.m_linearVelocity.x+=i.m_invMass*y,i.m_linearVelocity.y+=i.m_invMass*u,i.m_angularVelocity+=i.m_invI*(m*u-a*y))},solvePositionConstraints:function(){var t,o,i,s,n,e,m,a,c,l,r,_,h,x,y=this.m_bodyA,u=this.m_bodyB,p=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,d=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,B=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,b=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,D=0;return this.m_state==box2D.dynamics.joints.B2Joint.e_atUpperLimit&&(t=y.m_xf.R,o=this.m_localAnchor1.x-y.m_sweep.localCenter.x,i=this.m_localAnchor1.y-y.m_sweep.localCenter.y,x=t.col1.x*o+t.col2.x*i,i=t.col1.y*o+t.col2.y*i,o=x,t=u.m_xf.R,s=this.m_localAnchor2.x-u.m_sweep.localCenter.x,n=this.m_localAnchor2.y-u.m_sweep.localCenter.y,x=t.col1.x*s+t.col2.x*n,n=t.col1.y*s+t.col2.y*n,s=x,e=y.m_sweep.c.x+o,m=y.m_sweep.c.y+i,a=u.m_sweep.c.x+s,c=u.m_sweep.c.y+n,this.m_u1.set(e-p,m-d),this.m_u2.set(a-B,c-b),l=this.m_u1.length(),r=this.m_u2.length(),l>box2D.common.B2Settings.b2_linearSlop?this.m_u1.multiply(1/l):this.m_u1.setZero(),r>box2D.common.B2Settings.b2_linearSlop?this.m_u2.multiply(1/r):this.m_u2.setZero(),_=this.m_constant-l-this.m_ratio*r,D=box2D.common.math.B2Math.max(D,-_),_=box2D.common.math.B2Math.clamp(_+box2D.common.B2Settings.b2_linearSlop,-box2D.common.B2Settings.b2_maxLinearCorrection,0),h=-this.m_pulleyMass*_,e=-h*this.m_u1.x,m=-h*this.m_u1.y,a=-this.m_ratio*h*this.m_u2.x,c=-this.m_ratio*h*this.m_u2.y,y.m_sweep.c.x+=y.m_invMass*e,y.m_sweep.c.y+=y.m_invMass*m,y.m_sweep.a+=y.m_invI*(o*m-i*e),u.m_sweep.c.x+=u.m_invMass*a,u.m_sweep.c.y+=u.m_invMass*c,u.m_sweep.a+=u.m_invI*(s*c-n*a),y.synchronizeTransform(),u.synchronizeTransform()),this.m_limitState1==box2D.dynamics.joints.B2Joint.e_atUpperLimit&&(t=y.m_xf.R,o=this.m_localAnchor1.x-y.m_sweep.localCenter.x,i=this.m_localAnchor1.y-y.m_sweep.localCenter.y,x=t.col1.x*o+t.col2.x*i,i=t.col1.y*o+t.col2.y*i,o=x,e=y.m_sweep.c.x+o,m=y.m_sweep.c.y+i,this.m_u1.set(e-p,m-d),l=this.m_u1.length(),l>box2D.common.B2Settings.b2_linearSlop?(this.m_u1.x*=1/l,this.m_u1.y*=1/l):this.m_u1.setZero(),_=this.m_maxLength1-l,D=box2D.common.math.B2Math.max(D,-_),_=box2D.common.math.B2Math.clamp(_+box2D.common.B2Settings.b2_linearSlop,-box2D.common.B2Settings.b2_maxLinearCorrection,0),h=-this.m_limitMass1*_,e=-h*this.m_u1.x,m=-h*this.m_u1.y,y.m_sweep.c.x+=y.m_invMass*e,y.m_sweep.c.y+=y.m_invMass*m,y.m_sweep.a+=y.m_invI*(o*m-i*e),y.synchronizeTransform()),this.m_limitState2==box2D.dynamics.joints.B2Joint.e_atUpperLimit&&(t=u.m_xf.R,s=this.m_localAnchor2.x-u.m_sweep.localCenter.x,n=this.m_localAnchor2.y-u.m_sweep.localCenter.y,x=t.col1.x*s+t.col2.x*n,n=t.col1.y*s+t.col2.y*n,s=x,a=u.m_sweep.c.x+s,c=u.m_sweep.c.y+n,this.m_u2.set(a-B,c-b),r=this.m_u2.length(),r>box2D.common.B2Settings.b2_linearSlop?(this.m_u2.x*=1/r,this.m_u2.y*=1/r):this.m_u2.setZero(),_=this.m_maxLength2-r,D=box2D.common.math.B2Math.max(D,-_),_=box2D.common.math.B2Math.clamp(_+box2D.common.B2Settings.b2_linearSlop,-box2D.common.B2Settings.b2_maxLinearCorrection,0),h=-this.m_limitMass2*_,a=-h*this.m_u2.x,c=-h*this.m_u2.y,u.m_sweep.c.x+=u.m_invMass*a,u.m_sweep.c.y+=u.m_invMass*c,u.m_sweep.a+=u.m_invI*(s*c-n*a),u.synchronizeTransform()),D<box2D.common.B2Settings.b2_linearSlop},__class__:box2D.dynamics.joints.B2PulleyJoint}),box2D.dynamics.joints.B2PulleyJointDef=function(){box2D.dynamics.joints.B2JointDef.call(this),this.groundAnchorA=new box2D.common.math.B2Vec2,this.groundAnchorB=new box2D.common.math.B2Vec2,this.localAnchorA=new box2D.common.math.B2Vec2,this.localAnchorB=new box2D.common.math.B2Vec2,this.type=box2D.dynamics.joints.B2Joint.e_pulleyJoint,this.groundAnchorA.set(-1,1),this.groundAnchorB.set(1,1),this.localAnchorA.set(-1,0),this.localAnchorB.set(1,0),this.lengthA=0,this.maxLengthA=0,this.lengthB=0,this.maxLengthB=0,this.ratio=1,this.collideConnected=!0},box2D.dynamics.joints.B2PulleyJointDef.__name__=!0,box2D.dynamics.joints.B2PulleyJointDef.__super__=box2D.dynamics.joints.B2JointDef,box2D.dynamics.joints.B2PulleyJointDef.prototype=$extend(box2D.dynamics.joints.B2JointDef.prototype,{initialize:function(t,o,i,s,n,e,m){this.bodyA=t,this.bodyB=o,this.groundAnchorA.setV(i),this.groundAnchorB.setV(s),this.localAnchorA=this.bodyA.getLocalPoint(n),this.localAnchorB=this.bodyB.getLocalPoint(e);var a=n.x-i.x,c=n.y-i.y;this.lengthA=Math.sqrt(a*a+c*c);var l=e.x-s.x,r=e.y-s.y;this.lengthB=Math.sqrt(l*l+r*r),this.ratio=m;var _=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=_-this.ratio*box2D.dynamics.joints.B2PulleyJoint.b2_minPulleyLength,this.maxLengthB=(_-box2D.dynamics.joints.B2PulleyJoint.b2_minPulleyLength)/this.ratio},__class__:box2D.dynamics.joints.B2PulleyJointDef}),box2D.dynamics.joints.B2RevoluteJoint=function(t){box2D.dynamics.joints.B2Joint.call(this,t),this.K=new box2D.common.math.B2Mat22,this.K1=new box2D.common.math.B2Mat22,this.K2=new box2D.common.math.B2Mat22,this.K3=new box2D.common.math.B2Mat22,this.impulse3=new box2D.common.math.B2Vec3,this.impulse2=new box2D.common.math.B2Vec2,this.reduced=new box2D.common.math.B2Vec2,this.m_localAnchor1=new box2D.common.math.B2Vec2,this.m_localAnchor2=new box2D.common.math.B2Vec2,this.m_impulse=new box2D.common.math.B2Vec3,this.m_mass=new box2D.common.math.B2Mat33,this.m_localAnchor1.setV(t.localAnchorA),this.m_localAnchor2.setV(t.localAnchorB),this.m_referenceAngle=t.referenceAngle,this.m_impulse.setZero(),this.m_motorImpulse=0,this.m_lowerAngle=t.lowerAngle,this.m_upperAngle=t.upperAngle,this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=box2D.dynamics.joints.B2Joint.e_inactiveLimit},box2D.dynamics.joints.B2RevoluteJoint.__name__=!0,box2D.dynamics.joints.B2RevoluteJoint.__super__=box2D.dynamics.joints.B2Joint,box2D.dynamics.joints.B2RevoluteJoint.prototype=$extend(box2D.dynamics.joints.B2Joint.prototype,{getAnchorA:function(){return this.m_bodyA.getWorldPoint(this.m_localAnchor1)},getAnchorB:function(){return this.m_bodyB.getWorldPoint(this.m_localAnchor2)},getReactionForce:function(t){return new box2D.common.math.B2Vec2(t*this.m_impulse.x,t*this.m_impulse.y)},getReactionTorque:function(t){return t*this.m_impulse.z},getJointAngle:function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},getJointSpeed:function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},isLimitEnabled:function(){return this.m_enableLimit},enableLimit:function(t){this.m_enableLimit=t},getLowerLimit:function(){return this.m_lowerAngle},getUpperLimit:function(){return this.m_upperAngle},setLimits:function(t,o){this.m_lowerAngle=t,this.m_upperAngle=o},isMotorEnabled:function(){return this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor},enableMotor:function(t){this.m_enableMotor=t},setMotorSpeed:function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t},getMotorSpeed:function(){return this.m_motorSpeed},setMaxMotorTorque:function(t){this.m_maxMotorTorque=t},getMotorTorque:function(){return this.m_maxMotorTorque},initVelocityConstraints:function(t){var o,i,s=this.m_bodyA,n=this.m_bodyB;this.m_enableMotor||this.m_enableLimit,o=s.m_xf.R;var e=this.m_localAnchor1.x-s.m_sweep.localCenter.x,m=this.m_localAnchor1.y-s.m_sweep.localCenter.y;i=o.col1.x*e+o.col2.x*m,m=o.col1.y*e+o.col2.y*m,e=i,o=n.m_xf.R;var a=this.m_localAnchor2.x-n.m_sweep.localCenter.x,c=this.m_localAnchor2.y-n.m_sweep.localCenter.y;i=o.col1.x*a+o.col2.x*c,c=o.col1.y*a+o.col2.y*c,a=i;var l=s.m_invMass,r=n.m_invMass,_=s.m_invI,h=n.m_invI;if(this.m_mass.col1.x=l+r+m*m*_+c*c*h,this.m_mass.col2.x=-m*e*_-c*a*h,this.m_mass.col3.x=-m*_-c*h,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=l+r+e*e*_+a*a*h,this.m_mass.col3.y=e*_+a*h,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=_+h,this.m_motorMass=1/(_+h),0==this.m_enableMotor&&(this.m_motorImpulse=0),this.m_enableLimit){var x=n.m_sweep.a-s.m_sweep.a-this.m_referenceAngle;box2D.common.math.B2Math.abs(this.m_upperAngle-this.m_lowerAngle)<2*box2D.common.B2Settings.b2_angularSlop?this.m_limitState=box2D.dynamics.joints.B2Joint.e_equalLimits:x<=this.m_lowerAngle?(this.m_limitState!=box2D.dynamics.joints.B2Joint.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=box2D.dynamics.joints.B2Joint.e_atLowerLimit):x>=this.m_upperAngle?(this.m_limitState!=box2D.dynamics.joints.B2Joint.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=box2D.dynamics.joints.B2Joint.e_atUpperLimit):(this.m_limitState=box2D.dynamics.joints.B2Joint.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=box2D.dynamics.joints.B2Joint.e_inactiveLimit;if(t.warmStarting){this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_motorImpulse*=t.dtRatio;var y=this.m_impulse.x,u=this.m_impulse.y;s.m_linearVelocity.x-=l*y,s.m_linearVelocity.y-=l*u,s.m_angularVelocity-=_*(e*u-m*y+this.m_motorImpulse+this.m_impulse.z),n.m_linearVelocity.x+=r*y,n.m_linearVelocity.y+=r*u,n.m_angularVelocity+=h*(a*u-c*y+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.setZero(),this.m_motorImpulse=0},solveVelocityConstraints:function(t){var o,i,s,n,e,m,a,c=this.m_bodyA,l=this.m_bodyB,r=c.m_linearVelocity,_=c.m_angularVelocity,h=l.m_linearVelocity,x=l.m_angularVelocity,y=c.m_invMass,u=l.m_invMass,p=c.m_invI,d=l.m_invI;if(this.m_enableMotor&&this.m_limitState!=box2D.dynamics.joints.B2Joint.e_equalLimits){var B=x-_-this.m_motorSpeed,b=this.m_motorMass*-B,D=this.m_motorImpulse,f=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=box2D.common.math.B2Math.clamp(this.m_motorImpulse+b,-f,f),b=this.m_motorImpulse-D,_-=p*b,x+=d*b}if(this.m_enableLimit&&this.m_limitState!=box2D.dynamics.joints.B2Joint.e_inactiveLimit){o=c.m_xf.R,n=this.m_localAnchor1.x-c.m_sweep.localCenter.x,e=this.m_localAnchor1.y-c.m_sweep.localCenter.y,i=o.col1.x*n+o.col2.x*e,e=o.col1.y*n+o.col2.y*e,n=i,o=l.m_xf.R,m=this.m_localAnchor2.x-l.m_sweep.localCenter.x,a=this.m_localAnchor2.y-l.m_sweep.localCenter.y,i=o.col1.x*m+o.col2.x*a,a=o.col1.y*m+o.col2.y*a,m=i;var g=h.x+-x*a-r.x- -_*e,v=h.y+x*m-r.y-_*n,A=x-_;this.m_mass.solve33(this.impulse3,-g,-v,-A),this.m_limitState==box2D.dynamics.joints.B2Joint.e_equalLimits?this.m_impulse.add(this.impulse3):this.m_limitState==box2D.dynamics.joints.B2Joint.e_atLowerLimit?(s=this.m_impulse.z+this.impulse3.z,0>s&&(this.m_mass.solve22(this.reduced,-g,-v),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)):this.m_limitState==box2D.dynamics.joints.B2Joint.e_atUpperLimit&&(s=this.m_impulse.z+this.impulse3.z,s>0&&(this.m_mass.solve22(this.reduced,-g,-v),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)),r.x-=y*this.impulse3.x,r.y-=y*this.impulse3.y,_-=p*(n*this.impulse3.y-e*this.impulse3.x+this.impulse3.z),h.x+=u*this.impulse3.x,h.y+=u*this.impulse3.y,x+=d*(m*this.impulse3.y-a*this.impulse3.x+this.impulse3.z)}else{o=c.m_xf.R,n=this.m_localAnchor1.x-c.m_sweep.localCenter.x,e=this.m_localAnchor1.y-c.m_sweep.localCenter.y,i=o.col1.x*n+o.col2.x*e,e=o.col1.y*n+o.col2.y*e,n=i,o=l.m_xf.R,m=this.m_localAnchor2.x-l.m_sweep.localCenter.x,a=this.m_localAnchor2.y-l.m_sweep.localCenter.y,i=o.col1.x*m+o.col2.x*a,a=o.col1.y*m+o.col2.y*a,m=i;var w=h.x+-x*a-r.x- -_*e,V=h.y+x*m-r.y-_*n;this.m_mass.solve22(this.impulse2,-w,-V),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,r.x-=y*this.impulse2.x,r.y-=y*this.impulse2.y,_-=p*(n*this.impulse2.y-e*this.impulse2.x),h.x+=u*this.impulse2.x,h.y+=u*this.impulse2.y,x+=d*(m*this.impulse2.y-a*this.impulse2.x)}c.m_linearVelocity.setV(r),c.m_angularVelocity=_,l.m_linearVelocity.setV(h),l.m_angularVelocity=x},solvePositionConstraints:function(){var t,o,i,s,n,e=this.m_bodyA,m=this.m_bodyB,a=0,c=0;if(this.m_enableLimit&&this.m_limitState!=box2D.dynamics.joints.B2Joint.e_inactiveLimit){var l=m.m_sweep.a-e.m_sweep.a-this.m_referenceAngle,r=0;this.m_limitState==box2D.dynamics.joints.B2Joint.e_equalLimits?(t=box2D.common.math.B2Math.clamp(l-this.m_lowerAngle,-box2D.common.B2Settings.b2_maxAngularCorrection,box2D.common.B2Settings.b2_maxAngularCorrection),r=-this.m_motorMass*t,a=box2D.common.math.B2Math.abs(t)):this.m_limitState==box2D.dynamics.joints.B2Joint.e_atLowerLimit?(t=l-this.m_lowerAngle,a=-t,t=box2D.common.math.B2Math.clamp(t+box2D.common.B2Settings.b2_angularSlop,-box2D.common.B2Settings.b2_maxAngularCorrection,0),r=-this.m_motorMass*t):this.m_limitState==box2D.dynamics.joints.B2Joint.e_atUpperLimit&&(t=l-this.m_upperAngle,a=t,t=box2D.common.math.B2Math.clamp(t-box2D.common.B2Settings.b2_angularSlop,0,box2D.common.B2Settings.b2_maxAngularCorrection),r=-this.m_motorMass*t),e.m_sweep.a-=e.m_invI*r,m.m_sweep.a+=m.m_invI*r,e.synchronizeTransform(),m.synchronizeTransform()}o=e.m_xf.R;var _=this.m_localAnchor1.x-e.m_sweep.localCenter.x,h=this.m_localAnchor1.y-e.m_sweep.localCenter.y;i=o.col1.x*_+o.col2.x*h,h=o.col1.y*_+o.col2.y*h,_=i,o=m.m_xf.R;var x=this.m_localAnchor2.x-m.m_sweep.localCenter.x,y=this.m_localAnchor2.y-m.m_sweep.localCenter.y;i=o.col1.x*x+o.col2.x*y,y=o.col1.y*x+o.col2.y*y,x=i;var u=m.m_sweep.c.x+x-e.m_sweep.c.x-_,p=m.m_sweep.c.y+y-e.m_sweep.c.y-h,d=u*u+p*p,B=Math.sqrt(d);c=B;var b=e.m_invMass,D=m.m_invMass,f=e.m_invI,g=m.m_invI,v=10*box2D.common.B2Settings.b2_linearSlop;if(d>v*v){var A=b+D,w=1/A;s=w*-u,n=w*-p;var V=.5;e.m_sweep.c.x-=V*b*s,e.m_sweep.c.y-=V*b*n,m.m_sweep.c.x+=V*D*s,m.m_sweep.c.y+=V*D*n,u=m.m_sweep.c.x+x-e.m_sweep.c.x-_,p=m.m_sweep.c.y+y-e.m_sweep.c.y-h}return this.K1.col1.x=b+D,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=b+D,this.K2.col1.x=f*h*h,this.K2.col2.x=-f*_*h,this.K2.col1.y=-f*_*h,this.K2.col2.y=f*_*_,this.K3.col1.x=g*y*y,this.K3.col2.x=-g*x*y,this.K3.col1.y=-g*x*y,this.K3.col2.y=g*x*x,this.K.setM(this.K1),this.K.addM(this.K2),this.K.addM(this.K3),this.K.solve(box2D.dynamics.joints.B2RevoluteJoint.tImpulse,-u,-p),s=box2D.dynamics.joints.B2RevoluteJoint.tImpulse.x,n=box2D.dynamics.joints.B2RevoluteJoint.tImpulse.y,e.m_sweep.c.x-=e.m_invMass*s,e.m_sweep.c.y-=e.m_invMass*n,e.m_sweep.a-=e.m_invI*(_*n-h*s),m.m_sweep.c.x+=m.m_invMass*s,m.m_sweep.c.y+=m.m_invMass*n,m.m_sweep.a+=m.m_invI*(x*n-y*s),e.synchronizeTransform(),m.synchronizeTransform(),c<=box2D.common.B2Settings.b2_linearSlop&&a<=box2D.common.B2Settings.b2_angularSlop},__class__:box2D.dynamics.joints.B2RevoluteJoint}),box2D.dynamics.joints.B2RevoluteJointDef=function(){box2D.dynamics.joints.B2JointDef.call(this),this.localAnchorA=new box2D.common.math.B2Vec2,this.localAnchorB=new box2D.common.math.B2Vec2,this.type=box2D.dynamics.joints.B2Joint.e_revoluteJoint,this.localAnchorA.set(0,0),this.localAnchorB.set(0,0),this.referenceAngle=0,this.lowerAngle=0,this.upperAngle=0,this.maxMotorTorque=0,this.motorSpeed=0,this.enableLimit=!1,this.enableMotor=!1},box2D.dynamics.joints.B2RevoluteJointDef.__name__=!0,box2D.dynamics.joints.B2RevoluteJointDef.__super__=box2D.dynamics.joints.B2JointDef,box2D.dynamics.joints.B2RevoluteJointDef.prototype=$extend(box2D.dynamics.joints.B2JointDef.prototype,{initialize:function(t,o,i){this.bodyA=t,this.bodyB=o,this.localAnchorA=this.bodyA.getLocalPoint(i),this.localAnchorB=this.bodyB.getLocalPoint(i),this.referenceAngle=this.bodyB.getAngle()-this.bodyA.getAngle()},__class__:box2D.dynamics.joints.B2RevoluteJointDef}),box2D.dynamics.joints.B2WeldJoint=function(t){box2D.dynamics.joints.B2Joint.call(this,t),this.m_localAnchorA=new box2D.common.math.B2Vec2,this.m_localAnchorB=new box2D.common.math.B2Vec2,this.m_impulse=new box2D.common.math.B2Vec3,this.m_mass=new box2D.common.math.B2Mat33,this.m_localAnchorA.setV(t.localAnchorA),this.m_localAnchorB.setV(t.localAnchorB),this.m_referenceAngle=t.referenceAngle,this.m_impulse.setZero(),this.m_mass=new box2D.common.math.B2Mat33},box2D.dynamics.joints.B2WeldJoint.__name__=!0,box2D.dynamics.joints.B2WeldJoint.__super__=box2D.dynamics.joints.B2Joint,box2D.dynamics.joints.B2WeldJoint.prototype=$extend(box2D.dynamics.joints.B2Joint.prototype,{getAnchorA:function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},getAnchorB:function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},getReactionForce:function(t){return new box2D.common.math.B2Vec2(t*this.m_impulse.x,t*this.m_impulse.y)},getReactionTorque:function(t){return t*this.m_impulse.z},initVelocityConstraints:function(t){var o,i,s=this.m_bodyA,n=this.m_bodyB;o=s.m_xf.R;var e=this.m_localAnchorA.x-s.m_sweep.localCenter.x,m=this.m_localAnchorA.y-s.m_sweep.localCenter.y;i=o.col1.x*e+o.col2.x*m,m=o.col1.y*e+o.col2.y*m,e=i,o=n.m_xf.R;var a=this.m_localAnchorB.x-n.m_sweep.localCenter.x,c=this.m_localAnchorB.y-n.m_sweep.localCenter.y;i=o.col1.x*a+o.col2.x*c,c=o.col1.y*a+o.col2.y*c,a=i;var l=s.m_invMass,r=n.m_invMass,_=s.m_invI,h=n.m_invI;this.m_mass.col1.x=l+r+m*m*_+c*c*h,this.m_mass.col2.x=-m*e*_-c*a*h,this.m_mass.col3.x=-m*_-c*h,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=l+r+e*e*_+a*a*h,this.m_mass.col3.y=e*_+a*h,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=_+h,t.warmStarting?(this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_impulse.z*=t.dtRatio,s.m_linearVelocity.x-=l*this.m_impulse.x,s.m_linearVelocity.y-=l*this.m_impulse.y,s.m_angularVelocity-=_*(e*this.m_impulse.y-m*this.m_impulse.x+this.m_impulse.z),n.m_linearVelocity.x+=r*this.m_impulse.x,n.m_linearVelocity.y+=r*this.m_impulse.y,n.m_angularVelocity+=h*(a*this.m_impulse.y-c*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.setZero()},solveVelocityConstraints:function(){var t,o,i=this.m_bodyA,s=this.m_bodyB,n=i.m_linearVelocity,e=i.m_angularVelocity,m=s.m_linearVelocity,a=s.m_angularVelocity,c=i.m_invMass,l=s.m_invMass,r=i.m_invI,_=s.m_invI;t=i.m_xf.R;var h=this.m_localAnchorA.x-i.m_sweep.localCenter.x,x=this.m_localAnchorA.y-i.m_sweep.localCenter.y;o=t.col1.x*h+t.col2.x*x,x=t.col1.y*h+t.col2.y*x,h=o,t=s.m_xf.R;var y=this.m_localAnchorB.x-s.m_sweep.localCenter.x,u=this.m_localAnchorB.y-s.m_sweep.localCenter.y;o=t.col1.x*y+t.col2.x*u,u=t.col1.y*y+t.col2.y*u,y=o;var p=m.x-a*u-n.x+e*x,d=m.y+a*y-n.y-e*h,B=a-e,b=new box2D.common.math.B2Vec3;this.m_mass.solve33(b,-p,-d,-B),this.m_impulse.add(b),n.x-=c*b.x,n.y-=c*b.y,e-=r*(h*b.y-x*b.x+b.z),m.x+=l*b.x,m.y+=l*b.y,a+=_*(y*b.y-u*b.x+b.z),i.m_angularVelocity=e,s.m_angularVelocity=a},solvePositionConstraints:function(){var t,o,i=this.m_bodyA,s=this.m_bodyB;t=i.m_xf.R;var n=this.m_localAnchorA.x-i.m_sweep.localCenter.x,e=this.m_localAnchorA.y-i.m_sweep.localCenter.y;o=t.col1.x*n+t.col2.x*e,e=t.col1.y*n+t.col2.y*e,n=o,t=s.m_xf.R;var m=this.m_localAnchorB.x-s.m_sweep.localCenter.x,a=this.m_localAnchorB.y-s.m_sweep.localCenter.y;o=t.col1.x*m+t.col2.x*a,a=t.col1.y*m+t.col2.y*a,m=o;var c=i.m_invMass,l=s.m_invMass,r=i.m_invI,_=s.m_invI,h=s.m_sweep.c.x+m-i.m_sweep.c.x-n,x=s.m_sweep.c.y+a-i.m_sweep.c.y-e,y=s.m_sweep.a-i.m_sweep.a-this.m_referenceAngle,u=10*box2D.common.B2Settings.b2_linearSlop,p=Math.sqrt(h*h+x*x),d=box2D.common.math.B2Math.abs(y);p>u&&(r*=1,_*=1),this.m_mass.col1.x=c+l+e*e*r+a*a*_,this.m_mass.col2.x=-e*n*r-a*m*_,this.m_mass.col3.x=-e*r-a*_,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=c+l+n*n*r+m*m*_,this.m_mass.col3.y=n*r+m*_,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=r+_;var B=new box2D.common.math.B2Vec3;return this.m_mass.solve33(B,-h,-x,-y),i.m_sweep.c.x-=c*B.x,i.m_sweep.c.y-=c*B.y,i.m_sweep.a-=r*(n*B.y-e*B.x+B.z),s.m_sweep.c.x+=l*B.x,s.m_sweep.c.y+=l*B.y,s.m_sweep.a+=_*(m*B.y-a*B.x+B.z),i.synchronizeTransform(),s.synchronizeTransform(),p<=box2D.common.B2Settings.b2_linearSlop&&d<=box2D.common.B2Settings.b2_angularSlop},__class__:box2D.dynamics.joints.B2WeldJoint}),box2D.dynamics.joints.B2WeldJointDef=function(){box2D.dynamics.joints.B2JointDef.call(this),this.localAnchorA=new box2D.common.math.B2Vec2,this.localAnchorB=new box2D.common.math.B2Vec2,this.type=box2D.dynamics.joints.B2Joint.e_weldJoint,this.referenceAngle=0},box2D.dynamics.joints.B2WeldJointDef.__name__=!0,box2D.dynamics.joints.B2WeldJointDef.__super__=box2D.dynamics.joints.B2JointDef,box2D.dynamics.joints.B2WeldJointDef.prototype=$extend(box2D.dynamics.joints.B2JointDef.prototype,{initialize:function(t,o,i){this.bodyA=t,this.bodyB=o,this.localAnchorA.setV(this.bodyA.getLocalPoint(i)),this.localAnchorB.setV(this.bodyB.getLocalPoint(i)),this.referenceAngle=this.bodyB.getAngle()-this.bodyA.getAngle()},__class__:box2D.dynamics.joints.B2WeldJointDef});